diff --git a/package.json b/package.json
index 9b666d3..b133c6d 100644
--- a/package.json
+++ b/package.json
@@ -49,13 +49,11 @@
   },
   "homepage": "https://github.com/TypeStrong/ts-node",
   "devDependencies": {
-    "@types/react": "^15.0.38",
     "chai": "^4.0.1",
     "istanbul": "^0.4.0",
     "mocha": "^3.0.0",
     "ntypescript": "^1.201507091536.1",
     "proxyquire": "^1.7.2",
-    "react": "^15.6.1",
     "rimraf": "^2.5.4",
     "semver": "^5.1.0",
     "tslint": "^5.0.0",
diff --git a/src/index.spec.ts b/src/index.spec.ts
index f80d0e3..60edd28 100644
--- a/src/index.spec.ts
+++ b/src/index.spec.ts
@@ -10,8 +10,6 @@ const testDir = join(__dirname, '../tests')
 const EXEC_PATH = join(__dirname, '../dist/bin')
 const BIN_EXEC = `node "${EXEC_PATH}" --project "${testDir}"`
 
-const SOURCE_MAP_REGEXP = /\/\/# sourceMappingURL=data:application\/json;charset=utf\-8;base64,[\w\+]+=*$/
-
 describe('ts-node', function () {
   this.timeout(10000)
 
@@ -179,7 +177,7 @@ describe('ts-node', function () {
     })
 
     it('should pipe into an eval script', function (done) {
-      const cp = exec(`${BIN_EXEC} --fast -p 'process.stdin.isTTY'`, function (err, stdout) {
+      const cp = exec(`${BIN_EXEC} -p 'declare var process: any\nprocess.stdin.isTTY'`, function (err, stdout) {
         expect(err).to.equal(null)
         expect(stdout).to.equal('undefined\n')
 
@@ -206,15 +204,6 @@ describe('ts-node', function () {
         return done()
       })
     })
-
-    it.skip('should use source maps with react tsx', function (done) {
-      exec(`${BIN_EXEC} -r ./tests/emit-compiled.ts tests/jsx-react.tsx`, function (err, stdout) {
-        expect(err).to.equal(null)
-        expect(stdout).to.equal('todo')
-
-        return done()
-      })
-    })
   })
 
   describe('register', function () {
@@ -270,7 +259,6 @@ describe('ts-node', function () {
             compiled = code
             return _compile.call(this, code, fileName)
           }
-
           return old(m, fileName)
         }
       })
@@ -284,11 +272,8 @@ describe('ts-node', function () {
           require('../tests/with-jsx.tsx')
         } catch (error) {
           expect(error.stack).to.contain('SyntaxError: Unexpected token <\n')
+          done()
         }
-
-        expect(compiled).to.match(SOURCE_MAP_REGEXP)
-
-        done()
       })
     })
   })
diff --git a/src/index.ts b/src/index.ts
index bde082a..708432b 100644
--- a/src/index.ts
+++ b/src/index.ts
@@ -510,7 +510,7 @@ function updateOutput (outputText: string, fileName: string, sourceMap: string)
   const base64Map = new Buffer(updateSourceMap(sourceMap, fileName), 'utf8').toString('base64')
   const sourceMapContent = `data:application/json;charset=utf-8;base64,${base64Map}`
 
-  return outputText.replace(/[^=]+$/, sourceMapContent)
+  return outputText.slice(0, -1 * (basename(fileName).length + 4)) + sourceMapContent
 }
 
 /**
diff --git a/tests/emit-compiled.ts b/tests/emit-compiled.ts
deleted file mode 100644
index c2eeffd..0000000
--- a/tests/emit-compiled.ts
+++ /dev/null
@@ -1,16 +0,0 @@
-const extensions = ['.tsx']
-
-extensions.forEach(ext => {
-  const old = require.extensions[ext]
-
-  require.extensions[ext] = (m, path) => {
-    const _compile = m._compile
-
-    m._compile = (code, path) => {
-      console.log(code)
-      return _compile.call(this, code, path)
-    }
-
-    return old(m, path)
-  }
-})
diff --git a/tests/jsx-react.tsx b/tests/jsx-react.tsx
deleted file mode 100644
index 82d3094..0000000
--- a/tests/jsx-react.tsx
+++ /dev/null
@@ -1,7 +0,0 @@
-import * as React from 'react'
-
-const Component = props => {
-  return <div />
-}
-
-export default Component
diff --git a/tests/tsconfig.json b/tests/tsconfig.json
index 5e30d3c..d946318 100644
--- a/tests/tsconfig.json
+++ b/tests/tsconfig.json
@@ -1,8 +1,3 @@
 {
-  "compilerOptions": {
-    "jsx": "react"
-  },
-  "files": [
-    "../typings/globals/node/index.d.ts"
-  ]
+  "files": []
 }
diff --git a/tsconfig.json b/tsconfig.json
index e0126d8..61f78ac 100644
--- a/tsconfig.json
+++ b/tsconfig.json
@@ -12,8 +12,7 @@
     "noUnusedParameters": true,
     "moduleResolution": "node",
     "sourceMap": true,
-    "inlineSources": true,
-    "types": []
+    "inlineSources": true
   },
   "include": [
     "src/**/*",
