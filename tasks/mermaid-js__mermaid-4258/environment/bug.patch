diff --git a/cypress/integration/rendering/erDiagram.spec.js b/cypress/integration/rendering/erDiagram.spec.js
index faa511626..df1fac0cd 100644
--- a/cypress/integration/rendering/erDiagram.spec.js
+++ b/cypress/integration/rendering/erDiagram.spec.js
@@ -10,6 +10,7 @@ describe('Entity Relationship Diagram', () => {
       `,
       { logLevel: 1 }
     );
+    cy.get('svg');
   });
 
   it('should render an ER diagram with a recursive relationship', () => {
@@ -22,6 +23,7 @@ describe('Entity Relationship Diagram', () => {
       `,
       { logLevel: 1 }
     );
+    cy.get('svg');
   });
 
   it('should render an ER diagram with multiple relationships between the same two entities', () => {
@@ -33,6 +35,7 @@ describe('Entity Relationship Diagram', () => {
       `,
       { logLevel: 1 }
     );
+    cy.get('svg');
   });
 
   it('should render a cyclical ER diagram', () => {
@@ -45,6 +48,7 @@ describe('Entity Relationship Diagram', () => {
       `,
       { logLevel: 1 }
     );
+    cy.get('svg');
   });
 
   it('should render a not-so-simple ER diagram', () => {
@@ -62,6 +66,7 @@ describe('Entity Relationship Diagram', () => {
       `,
       { logLevel: 1 }
     );
+    cy.get('svg');
   });
 
   it('should render multiple ER diagrams', () => {
@@ -80,6 +85,7 @@ describe('Entity Relationship Diagram', () => {
       ],
       { logLevel: 1 }
     );
+    cy.get('svg');
   });
 
   it('should render an ER diagram with blank or empty labels', () => {
@@ -92,6 +98,7 @@ describe('Entity Relationship Diagram', () => {
       `,
       { logLevel: 1 }
     );
+    cy.get('svg');
   });
 
   it('should render an ER diagrams when useMaxWidth is true (default)', () => {
@@ -144,6 +151,7 @@ describe('Entity Relationship Diagram', () => {
       `,
       { er: { useMaxWidth: false } }
     );
+    cy.get('svg');
   });
 
   it('should render entities with and without attributes', () => {
@@ -156,6 +164,7 @@ describe('Entity Relationship Diagram', () => {
       `,
       { logLevel: 1 }
     );
+    cy.get('svg');
   });
 
   it('should render entities with generic and array attributes', () => {
@@ -170,6 +179,7 @@ describe('Entity Relationship Diagram', () => {
       `,
       { logLevel: 1 }
     );
+    cy.get('svg');
   });
 
   it('should render entities with length in attributes type', () => {
@@ -183,6 +193,7 @@ describe('Entity Relationship Diagram', () => {
       `,
       { logLevel: 1 }
     );
+    cy.get('svg');
   });
 
   it('should render entities and attributes with big and small entity names', () => {
@@ -198,6 +209,7 @@ describe('Entity Relationship Diagram', () => {
       `,
       { logLevel: 1 }
     );
+    cy.get('svg');
   });
 
   it('should render entities with keys', () => {
@@ -216,6 +228,7 @@ describe('Entity Relationship Diagram', () => {
       `,
       { logLevel: 1 }
     );
+    cy.get('svg');
   });
 
   it('should render entities with comments', () => {
@@ -234,6 +247,7 @@ describe('Entity Relationship Diagram', () => {
       `,
       { logLevel: 1 }
     );
+    cy.get('svg');
   });
 
   it('should render entities with keys and comments', () => {
@@ -253,6 +267,7 @@ describe('Entity Relationship Diagram', () => {
       `,
       { logLevel: 1 }
     );
+    cy.get('svg');
   });
 
   it('should render entities with aliases', () => {
@@ -270,6 +285,7 @@ describe('Entity Relationship Diagram', () => {
       `,
       { logLevel: 1 }
     );
+    cy.get('svg');
   });
 
   it('1433: should render a simple ER diagram with a title', () => {
diff --git a/cypress/integration/rendering/errorDiagram.spec.js b/cypress/integration/rendering/errorDiagram.spec.js
deleted file mode 100644
index e837565d3..000000000
--- a/cypress/integration/rendering/errorDiagram.spec.js
+++ /dev/null
@@ -1,45 +0,0 @@
-import { imgSnapshotTest } from '../../helpers/util';
-
-describe('Error Diagrams', () => {
-  beforeEach(() => {
-    cy.on('uncaught:exception', (err) => {
-      expect(err.message).to.include('Parse error');
-      // return false to prevent the error from
-      // failing this test
-      return false;
-    });
-  });
-
-  it('should render a simple ER diagram', () => {
-    imgSnapshotTest(
-      `
-      error
-      `,
-      { logLevel: 1 }
-    );
-  });
-
-  it('should render error diagram for actual errors', () => {
-    imgSnapshotTest(
-      `
-    flowchart TD
-      A[Christmas] --|Get money| B(Go shopping)
-      `,
-      { logLevel: 1 }
-    );
-  });
-
-  it('should render error for wrong ER diagram', () => {
-    imgSnapshotTest(
-      `
-    erDiagram
-        ATLAS-ORGANIZATION ||--|{ ATLAS-PROJECTS : "has many"
-        ATLAS-PROJECTS ||--|{ MONGODB-CLUSTERS : "has many"
-        ATLAS-PROJECTS ||--|{ ATLAS-TEAMS : "has many"
-        MONGODB-CLUSTERS ||..|{
-        ATLAS-TEAMS ||..|{
-      `,
-      { logLevel: 1 }
-    );
-  });
-});
diff --git a/cypress/platform/viewer.js b/cypress/platform/viewer.js
index 99533192d..2e1093519 100644
--- a/cypress/platform/viewer.js
+++ b/cypress/platform/viewer.js
@@ -47,6 +47,7 @@ const contentLoaded = async function () {
     await mermaid2.registerExternalDiagrams([externalExample]);
     mermaid2.initialize(graphObj.mermaid);
     await mermaid2.run();
+    markRendered();
   }
 };
 
@@ -122,6 +123,7 @@ const contentLoadedApi = async function () {
       bindFunctions(div);
     }
   }
+  markRendered();
 };
 
 if (typeof document !== 'undefined') {
@@ -133,10 +135,10 @@ if (typeof document !== 'undefined') {
     function () {
       if (this.location.href.match('xss.html')) {
         this.console.log('Using api');
-        void contentLoadedApi().finally(markRendered);
+        void contentLoadedApi();
       } else {
         this.console.log('Not using api');
-        void contentLoaded().finally(markRendered);
+        void contentLoaded();
       }
     },
     false
diff --git a/demos/error.html b/demos/error.html
deleted file mode 100644
index 2d6d1b01f..000000000
--- a/demos/error.html
+++ /dev/null
@@ -1,38 +0,0 @@
-<!DOCTYPE html>
-<html lang="en">
-  <head>
-    <meta charset="utf-8" />
-    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
-    <title>Error | Mermaid Quick Test Page</title>
-    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo=" />
-  </head>
-
-  <body>
-    <pre class="mermaid">
-      erDiagram
-        ATLAS-ORGANIZATION ||--|{ ATLAS-PROJECTS : "has many"
-        ATLAS-PROJECTS ||--|{ MONGODB-CLUSTERS : "has many"
-        ATLAS-PROJECTS ||--|{ ATLAS-TEAMS : "has many"
-    </pre>
-    <pre class="mermaid">
-      erDiagram
-        ATLAS-ORGANIZATION ||--|{ ATLAS-PROJECTS : "has many"
-        ATLAS-PROJECTS ||--|{ MONGODB-CLUSTERS : "has many"
-        ATLAS-PROJECTS ||--|{ ATLAS-TEAMS : "has many"
-        MONGODB-CLUSTERS ||..|{
-        ATLAS-TEAMS ||..|{
-    </pre>
-    <hr />
-    <pre class="mermaid">
-    flowchart TD
-      A[Christmas] -->|Get money| B(Go shopping)
-    </pre>
-    <pre class="mermaid">
-    flowchart TD
-      A[Christmas] --|Get money| B(Go shopping)
-    </pre>
-    <script type="module">
-      import mermaid from './mermaid.esm.mjs';
-    </script>
-  </body>
-</html>
diff --git a/packages/mermaid/src/diagram-api/diagram-orchestration.ts b/packages/mermaid/src/diagram-api/diagram-orchestration.ts
index a88a34f19..73bfcf084 100644
--- a/packages/mermaid/src/diagram-api/diagram-orchestration.ts
+++ b/packages/mermaid/src/diagram-api/diagram-orchestration.ts
@@ -13,7 +13,7 @@ import classDiagramV2 from '../diagrams/class/classDetector-V2';
 import state from '../diagrams/state/stateDetector';
 import stateV2 from '../diagrams/state/stateDetector-V2';
 import journey from '../diagrams/user-journey/journeyDetector';
-import errorDiagram from '../diagrams/error/errorDiagram';
+import error from '../diagrams/error/errorDetector';
 import flowchartElk from '../diagrams/flowchart/elk/detector';
 import timeline from '../diagrams/timeline/detector';
 import mindmap from '../diagrams/mindmap/detector';
@@ -28,9 +28,6 @@ export const addDiagrams = () => {
   // This is added here to avoid race-conditions.
   // We could optimize the loading logic somehow.
   hasLoadedDiagrams = true;
-  registerDiagram('error', errorDiagram, (text) => {
-    return text.toLowerCase().trim() === 'error';
-  });
   registerDiagram(
     '---',
     // --- diagram type may appear if YAML front-matter is not parsed correctly
@@ -60,6 +57,7 @@ export const addDiagrams = () => {
   );
   // Ordering of detectors is important. The first one to return true will be used.
   registerLazyLoadedDiagrams(
+    error,
     c4,
     classDiagramV2,
     classDiagram,
diff --git a/packages/mermaid/src/diagrams/error/errorDetector.ts b/packages/mermaid/src/diagrams/error/errorDetector.ts
new file mode 100644
index 000000000..2bdcd7028
--- /dev/null
+++ b/packages/mermaid/src/diagrams/error/errorDetector.ts
@@ -0,0 +1,20 @@
+import type { DiagramDetector, ExternalDiagramDefinition } from '../../diagram-api/types';
+
+const id = 'error';
+
+const detector: DiagramDetector = (text) => {
+  return text.toLowerCase().trim() === 'error';
+};
+
+const loader = async () => {
+  const { diagram } = await import('./errorDiagram');
+  return { id, diagram };
+};
+
+const plugin: ExternalDiagramDefinition = {
+  id,
+  detector,
+  loader,
+};
+
+export default plugin;
diff --git a/packages/mermaid/src/diagrams/error/errorDiagram.ts b/packages/mermaid/src/diagrams/error/errorDiagram.ts
index 7b9f18c3b..d081e1028 100644
--- a/packages/mermaid/src/diagrams/error/errorDiagram.ts
+++ b/packages/mermaid/src/diagrams/error/errorDiagram.ts
@@ -19,5 +19,3 @@ export const diagram: DiagramDefinition = {
     // no op
   },
 };
-
-export default diagram;
diff --git a/packages/mermaid/src/diagrams/error/errorRenderer.ts b/packages/mermaid/src/diagrams/error/errorRenderer.ts
index 046bcfdcf..60877cb8d 100644
--- a/packages/mermaid/src/diagrams/error/errorRenderer.ts
+++ b/packages/mermaid/src/diagrams/error/errorRenderer.ts
@@ -4,13 +4,15 @@ import { select } from 'd3';
 import { log } from '../../logger';
 import { getErrorMessage } from '../../utils';
 
+let conf = {};
+
 /**
  * Merges the value of `conf` with the passed `cnf`
  *
  * @param cnf - Config to merge
  */
-export const setConf = function () {
-  // no-op
+export const setConf = function (cnf: any) {
+  conf = { ...conf, ...cnf };
 };
 
 /**
@@ -76,7 +78,7 @@ export const draw = (_text: string, id: string, mermaidVersion: string) => {
       .attr('y', 250)
       .attr('font-size', '150px')
       .style('text-anchor', 'middle')
-      .text('Syntax error in text');
+      .text('Syntax error in graph');
     g.append('text') // text label for the x axis
       .attr('class', 'error-text')
       .attr('x', 1250)
diff --git a/packages/mermaid/src/mermaidAPI.ts b/packages/mermaid/src/mermaidAPI.ts
index 520bf8b4e..dba629477 100644
--- a/packages/mermaid/src/mermaidAPI.ts
+++ b/packages/mermaid/src/mermaidAPI.ts
@@ -534,10 +534,6 @@ const render = async function (
 
   attachFunctions();
 
-  if (parseEncounteredException) {
-    throw parseEncounteredException;
-  }
-
   // -------------------------------------------------------------------------------
   // Remove the temporary HTML element if appropriate
   const tmpElementSelector = isSandboxed ? iFrameID_selector : enclosingDivID_selector;
@@ -546,6 +542,10 @@ const render = async function (
     node.remove();
   }
 
+  if (parseEncounteredException) {
+    throw parseEncounteredException;
+  }
+
   return {
     svg: svgCode,
     bindFunctions: diag.db.bindFunctions,
