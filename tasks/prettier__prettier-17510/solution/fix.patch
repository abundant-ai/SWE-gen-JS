diff --git a/changelog_unreleased/javascript/17510.md b/changelog_unreleased/javascript/17510.md
new file mode 100644
index 000000000..fa083e2d9
--- /dev/null
+++ b/changelog_unreleased/javascript/17510.md
@@ -0,0 +1,21 @@
+#### Fix unstable comment format in tagged template literal (#17510 by @fisker)
+
+<!-- prettier-ignore -->
+```js
+// Input
+foo
+  // Comment
+  `x`
+
+// Prettier stable (First format)
+foo// Comment
+`x`;
+
+// Prettier stable (Second format)
+foo // Comment
+`x`;
+
+// Prettier main
+foo // Comment
+`x`;
+```
diff --git a/package.json b/package.json
index 657587e70..79391c79a 100644
--- a/package.json
+++ b/package.json
@@ -53,7 +53,7 @@
     "css-units-list": "2.1.0",
     "dashify": "2.0.0",
     "deno-path-from-file-url": "0.0.2",
-    "diff": "8.0.2",
+    "diff": "8.0.1",
     "editorconfig": "0.15.3",
     "emoji-regex": "10.4.0",
     "escape-string-regexp": "5.0.0",
diff --git a/src/index.js b/src/index.js
index cf06e88c9..29804c9f6 100644
--- a/src/index.js
+++ b/src/index.js
@@ -5,7 +5,7 @@ The following are bundled here since they are used in API too
 - leven
 - picocolors
 */
-import { createTwoFilesPatch } from "diff";
+import { createTwoFilesPatch } from "diff/lib/patch/create.js";
 import fastGlob from "fast-glob";
 import leven from "leven";
 import picocolors from "picocolors";
diff --git a/src/language-js/print/estree.js b/src/language-js/print/estree.js
index 2c4dd94c9..6a237d855 100644
--- a/src/language-js/print/estree.js
+++ b/src/language-js/print/estree.js
@@ -632,7 +632,7 @@ function printEstree(path, options, print, args) {
     case "TemplateLiteral":
       return printTemplateLiteral(path, options, print);
     case "TaggedTemplateExpression":
-      return printTaggedTemplateLiteral(path, print);
+      return printTaggedTemplateLiteral(path, options, print);
     case "PrivateIdentifier":
       return ["#", node.name];
     case "PrivateName":
diff --git a/src/language-js/print/template-literal.js b/src/language-js/print/template-literal.js
index db81d5a9d..3a8d1ecc1 100644
--- a/src/language-js/print/template-literal.js
+++ b/src/language-js/print/template-literal.js
@@ -16,12 +16,18 @@ import getStringWidth from "../../utils/get-string-width.js";
 import hasNewlineInRange from "../../utils/has-newline-in-range.js";
 import { locEnd, locStart } from "../loc.js";
 import {
+  CommentCheckFlags,
+  getComments,
   hasComment,
   isBinaryCastExpression,
   isBinaryish,
   isMemberExpression,
 } from "../utils/index.js";
 
+/**
+ * @import {Doc} from "../../document/builders.js"
+ */
+
 function printTemplateLiteral(path, options, print) {
   const { node } = path;
   const isTemplateLiteral = node.type === "TemplateLiteral";
@@ -122,11 +128,34 @@ function printTemplateLiteral(path, options, print) {
   return parts;
 }
 
-function printTaggedTemplateLiteral(path, print) {
+function printTaggedTemplateLiteral(path, options, print) {
   const quasiDoc = print("quasi");
+  const { node } = path;
+
+  /** @type {Doc} */
+  let space = "";
+  const quasiLeadingComment = getComments(
+    node.quasi,
+    CommentCheckFlags.Leading,
+  )[0];
+  if (quasiLeadingComment) {
+    if (
+      hasNewlineInRange(
+        options.originalText,
+        locEnd(node.typeArguments ?? node.typeParameters ?? node.tag),
+        locStart(quasiLeadingComment),
+      )
+    ) {
+      space = softline;
+    } else {
+      space = " ";
+    }
+  }
+
   return label(quasiDoc.label && { tagged: true, ...quasiDoc.label }, [
     print("tag"),
-    print(path.node.typeArguments ? "typeArguments" : "typeParameters"),
+    print(node.typeArguments ? "typeArguments" : "typeParameters"),
+    space,
     lineSuffixBoundary,
     quasiDoc,
   ]);
diff --git a/src/main/core.js b/src/main/core.js
index 193da4fa5..c60d23bdf 100644
--- a/src/main/core.js
+++ b/src/main/core.js
@@ -1,4 +1,4 @@
-import { diffArrays } from "diff";
+import { diffArrays } from "diff/lib/diff/array.js";
 import {
   convertEndOfLineToChars,
   countEndOfLineChars,
diff --git a/yarn.lock b/yarn.lock
index 548ec532f..ee241bbd8 100644
--- a/yarn.lock
+++ b/yarn.lock
@@ -3412,10 +3412,10 @@ __metadata:
   languageName: node
   linkType: hard
 
-"diff@npm:8.0.2":
-  version: 8.0.2
-  resolution: "diff@npm:8.0.2"
-  checksum: 10/82a2120d3418f97822e17a6044ccd4b99a91e26e145e8698353673d7146bd2d092bbebb79c112aae7badc7b9c526f9098cbe342f96174feb6beabdd2587b3c42
+"diff@npm:8.0.1":
+  version: 8.0.1
+  resolution: "diff@npm:8.0.1"
+  checksum: 10/1f56c913dc48ad85dcd83ac374d43b0acda6c4a25dc32660f65988fcd2c2f2d8f6cc9cddb58a268513e0bf1bff139b028c42cabec5dfeeb7e0af68830ce8787a
   languageName: node
   linkType: hard
 
@@ -7027,7 +7027,7 @@ __metadata:
     css-units-list: "npm:2.1.0"
     dashify: "npm:2.0.0"
     deno-path-from-file-url: "npm:0.0.2"
-    diff: "npm:8.0.2"
+    diff: "npm:8.0.1"
     editorconfig: "npm:0.15.3"
     emoji-regex: "npm:10.4.0"
     enquirer: "npm:2.4.1"
