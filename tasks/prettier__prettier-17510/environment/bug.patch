diff --git a/.github/workflows/prod-test.yml b/.github/workflows/prod-test.yml
index 9dfb7e996..ce83197f6 100644
--- a/.github/workflows/prod-test.yml
+++ b/.github/workflows/prod-test.yml
@@ -155,7 +155,7 @@ jobs:
         run: node dist/prettier/bin/prettier.cjs --version 2>&1 >/dev/null | grep "prettier requires at least version 14 of Node, please upgrade" || exit 1
 
   preview:
-    if: github.event_name == 'pull_request' && github.repository == 'prettier/prettier'
+    if: github.repository == 'prettier/prettier'
     name: Preview release
     runs-on: ubuntu-latest
     needs: [build]
@@ -177,5 +177,4 @@ jobs:
 
       - name: Release
         run: |
-          npx pkg-pr-new publish --compact
-        working-directory: dist/prettier
+          npx pkg-pr-new publish "./dist/*" --compact --packageManager=yarn
diff --git a/changelog_unreleased/javascript/17510.md b/changelog_unreleased/javascript/17510.md
deleted file mode 100644
index fa083e2d9..000000000
--- a/changelog_unreleased/javascript/17510.md
+++ /dev/null
@@ -1,21 +0,0 @@
-#### Fix unstable comment format in tagged template literal (#17510 by @fisker)
-
-<!-- prettier-ignore -->
-```js
-// Input
-foo
-  // Comment
-  `x`
-
-// Prettier stable (First format)
-foo// Comment
-`x`;
-
-// Prettier stable (Second format)
-foo // Comment
-`x`;
-
-// Prettier main
-foo // Comment
-`x`;
-```
diff --git a/package.json b/package.json
index 79391c79a..657587e70 100644
--- a/package.json
+++ b/package.json
@@ -53,7 +53,7 @@
     "css-units-list": "2.1.0",
     "dashify": "2.0.0",
     "deno-path-from-file-url": "0.0.2",
-    "diff": "8.0.1",
+    "diff": "8.0.2",
     "editorconfig": "0.15.3",
     "emoji-regex": "10.4.0",
     "escape-string-regexp": "5.0.0",
diff --git a/src/index.js b/src/index.js
index 29804c9f6..cf06e88c9 100644
--- a/src/index.js
+++ b/src/index.js
@@ -5,7 +5,7 @@ The following are bundled here since they are used in API too
 - leven
 - picocolors
 */
-import { createTwoFilesPatch } from "diff/lib/patch/create.js";
+import { createTwoFilesPatch } from "diff";
 import fastGlob from "fast-glob";
 import leven from "leven";
 import picocolors from "picocolors";
diff --git a/src/language-js/print/estree.js b/src/language-js/print/estree.js
index 6a237d855..2c4dd94c9 100644
--- a/src/language-js/print/estree.js
+++ b/src/language-js/print/estree.js
@@ -632,7 +632,7 @@ function printEstree(path, options, print, args) {
     case "TemplateLiteral":
       return printTemplateLiteral(path, options, print);
     case "TaggedTemplateExpression":
-      return printTaggedTemplateLiteral(path, options, print);
+      return printTaggedTemplateLiteral(path, print);
     case "PrivateIdentifier":
       return ["#", node.name];
     case "PrivateName":
diff --git a/src/language-js/print/template-literal.js b/src/language-js/print/template-literal.js
index 3a8d1ecc1..db81d5a9d 100644
--- a/src/language-js/print/template-literal.js
+++ b/src/language-js/print/template-literal.js
@@ -16,18 +16,12 @@ import getStringWidth from "../../utils/get-string-width.js";
 import hasNewlineInRange from "../../utils/has-newline-in-range.js";
 import { locEnd, locStart } from "../loc.js";
 import {
-  CommentCheckFlags,
-  getComments,
   hasComment,
   isBinaryCastExpression,
   isBinaryish,
   isMemberExpression,
 } from "../utils/index.js";
 
-/**
- * @import {Doc} from "../../document/builders.js"
- */
-
 function printTemplateLiteral(path, options, print) {
   const { node } = path;
   const isTemplateLiteral = node.type === "TemplateLiteral";
@@ -128,34 +122,11 @@ function printTemplateLiteral(path, options, print) {
   return parts;
 }
 
-function printTaggedTemplateLiteral(path, options, print) {
+function printTaggedTemplateLiteral(path, print) {
   const quasiDoc = print("quasi");
-  const { node } = path;
-
-  /** @type {Doc} */
-  let space = "";
-  const quasiLeadingComment = getComments(
-    node.quasi,
-    CommentCheckFlags.Leading,
-  )[0];
-  if (quasiLeadingComment) {
-    if (
-      hasNewlineInRange(
-        options.originalText,
-        locEnd(node.typeArguments ?? node.typeParameters ?? node.tag),
-        locStart(quasiLeadingComment),
-      )
-    ) {
-      space = softline;
-    } else {
-      space = " ";
-    }
-  }
-
   return label(quasiDoc.label && { tagged: true, ...quasiDoc.label }, [
     print("tag"),
-    print(node.typeArguments ? "typeArguments" : "typeParameters"),
-    space,
+    print(path.node.typeArguments ? "typeArguments" : "typeParameters"),
     lineSuffixBoundary,
     quasiDoc,
   ]);
diff --git a/src/main/core.js b/src/main/core.js
index c60d23bdf..193da4fa5 100644
--- a/src/main/core.js
+++ b/src/main/core.js
@@ -1,4 +1,4 @@
-import { diffArrays } from "diff/lib/diff/array.js";
+import { diffArrays } from "diff";
 import {
   convertEndOfLineToChars,
   countEndOfLineChars,
diff --git a/tests/config/run-format-test.js b/tests/config/run-format-test.js
index 0379bda7b..e4ae5c103 100644
--- a/tests/config/run-format-test.js
+++ b/tests/config/run-format-test.js
@@ -385,12 +385,6 @@ async function runTest({
       formatOptions,
     );
     if (isUnstableTest) {
-      if (secondOutput === firstOutput) {
-        throw new Error(
-          `Unstable file '${filename}' is stable now, please remove from the 'unstableTests' list.`,
-        );
-      }
-
       // To keep eye on failed tests, this assert never supposed to pass,
       // if it fails, just remove the file from `unstableTests`
       expect(secondOutput).not.toEqual(firstOutput);
diff --git a/tests/format/js/comments/__snapshots__/format.test.js.snap b/tests/format/js/comments/__snapshots__/format.test.js.snap
index 43f6dd038..d0452304f 100644
--- a/tests/format/js/comments/__snapshots__/format.test.js.snap
+++ b/tests/format/js/comments/__snapshots__/format.test.js.snap
@@ -6133,36 +6133,36 @@ printWidth: 80
 semi: false
                                                                                 | printWidth
 =====================================input======================================
-foo\`\`; // comment 1
+foo\`\`; // comment
 
-foo // comment 2
+foo // comment
 \`\`;
 
-foo // comment 3
+foo // comment
 \`
 \`;
 
-foo /* comment 4 */\`
+foo /* comment */\`
 \`;
 
-foo /* comment 5 */
+foo /* comment */
 \`
 \`;
 
 =====================================output=====================================
-foo\`\` // comment 1
+foo\`\` // comment
 
-foo // comment 2
+foo // comment
 \`\`
 
-foo // comment 3
+foo // comment
 \`
 \`
 
-foo /* comment 4 */ \`
+foo/* comment */ \`
 \`
 
-foo /* comment 5 */\`
+foo /* comment */\`
 \`
 
 ================================================================================
@@ -6174,36 +6174,36 @@ parsers: ["babel", "flow", "typescript"]
 printWidth: 80
                                                                                 | printWidth
 =====================================input======================================
-foo\`\`; // comment 1
+foo\`\`; // comment
 
-foo // comment 2
+foo // comment
 \`\`;
 
-foo // comment 3
+foo // comment
 \`
 \`;
 
-foo /* comment 4 */\`
+foo /* comment */\`
 \`;
 
-foo /* comment 5 */
+foo /* comment */
 \`
 \`;
 
 =====================================output=====================================
-foo\`\`; // comment 1
+foo\`\`; // comment
 
-foo // comment 2
+foo // comment
 \`\`;
 
-foo // comment 3
+foo // comment
 \`
 \`;
 
-foo /* comment 4 */ \`
+foo/* comment */ \`
 \`;
 
-foo /* comment 5 */\`
+foo /* comment */\`
 \`;
 
 ================================================================================
diff --git a/tests/format/js/comments/tagged-template-literal.js b/tests/format/js/comments/tagged-template-literal.js
index 7afab7961..11e997445 100644
--- a/tests/format/js/comments/tagged-template-literal.js
+++ b/tests/format/js/comments/tagged-template-literal.js
@@ -1,15 +1,15 @@
-foo``; // comment 1
+foo``; // comment
 
-foo // comment 2
+foo // comment
 ``;
 
-foo // comment 3
+foo // comment
 `
 `;
 
-foo /* comment 4 */`
+foo /* comment */`
 `;
 
-foo /* comment 5 */
+foo /* comment */
 `
 `;
diff --git a/tests/format/js/comments/tagged-template-literal/11662.js b/tests/format/js/comments/tagged-template-literal/11662.js
deleted file mode 100644
index 771ddae47..000000000
--- a/tests/format/js/comments/tagged-template-literal/11662.js
+++ /dev/null
@@ -1,8 +0,0 @@
-foo
-  // TEST
-  // 1
-  // 2
-  // 3
-  // 4
-  // 5
-  `x`
diff --git a/tests/format/js/comments/tagged-template-literal/__snapshots__/format.test.js.snap b/tests/format/js/comments/tagged-template-literal/__snapshots__/format.test.js.snap
deleted file mode 100644
index a65d610ff..000000000
--- a/tests/format/js/comments/tagged-template-literal/__snapshots__/format.test.js.snap
+++ /dev/null
@@ -1,29 +0,0 @@
-// Jest Snapshot v1, https://goo.gl/fbAQLP
-
-exports[`11662.js format 1`] = `
-====================================options=====================================
-parsers: ["babel", "flow", "typescript"]
-printWidth: 80
-                                                                                | printWidth
-=====================================input======================================
-foo
-  // TEST
-  // 1
-  // 2
-  // 3
-  // 4
-  // 5
-  \`x\`
-
-=====================================output=====================================
-foo
-// TEST
-// 1
-// 2
-// 3
-// 4
-// 5
-\`x\`;
-
-================================================================================
-`;
diff --git a/tests/format/js/comments/tagged-template-literal/format.test.js b/tests/format/js/comments/tagged-template-literal/format.test.js
deleted file mode 100644
index 67c251cce..000000000
--- a/tests/format/js/comments/tagged-template-literal/format.test.js
+++ /dev/null
@@ -1 +0,0 @@
-runFormatTest(import.meta, ["babel", "flow", "typescript"]);
diff --git a/tests/format/typescript/comments/11662.ts b/tests/format/typescript/comments/11662.ts
deleted file mode 100644
index fa08ca257..000000000
--- a/tests/format/typescript/comments/11662.ts
+++ /dev/null
@@ -1,8 +0,0 @@
-foo<a>
-  // TEST
-  // 1
-  // 2
-  // 3
-  // 4
-  // 5
-  `x`
diff --git a/tests/format/typescript/comments/__snapshots__/format.test.js.snap b/tests/format/typescript/comments/__snapshots__/format.test.js.snap
index e09c788b6..5d8c59465 100644
--- a/tests/format/typescript/comments/__snapshots__/format.test.js.snap
+++ b/tests/format/typescript/comments/__snapshots__/format.test.js.snap
@@ -1,33 +1,5 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`11662.ts format 1`] = `
-====================================options=====================================
-parsers: ["typescript"]
-printWidth: 80
-                                                                                | printWidth
-=====================================input======================================
-foo<a>
-  // TEST
-  // 1
-  // 2
-  // 3
-  // 4
-  // 5
-  \`x\`
-
-=====================================output=====================================
-foo<a>
-// TEST
-// 1
-// 2
-// 3
-// 4
-// 5
-\`x\`;
-
-================================================================================
-`;
-
 exports[`15707.ts format 1`] = `
 ====================================options=====================================
 parsers: ["typescript"]
diff --git a/yarn.lock b/yarn.lock
index ee241bbd8..548ec532f 100644
--- a/yarn.lock
+++ b/yarn.lock
@@ -3412,10 +3412,10 @@ __metadata:
   languageName: node
   linkType: hard
 
-"diff@npm:8.0.1":
-  version: 8.0.1
-  resolution: "diff@npm:8.0.1"
-  checksum: 10/1f56c913dc48ad85dcd83ac374d43b0acda6c4a25dc32660f65988fcd2c2f2d8f6cc9cddb58a268513e0bf1bff139b028c42cabec5dfeeb7e0af68830ce8787a
+"diff@npm:8.0.2":
+  version: 8.0.2
+  resolution: "diff@npm:8.0.2"
+  checksum: 10/82a2120d3418f97822e17a6044ccd4b99a91e26e145e8698353673d7146bd2d092bbebb79c112aae7badc7b9c526f9098cbe342f96174feb6beabdd2587b3c42
   languageName: node
   linkType: hard
 
@@ -7027,7 +7027,7 @@ __metadata:
     css-units-list: "npm:2.1.0"
     dashify: "npm:2.0.0"
     deno-path-from-file-url: "npm:0.0.2"
-    diff: "npm:8.0.1"
+    diff: "npm:8.0.2"
     editorconfig: "npm:0.15.3"
     emoji-regex: "npm:10.4.0"
     enquirer: "npm:2.4.1"
