diff --git a/.github/workflows/ci.yml b/.github/workflows/ci.yml
index 6f53443ba..2430850f0 100644
--- a/.github/workflows/ci.yml
+++ b/.github/workflows/ci.yml
@@ -24,14 +24,12 @@ jobs:
         image: verdaccio/verdaccio:nightly-master
         ports:
           - 4873:4873
-        env:
-          NODE_ENV: production          
     steps:
     - uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b # tag=v3
-    - name: Node
+    - name: Use Node 16
       uses: actions/setup-node@2fddd8803e2f5c9604345a0b591c3020ee971a93 # tag=v3
       with:
-        node-version-file: '.nvmrc'
+        node-version: 16
     - name: Install pnpm
       run: npm i pnpm@6.32.15 -g
     - name: set store
@@ -53,10 +51,10 @@ jobs:
     needs: prepare
     steps:
       - uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b # tag=v3
-      - name: Node
+      - name: Use Node 16
         uses: actions/setup-node@2fddd8803e2f5c9604345a0b591c3020ee971a93 # tag=v3
         with:
-          node-version-file: '.nvmrc'
+          node-version: 16
       - name: Install pnpm
         run: npm i pnpm@6.32.15 -g
       - uses: actions/cache@fd5de65bc895cf536527842281bea11763fefd77 # tag=v3
@@ -64,7 +62,7 @@ jobs:
           path: ~/.pnpm-store
           key: pnpm-${{ hashFiles('pnpm-lock.yaml') }}
       - name: Install
-        run: pnpm recursive install --offline --frozen-lockfile --reporter=silence --ignore-scripts
+        run: pnpm recursive install --frozen-lockfile --ignore-scripts
       - name: Lint
         run: pnpm lint
   format:
@@ -73,10 +71,10 @@ jobs:
     needs: prepare
     steps:
       - uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b # tag=v3
-      - name: Use Node
+      - name: Use Node 16
         uses: actions/setup-node@2fddd8803e2f5c9604345a0b591c3020ee971a93 # tag=v3
         with:
-          node-version-file: '.nvmrc'
+          node-version: 16
       - name: Install pnpm
         run: npm i pnpm@6.32.15 -g
       - uses: actions/cache@fd5de65bc895cf536527842281bea11763fefd77 # tag=v3
@@ -84,7 +82,7 @@ jobs:
           path: ~/.pnpm-store
           key: pnpm-${{ hashFiles('pnpm-lock.yaml') }}
       - name: Install
-        run: pnpm recursive install --offline --frozen-lockfile --reporter=silence --ignore-scripts
+        run: pnpm recursive install --frozen-lockfile --ignore-scripts
       - name: Lint
         run: pnpm format:check
   build:
@@ -92,7 +90,7 @@ jobs:
     strategy:
       fail-fast: true
       matrix:
-        os: [ubuntu-latest]
+        os: [ubuntu-latest, windows-latest]
         node_version: [16, 18]
     name: ${{ matrix.os }} / Node ${{ matrix.node_version }}
     runs-on: ${{ matrix.os }}
@@ -109,7 +107,7 @@ jobs:
           path: ~/.pnpm-store
           key: pnpm-${{ hashFiles('pnpm-lock.yaml') }}
       - name: Install
-        run: pnpm recursive install --offline --frozen-lockfile --reporter=silence --ignore-scripts --registry http://localhost:4873
+        run: pnpm recursive install --frozen-lockfile --ignore-scripts
       - name: build
         run: pnpm build
       - name: Test
@@ -117,12 +115,12 @@ jobs:
   ci-e2e-ui:
     needs: [format, lint]
     runs-on: ubuntu-latest
-    name: UI Test E2E
+    name: UI Test E2E Node 16
     steps:
       - uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b # tag=v3
       - uses: actions/setup-node@2fddd8803e2f5c9604345a0b591c3020ee971a93 # tag=v3
         with:
-          node-version-file: '.nvmrc'
+          node-version: 16
       - name: Install pnpm
         run: npm i pnpm@6.32.15 -g
       - uses: actions/cache@fd5de65bc895cf536527842281bea11763fefd77 # tag=v3
@@ -130,15 +128,39 @@ jobs:
           path: ~/.pnpm-store
           key: pnpm-${{ hashFiles('pnpm-lock.yaml') }}
       - name: Install
-        run: pnpm recursive install --offline --frozen-lockfile --reporter=silence --registry http://localhost:4873
+        run: pnpm recursive install --frozen-lockfile
       - name: build
         run: pnpm build
       - name: Test UI
         run: pnpm test:e2e:ui
         # env:
         #  DEBUG: verdaccio:e2e*
+  ci-e2e-cli:
+    needs: [format, lint]
+    runs-on: ubuntu-latest
+    name: CLI Test E2E Node 16
+    steps:
+      - uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b # tag=v3
+      - uses: actions/setup-node@2fddd8803e2f5c9604345a0b591c3020ee971a93 # tag=v3
+        with:
+          node-version: 16
+      - name: Install pnpm
+        run: npm i pnpm@6.32.15 -g
+      - uses: actions/cache@fd5de65bc895cf536527842281bea11763fefd77 # tag=v3
+        with:
+          path: ~/.pnpm-store
+          key: pnpm-${{ hashFiles('pnpm-lock.yaml') }}
+      - name: Install
+        ## we need scripts, pupetter downloads aditional content
+        run: pnpm recursive install --frozen-lockfile
+      - name: build
+        run: pnpm build
+      - name: Test CLI
+        run: pnpm test:e2e:cli
+        # env:
+        #   DEBUG: verdaccio*
   sync-translations:
-    needs: [ci-e2e-ui]
+    needs: [ci-e2e-cli, ci-e2e-ui]
     runs-on: ubuntu-latest
     name: synchronize translations
     if: (github.event_name == 'push' && github.ref == 'refs/heads/master') || github.event_name == 'workflow_dispatch'
@@ -146,7 +168,7 @@ jobs:
       - uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b # tag=v3
       - uses: actions/setup-node@2fddd8803e2f5c9604345a0b591c3020ee971a93 # tag=v3
         with:
-          node-version-file: '.nvmrc'
+          node-version: 16
       - name: Install pnpm
         run: npm i pnpm@6.32.15 -g
       - uses: actions/cache@fd5de65bc895cf536527842281bea11763fefd77 # tag=v3
@@ -155,7 +177,7 @@ jobs:
           key: pnpm-${{ hashFiles('pnpm-lock.yaml') }}
       - name: Install
         ## we need scripts, pupetter downloads aditional content
-        run: pnpm recursive install --frozen-lockfile --registry http://localhost:4873
+        run: pnpm recursive install --frozen-lockfile
       - name: build
         run: pnpm build
       - name: generate website translations
diff --git a/.github/workflows/e2e-ci.yml b/.github/workflows/e2e-ci.yml
deleted file mode 100644
index 570c3d728..000000000
--- a/.github/workflows/e2e-ci.yml
+++ /dev/null
@@ -1,113 +0,0 @@
-name: E2E CLI
-
-on:
-  pull_request:
-    paths:
-      - .changeset/**
-      - .github/workflows/e2e-ci.yml
-      - 'packages/**'
-      - 'test/**'
-      - 'jest/**'
-      - 'package.json'
-      - 'pnpm-workspace.yaml'
-permissions:
-  contents: read
-jobs:
-  prepare:
-    runs-on: ubuntu-latest
-    name: setup e2e verdaccio
-    services:
-      verdaccio:
-        image: verdaccio/verdaccio:nightly-master
-        ports:
-          - 4873:4873
-        env:
-          NODE_ENV: production
-    steps:
-    - uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b # tag=v3
-    - name: Use Node 16
-      uses: actions/setup-node@2fddd8803e2f5c9604345a0b591c3020ee971a93 # tag=v3
-      with:
-        node-version: 16
-    - name: Install pnpm
-      run: npm i pnpm@6.32.15 -g
-    - name: set store
-      run: |
-        mkdir ~/.pnpm-store
-        pnpm config set store-dir ~/.pnpm-store
-    - name: Install
-      run: pnpm recursive install --frozen-lockfile --reporter=silence --ignore-scripts --registry http://localhost:4873
-    - name: Cache .pnpm-store
-      uses: actions/cache@fd5de65bc895cf536527842281bea11763fefd77 # tag=v3
-      with:
-        path: ~/.pnpm-store
-        key: pnpm-${{ hashFiles('pnpm-lock.yaml') }}
-        restore-keys: |
-          pnpm-
-  build:
-    needs: [prepare]
-    runs-on: ubuntu-latest
-    steps:
-      - uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b # tag=v3
-      - name: Use Node 16
-        uses: actions/setup-node@2fddd8803e2f5c9604345a0b591c3020ee971a93 # tag=v3
-        with:
-          node-version: 16
-      - name: Install pnpm
-        run: npm i pnpm@6.32.15 -g
-      - uses: actions/cache@fd5de65bc895cf536527842281bea11763fefd77 # tag=v3
-        with:
-          path: ~/.pnpm-store
-          key: pnpm-${{ hashFiles('pnpm-lock.yaml') }}
-      - name: Install
-        run: pnpm recursive install --offline --frozen-lockfile --reporter=silence --ignore-scripts --registry http://localhost:4873
-      - name: build
-        run: pnpm build
-      - name: Cache packages
-        uses: actions/cache@fd5de65bc895cf536527842281bea11763fefd77 # tag=v3
-        id: cache-packages
-        with:
-          path: ./packages/
-          key: pkg-${{ hashFiles('pnpm-lock.yaml') }}
-          restore-keys: |
-            packages-
-      - name: Cache test
-        uses: actions/cache@fd5de65bc895cf536527842281bea11763fefd77 # tag=v3
-        id: cache-test
-        with:
-          path: ./test/
-          key: test-${{ hashFiles('pnpm-lock.yaml') }}
-          restore-keys: |
-            test-
-
-  e2e-cli:
-    needs: [prepare, build]
-    strategy:
-      fail-fast: true
-      matrix:
-        pkg: [npm6, npm7, npm8, pnpm6, pnpm7, yarn1, yarn2,  yarn3, yarn4]
-    name:  E2E / ${{ matrix.pkg }} / ${{ matrix.os }}
-    runs-on: ubuntu-latest
-    steps:
-      - uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b # tag=v3
-      - uses: actions/setup-node@2fddd8803e2f5c9604345a0b591c3020ee971a93 # tag=v3
-        with:
-          node-version-file: '.nvmrc'
-      - name: Install pnpm
-        run: npm i pnpm@6.32.15 -g
-      - uses: actions/cache@fd5de65bc895cf536527842281bea11763fefd77 # tag=v3
-        with:
-          path: ~/.pnpm-store
-          key: pnpm-${{ hashFiles('pnpm-lock.yaml') }}
-      - name: Install
-        run: pnpm recursive install --offline --frozen-lockfile --reporter=silence --ignore-scripts --registry http://localhost:4873
-      - uses: actions/cache@fd5de65bc895cf536527842281bea11763fefd77 # tag=v3
-        with:
-          path: ./packages/
-          key: pkg-${{ hashFiles('pnpm-lock.yaml') }}
-      - uses: actions/cache@fd5de65bc895cf536527842281bea11763fefd77 # tag=v3
-        with:
-          path: ./test/
-          key: test-${{ hashFiles('pnpm-lock.yaml') }}      
-      - name: Test CLI
-        run: NODE_ENV=production pnpm test --filter ...@verdaccio/e2e-cli-${{matrix.pkg}}
diff --git a/packages/api/src/publish.ts b/packages/api/src/publish.ts
index dc0ab089a..9d87b280a 100644
--- a/packages/api/src/publish.ts
+++ b/packages/api/src/publish.ts
@@ -95,20 +95,22 @@ const debug = buildDebug('verdaccio:api:publish');
    */
 export default function publish(router: Router, auth: IAuth, storage: Storage): void {
   const can = allow(auth);
+  // publish (update manifest) v6
   router.put(
     '/:package',
     can('publish'),
     media(mime.getType('json')),
     expectJson,
-    publishPackage(storage)
+    publishPackageNext(storage)
   );
 
+  // unpublish a pacakge v6
   router.put(
     '/:package/-rev/:revision',
     can('unpublish'),
     media(mime.getType('json')),
     expectJson,
-    publishPackage(storage)
+    publishPackageNext(storage)
   );
 
   /**
@@ -119,6 +121,7 @@ export default function publish(router: Router, auth: IAuth, storage: Storage):
    * npm http fetch GET 304 http://localhost:4873/package-name?write=true 1076ms (from cache)
    * npm http fetch DELETE 201 http://localhost:4873/package-name/-rev/18-d8ebe3020bd4ac9c 22ms
    */
+  // v6
   router.delete(
     '/:package/-rev/:revision',
     can('unpublish'),
@@ -174,7 +177,7 @@ export default function publish(router: Router, auth: IAuth, storage: Storage):
   );
 }
 
-export function publishPackage(storage: Storage): any {
+export function publishPackageNext(storage: Storage): any {
   return async function (
     req: $RequestExtend,
     _res: $ResponseExtend,
diff --git a/packages/node-api/src/server.ts b/packages/node-api/src/server.ts
index 2ceebba60..f9987b97c 100644
--- a/packages/node-api/src/server.ts
+++ b/packages/node-api/src/server.ts
@@ -155,7 +155,7 @@ export async function initServer(
           process.exitCode = 1;
         });
       function handleShutdownGracefully() {
-        logger.info('received shutdown signal - closing server gracefully...');
+        logger.warn('received shutdown signal - closing server gracefully...');
         serverFactory.close(() => {
           logger.info('server closed.');
           process.exit(0);
diff --git a/packages/store/jest.config.js b/packages/store/jest.config.js
index b4b5ec7c9..535c138d4 100644
--- a/packages/store/jest.config.js
+++ b/packages/store/jest.config.js
@@ -4,9 +4,9 @@ module.exports = Object.assign({}, config, {
   coverageThreshold: {
     global: {
       // FIXME: increase to 90
-      branches: 51,
-      functions: 69,
-      lines: 66,
+      branches: 55,
+      functions: 81,
+      lines: 71,
     },
   },
 });
diff --git a/packages/store/src/storage.ts b/packages/store/src/storage.ts
index ef8ff30c3..51819d1e5 100644
--- a/packages/store/src/storage.ts
+++ b/packages/store/src/storage.ts
@@ -103,7 +103,11 @@ class Storage {
    Function changes a package info from local storage and all uplinks with write access./
    Used storages: local (write)
    */
-  public async changePackage(name: string, metadata: Manifest, revision: string): Promise<void> {
+  public async changePackageNext(
+    name: string,
+    metadata: Manifest,
+    revision: string
+  ): Promise<void> {
     debug('change existing package for package %o revision %o', name, revision);
     debug(`change manifest tags for %o revision %s`, name, revision);
     if (
@@ -115,7 +119,7 @@ class Storage {
     }
 
     debug(`change manifest udapting manifest for %o`, name);
-    await this.updatePackage(name, async (localData: Manifest): Promise<Manifest> => {
+    await this.updatePackageNext(name, async (localData: Manifest): Promise<Manifest> => {
       // eslint-disable-next-line guard-for-in
       for (const version in localData.versions) {
         const incomingVersion = metadata.versions[version];
@@ -190,11 +194,14 @@ class Storage {
       throw err;
     }
 
-    const manifest = await this.updatePackage(name, async (data: Manifest): Promise<Manifest> => {
-      let newData: Manifest = { ...data };
-      delete data._attachments[filename];
-      return newData;
-    });
+    const manifest = await this.updatePackageNext(
+      name,
+      async (data: Manifest): Promise<Manifest> => {
+        let newData: Manifest = { ...data };
+        delete data._attachments[filename];
+        return newData;
+      }
+    );
 
     try {
       const storage: IPackageStorage = this.getPrivatePackageStorage(name);
@@ -872,7 +879,7 @@ class Storage {
    * @param tags list of dist-tags
    */
   public async mergeTagsNext(name: string, tags: MergeTags): Promise<Manifest> {
-    return await this.updatePackage(name, async (data: Manifest): Promise<Manifest> => {
+    return await this.updatePackageNext(name, async (data: Manifest): Promise<Manifest> => {
       let newData: Manifest = { ...data };
       for (const tag of Object.keys(tags)) {
         // this handle dist-tag rm command
@@ -915,6 +922,14 @@ class Storage {
     return uplink;
   }
 
+  public async updateLocalMetadata(pkgName: string) {
+    const storage = this.getPrivatePackageStorage(pkgName);
+
+    if (!storage) {
+      throw errorUtils.getNotFound();
+    }
+  }
+
   public async updateManifest(manifest: Manifest, options: UpdateManifestOptions): Promise<void> {
     if (isDeprecatedManifest(manifest)) {
       // if the manifest is deprecated, we need to update the package.json
@@ -953,10 +968,14 @@ class Storage {
     }
   }
 
-  private async deprecate(manifest: Manifest, options: UpdateManifestOptions): Promise<void> {
-    const { name } = manifest;
-    debug('deprecating %s', name);
-    return this.changePackage(name, manifest, options.revision as string);
+  // eslint-disable-next-line @typescript-eslint/no-unused-vars
+  private async deprecate(_body: Manifest, _options: PublishOptions): Promise<void> {
+    // // const storage: IPackageStorage = this.getPrivatePackageStorage(opname);
+
+    // if (typeof storage === 'undefined') {
+    //   throw errorUtils.getNotFound();
+    // }
+    throw errorUtils.getInternalError('no implementation ready for npm deprecate');
   }
 
   // eslint-disable-next-line @typescript-eslint/no-unused-vars
@@ -1234,7 +1253,7 @@ class Storage {
         try {
           debug('uploaded tarball %o for %o', filename, pkgName);
           // update the package metadata
-          await this.updatePackage(pkgName, async (data: Manifest): Promise<Manifest> => {
+          await this.updatePackageNext(pkgName, async (data: Manifest): Promise<Manifest> => {
             const newData: Manifest = { ...data };
             debug('added _attachment for %o', pkgName);
             newData._attachments[filename] = {
@@ -1282,7 +1301,7 @@ class Storage {
     tag: StringValue
   ): Promise<void> {
     debug(`add version %s package for %s`, version, name);
-    await this.updatePackage(name, async (data: Manifest): Promise<Manifest> => {
+    await this.updatePackageNext(name, async (data: Manifest): Promise<Manifest> => {
       // keep only one readme per package
       data.readme = metadata.readme;
       debug('%s` readme mutated', name);
@@ -1441,15 +1460,13 @@ class Storage {
 
     // this is intended in debug mode we do not want modify the store revision
     if (_.isNil(this.config._debug)) {
-      const prev = json._rev;
       json._rev = generateRevision(json._rev);
-      debug('revision metadata for %s updated from %s to %s', json.name, prev, json._rev);
     }
 
     return json;
   }
 
-  private async writePackage(name: string, json: Manifest): Promise<void> {
+  private async writePackageNext(name: string, json: Manifest): Promise<void> {
     const storage: any = this.getPrivatePackageStorage(name);
     if (_.isNil(storage)) {
       // TODO: replace here 500 error
@@ -1464,7 +1481,7 @@ class Storage {
    * @param {*} callback callback that gets invoked after it's all updated
    * @return {Function}
    */
-  private async updatePackage(
+  private async updatePackageNext(
     name: string,
     updateHandler: (manifest: Manifest) => Promise<Manifest>
   ): Promise<Manifest> {
@@ -1478,7 +1495,7 @@ class Storage {
     const updatedManifest: Manifest = await storage.updatePackage(name, updateHandler);
     // after correctly updated write to the storage
     try {
-      await this.writePackage(name, normalizePackage(updatedManifest));
+      await this.writePackageNext(name, normalizePackage(updatedManifest));
       return updatedManifest;
     } catch (err: any) {
       if (err.code === resourceNotAvailable) {
@@ -1896,7 +1913,7 @@ class Storage {
 
     if (change) {
       debug('updating package info %o', name);
-      await this.writePackage(name, cacheManifest);
+      await this.writePackageNext(name, cacheManifest);
       return cacheManifest;
     } else {
       return cacheManifest;
diff --git a/packages/store/test/fixtures/config/deprecate.yaml b/packages/store/test/fixtures/config/deprecate.yaml
deleted file mode 100644
index 54b8abbc1..000000000
--- a/packages/store/test/fixtures/config/deprecate.yaml
+++ /dev/null
@@ -1,15 +0,0 @@
-packages:
-  '@scope/foo':
-    access: $all
-    publish: $authenticated
-  '@*/*':
-    access: $all
-    publish: $all
-    proxy: ver
-  'foo':
-    access: $all
-    publish: $authenticated
-  '*':
-    access: $all
-    publish: $all
-    proxy: npmjs
diff --git a/packages/store/test/storage.spec.ts b/packages/store/test/storage.spec.ts
index d8e851c91..0efb81175 100644
--- a/packages/store/test/storage.spec.ts
+++ b/packages/store/test/storage.spec.ts
@@ -14,9 +14,8 @@ import {
   generateLocalPackageMetadata,
   generatePackageMetadata,
   generateRemotePackageMetadata,
-  getDeprecatedPackageMetadata,
 } from '@verdaccio/test-helper';
-import { AbbreviatedManifest, ConfigYaml, Manifest, Version } from '@verdaccio/types';
+import { AbbreviatedManifest, Manifest, Version } from '@verdaccio/types';
 
 import { Storage } from '../src';
 import manifestFooRemoteNpmjs from './fixtures/manifests/foo-npmjs.json';
@@ -35,27 +34,6 @@ const domain = 'https://registry.npmjs.org';
 const fakeHost = 'localhost:4873';
 const fooManifest = generatePackageMetadata('foo', '1.0.0');
 
-const getConfig = (file, override: Partial<ConfigYaml> = {}): Config => {
-  const config = new Config(
-    configExample(
-      {
-        ...getDefaultConfig(),
-        storage: generateRandomStorage(),
-        ...override,
-      },
-      `./fixtures/config/${file}`,
-      __dirname
-    )
-  );
-  return config;
-};
-
-const defaultRequestOptions = {
-  host: 'localhost',
-  protocol: 'http',
-  headers: {},
-};
-
 describe('storage', () => {
   beforeEach(() => {
     nock.cleanAll();
@@ -64,183 +42,79 @@ describe('storage', () => {
   });
 
   describe('updateManifest', () => {
-    describe('publishing', () => {
-      test('create private package', async () => {
-        const mockDate = '2018-01-14T11:17:40.712Z';
-        MockDate.set(mockDate);
-        const pkgName = 'upstream';
-        const requestOptions = {
-          host: 'localhost',
-          protocol: 'http',
-          headers: {},
-        };
-        const config = new Config(
-          configExample(
-            {
-              ...getDefaultConfig(),
-              storage: generateRandomStorage(),
-            },
-            './fixtures/config/updateManifest-1.yaml',
-            __dirname
-          )
-        );
-        const storage = new Storage(config);
-        await storage.init(config);
-        const bodyNewManifest = generatePackageMetadata(pkgName, '1.0.0');
-        await storage.updateManifest(bodyNewManifest, {
-          signal: new AbortController().signal,
-          name: pkgName,
-          uplinksLook: true,
-          revision: '1',
-          requestOptions,
-        });
-        const manifest = (await storage.getPackageByOptions({
-          name: pkgName,
-          uplinksLook: true,
-          requestOptions,
-        })) as Manifest;
-        expect(manifest.name).toEqual(pkgName);
-        expect(manifest._id).toEqual(pkgName);
-        expect(Object.keys(manifest.versions)).toEqual(['1.0.0']);
-        expect(manifest.time).toEqual({
-          '1.0.0': mockDate,
-          created: mockDate,
-          modified: mockDate,
-        });
-        expect(manifest[DIST_TAGS]).toEqual({ latest: '1.0.0' });
-        expect(manifest.readme).toEqual('# test');
-        expect(manifest._attachments).toEqual({});
-        expect(typeof manifest._rev).toBeTruthy();
+    test('create private package', async () => {
+      const mockDate = '2018-01-14T11:17:40.712Z';
+      MockDate.set(mockDate);
+      const pkgName = 'upstream';
+      const requestOptions = {
+        host: 'localhost',
+        protocol: 'http',
+        headers: {},
+      };
+      const config = new Config(
+        configExample(
+          {
+            ...getDefaultConfig(),
+            storage: generateRandomStorage(),
+          },
+          './fixtures/config/updateManifest-1.yaml',
+          __dirname
+        )
+      );
+      const storage = new Storage(config);
+      await storage.init(config);
+      const bodyNewManifest = generatePackageMetadata(pkgName, '1.0.0');
+      await storage.updateManifest(bodyNewManifest, {
+        signal: new AbortController().signal,
+        name: pkgName,
+        uplinksLook: true,
+        revision: '1',
+        requestOptions,
       });
-
-      // TODO: Review triggerUncaughtException exception on abort
-      test.skip('abort creating a private package', async () => {
-        const mockDate = '2018-01-14T11:17:40.712Z';
-        MockDate.set(mockDate);
-        const pkgName = 'upstream';
-        const config = new Config(
-          configExample(
-            {
-              storage: generateRandomStorage(),
-            },
-            './fixtures/config/updateManifest-1.yaml',
-            __dirname
-          )
-        );
-        const storage = new Storage(config);
-        await storage.init(config);
-        const ac = new AbortController();
-        setTimeout(() => {
-          ac.abort();
-        }, 10);
-        const bodyNewManifest = generatePackageMetadata(pkgName, '1.0.0');
-        await expect(
-          storage.updateManifest(bodyNewManifest, {
-            signal: ac.signal,
-            name: pkgName,
-            uplinksLook: true,
-            revision: '1',
-            requestOptions: {
-              host: 'localhost',
-              protocol: 'http',
-              headers: {},
-            },
-          })
-        ).rejects.toThrow('should throw here');
+      const manifest = (await storage.getPackageByOptions({
+        name: pkgName,
+        uplinksLook: true,
+        requestOptions,
+      })) as Manifest;
+      expect(manifest.name).toEqual(pkgName);
+      expect(manifest._id).toEqual(pkgName);
+      expect(Object.keys(manifest.versions)).toEqual(['1.0.0']);
+      expect(manifest.time).toEqual({
+        '1.0.0': mockDate,
+        created: mockDate,
+        modified: mockDate,
       });
+      expect(manifest[DIST_TAGS]).toEqual({ latest: '1.0.0' });
+      expect(manifest.readme).toEqual('# test');
+      expect(manifest._attachments).toEqual({});
+      expect(typeof manifest._rev).toBeTruthy();
+    });
 
-      test('create private package with multiple consecutive versions', async () => {
-        const mockDate = '2018-01-14T11:17:40.712Z';
-        MockDate.set(mockDate);
-        const settings = {
-          uplinksLook: true,
-          revision: '1',
-          requestOptions: {
-            host: 'localhost',
-            protocol: 'http',
-            headers: {},
-          },
-        };
-        const pkgName = 'upstream';
-        // const storage = generateRandomStorage();
-        const config = new Config(
-          configExample(
-            {
-              storage: await fileUtils.createTempStorageFolder('storage-test'),
-            },
-            './fixtures/config/updateManifest-1.yaml',
-            __dirname
-          )
-        );
-        const storage = new Storage(config);
-        await storage.init(config);
-        // create a package
-        const bodyNewManifest1 = generatePackageMetadata(pkgName, '1.0.0');
-        await storage.updateManifest(bodyNewManifest1, {
-          signal: new AbortController().signal,
-          name: pkgName,
-          ...settings,
-        });
-        // publish second version
-        const bodyNewManifest2 = generatePackageMetadata(pkgName, '1.0.1');
-        await storage.updateManifest(bodyNewManifest2, {
-          signal: new AbortController().signal,
-          name: pkgName,
-          ...settings,
-        });
-        // retrieve package metadata
-        const manifest = (await storage.getPackageByOptions({
-          name: pkgName,
-          uplinksLook: true,
-          requestOptions: {
-            host: 'localhost',
-            protocol: 'http',
-            headers: {},
+    // TODO: Review triggerUncaughtException exception on abort
+    test.skip('abort creating a private package', async () => {
+      const mockDate = '2018-01-14T11:17:40.712Z';
+      MockDate.set(mockDate);
+      const pkgName = 'upstream';
+      const config = new Config(
+        configExample(
+          {
+            storage: generateRandomStorage(),
           },
-        })) as Manifest;
-        expect(manifest.name).toEqual(pkgName);
-        expect(manifest._id).toEqual(pkgName);
-        expect(Object.keys(manifest.versions)).toEqual(['1.0.0', '1.0.1']);
-        expect(manifest.time).toEqual({
-          '1.0.0': mockDate,
-          '1.0.1': mockDate,
-          created: mockDate,
-          modified: mockDate,
-        });
-        expect(manifest[DIST_TAGS]).toEqual({ latest: '1.0.1' });
-        expect(manifest.readme).toEqual('# test');
-        expect(manifest._attachments).toEqual({});
-        expect(typeof manifest._rev).toBeTruthy();
-        // verify the version structure is correct
-        const manifestVersion = (await storage.getPackageByOptions({
+          './fixtures/config/updateManifest-1.yaml',
+          __dirname
+        )
+      );
+      const storage = new Storage(config);
+      await storage.init(config);
+      const ac = new AbortController();
+      setTimeout(() => {
+        ac.abort();
+      }, 10);
+      const bodyNewManifest = generatePackageMetadata(pkgName, '1.0.0');
+      await expect(
+        storage.updateManifest(bodyNewManifest, {
+          signal: ac.signal,
           name: pkgName,
-          version: '1.0.1',
-          uplinksLook: true,
-          requestOptions: {
-            host: 'localhost',
-            protocol: 'http',
-            headers: {},
-          },
-        })) as Version;
-        expect(manifestVersion.name).toEqual(pkgName);
-        expect(manifestVersion.version).toEqual('1.0.1');
-        expect(manifestVersion._id).toEqual(`${pkgName}@1.0.1`);
-        expect(manifestVersion.description).toEqual('package generated');
-        expect(manifestVersion.dist).toEqual({
-          integrity:
-            'sha512-6gHiERpiDgtb3hjqpQH5/i7zRmvYi9pmCjQf2ZMy3QEa9wVk9RgdZaPWUt7ZOnWUPFjcr9cmE6dUBf+XoPoH4g==',
-          shasum: '2c03764f651a9f016ca0b7620421457b619151b9',
-          tarball: 'http://localhost:5555/upstream/-/upstream-1.0.1.tgz',
-        });
-
-        expect(manifestVersion.contributors).toEqual([]);
-        expect(manifestVersion.main).toEqual('index.js');
-        expect(manifestVersion.author).toEqual({ name: 'User NPM', email: 'user@domain.com' });
-        expect(manifestVersion.dependencies).toEqual({ verdaccio: '^2.7.2' });
-      });
-
-      test('fails if version already exist', async () => {
-        const settings = {
           uplinksLook: true,
           revision: '1',
           requestOptions: {
@@ -248,157 +122,136 @@ describe('storage', () => {
             protocol: 'http',
             headers: {},
           },
-        };
-        const pkgName = 'upstream';
-        const config = new Config(
-          configExample(
-            {
-              storage: generateRandomStorage(),
-            },
-            './fixtures/config/getTarballNext-getupstream.yaml',
-            __dirname
-          )
-        );
-        const storage = new Storage(config);
-        await storage.init(config);
-        const bodyNewManifest1 = generatePackageMetadata(pkgName, '1.0.0');
-        const bodyNewManifest2 = generatePackageMetadata(pkgName, '1.0.0');
-        await storage.updateManifest(bodyNewManifest1, {
-          signal: new AbortController().signal,
-          name: pkgName,
-          ...settings,
-        });
-        await expect(
-          storage.updateManifest(bodyNewManifest2, {
-            signal: new AbortController().signal,
-            name: pkgName,
-            ...settings,
-          })
-        ).rejects.toThrow(API_ERROR.PACKAGE_EXIST);
-      });
+        })
+      ).rejects.toThrow('should throw here');
     });
-    describe('deprecate', () => {
-      test.each([['foo'], ['@scope/foo']])('deprecate package %s', async (pkgName) => {
-        const mockDate = '2018-01-14T11:17:40.712Z';
-        MockDate.set(mockDate);
-        const config = getConfig('deprecate.yaml');
-        const storage = new Storage(config);
-        await storage.init(config);
-        const bodyNewManifest = generatePackageMetadata(pkgName, '1.0.0');
-        await storage.updateManifest(bodyNewManifest, {
-          signal: new AbortController().signal,
-          name: pkgName,
-          uplinksLook: true,
-          revision: '1',
-          requestOptions: defaultRequestOptions,
-        });
-        const manifest1 = (await storage.getPackageByOptions({
-          name: pkgName,
-          uplinksLook: true,
-          requestOptions: defaultRequestOptions,
-        })) as Manifest;
-        expect(manifest1.versions['1.0.0'].deprecated).toBeUndefined();
 
-        const deprecatedManifest = getDeprecatedPackageMetadata(
-          pkgName,
-          '1.0.0',
+    test('create private package with multiple consecutive versions', async () => {
+      const mockDate = '2018-01-14T11:17:40.712Z';
+      MockDate.set(mockDate);
+      const settings = {
+        uplinksLook: true,
+        revision: '1',
+        requestOptions: {
+          host: 'localhost',
+          protocol: 'http',
+          headers: {},
+        },
+      };
+      const pkgName = 'upstream';
+      // const storage = generateRandomStorage();
+      const config = new Config(
+        configExample(
           {
-            ['latest']: '1.0.0',
+            storage: await fileUtils.createTempStorageFolder('storage-test'),
           },
-          'some deprecation message',
-          manifest1._rev
-        );
-        await storage.updateManifest(deprecatedManifest, {
-          signal: new AbortController().signal,
-          name: pkgName,
-          uplinksLook: true,
-          revision: '1',
-          requestOptions: defaultRequestOptions,
-        });
-        const manifest = (await storage.getPackageByOptions({
-          name: pkgName,
-          uplinksLook: true,
-          requestOptions: defaultRequestOptions,
-        })) as Manifest;
-        expect(manifest.name).toEqual(pkgName);
-        expect(manifest.versions['1.0.0'].deprecated).toEqual('some deprecation message');
-        // important revision is updated
-        expect(manifest._rev !== deprecatedManifest._rev).toBeTruthy();
+          './fixtures/config/updateManifest-1.yaml',
+          __dirname
+        )
+      );
+      const storage = new Storage(config);
+      await storage.init(config);
+      // create a package
+      const bodyNewManifest1 = generatePackageMetadata(pkgName, '1.0.0');
+      await storage.updateManifest(bodyNewManifest1, {
+        signal: new AbortController().signal,
+        name: pkgName,
+        ...settings,
+      });
+      // publish second version
+      const bodyNewManifest2 = generatePackageMetadata(pkgName, '1.0.1');
+      await storage.updateManifest(bodyNewManifest2, {
+        signal: new AbortController().signal,
+        name: pkgName,
+        ...settings,
+      });
+      // retrieve package metadata
+      const manifest = (await storage.getPackageByOptions({
+        name: pkgName,
+        uplinksLook: true,
+        requestOptions: {
+          host: 'localhost',
+          protocol: 'http',
+          headers: {},
+        },
+      })) as Manifest;
+      expect(manifest.name).toEqual(pkgName);
+      expect(manifest._id).toEqual(pkgName);
+      expect(Object.keys(manifest.versions)).toEqual(['1.0.0', '1.0.1']);
+      expect(manifest.time).toEqual({
+        '1.0.0': mockDate,
+        '1.0.1': mockDate,
+        created: mockDate,
+        modified: mockDate,
+      });
+      expect(manifest[DIST_TAGS]).toEqual({ latest: '1.0.1' });
+      expect(manifest.readme).toEqual('# test');
+      expect(manifest._attachments).toEqual({});
+      expect(typeof manifest._rev).toBeTruthy();
+      // verify the version structure is correct
+      const manifestVersion = (await storage.getPackageByOptions({
+        name: pkgName,
+        version: '1.0.1',
+        uplinksLook: true,
+        requestOptions: {
+          host: 'localhost',
+          protocol: 'http',
+          headers: {},
+        },
+      })) as Version;
+      expect(manifestVersion.name).toEqual(pkgName);
+      expect(manifestVersion.version).toEqual('1.0.1');
+      expect(manifestVersion._id).toEqual(`${pkgName}@1.0.1`);
+      expect(manifestVersion.description).toEqual('package generated');
+      expect(manifestVersion.dist).toEqual({
+        integrity:
+          'sha512-6gHiERpiDgtb3hjqpQH5/i7zRmvYi9pmCjQf2ZMy3QEa9wVk9RgdZaPWUt7ZOnWUPFjcr9cmE6dUBf+XoPoH4g==',
+        shasum: '2c03764f651a9f016ca0b7620421457b619151b9',
+        tarball: 'http://localhost:5555/upstream/-/upstream-1.0.1.tgz',
       });
-      test.each([['foo'], ['@scope/foo']])('undeprecate package %s', async (pkgName) => {
-        const mockDate = '2018-01-14T11:17:40.712Z';
-        MockDate.set(mockDate);
-        const config = getConfig('deprecate.yaml');
-        const storage = new Storage(config);
-        await storage.init(config);
-        // publish new package
-        const bodyNewManifest = generatePackageMetadata(pkgName, '1.0.0');
-        await storage.updateManifest(bodyNewManifest, {
-          signal: new AbortController().signal,
-          name: pkgName,
-          uplinksLook: true,
-          revision: '1',
-          requestOptions: defaultRequestOptions,
-        });
 
-        // verify not deprecated
-        const manifest1 = (await storage.getPackageByOptions({
-          name: pkgName,
-          uplinksLook: true,
-          requestOptions: defaultRequestOptions,
-        })) as Manifest;
-        expect(manifest1.versions['1.0.0'].deprecated).toBeUndefined();
+      expect(manifestVersion.contributors).toEqual([]);
+      expect(manifestVersion.main).toEqual('index.js');
+      expect(manifestVersion.author).toEqual({ name: 'User NPM', email: 'user@domain.com' });
+      expect(manifestVersion.dependencies).toEqual({ verdaccio: '^2.7.2' });
+    });
 
-        // deprecate version
-        const deprecatedManifest = getDeprecatedPackageMetadata(
-          pkgName,
-          '1.0.0',
+    test('fails if version already exist', async () => {
+      const settings = {
+        uplinksLook: true,
+        revision: '1',
+        requestOptions: {
+          host: 'localhost',
+          protocol: 'http',
+          headers: {},
+        },
+      };
+      const pkgName = 'upstream';
+      const config = new Config(
+        configExample(
           {
-            ['latest']: '1.0.0',
+            storage: generateRandomStorage(),
           },
-          'some deprecation message',
-          manifest1._rev
-        );
-        await storage.updateManifest(deprecatedManifest, {
-          signal: new AbortController().signal,
-          name: pkgName,
-          uplinksLook: true,
-          revision: '1',
-          requestOptions: defaultRequestOptions,
-        });
-        const manifest = (await storage.getPackageByOptions({
-          name: pkgName,
-          uplinksLook: true,
-          requestOptions: defaultRequestOptions,
-        })) as Manifest;
-        expect(manifest.name).toEqual(pkgName);
-        expect(manifest.versions['1.0.0'].deprecated).toEqual('some deprecation message');
-        // important revision is updated
-        expect(manifest._rev !== deprecatedManifest._rev).toBeTruthy();
-
-        // un deprecated the previous deprecated
-        const undeprecatedManifest = {
-          ...manifest,
-        };
-        undeprecatedManifest.versions['1.0.0'].deprecated = '';
-        await storage.updateManifest(undeprecatedManifest, {
+          './fixtures/config/getTarballNext-getupstream.yaml',
+          __dirname
+        )
+      );
+      const storage = new Storage(config);
+      await storage.init(config);
+      const bodyNewManifest1 = generatePackageMetadata(pkgName, '1.0.0');
+      const bodyNewManifest2 = generatePackageMetadata(pkgName, '1.0.0');
+      await storage.updateManifest(bodyNewManifest1, {
+        signal: new AbortController().signal,
+        name: pkgName,
+        ...settings,
+      });
+      await expect(
+        storage.updateManifest(bodyNewManifest2, {
           signal: new AbortController().signal,
           name: pkgName,
-          uplinksLook: true,
-          revision: '1',
-          requestOptions: defaultRequestOptions,
-        });
-
-        const manifest3 = (await storage.getPackageByOptions({
-          name: pkgName,
-          uplinksLook: true,
-          requestOptions: defaultRequestOptions,
-        })) as Manifest;
-        expect(manifest3.name).toEqual(pkgName);
-        expect(manifest3.versions['1.0.0'].deprecated).toBeUndefined();
-        // important revision is updated
-        expect(manifest3._rev !== deprecatedManifest._rev).toBeTruthy();
-      });
+          ...settings,
+        })
+      ).rejects.toThrow(API_ERROR.PACKAGE_EXIST);
     });
   });
 
@@ -871,7 +724,7 @@ describe('storage', () => {
     });
   });
 
-  describe('getLocalDatabase', () => {
+  describe('getLocalDatabaseNext', () => {
     test('should return 0 local packages', async () => {
       const config = new Config(
         configExample({
@@ -1049,7 +902,7 @@ describe('storage', () => {
     });
   });
 
-  describe('getPackageByOptions()', () => {
+  describe('get packages getPackageByOptions()', () => {
     describe('with uplinks', () => {
       test('should get 201 and merge from uplink', async () => {
         nock(domain).get('/foo').reply(201, fooManifest);
diff --git a/packages/tools/helpers/jest.config.js b/packages/tools/helpers/jest.config.js
index 766313f2c..a8bfe6885 100644
--- a/packages/tools/helpers/jest.config.js
+++ b/packages/tools/helpers/jest.config.js
@@ -4,7 +4,7 @@ module.exports = Object.assign({}, config, {
   coverageThreshold: {
     global: {
       // FIXME: increase to 90
-      lines: 40,
+      lines: 48,
     },
   },
 });
diff --git a/packages/tools/helpers/src/generatePackageMetadata.ts b/packages/tools/helpers/src/generatePackageMetadata.ts
index 1cc8607c4..ea41737b3 100644
--- a/packages/tools/helpers/src/generatePackageMetadata.ts
+++ b/packages/tools/helpers/src/generatePackageMetadata.ts
@@ -217,21 +217,6 @@ export function generateRemotePackageMetadata(
   };
 }
 
-export function getDeprecatedPackageMetadata(
-  pkgName: string,
-  version = '1.0.0',
-  distTags: DistTags = { ['latest']: version },
-  deprecated = 'default deprecated message',
-  rev = 'rev-foo'
-): Manifest {
-  const manifest = generatePackageMetadata(pkgName, version, distTags);
-  // deprecated message requires empty attachments
-  manifest._attachments = {};
-  manifest._rev = rev;
-  manifest.versions[version].deprecated = deprecated;
-  return manifest;
-}
-
 export function generatePackageMetadata(
   pkgName: string,
   version = '1.0.0',
diff --git a/packages/tools/helpers/src/index.ts b/packages/tools/helpers/src/index.ts
index afd88b043..bb4012018 100644
--- a/packages/tools/helpers/src/index.ts
+++ b/packages/tools/helpers/src/index.ts
@@ -3,7 +3,6 @@ export {
   addNewVersion,
   generateLocalPackageMetadata,
   generateRemotePackageMetadata,
-  getDeprecatedPackageMetadata,
 } from './generatePackageMetadata';
 export { generatePublishNewVersionManifest } from './generatePublishNewVersionManifest';
 export { initializeServer } from './initializeServer';
diff --git a/test/cli/README.md b/test/cli/README.md
index 0ff534669..48cc0f5ee 100644
--- a/test/cli/README.md
+++ b/test/cli/README.md
@@ -7,17 +7,12 @@
 
 ### Commands Tested
 
-| cmd       | npm6 | npm7 | npm8 | pnpm6 | pnpm7 | yarn1 | yarn2 | yarn3 | yarn4 |
-| --------- | ---- | ---- | ---- | ----- | ----- | ----- | ----- | ----- | ----- |
-| publish   | ✅   | ✅   | ✅   | ✅    | ✅    | ✅    | ❌    | ❌    | ❌    |
-| info      | ✅   | ✅   | ✅   | ✅    | ✅    | ✅    | ✅    | ✅    | ✅    |
-| audit     | ✅   | ✅   | ✅   | ✅    | ✅    | ✅    | ✅    | ✅    | ❌    |
-| install   | ✅   | ✅   | ✅   | ✅    | ✅    | ✅    | ✅    | ✅    | ✅    |
-| deprecate | ✅   | ✅   | ✅   | ✅    | ✅    | ⛔    | ⛔    | ⛔    | ⛔    |
-
-❌ = no tested
-✅ = tested
-⛔ = no supported
+| cmd     | npm6 | npm7 | npm8 | pnpm6 | pnpm7 | yarn1 | yarn2 | yarn3 | yarn4 |
+| ------- | ---- | ---- | ---- | ----- | ----- | ----- | ----- | ----- | ----- |
+| publish | ✅   | ✅   | ✅   | ✅    | ✅    | ✅    | ❌    | ❌    | ❌    |
+| info    | ✅   | ✅   | ✅   | ✅    | ✅    | ✅    | ✅    | ✅    | ✅    |
+| audit   | ✅   | ✅   | ✅   | ✅    | ✅    | ✅    | ✅    | ✅    | ❌    |
+| install | ✅   | ✅   | ✅   | ✅    | ✅    | ✅    | ✅    | ✅    | ✅    |
 
 ## How it works?
 
diff --git a/test/cli/cli-commons/src/process.ts b/test/cli/cli-commons/src/process.ts
index 9b8763bd9..b6d5adee7 100644
--- a/test/cli/cli-commons/src/process.ts
+++ b/test/cli/cli-commons/src/process.ts
@@ -21,7 +21,7 @@ export async function exec(options: SpawnOptions, cmd, args): Promise<ExecOutput
   const spawnOptions = {
     cwd: options.cwd,
     stdio: options.stdio || 'pipe',
-    env: process.env,
+    ...(env ? { env } : {}),
   };
 
   if (process.platform.startsWith('win')) {
diff --git a/test/cli/cli-commons/src/registry.ts b/test/cli/cli-commons/src/registry.ts
index 81f0ee78e..e1bc985da 100644
--- a/test/cli/cli-commons/src/registry.ts
+++ b/test/cli/cli-commons/src/registry.ts
@@ -12,24 +12,9 @@ export type Setup = {
   tempFolder: string;
 };
 
-const log =
-  process.env.NODE_ENV === 'production'
-    ? { type: 'stdout', format: 'json', level: 'warn' }
-    : { type: 'stdout', format: 'pretty', level: 'warn' };
-const defaultConfig = {
-  ...getDefaultConfig(),
-  log,
-};
-
 export async function initialSetup(customConfig?: ConfigYaml): Promise<Setup> {
-  // @ts-ignore
   const { configPath, tempFolder } = await Registry.fromConfigToPath({
-    ...(customConfig
-      ? customConfig
-      : {
-          ...defaultConfig,
-          _debug: true,
-        }),
+    ...(customConfig ? customConfig : { ...getDefaultConfig(), _debug: true }),
   });
   debug(`configPath %o`, configPath);
   debug(`tempFolder %o`, tempFolder);
diff --git a/test/cli/e2e-npm6/deprecate.spec.ts b/test/cli/e2e-npm6/deprecate.spec.ts
deleted file mode 100644
index 37f38cfeb..000000000
--- a/test/cli/e2e-npm6/deprecate.spec.ts
+++ /dev/null
@@ -1,137 +0,0 @@
-import { addRegistry, initialSetup, prepareGenericEmptyProject } from '@verdaccio/test-cli-commons';
-
-import { npm } from './utils';
-
-describe('deprecate a package', () => {
-  jest.setTimeout(15000);
-  let registry;
-
-  async function bumbUp(tempFolder, registry) {
-    await npm({ cwd: tempFolder }, 'version', 'minor', ...addRegistry(registry.getRegistryUrl()));
-  }
-
-  async function publish(tempFolder, pkgName, registry) {
-    const resp = await npm(
-      { cwd: tempFolder },
-      'publish',
-      '--json',
-      ...addRegistry(registry.getRegistryUrl())
-    );
-    const parsedBody = JSON.parse(resp.stdout as string);
-    expect(parsedBody.name).toEqual(pkgName);
-  }
-
-  async function deprecate(tempFolder, packageVersion, registry, message) {
-    await npm(
-      { cwd: tempFolder },
-      'deprecate',
-      packageVersion,
-      message,
-      '--json',
-      ...addRegistry(registry.getRegistryUrl())
-    );
-  }
-
-  async function getInfoVersions(pkgName, registry) {
-    const infoResp = await npm(
-      {},
-      'info',
-      pkgName,
-      '--json',
-      ...addRegistry(registry.getRegistryUrl())
-    );
-    const infoBody = JSON.parse(infoResp.stdout as string);
-    return infoBody;
-  }
-
-  beforeAll(async () => {
-    const setup = await initialSetup();
-    registry = setup.registry;
-    await registry.init();
-  });
-
-  test.each([['@verdaccio/deprecated-1']])(
-    'should deprecate a single package %s',
-    async (pkgName) => {
-      const message = 'some message';
-      const { tempFolder } = await prepareGenericEmptyProject(
-        pkgName,
-        '1.0.0',
-        registry.port,
-        registry.getToken(),
-        registry.getRegistryUrl()
-      );
-      await publish(tempFolder, pkgName, registry);
-      // deprecate one version
-      await deprecate(tempFolder, `${pkgName}@1.0.0`, registry, message);
-      // verify is deprecated
-      const infoBody = await getInfoVersions(`${pkgName}`, registry);
-      expect(infoBody.name).toEqual(pkgName);
-      expect(infoBody.deprecated).toEqual(message);
-    }
-  );
-
-  test.each([['@verdaccio/deprecated-2']])('should un-deprecate a package %s', async (pkgName) => {
-    const message = 'some message';
-    const { tempFolder } = await prepareGenericEmptyProject(
-      pkgName,
-      '1.0.0',
-      registry.port,
-      registry.getToken(),
-      registry.getRegistryUrl()
-    );
-    await publish(tempFolder, pkgName, registry);
-    // deprecate one version
-    await deprecate(tempFolder, `${pkgName}@1.0.0`, registry, message);
-    // verify is deprecated
-    const infoBody = await getInfoVersions(`${pkgName}`, registry);
-    expect(infoBody.deprecated).toEqual(message);
-    // empty string is same as undeprecate
-    await deprecate(tempFolder, `${pkgName}@1.0.0`, registry, '');
-    const infoBody2 = await getInfoVersions(`${pkgName}`, registry);
-    expect(infoBody2.deprecated).toBeUndefined();
-  });
-
-  test.each([['@verdaccio/deprecated-3']])(
-    'should deprecate a multiple packages %s',
-    async (pkgName) => {
-      const message = 'some message';
-      const { tempFolder } = await prepareGenericEmptyProject(
-        pkgName,
-        '1.0.0',
-        registry.port,
-        registry.getToken(),
-        registry.getRegistryUrl()
-      );
-      // publish 1.0.0
-      await publish(tempFolder, pkgName, registry);
-      // publish 1.1.0
-      await bumbUp(tempFolder, registry);
-      await publish(tempFolder, pkgName, registry);
-      // publish 1.2.0
-      await bumbUp(tempFolder, registry);
-      await publish(tempFolder, pkgName, registry);
-      // publish 1.3.0
-      await bumbUp(tempFolder, registry);
-      await publish(tempFolder, pkgName, registry);
-      // // deprecate all version
-      await deprecate(tempFolder, pkgName, registry, message);
-      // verify is deprecated
-      for (let v of ['1.0.0', '1.1.0', '1.2.0', '1.3.0']) {
-        const infoResp = await getInfoVersions(`${pkgName}@${v}`, registry);
-        expect(infoResp.deprecated).toEqual(message);
-      }
-      // publish normal version
-      // publish 1.4.0
-      await bumbUp(tempFolder, registry);
-      await publish(tempFolder, pkgName, registry);
-      const infoResp = await getInfoVersions(`${pkgName}@1.4.0`, registry);
-      // must be not deprecated
-      expect(infoResp.deprecated).toBeUndefined();
-    }
-  );
-
-  afterAll(async () => {
-    registry.stop();
-  });
-});
diff --git a/test/cli/e2e-npm6/jest.config.js b/test/cli/e2e-npm6/jest.config.js
index cd9759162..56618976e 100644
--- a/test/cli/e2e-npm6/jest.config.js
+++ b/test/cli/e2e-npm6/jest.config.js
@@ -1,3 +1,6 @@
-const config = require('../jest.config');
+const { defaults } = require('jest-config');
+const config = require('../../../jest/config');
 
-module.exports = { ...config };
+module.exports = Object.assign({}, config, {
+  moduleFileExtensions: [...defaults.moduleFileExtensions, 'ts'],
+});
diff --git a/test/cli/e2e-npm6/publish.spec.ts b/test/cli/e2e-npm6/publish.spec.ts
index 50b3bd42a..ed137ecb3 100644
--- a/test/cli/e2e-npm6/publish.spec.ts
+++ b/test/cli/e2e-npm6/publish.spec.ts
@@ -2,7 +2,7 @@ import { addRegistry, initialSetup, prepareGenericEmptyProject } from '@verdacci
 
 import { npm } from './utils';
 
-describe('publish a package', () => {
+describe('install a package', () => {
   jest.setTimeout(10000);
   let registry;
 
diff --git a/test/cli/e2e-npm7/deprecate.spec.ts b/test/cli/e2e-npm7/deprecate.spec.ts
deleted file mode 100644
index 37f38cfeb..000000000
--- a/test/cli/e2e-npm7/deprecate.spec.ts
+++ /dev/null
@@ -1,137 +0,0 @@
-import { addRegistry, initialSetup, prepareGenericEmptyProject } from '@verdaccio/test-cli-commons';
-
-import { npm } from './utils';
-
-describe('deprecate a package', () => {
-  jest.setTimeout(15000);
-  let registry;
-
-  async function bumbUp(tempFolder, registry) {
-    await npm({ cwd: tempFolder }, 'version', 'minor', ...addRegistry(registry.getRegistryUrl()));
-  }
-
-  async function publish(tempFolder, pkgName, registry) {
-    const resp = await npm(
-      { cwd: tempFolder },
-      'publish',
-      '--json',
-      ...addRegistry(registry.getRegistryUrl())
-    );
-    const parsedBody = JSON.parse(resp.stdout as string);
-    expect(parsedBody.name).toEqual(pkgName);
-  }
-
-  async function deprecate(tempFolder, packageVersion, registry, message) {
-    await npm(
-      { cwd: tempFolder },
-      'deprecate',
-      packageVersion,
-      message,
-      '--json',
-      ...addRegistry(registry.getRegistryUrl())
-    );
-  }
-
-  async function getInfoVersions(pkgName, registry) {
-    const infoResp = await npm(
-      {},
-      'info',
-      pkgName,
-      '--json',
-      ...addRegistry(registry.getRegistryUrl())
-    );
-    const infoBody = JSON.parse(infoResp.stdout as string);
-    return infoBody;
-  }
-
-  beforeAll(async () => {
-    const setup = await initialSetup();
-    registry = setup.registry;
-    await registry.init();
-  });
-
-  test.each([['@verdaccio/deprecated-1']])(
-    'should deprecate a single package %s',
-    async (pkgName) => {
-      const message = 'some message';
-      const { tempFolder } = await prepareGenericEmptyProject(
-        pkgName,
-        '1.0.0',
-        registry.port,
-        registry.getToken(),
-        registry.getRegistryUrl()
-      );
-      await publish(tempFolder, pkgName, registry);
-      // deprecate one version
-      await deprecate(tempFolder, `${pkgName}@1.0.0`, registry, message);
-      // verify is deprecated
-      const infoBody = await getInfoVersions(`${pkgName}`, registry);
-      expect(infoBody.name).toEqual(pkgName);
-      expect(infoBody.deprecated).toEqual(message);
-    }
-  );
-
-  test.each([['@verdaccio/deprecated-2']])('should un-deprecate a package %s', async (pkgName) => {
-    const message = 'some message';
-    const { tempFolder } = await prepareGenericEmptyProject(
-      pkgName,
-      '1.0.0',
-      registry.port,
-      registry.getToken(),
-      registry.getRegistryUrl()
-    );
-    await publish(tempFolder, pkgName, registry);
-    // deprecate one version
-    await deprecate(tempFolder, `${pkgName}@1.0.0`, registry, message);
-    // verify is deprecated
-    const infoBody = await getInfoVersions(`${pkgName}`, registry);
-    expect(infoBody.deprecated).toEqual(message);
-    // empty string is same as undeprecate
-    await deprecate(tempFolder, `${pkgName}@1.0.0`, registry, '');
-    const infoBody2 = await getInfoVersions(`${pkgName}`, registry);
-    expect(infoBody2.deprecated).toBeUndefined();
-  });
-
-  test.each([['@verdaccio/deprecated-3']])(
-    'should deprecate a multiple packages %s',
-    async (pkgName) => {
-      const message = 'some message';
-      const { tempFolder } = await prepareGenericEmptyProject(
-        pkgName,
-        '1.0.0',
-        registry.port,
-        registry.getToken(),
-        registry.getRegistryUrl()
-      );
-      // publish 1.0.0
-      await publish(tempFolder, pkgName, registry);
-      // publish 1.1.0
-      await bumbUp(tempFolder, registry);
-      await publish(tempFolder, pkgName, registry);
-      // publish 1.2.0
-      await bumbUp(tempFolder, registry);
-      await publish(tempFolder, pkgName, registry);
-      // publish 1.3.0
-      await bumbUp(tempFolder, registry);
-      await publish(tempFolder, pkgName, registry);
-      // // deprecate all version
-      await deprecate(tempFolder, pkgName, registry, message);
-      // verify is deprecated
-      for (let v of ['1.0.0', '1.1.0', '1.2.0', '1.3.0']) {
-        const infoResp = await getInfoVersions(`${pkgName}@${v}`, registry);
-        expect(infoResp.deprecated).toEqual(message);
-      }
-      // publish normal version
-      // publish 1.4.0
-      await bumbUp(tempFolder, registry);
-      await publish(tempFolder, pkgName, registry);
-      const infoResp = await getInfoVersions(`${pkgName}@1.4.0`, registry);
-      // must be not deprecated
-      expect(infoResp.deprecated).toBeUndefined();
-    }
-  );
-
-  afterAll(async () => {
-    registry.stop();
-  });
-});
diff --git a/test/cli/e2e-npm7/jest.config.js b/test/cli/e2e-npm7/jest.config.js
index cd9759162..56618976e 100644
--- a/test/cli/e2e-npm7/jest.config.js
+++ b/test/cli/e2e-npm7/jest.config.js
@@ -1,3 +1,6 @@
-const config = require('../jest.config');
+const { defaults } = require('jest-config');
+const config = require('../../../jest/config');
 
-module.exports = { ...config };
+module.exports = Object.assign({}, config, {
+  moduleFileExtensions: [...defaults.moduleFileExtensions, 'ts'],
+});
diff --git a/test/cli/e2e-npm8/deprecate.spec.ts b/test/cli/e2e-npm8/deprecate.spec.ts
deleted file mode 100644
index 37f38cfeb..000000000
--- a/test/cli/e2e-npm8/deprecate.spec.ts
+++ /dev/null
@@ -1,137 +0,0 @@
-import { addRegistry, initialSetup, prepareGenericEmptyProject } from '@verdaccio/test-cli-commons';
-
-import { npm } from './utils';
-
-describe('deprecate a package', () => {
-  jest.setTimeout(15000);
-  let registry;
-
-  async function bumbUp(tempFolder, registry) {
-    await npm({ cwd: tempFolder }, 'version', 'minor', ...addRegistry(registry.getRegistryUrl()));
-  }
-
-  async function publish(tempFolder, pkgName, registry) {
-    const resp = await npm(
-      { cwd: tempFolder },
-      'publish',
-      '--json',
-      ...addRegistry(registry.getRegistryUrl())
-    );
-    const parsedBody = JSON.parse(resp.stdout as string);
-    expect(parsedBody.name).toEqual(pkgName);
-  }
-
-  async function deprecate(tempFolder, packageVersion, registry, message) {
-    await npm(
-      { cwd: tempFolder },
-      'deprecate',
-      packageVersion,
-      message,
-      '--json',
-      ...addRegistry(registry.getRegistryUrl())
-    );
-  }
-
-  async function getInfoVersions(pkgName, registry) {
-    const infoResp = await npm(
-      {},
-      'info',
-      pkgName,
-      '--json',
-      ...addRegistry(registry.getRegistryUrl())
-    );
-    const infoBody = JSON.parse(infoResp.stdout as string);
-    return infoBody;
-  }
-
-  beforeAll(async () => {
-    const setup = await initialSetup();
-    registry = setup.registry;
-    await registry.init();
-  });
-
-  test.each([['@verdaccio/deprecated-1']])(
-    'should deprecate a single package %s',
-    async (pkgName) => {
-      const message = 'some message';
-      const { tempFolder } = await prepareGenericEmptyProject(
-        pkgName,
-        '1.0.0',
-        registry.port,
-        registry.getToken(),
-        registry.getRegistryUrl()
-      );
-      await publish(tempFolder, pkgName, registry);
-      // deprecate one version
-      await deprecate(tempFolder, `${pkgName}@1.0.0`, registry, message);
-      // verify is deprecated
-      const infoBody = await getInfoVersions(`${pkgName}`, registry);
-      expect(infoBody.name).toEqual(pkgName);
-      expect(infoBody.deprecated).toEqual(message);
-    }
-  );
-
-  test.each([['@verdaccio/deprecated-2']])('should un-deprecate a package %s', async (pkgName) => {
-    const message = 'some message';
-    const { tempFolder } = await prepareGenericEmptyProject(
-      pkgName,
-      '1.0.0',
-      registry.port,
-      registry.getToken(),
-      registry.getRegistryUrl()
-    );
-    await publish(tempFolder, pkgName, registry);
-    // deprecate one version
-    await deprecate(tempFolder, `${pkgName}@1.0.0`, registry, message);
-    // verify is deprecated
-    const infoBody = await getInfoVersions(`${pkgName}`, registry);
-    expect(infoBody.deprecated).toEqual(message);
-    // empty string is same as undeprecate
-    await deprecate(tempFolder, `${pkgName}@1.0.0`, registry, '');
-    const infoBody2 = await getInfoVersions(`${pkgName}`, registry);
-    expect(infoBody2.deprecated).toBeUndefined();
-  });
-
-  test.each([['@verdaccio/deprecated-3']])(
-    'should deprecate a multiple packages %s',
-    async (pkgName) => {
-      const message = 'some message';
-      const { tempFolder } = await prepareGenericEmptyProject(
-        pkgName,
-        '1.0.0',
-        registry.port,
-        registry.getToken(),
-        registry.getRegistryUrl()
-      );
-      // publish 1.0.0
-      await publish(tempFolder, pkgName, registry);
-      // publish 1.1.0
-      await bumbUp(tempFolder, registry);
-      await publish(tempFolder, pkgName, registry);
-      // publish 1.2.0
-      await bumbUp(tempFolder, registry);
-      await publish(tempFolder, pkgName, registry);
-      // publish 1.3.0
-      await bumbUp(tempFolder, registry);
-      await publish(tempFolder, pkgName, registry);
-      // // deprecate all version
-      await deprecate(tempFolder, pkgName, registry, message);
-      // verify is deprecated
-      for (let v of ['1.0.0', '1.1.0', '1.2.0', '1.3.0']) {
-        const infoResp = await getInfoVersions(`${pkgName}@${v}`, registry);
-        expect(infoResp.deprecated).toEqual(message);
-      }
-      // publish normal version
-      // publish 1.4.0
-      await bumbUp(tempFolder, registry);
-      await publish(tempFolder, pkgName, registry);
-      const infoResp = await getInfoVersions(`${pkgName}@1.4.0`, registry);
-      // must be not deprecated
-      expect(infoResp.deprecated).toBeUndefined();
-    }
-  );
-
-  afterAll(async () => {
-    registry.stop();
-  });
-});
diff --git a/test/cli/e2e-npm8/jest.config.js b/test/cli/e2e-npm8/jest.config.js
index cd9759162..56618976e 100644
--- a/test/cli/e2e-npm8/jest.config.js
+++ b/test/cli/e2e-npm8/jest.config.js
@@ -1,3 +1,6 @@
-const config = require('../jest.config');
+const { defaults } = require('jest-config');
+const config = require('../../../jest/config');
 
-module.exports = { ...config };
+module.exports = Object.assign({}, config, {
+  moduleFileExtensions: [...defaults.moduleFileExtensions, 'ts'],
+});
diff --git a/test/cli/e2e-pnpm6/deprecate.spec.ts b/test/cli/e2e-pnpm6/deprecate.spec.ts
deleted file mode 100644
index f4bc8e29a..000000000
--- a/test/cli/e2e-pnpm6/deprecate.spec.ts
+++ /dev/null
@@ -1,137 +0,0 @@
-import { addRegistry, initialSetup, prepareGenericEmptyProject } from '@verdaccio/test-cli-commons';
-
-import { pnpm } from './utils';
-
-describe('deprecate a package', () => {
-  jest.setTimeout(15000);
-  let registry;
-
-  async function bumbUp(tempFolder, registry) {
-    await pnpm({ cwd: tempFolder }, 'version', 'minor', ...addRegistry(registry.getRegistryUrl()));
-  }
-
-  async function publish(tempFolder, pkgName, registry) {
-    const resp = await pnpm(
-      { cwd: tempFolder },
-      'publish',
-      '--json',
-      ...addRegistry(registry.getRegistryUrl())
-    );
-    const parsedBody = JSON.parse(resp.stdout as string);
-    expect(parsedBody.name).toEqual(pkgName);
-  }
-
-  async function deprecate(tempFolder, packageVersion, registry, message) {
-    await pnpm(
-      { cwd: tempFolder },
-      'deprecate',
-      packageVersion,
-      message,
-      '--json',
-      ...addRegistry(registry.getRegistryUrl())
-    );
-  }
-
-  async function getInfoVersions(pkgName, registry) {
-    const infoResp = await pnpm(
-      {},
-      'info',
-      pkgName,
-      '--json',
-      ...addRegistry(registry.getRegistryUrl())
-    );
-    const infoBody = JSON.parse(infoResp.stdout as string);
-    return infoBody;
-  }
-
-  beforeAll(async () => {
-    const setup = await initialSetup();
-    registry = setup.registry;
-    await registry.init();
-  });
-
-  test.each([['@verdaccio/deprecated-1']])(
-    'should deprecate a single package %s',
-    async (pkgName) => {
-      const message = 'some message';
-      const { tempFolder } = await prepareGenericEmptyProject(
-        pkgName,
-        '1.0.0',
-        registry.port,
-        registry.getToken(),
-        registry.getRegistryUrl()
-      );
-      await publish(tempFolder, pkgName, registry);
-      // deprecate one version
-      await deprecate(tempFolder, `${pkgName}@1.0.0`, registry, message);
-      // verify is deprecated
-      const infoBody = await getInfoVersions(`${pkgName}`, registry);
-      expect(infoBody.name).toEqual(pkgName);
-      expect(infoBody.deprecated).toEqual(message);
-    }
-  );
-
-  test.each([['@verdaccio/deprecated-2']])('should un-deprecate a package %s', async (pkgName) => {
-    const message = 'some message';
-    const { tempFolder } = await prepareGenericEmptyProject(
-      pkgName,
-      '1.0.0',
-      registry.port,
-      registry.getToken(),
-      registry.getRegistryUrl()
-    );
-    await publish(tempFolder, pkgName, registry);
-    // deprecate one version
-    await deprecate(tempFolder, `${pkgName}@1.0.0`, registry, message);
-    // verify is deprecated
-    const infoBody = await getInfoVersions(`${pkgName}`, registry);
-    expect(infoBody.deprecated).toEqual(message);
-    // empty string is same as undeprecate
-    await deprecate(tempFolder, `${pkgName}@1.0.0`, registry, '');
-    const infoBody2 = await getInfoVersions(`${pkgName}`, registry);
-    expect(infoBody2.deprecated).toBeUndefined();
-  });
-
-  test.each([['@verdaccio/deprecated-3']])(
-    'should deprecate a multiple packages %s',
-    async (pkgName) => {
-      const message = 'some message';
-      const { tempFolder } = await prepareGenericEmptyProject(
-        pkgName,
-        '1.0.0',
-        registry.port,
-        registry.getToken(),
-        registry.getRegistryUrl()
-      );
-      // publish 1.0.0
-      await publish(tempFolder, pkgName, registry);
-      // publish 1.1.0
-      await bumbUp(tempFolder, registry);
-      await publish(tempFolder, pkgName, registry);
-      // publish 1.2.0
-      await bumbUp(tempFolder, registry);
-      await publish(tempFolder, pkgName, registry);
-      // publish 1.3.0
-      await bumbUp(tempFolder, registry);
-      await publish(tempFolder, pkgName, registry);
-      // // deprecate all version
-      await deprecate(tempFolder, pkgName, registry, message);
-      // verify is deprecated
-      for (let v of ['1.0.0', '1.1.0', '1.2.0', '1.3.0']) {
-        const infoResp = await getInfoVersions(`${pkgName}@${v}`, registry);
-        expect(infoResp.deprecated).toEqual(message);
-      }
-      // publish normal version
-      // publish 1.4.0
-      await bumbUp(tempFolder, registry);
-      await publish(tempFolder, pkgName, registry);
-      const infoResp = await getInfoVersions(`${pkgName}@1.4.0`, registry);
-      // must be not deprecated
-      expect(infoResp.deprecated).toBeUndefined();
-    }
-  );
-
-  afterAll(async () => {
-    registry.stop();
-  });
-});
diff --git a/test/cli/e2e-pnpm6/jest.config.js b/test/cli/e2e-pnpm6/jest.config.js
index cd9759162..56618976e 100644
--- a/test/cli/e2e-pnpm6/jest.config.js
+++ b/test/cli/e2e-pnpm6/jest.config.js
@@ -1,3 +1,6 @@
-const config = require('../jest.config');
+const { defaults } = require('jest-config');
+const config = require('../../../jest/config');
 
-module.exports = { ...config };
+module.exports = Object.assign({}, config, {
+  moduleFileExtensions: [...defaults.moduleFileExtensions, 'ts'],
+});
diff --git a/test/cli/e2e-pnpm7/deprecate.spec.ts b/test/cli/e2e-pnpm7/deprecate.spec.ts
deleted file mode 100644
index f4bc8e29a..000000000
--- a/test/cli/e2e-pnpm7/deprecate.spec.ts
+++ /dev/null
@@ -1,137 +0,0 @@
-import { addRegistry, initialSetup, prepareGenericEmptyProject } from '@verdaccio/test-cli-commons';
-
-import { pnpm } from './utils';
-
-describe('deprecate a package', () => {
-  jest.setTimeout(15000);
-  let registry;
-
-  async function bumbUp(tempFolder, registry) {
-    await pnpm({ cwd: tempFolder }, 'version', 'minor', ...addRegistry(registry.getRegistryUrl()));
-  }
-
-  async function publish(tempFolder, pkgName, registry) {
-    const resp = await pnpm(
-      { cwd: tempFolder },
-      'publish',
-      '--json',
-      ...addRegistry(registry.getRegistryUrl())
-    );
-    const parsedBody = JSON.parse(resp.stdout as string);
-    expect(parsedBody.name).toEqual(pkgName);
-  }
-
-  async function deprecate(tempFolder, packageVersion, registry, message) {
-    await pnpm(
-      { cwd: tempFolder },
-      'deprecate',
-      packageVersion,
-      message,
-      '--json',
-      ...addRegistry(registry.getRegistryUrl())
-    );
-  }
-
-  async function getInfoVersions(pkgName, registry) {
-    const infoResp = await pnpm(
-      {},
-      'info',
-      pkgName,
-      '--json',
-      ...addRegistry(registry.getRegistryUrl())
-    );
-    const infoBody = JSON.parse(infoResp.stdout as string);
-    return infoBody;
-  }
-
-  beforeAll(async () => {
-    const setup = await initialSetup();
-    registry = setup.registry;
-    await registry.init();
-  });
-
-  test.each([['@verdaccio/deprecated-1']])(
-    'should deprecate a single package %s',
-    async (pkgName) => {
-      const message = 'some message';
-      const { tempFolder } = await prepareGenericEmptyProject(
-        pkgName,
-        '1.0.0',
-        registry.port,
-        registry.getToken(),
-        registry.getRegistryUrl()
-      );
-      await publish(tempFolder, pkgName, registry);
-      // deprecate one version
-      await deprecate(tempFolder, `${pkgName}@1.0.0`, registry, message);
-      // verify is deprecated
-      const infoBody = await getInfoVersions(`${pkgName}`, registry);
-      expect(infoBody.name).toEqual(pkgName);
-      expect(infoBody.deprecated).toEqual(message);
-    }
-  );
-
-  test.each([['@verdaccio/deprecated-2']])('should un-deprecate a package %s', async (pkgName) => {
-    const message = 'some message';
-    const { tempFolder } = await prepareGenericEmptyProject(
-      pkgName,
-      '1.0.0',
-      registry.port,
-      registry.getToken(),
-      registry.getRegistryUrl()
-    );
-    await publish(tempFolder, pkgName, registry);
-    // deprecate one version
-    await deprecate(tempFolder, `${pkgName}@1.0.0`, registry, message);
-    // verify is deprecated
-    const infoBody = await getInfoVersions(`${pkgName}`, registry);
-    expect(infoBody.deprecated).toEqual(message);
-    // empty string is same as undeprecate
-    await deprecate(tempFolder, `${pkgName}@1.0.0`, registry, '');
-    const infoBody2 = await getInfoVersions(`${pkgName}`, registry);
-    expect(infoBody2.deprecated).toBeUndefined();
-  });
-
-  test.each([['@verdaccio/deprecated-3']])(
-    'should deprecate a multiple packages %s',
-    async (pkgName) => {
-      const message = 'some message';
-      const { tempFolder } = await prepareGenericEmptyProject(
-        pkgName,
-        '1.0.0',
-        registry.port,
-        registry.getToken(),
-        registry.getRegistryUrl()
-      );
-      // publish 1.0.0
-      await publish(tempFolder, pkgName, registry);
-      // publish 1.1.0
-      await bumbUp(tempFolder, registry);
-      await publish(tempFolder, pkgName, registry);
-      // publish 1.2.0
-      await bumbUp(tempFolder, registry);
-      await publish(tempFolder, pkgName, registry);
-      // publish 1.3.0
-      await bumbUp(tempFolder, registry);
-      await publish(tempFolder, pkgName, registry);
-      // // deprecate all version
-      await deprecate(tempFolder, pkgName, registry, message);
-      // verify is deprecated
-      for (let v of ['1.0.0', '1.1.0', '1.2.0', '1.3.0']) {
-        const infoResp = await getInfoVersions(`${pkgName}@${v}`, registry);
-        expect(infoResp.deprecated).toEqual(message);
-      }
-      // publish normal version
-      // publish 1.4.0
-      await bumbUp(tempFolder, registry);
-      await publish(tempFolder, pkgName, registry);
-      const infoResp = await getInfoVersions(`${pkgName}@1.4.0`, registry);
-      // must be not deprecated
-      expect(infoResp.deprecated).toBeUndefined();
-    }
-  );
-
-  afterAll(async () => {
-    registry.stop();
-  });
-});
diff --git a/test/cli/e2e-pnpm7/jest.config.js b/test/cli/e2e-pnpm7/jest.config.js
index cd9759162..56618976e 100644
--- a/test/cli/e2e-pnpm7/jest.config.js
+++ b/test/cli/e2e-pnpm7/jest.config.js
@@ -1,3 +1,6 @@
-const config = require('../jest.config');
+const { defaults } = require('jest-config');
+const config = require('../../../jest/config');
 
-module.exports = { ...config };
+module.exports = Object.assign({}, config, {
+  moduleFileExtensions: [...defaults.moduleFileExtensions, 'ts'],
+});
diff --git a/test/cli/e2e-yarn1/jest.config.js b/test/cli/e2e-yarn1/jest.config.js
index cd9759162..757434d39 100644
--- a/test/cli/e2e-yarn1/jest.config.js
+++ b/test/cli/e2e-yarn1/jest.config.js
@@ -1,3 +1,14 @@
-const config = require('../jest.config');
+const { defaults } = require('jest-config');
+const config = require('../../../jest/config');
 
-module.exports = { ...config };
+module.exports = Object.assign({}, config, {
+  name: 'verdaccio-e2e-cli-jest',
+  // verbose: true,
+  // collectCoverage: false,
+  moduleFileExtensions: [...defaults.moduleFileExtensions, 'ts'],
+  // testEnvironment: './env_babel.js',
+  // globalSetup: './env_setup.js',
+  // globalTeardown: './env_teardown.js',
+  // testRegex: '(/test/e2e.*\\.spec)\\.ts',
+  testRegex: '(/test/*.*.spec)\\.ts',
+});
diff --git a/test/cli/e2e-yarn2/info.spec.ts b/test/cli/e2e-yarn2/info.spec.ts
index 19e2c390a..21274ae75 100644
--- a/test/cli/e2e-yarn2/info.spec.ts
+++ b/test/cli/e2e-yarn2/info.spec.ts
@@ -23,9 +23,9 @@ describe('install a package', () => {
   });
 
   test('should run yarn 2 info json body', async () => {
-    const resp = await yarn(projectFolder, 'npm', 'info', 'react', '--json');
+    const resp = await yarn(projectFolder, 'npm', 'info', 'verdaccio', '--json');
     const parsedBody = JSON.parse(resp.stdout as string);
-    expect(parsedBody.name).toEqual('react');
+    expect(parsedBody.name).toEqual('verdaccio');
     expect(parsedBody.dependencies).toBeDefined();
   });
 
diff --git a/test/cli/e2e-yarn2/install.spec.ts b/test/cli/e2e-yarn2/install.spec.ts
index 2a3a01745..91486ee0b 100644
--- a/test/cli/e2e-yarn2/install.spec.ts
+++ b/test/cli/e2e-yarn2/install.spec.ts
@@ -5,7 +5,7 @@ import { initialSetup, prepareYarnModernProject } from '@verdaccio/test-cli-comm
 import { getYarnCommand, yarn } from './utils';
 
 describe('install a packages', () => {
-  jest.setTimeout(20000);
+  jest.setTimeout(10000);
   let registry;
   let projectFolder;
 
diff --git a/test/cli/e2e-yarn2/jest.config.js b/test/cli/e2e-yarn2/jest.config.js
index cd9759162..56618976e 100644
--- a/test/cli/e2e-yarn2/jest.config.js
+++ b/test/cli/e2e-yarn2/jest.config.js
@@ -1,3 +1,6 @@
-const config = require('../jest.config');
+const { defaults } = require('jest-config');
+const config = require('../../../jest/config');
 
-module.exports = { ...config };
+module.exports = Object.assign({}, config, {
+  moduleFileExtensions: [...defaults.moduleFileExtensions, 'ts'],
+});
diff --git a/test/cli/e2e-yarn3/info.spec.ts b/test/cli/e2e-yarn3/info.spec.ts
index a32428d2e..a3f0e8191 100644
--- a/test/cli/e2e-yarn3/info.spec.ts
+++ b/test/cli/e2e-yarn3/info.spec.ts
@@ -24,9 +24,9 @@ describe('install a package', () => {
 
   test('should run yarn 3 info json body', async () => {
     await yarn(projectFolder, 'install');
-    const resp = await yarn(projectFolder, 'npm', 'info', 'react', '--json');
+    const resp = await yarn(projectFolder, 'npm', 'info', 'verdaccio', '--json');
     const parsedBody = JSON.parse(resp.stdout as string);
-    expect(parsedBody.name).toEqual('react');
+    expect(parsedBody.name).toEqual('verdaccio');
     expect(parsedBody.dependencies).toBeDefined();
   });
 
diff --git a/test/cli/e2e-yarn3/install.spec.ts b/test/cli/e2e-yarn3/install.spec.ts
index 2a3a01745..91486ee0b 100644
--- a/test/cli/e2e-yarn3/install.spec.ts
+++ b/test/cli/e2e-yarn3/install.spec.ts
@@ -5,7 +5,7 @@ import { initialSetup, prepareYarnModernProject } from '@verdaccio/test-cli-comm
 import { getYarnCommand, yarn } from './utils';
 
 describe('install a packages', () => {
-  jest.setTimeout(20000);
+  jest.setTimeout(10000);
   let registry;
   let projectFolder;
 
diff --git a/test/cli/e2e-yarn3/jest.config.js b/test/cli/e2e-yarn3/jest.config.js
index cd9759162..56618976e 100644
--- a/test/cli/e2e-yarn3/jest.config.js
+++ b/test/cli/e2e-yarn3/jest.config.js
@@ -1,3 +1,6 @@
-const config = require('../jest.config');
+const { defaults } = require('jest-config');
+const config = require('../../../jest/config');
 
-module.exports = { ...config };
+module.exports = Object.assign({}, config, {
+  moduleFileExtensions: [...defaults.moduleFileExtensions, 'ts'],
+});
diff --git a/test/cli/e2e-yarn4/info.spec.ts b/test/cli/e2e-yarn4/info.spec.ts
index d83850791..fee9162dc 100644
--- a/test/cli/e2e-yarn4/info.spec.ts
+++ b/test/cli/e2e-yarn4/info.spec.ts
@@ -23,9 +23,9 @@ describe('install a package', () => {
   });
 
   test('should run yarn 4 info json body', async () => {
-    const resp = await yarn(projectFolder, 'npm', 'info', 'react', '--json');
+    const resp = await yarn(projectFolder, 'npm', 'info', 'verdaccio', '--json');
     const parsedBody = JSON.parse(resp.stdout as string);
-    expect(parsedBody.name).toEqual('react');
+    expect(parsedBody.name).toEqual('verdaccio');
     expect(parsedBody.dependencies).toBeDefined();
   });
 
diff --git a/test/cli/e2e-yarn4/install.spec.ts b/test/cli/e2e-yarn4/install.spec.ts
index 2a3a01745..91486ee0b 100644
--- a/test/cli/e2e-yarn4/install.spec.ts
+++ b/test/cli/e2e-yarn4/install.spec.ts
@@ -5,7 +5,7 @@ import { initialSetup, prepareYarnModernProject } from '@verdaccio/test-cli-comm
 import { getYarnCommand, yarn } from './utils';
 
 describe('install a packages', () => {
-  jest.setTimeout(20000);
+  jest.setTimeout(10000);
   let registry;
   let projectFolder;
 
diff --git a/test/cli/e2e-yarn4/jest.config.js b/test/cli/e2e-yarn4/jest.config.js
index cd9759162..56618976e 100644
--- a/test/cli/e2e-yarn4/jest.config.js
+++ b/test/cli/e2e-yarn4/jest.config.js
@@ -1,3 +1,6 @@
-const config = require('../jest.config');
+const { defaults } = require('jest-config');
+const config = require('../../../jest/config');
 
-module.exports = { ...config };
+module.exports = Object.assign({}, config, {
+  moduleFileExtensions: [...defaults.moduleFileExtensions, 'ts'],
+});
diff --git a/test/cli/jest.config.js b/test/cli/jest.config.js
deleted file mode 100644
index 17ef24684..000000000
--- a/test/cli/jest.config.js
+++ /dev/null
@@ -1,8 +0,0 @@
-const { defaults } = require('jest-config');
-const config = require('../../jest/config');
-
-module.exports = Object.assign({}, config, {
-  collectCoverage: false,
-  coverageReporters: ['text'],
-  moduleFileExtensions: [...defaults.moduleFileExtensions, 'ts'],
-});
