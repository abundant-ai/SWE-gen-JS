diff --git a/.github/workflows/prod-test.yml b/.github/workflows/prod-test.yml
index 4a12cf2d2..bf6c99529 100644
--- a/.github/workflows/prod-test.yml
+++ b/.github/workflows/prod-test.yml
@@ -75,9 +75,8 @@ jobs:
           - os: "ubuntu-latest"
             node: "16"
           # Tests on Intel Mac x Node.js 14 ( https://github.com/prettier/prettier/issues/16248 )
-          # We are disabling MacOS x Node.js 14 temporary ( https://github.com/prettier/prettier/issues/16964 )
-          # - os: "macos-13"
-          #   node: "14"
+          - os: "macos-13"
+            node: "14"
         # setup-node does not support Node.js 14 x M1 Mac
         exclude:
           - os: "macos-latest"
diff --git a/changelog_unreleased/api/17344.md b/changelog_unreleased/api/17344.md
new file mode 100644
index 000000000..fb4762bdc
--- /dev/null
+++ b/changelog_unreleased/api/17344.md
@@ -0,0 +1,20 @@
+#### Ignore files with `--check-ignore-pragma` (#17344 by @wnayes)
+
+Individual files can now opt out of formatting via `@noformat` or `@noprettier` "pragma" comments at the top of the file.
+
+To enable this feature, use the new option [`--check-ignore-pragma`](https://prettier.io/docs/options#check-ignore-pragma) (`checkIgnorePragma` via configuration or API).
+
+Language plugins can [implement support](https://prettier.io/docs/plugins#parsers) for this feature. Most built-in parsers, including JavaScript (TypeScript), CSS, HTML, JSON, Markdown (MDX), YAML, and GraphQL, were updated to support this feature.
+
+<!-- prettier-ignore -->
+```jsx
+/**
+ * @noformat
+ */
+
+export default matrix(
+  1, 0, 0,
+  0, 1, 0,
+  0, 0, 1
+);
+```
diff --git a/changelog_unreleased/javascript/17398.md b/changelog_unreleased/javascript/17398.md
deleted file mode 100644
index a45a7831f..000000000
--- a/changelog_unreleased/javascript/17398.md
+++ /dev/null
@@ -1,19 +0,0 @@
-#### Preserve spaces between CSS words and embedded expression (#17398 by @sosukesuzuki)
-
-<!-- prettier-ignore -->
-```jsx
-// Input
-const Heading = styled.h1`
-    font-size: var(--font-size-h${level});
-`;
-
-// Prettier stable
-const Heading = styled.h1`
-    font-size: var(--font-size-h ${level});
-`;
-
-// Prettier main
-const Heading = styled.h1`
-    font-size: var(--font-size-h${level});
-`;
-```
diff --git a/cspell.json b/cspell.json
index 65802f9be..246432cdd 100644
--- a/cspell.json
+++ b/cspell.json
@@ -159,6 +159,7 @@
         "lintstaged",
         "lintstagedrc",
         "literalline",
+        "llms",
         "loglevel",
         "lydell",
         "Marek",
@@ -194,9 +195,11 @@
         "neoformat",
         "neovim",
         "nnoremap",
+        "noformat",
         "nonenumerable",
         "Nonspacing",
         "noopener",
+        "noprettier",
         "noreferrer",
         "normalise",
         "normalised",
diff --git a/docs/options.md b/docs/options.md
index 157110b60..9f5bf1afe 100644
--- a/docs/options.md
+++ b/docs/options.md
@@ -394,6 +394,34 @@ Note that “in tandem” doesn’t mean “at the same time”. When the two op
 
 [adoption strategy]: https://prettier.io/blog/2017/05/03/1.3.0.html#facebook-adoption-update
 
+## Check Ignore Pragma
+
+_First available in v3.6.0_
+
+Prettier can allow individual files to opt out of formatting if they contain a special comment, called a pragma, at the top of the file.
+
+Checking for these markers incurs a small upfront cost during formatting, so it's not enabled by default.
+
+A file with the following as its first comment will **not** be formatted when `--check-ignore-pragma` is supplied:
+
+```js
+/**
+ * @noprettier
+ */
+```
+
+or
+
+```js
+/**
+ * @noformat
+ */
+```
+
+| Default | CLI Override            | API Override                |
+| ------- | ----------------------- | --------------------------- |
+| `false` | `--check-ignore-pragma` | `checkIgnorePragma: <bool>` |
+
 ## Prose Wrap
 
 _First available in v1.8.2_
diff --git a/docs/plugins.md b/docs/plugins.md
index 7597a6e23..e7e6c8864 100644
--- a/docs/plugins.md
+++ b/docs/plugins.md
@@ -113,6 +113,7 @@ export const parsers = {
     // The name of the AST that the parser produces.
     astFormat: "dance-ast",
     hasPragma,
+    hasIgnorePragma,
     locStart,
     locEnd,
     preprocess,
@@ -138,6 +139,12 @@ _(Optional)_ The pragma detection function (`hasPragma`) should return if the te
 function hasPragma(text: string): boolean;
 ```
 
+_(Optional)_ The "ignore pragma" detection function (`hasIgnorePragma`) should return if the text contains a pragma indicating the text should not be formatted.
+
+```ts
+function hasIgnorePragma(text: string): boolean;
+```
+
 _(Optional)_ The preprocess function can process the input text before passing into `parse` function.
 
 ```ts
diff --git a/jest.config.js b/jest.config.js
index 4376f74e1..873afa7be 100644
--- a/jest.config.js
+++ b/jest.config.js
@@ -63,7 +63,7 @@ const config = {
     "<rootDir>/tests/config/format-test-setup.js",
     "<rootDir>/tests/integration/integration-test-setup.js",
   ],
-  runner: "jest-light-runner",
+  runner: "jest-light-runner/child-process",
   snapshotSerializers: [
     "jest-snapshot-serializer-raw",
     "jest-snapshot-serializer-ansi",
diff --git a/package.json b/package.json
index dac94147d..b5e435d6d 100644
--- a/package.json
+++ b/package.json
@@ -30,7 +30,7 @@
     "bin"
   ],
   "dependencies": {
-    "@angular/compiler": "19.2.5",
+    "@angular/compiler": "19.2.7",
     "@babel/code-frame": "7.26.2",
     "@babel/parser": "7.27.0",
     "@babel/types": "7.27.0",
@@ -136,7 +136,7 @@
     "globals": "16.0.0",
     "index-to-position": "1.1.0",
     "jest": "30.0.0-alpha.7",
-    "jest-light-runner": "0.6.0",
+    "jest-light-runner": "0.7.8",
     "jest-snapshot-serializer-ansi": "2.2.1",
     "jest-snapshot-serializer-raw": "2.0.0",
     "jest-watch-typeahead": "2.2.2",
@@ -160,7 +160,7 @@
   },
   "scripts": {
     "prepublishOnly": "echo \"Error: must publish from dist/\" && exit 1",
-    "test": "jest --runInBand",
+    "test": "jest",
     "test:dev-package": "cross-env INSTALL_PACKAGE=1 yarn test",
     "test:dist": "cross-env NODE_ENV=production yarn test",
     "test:dist-standalone": "cross-env TEST_STANDALONE=1 yarn test:dist",
diff --git a/src/cli/format.js b/src/cli/format.js
index 5f3e04b51..eedeb4c9b 100644
--- a/src/cli/format.js
+++ b/src/cli/format.js
@@ -1,22 +1,20 @@
 import fs from "node:fs/promises";
 import path from "node:path";
+import getStdin from "get-stdin";
 import * as prettier from "../index.js";
 import { expandPatterns } from "./expand-patterns.js";
 import findCacheFile from "./find-cache-file.js";
 import FormatResultsCache from "./format-results-cache.js";
-import isTTY from "./is-tty.js";
+import mockable from "./mockable.js";
 import getOptionsForFile from "./options/get-options-for-file.js";
 import {
   createIsIgnoredFunction,
   createTwoFilesPatch,
   errors,
-  mockable,
   picocolors,
 } from "./prettier-internal.js";
 import { normalizeToPosix, statSafe } from "./utils.js";
 
-const { getStdin, writeFormattedFile } = mockable;
-
 function diff(a, b) {
   return createTwoFilesPatch("", "", a, b, "", "", { context: 2 });
 }
@@ -32,7 +30,7 @@ function handleError(context, filename, error, printedFilename, ignoreUnknown) {
     error instanceof errors.UndefinedParserError;
 
   if (printedFilename) {
-    // Can't test on CI, `isTTY()` is always false, see ./is-tty.js
+    // Can't test on CI, `isTTY` is always false, see comments in `formatFiles`
     /* c8 ignore next 3 */
     if ((context.argv.write || ignoreUnknown) && errorIsUndefinedParseError) {
       printedFilename.clear();
@@ -192,14 +190,11 @@ async function format(context, input, opt) {
     context.logger.debug(
       `'${performanceTestFlag.name}' found, running formatWithCursor ${repeat} times.`,
     );
-    let totalMs = 0;
+    const start = mockable.getTimestamp();
     for (let i = 0; i < repeat; ++i) {
-      // should be using `performance.now()`, but only `Date` is cross-platform enough
-      const startMs = Date.now();
       await prettier.formatWithCursor(input, opt);
-      totalMs += Date.now() - startMs;
     }
-    const averageMs = totalMs / repeat;
+    const averageMs = (mockable.getTimestamp() - start) / repeat;
     const results = {
       repeat,
       hz: 1000 / averageMs,
@@ -305,6 +300,11 @@ async function formatFiles(context) {
     }
   }
 
+  // Some CI pipelines incorrectly report process.stdout.isTTY status,
+  // which causes unwanted lines in the output. An additional check for isCI() helps.
+  // See https://github.com/prettier/prettier/issues/5801
+  const isTTY = mockable.isStreamTTY(process.stdout) && !mockable.isCI();
+
   for await (const { error, filename, ignoreUnknown } of expandPatterns(
     context,
   )) {
@@ -333,7 +333,7 @@ async function formatFiles(context) {
 
     const fileNameToDisplay = normalizeToPosix(path.relative(cwd, filename));
     let printedFilename;
-    if (isTTY()) {
+    if (isTTY) {
       printedFilename = context.logger.log(fileNameToDisplay, {
         newline: false,
         clearable: true,
@@ -365,7 +365,7 @@ async function formatFiles(context) {
       continue;
     }
 
-    const start = Date.now();
+    const start = mockable.getTimestamp();
 
     const isCacheExists = formatResultsCache?.existsAvailableFormatResultsCache(
       filename,
@@ -407,15 +407,16 @@ async function formatFiles(context) {
     }
 
     if (context.argv.write) {
+      const timeToDisplay = `${Math.round(mockable.getTimestamp() - start)}ms`;
       // Don't write the file if it won't change in order not to invalidate
       // mtime based caches.
       if (isDifferent) {
         if (!context.argv.check && !context.argv.listDifferent) {
-          context.logger.log(`${fileNameToDisplay} ${Date.now() - start}ms`);
+          context.logger.log(`${fileNameToDisplay} ${timeToDisplay}`);
         }
 
         try {
-          await writeFormattedFile(filename, output);
+          await mockable.writeFormattedFile(filename, output);
 
           // Set cache if format succeeds
           shouldSetCache = true;
@@ -428,9 +429,7 @@ async function formatFiles(context) {
           process.exitCode = 2;
         }
       } else if (!context.argv.check && !context.argv.listDifferent) {
-        const message = `${picocolors.gray(fileNameToDisplay)} ${
-          Date.now() - start
-        }ms (unchanged)`;
+        const message = `${picocolors.gray(fileNameToDisplay)} ${timeToDisplay} (unchanged)`;
         if (isCacheExists) {
           context.logger.log(`${message} (cached)`);
         } else {
diff --git a/src/cli/index.js b/src/cli/index.js
index 81e6ef407..9335874ef 100644
--- a/src/cli/index.js
+++ b/src/cli/index.js
@@ -4,6 +4,7 @@ import logFileInfoOrDie from "./file-info.js";
 import logResolvedConfigPathOrDie from "./find-config-path.js";
 import { formatFiles, formatStdin } from "./format.js";
 import createLogger from "./logger.js";
+import mockable from "./mockable.js";
 import { parseArgvWithoutPlugins } from "./options/parse-cli-arguments.js";
 import printSupportInfo from "./print-support-info.js";
 import { createDetailedUsage, createUsage } from "./usage.js";
@@ -88,7 +89,8 @@ async function main(context) {
 
   const hasFilePatterns = context.filePatterns.length > 0;
   const useStdin =
-    !hasFilePatterns && (!process.stdin.isTTY || context.argv.filepath);
+    !hasFilePatterns &&
+    (!mockable.isStreamTTY(process.stdin) || context.argv.filepath);
 
   if (useStdin) {
     if (context.argv.cache) {
@@ -109,3 +111,5 @@ async function main(context) {
 }
 
 export { run };
+// Exposed for tests
+export { mockable } from "./mockable.js";
diff --git a/src/cli/is-tty.js b/src/cli/is-tty.js
deleted file mode 100644
index fc8e9bca0..000000000
--- a/src/cli/is-tty.js
+++ /dev/null
@@ -1,8 +0,0 @@
-import { mockable } from "./prettier-internal.js";
-
-// Some CI pipelines incorrectly report process.stdout.isTTY status,
-// which causes unwanted lines in the output. An additional check for isCI() helps.
-// See https://github.com/prettier/prettier/issues/5801
-export default function isTTY() {
-  return process.stdout.isTTY && !mockable.isCI();
-}
diff --git a/src/cli/logger.js b/src/cli/logger.js
index 1eab35dee..ba59caa90 100644
--- a/src/cli/logger.js
+++ b/src/cli/logger.js
@@ -1,31 +1,6 @@
-import readline from "node:readline";
-import stripAnsi from "strip-ansi";
-import wcwidth from "wcwidth.js";
+import mockable from "./mockable.js";
 import { picocolors } from "./prettier-internal.js";
 
-const countLines = (stream, text) => {
-  const columns = stream.columns || 80;
-  let lineCount = 0;
-  for (const line of stripAnsi(text).split("\n")) {
-    lineCount += Math.max(1, Math.ceil(wcwidth(line) / columns));
-  }
-  return lineCount;
-};
-
-const clear = (stream, text) => () => {
-  const lineCount = countLines(stream, text);
-
-  for (let line = 0; line < lineCount; line++) {
-    /* c8 ignore next 3 */
-    if (line > 0) {
-      readline.moveCursor(stream, 0, -1);
-    }
-
-    readline.clearLine(stream, 0);
-    readline.cursorTo(stream, 0);
-  }
-};
-
 const emptyLogResult = { clear() {} };
 function createLogger(logLevel = "log") {
   return {
@@ -56,7 +31,7 @@ function createLogger(logLevel = "log") {
 
       if (options.clearable) {
         return {
-          clear: clear(stream, message),
+          clear: () => mockable.clearStreamText(stream, message),
         };
       }
     };
diff --git a/src/cli/mockable.js b/src/cli/mockable.js
new file mode 100644
index 000000000..804da58fd
--- /dev/null
+++ b/src/cli/mockable.js
@@ -0,0 +1,17 @@
+import fs from "node:fs/promises";
+import { performance } from "node:perf_hooks";
+import { isCI } from "ci-info";
+// @ts-expect-error
+import { __internal as sharedWithCli } from "../index.js";
+import clearStreamText from "./utilities/clear-stream-text.js";
+
+const mockable = sharedWithCli.utils.createMockable({
+  clearStreamText,
+  getTimestamp: performance.now.bind(performance),
+  isCI: () => isCI,
+  isStreamTTY: (stream) => stream.isTTY,
+  writeFormattedFile: (file, data) => fs.writeFile(file, data),
+});
+
+export default mockable.mocked;
+export { mockable };
diff --git a/src/cli/prettier-internal.js b/src/cli/prettier-internal.js
index ef7d83d61..055114054 100644
--- a/src/cli/prettier-internal.js
+++ b/src/cli/prettier-internal.js
@@ -12,7 +12,6 @@ export const {
   vnopts,
   fastGlob,
   createTwoFilesPatch,
-  mockable,
   picocolors,
   leven,
 } = sharedWithCli;
diff --git a/src/cli/utilities/clear-stream-text.js b/src/cli/utilities/clear-stream-text.js
new file mode 100644
index 000000000..36c8355f2
--- /dev/null
+++ b/src/cli/utilities/clear-stream-text.js
@@ -0,0 +1,28 @@
+import readline from "node:readline";
+import stripAnsi from "strip-ansi";
+import wcwidth from "wcwidth.js";
+
+const countLines = (stream, text) => {
+  const columns = stream.columns || 80;
+  let lineCount = 0;
+  for (const line of stripAnsi(text).split("\n")) {
+    lineCount += Math.max(1, Math.ceil(wcwidth(line) / columns));
+  }
+  return lineCount;
+};
+
+function clearStreamText(stream, text) {
+  const lineCount = countLines(stream, text);
+
+  for (let line = 0; line < lineCount; line++) {
+    /* c8 ignore next 3 */
+    if (line > 0) {
+      readline.moveCursor(stream, 0, -1);
+    }
+
+    readline.clearLine(stream, 0);
+    readline.cursorTo(stream, 0);
+  }
+}
+
+export default clearStreamText;
diff --git a/src/common/mockable.js b/src/common/mockable.js
index 97acb8c6b..cbf68566c 100644
--- a/src/common/mockable.js
+++ b/src/common/mockable.js
@@ -1,16 +1,8 @@
-import fs from "node:fs/promises";
-import { isCI } from "ci-info";
-import getStdin from "get-stdin";
+import createMockable from "../utils/create-mockable.js";
 
-function writeFormattedFile(file, data) {
-  return fs.writeFile(file, data);
-}
-
-const mockable = {
+const mockable = createMockable({
   getPrettierConfigSearchStopDirectory: () => undefined,
-  getStdin,
-  isCI: () => isCI,
-  writeFormattedFile,
-};
+});
 
-export default mockable;
+export default mockable.mocked;
+export { mockable };
diff --git a/src/index.d.ts b/src/index.d.ts
index ea505bdf8..c8f10e1e7 100644
--- a/src/index.d.ts
+++ b/src/index.d.ts
@@ -385,6 +385,11 @@ export interface RequiredOptions extends doc.printer.Options {
    * @default false
    */
   insertPragma: boolean;
+  /**
+   * Prettier can allow individual files to opt out of formatting if they contain a special comment, called a pragma, at the top of the file.
+   * @default false
+   */
+  checkIgnorePragma: boolean;
   /**
    * By default, Prettier will wrap markdown text as-is since some services use a linebreak-sensitive renderer.
    * In some cases you may want to rely on editor/viewer soft wrapping instead, so this option allows you to opt out.
@@ -471,6 +476,7 @@ export interface Parser<T = any> {
   parse: (text: string, options: ParserOptions<T>) => T | Promise<T>;
   astFormat: string;
   hasPragma?: ((text: string) => boolean) | undefined;
+  hasIgnorePragma?: ((text: string) => boolean) | undefined;
   locStart: (node: T) => number;
   locEnd: (node: T) => number;
   preprocess?:
diff --git a/src/index.js b/src/index.js
index 6d88aa219..cf06e88c9 100644
--- a/src/index.js
+++ b/src/index.js
@@ -12,7 +12,7 @@ import picocolors from "picocolors";
 import * as vnopts from "vnopts";
 import * as errors from "./common/errors.js";
 import getFileInfoWithoutPlugins from "./common/get-file-info.js";
-import mockable from "./common/mockable.js";
+import { mockable } from "./common/mockable.js";
 import {
   clearCache as clearConfigCache,
   resolveConfig,
@@ -31,6 +31,7 @@ import {
   getSupportInfo as getSupportInfoWithoutPlugins,
   normalizeOptionSettings,
 } from "./main/support.js";
+import createMockable from "./utils/create-mockable.js";
 import { createIsIgnoredFunction } from "./utils/ignore.js";
 import inferParserWithoutPlugins from "./utils/infer-parser.js";
 import omit from "./utils/object-omit.js";
@@ -114,8 +115,8 @@ const sharedWithCli = {
   leven,
   utils: {
     omit,
+    createMockable,
   },
-  mockable,
 };
 
 const debugApis = {
@@ -124,6 +125,7 @@ const debugApis = {
   formatDoc: withPlugins(core.formatDoc),
   printToDoc: withPlugins(core.printToDoc),
   printDocToString: withPlugins(core.printDocToString),
+  // Exposed for tests
   mockable,
 };
 
diff --git a/src/language-css/loc.js b/src/language-css/loc.js
index 6b4ea4dc4..c01e5f896 100644
--- a/src/language-css/loc.js
+++ b/src/language-css/loc.js
@@ -2,14 +2,6 @@ import isNonEmptyArray from "../utils/is-non-empty-array.js";
 import lineColumnToIndex from "../utils/line-column-to-index.js";
 import { skipEverythingButNewLine } from "../utils/skip.js";
 
-function fixValueWordLoc(node, originalIndex) {
-  const { value } = node;
-  if (value === "-" || value === "--" || value.charAt(0) !== "-") {
-    return originalIndex;
-  }
-  return originalIndex - (value.charAt(1) === "-" ? 2 : 1);
-}
-
 function calculateLocStart(node, text) {
   // `postcss>=8`
   if (typeof node.source?.start?.offset === "number") {
@@ -18,9 +10,6 @@ function calculateLocStart(node, text) {
 
   // value-* nodes have this
   if (typeof node.sourceIndex === "number") {
-    if (node.type === "value-word") {
-      return fixValueWordLoc(node, node.sourceIndex);
-    }
     return node.sourceIndex;
   }
 
@@ -44,11 +33,7 @@ function calculateLocEnd(node, text) {
 
   if (node.source) {
     if (node.source.end) {
-      const index = lineColumnToIndex(node.source.end, text);
-      if (node.type === "value-word") {
-        return fixValueWordLoc(node, index);
-      }
-      return index;
+      return lineColumnToIndex(node.source.end, text);
     }
 
     if (isNonEmptyArray(node.nodes)) {
diff --git a/src/language-css/parser-postcss.js b/src/language-css/parser-postcss.js
index ff46fa30f..c7923a532 100644
--- a/src/language-css/parser-postcss.js
+++ b/src/language-css/parser-postcss.js
@@ -13,7 +13,7 @@ import parseMediaQuery from "./parse/parse-media-query.js";
 import parseSelector from "./parse/parse-selector.js";
 import parseValue from "./parse/parse-value.js";
 import { addTypePrefix } from "./parse/utils.js";
-import { hasPragma } from "./pragma.js";
+import { hasIgnorePragma, hasPragma } from "./pragma.js";
 import isModuleRuleName from "./utils/is-module-rule-name.js";
 import isSCSSNestedPropertyNode from "./utils/is-scss-nested-property-node.js";
 
@@ -430,6 +430,7 @@ function parseScss(text, options = {}) {
 const postCssParser = {
   astFormat: "postcss",
   hasPragma,
+  hasIgnorePragma,
   locStart,
   locEnd,
 };
diff --git a/src/language-css/pragma.js b/src/language-css/pragma.js
index 5f28841d1..6145002ca 100644
--- a/src/language-css/pragma.js
+++ b/src/language-css/pragma.js
@@ -1,4 +1,5 @@
 import {
+  hasIgnorePragma as jsHasIgnorePragma,
   hasPragma as jsHasPragma,
   insertPragma as jsInsertPragma,
 } from "../language-js/pragma.js";
@@ -8,6 +9,10 @@ function hasPragma(text) {
   return jsHasPragma(parseFrontMatter(text).content);
 }
 
+function hasIgnorePragma(text) {
+  return jsHasIgnorePragma(parseFrontMatter(text).content);
+}
+
 function insertPragma(text) {
   const { frontMatter, content } = parseFrontMatter(text);
   return (
@@ -15,4 +20,4 @@ function insertPragma(text) {
   );
 }
 
-export { hasPragma, insertPragma };
+export { hasIgnorePragma, hasPragma, insertPragma };
diff --git a/src/language-css/print/comma-separated-value-group.js b/src/language-css/print/comma-separated-value-group.js
index 37f112255..ab4cdce7f 100644
--- a/src/language-css/print/comma-separated-value-group.js
+++ b/src/language-css/print/comma-separated-value-group.js
@@ -147,15 +147,11 @@ function printCommaSeparatedValueGroup(path, options, print) {
       continue;
     }
 
-    // We should keep spaces between words in a embedded JS expression
-    // examples:
-    //   styled.div` font-size: var(--font-size-h${({ level }) => level}); `;
-    //   styled.div` grid-area: area-${({ area }) => area}; `;
-    //   styled.div` border: 1px ${solid} red; `;
+    // styled.div` background: var(--${one}); `
     if (
       iNode.type === "value-word" &&
-      isAtWordPlaceholderNode(iNextNode) &&
-      locEnd(iNode) === locStart(iNextNode)
+      iNode.value.endsWith("-") &&
+      isAtWordPlaceholderNode(iNextNode)
     ) {
       continue;
     }
diff --git a/src/language-graphql/parser-graphql.js b/src/language-graphql/parser-graphql.js
index 8f35ce61e..d833863f5 100644
--- a/src/language-graphql/parser-graphql.js
+++ b/src/language-graphql/parser-graphql.js
@@ -1,7 +1,7 @@
 import { parse as parseGraphql } from "graphql/language/parser.mjs";
 import createError from "../common/parser-create-error.js";
 import { locEnd, locStart } from "./loc.js";
-import { hasPragma } from "./pragma.js";
+import { hasIgnorePragma, hasPragma } from "./pragma.js";
 
 function parseComments(ast) {
   const comments = [];
@@ -48,6 +48,7 @@ export const graphql = {
   parse,
   astFormat: "graphql",
   hasPragma,
+  hasIgnorePragma,
   locStart,
   locEnd,
 };
diff --git a/src/language-graphql/pragma.js b/src/language-graphql/pragma.js
index 449d93781..005c0dc9c 100644
--- a/src/language-graphql/pragma.js
+++ b/src/language-graphql/pragma.js
@@ -1,5 +1,6 @@
 import {
   FORMAT_PRAGMA_TO_INSERT,
+  GRAPHQL_HAS_IGNORE_PRAGMA_REGEXP,
   GRAPHQL_HAS_PRAGMA_REGEXP,
 } from "../utils/pragma/pragma.evaluate.js";
 
@@ -7,8 +8,12 @@ function hasPragma(text) {
   return GRAPHQL_HAS_PRAGMA_REGEXP.test(text);
 }
 
+function hasIgnorePragma(text) {
+  return GRAPHQL_HAS_IGNORE_PRAGMA_REGEXP.test(text);
+}
+
 function insertPragma(text) {
   return `# @${FORMAT_PRAGMA_TO_INSERT}\n\n${text}`;
 }
 
-export { hasPragma, insertPragma };
+export { hasIgnorePragma, hasPragma, insertPragma };
diff --git a/src/language-html/parser-html.js b/src/language-html/parser-html.js
index 57af1d01f..e9af4eee9 100644
--- a/src/language-html/parser-html.js
+++ b/src/language-html/parser-html.js
@@ -15,7 +15,7 @@ import isNonEmptyArray from "../utils/is-non-empty-array.js";
 import { Node } from "./ast.js";
 import { parseIeConditionalComment } from "./conditional-comment.js";
 import { locEnd, locStart } from "./loc.js";
-import { hasPragma } from "./pragma.js";
+import { hasIgnorePragma, hasPragma } from "./pragma.js";
 import HTML_ELEMENT_ATTRIBUTES from "./utils/html-elements-attributes.evaluate.js";
 import HTML_TAGS from "./utils/html-tag-names.evaluate.js";
 import isUnknownNamespace from "./utils/is-unknown-namespace.js";
@@ -428,6 +428,7 @@ function createParser(parseOptions) {
   return {
     parse: (text, options) => parse(text, parseOptions, options),
     hasPragma,
+    hasIgnorePragma,
     astFormat: "html",
     locStart,
     locEnd,
diff --git a/src/language-html/pragma.js b/src/language-html/pragma.js
index 198c92e5e..e220fcdcb 100644
--- a/src/language-html/pragma.js
+++ b/src/language-html/pragma.js
@@ -1,15 +1,19 @@
 import {
   FORMAT_PRAGMA_TO_INSERT,
+  HTML_HAS_IGNORE_PRAGMA_REGEXP,
   HTML_HAS_PRAGMA_REGEXP,
 } from "../utils/pragma/pragma.evaluate.js";
 
 function hasPragma(text) {
-  // FIXME
   return HTML_HAS_PRAGMA_REGEXP.test(text);
 }
 
+function hasIgnorePragma(text) {
+  return HTML_HAS_IGNORE_PRAGMA_REGEXP.test(text);
+}
+
 function insertPragma(text) {
   return `<!-- @${FORMAT_PRAGMA_TO_INSERT} -->\n\n${text}`;
 }
 
-export { hasPragma, insertPragma };
+export { hasIgnorePragma, hasPragma, insertPragma };
diff --git a/src/language-html/print/tag.js b/src/language-html/print/tag.js
index da50dff68..d10c8219f 100644
--- a/src/language-html/print/tag.js
+++ b/src/language-html/print/tag.js
@@ -355,15 +355,17 @@ function printOpeningTagStartMarker(node, options) {
     case "docType": {
       // Only lowercase HTML5 doctype in `.html` and `.htm` files
       if (node.value === "html") {
-        const filepath = options.filepath ?? "";
-        if (/\.html?$/u.test(filepath)) {
+        const { filepath } = options;
+        if (filepath && /\.html?$/u.test(filepath)) {
           return HTML5_DOCTYPE_START_MARKER;
         }
       }
 
-      const original = options.originalText.slice(locStart(node), locEnd(node));
-
-      return original.slice(0, HTML5_DOCTYPE_START_MARKER.length);
+      const start = locStart(node);
+      return options.originalText.slice(
+        start,
+        start + HTML5_DOCTYPE_START_MARKER.length,
+      );
     }
 
     case "angularIcuExpression":
diff --git a/src/language-js/parse/utils/create-parser.js b/src/language-js/parse/utils/create-parser.js
index c93042cd4..c82a41986 100644
--- a/src/language-js/parse/utils/create-parser.js
+++ b/src/language-js/parse/utils/create-parser.js
@@ -1,5 +1,5 @@
 import { locEnd, locStart } from "../../loc.js";
-import { hasPragma } from "../../pragma.js";
+import { hasIgnorePragma, hasPragma } from "../../pragma.js";
 
 function createParser(options) {
   options = typeof options === "function" ? { parse: options } : options;
@@ -7,6 +7,7 @@ function createParser(options) {
   return {
     astFormat: "estree",
     hasPragma,
+    hasIgnorePragma,
     locStart,
     locEnd,
     ...options,
diff --git a/src/language-js/pragma.js b/src/language-js/pragma.js
index 62b669526..3f7ad568d 100644
--- a/src/language-js/pragma.js
+++ b/src/language-js/pragma.js
@@ -1,6 +1,7 @@
 import { extract, parseWithComments, print, strip } from "jest-docblock";
 import { normalizeEndOfLine } from "../common/end-of-line.js";
 import {
+  FORMAT_IGNORE_PRAGMAS,
   FORMAT_PRAGMA_TO_INSERT,
   FORMAT_PRAGMAS,
 } from "../utils/pragma/pragma.evaluate.js";
@@ -23,6 +24,11 @@ function hasPragma(text) {
   return FORMAT_PRAGMAS.some((pragma) => Object.hasOwn(pragmas, pragma));
 }
 
+function hasIgnorePragma(text) {
+  const { pragmas } = parseDocBlock(text);
+  return FORMAT_IGNORE_PRAGMAS.some((pragma) => Object.hasOwn(pragmas, pragma));
+}
+
 function insertPragma(originalText) {
   const { shebang, text, pragmas, comments } = parseDocBlock(originalText);
   const strippedText = strip(text);
@@ -50,4 +56,4 @@ function insertPragma(originalText) {
   );
 }
 
-export { hasPragma, insertPragma };
+export { hasIgnorePragma, hasPragma, insertPragma };
diff --git a/src/language-json/parser-json.js b/src/language-json/parser-json.js
index 9ef5b96d6..3f4e4b1ac 100644
--- a/src/language-json/parser-json.js
+++ b/src/language-json/parser-json.js
@@ -176,6 +176,7 @@ const jsonParsers = {
   json: createParser({
     parse: (text) => parseJson(text),
     hasPragma: () => true,
+    hasIgnorePragma: () => false,
   }),
   json5: createParser((text) => parseJson(text)),
   jsonc: createParser((text) => parseJson(text, { allowEmpty: true })),
diff --git a/src/language-markdown/clean.js b/src/language-markdown/clean.js
index b2a5da084..9c53c6821 100644
--- a/src/language-markdown/clean.js
+++ b/src/language-markdown/clean.js
@@ -1,5 +1,6 @@
 import collapseWhiteSpace from "collapse-white-space";
 import isFrontMatter from "../utils/front-matter/is-front-matter.js";
+import { FORMAT_PRAGMAS } from "../utils/pragma/pragma.evaluate.js";
 import { startWithPragma } from "./pragma.js";
 
 const ignoredProperties = new Set([
@@ -77,7 +78,7 @@ function clean(original, cloned, parent) {
     (parent.children[0] === original ||
       (isFrontMatter(parent.children[0]) && parent.children[1] === original)) &&
     original.type === "html" &&
-    startWithPragma(original.value)
+    startWithPragma(original.value, FORMAT_PRAGMAS)
   ) {
     return null;
   }
diff --git a/src/language-markdown/parser-markdown.js b/src/language-markdown/parser-markdown.js
index 2522c06a0..f6049a92e 100644
--- a/src/language-markdown/parser-markdown.js
+++ b/src/language-markdown/parser-markdown.js
@@ -4,7 +4,7 @@ import remarkParse from "remark-parse";
 import unified from "unified";
 import { locEnd, locStart } from "./loc.js";
 import { BLOCKS_REGEX, esSyntax } from "./mdx.js";
-import { hasPragma } from "./pragma.js";
+import { hasIgnorePragma, hasPragma } from "./pragma.js";
 import frontMatter from "./unified-plugins/front-matter.js";
 import htmlToJsx from "./unified-plugins/html-to-jsx.js";
 import liquid from "./unified-plugins/liquid.js";
@@ -47,6 +47,7 @@ function noop() {}
 const baseParser = {
   astFormat: "mdast",
   hasPragma,
+  hasIgnorePragma,
   locStart,
   locEnd,
 };
diff --git a/src/language-markdown/pragma.js b/src/language-markdown/pragma.js
index 71e6bb7ec..735aed6e3 100644
--- a/src/language-markdown/pragma.js
+++ b/src/language-markdown/pragma.js
@@ -1,11 +1,13 @@
 import parseFrontMatter from "../utils/front-matter/parse.js";
+import {
+  FORMAT_IGNORE_PRAGMAS,
+  FORMAT_PRAGMA_TO_INSERT,
+  FORMAT_PRAGMAS,
+} from "../utils/pragma/pragma.evaluate.js";
 
-const pragmas = ["format", "prettier"];
-
-function startWithPragma(text) {
+function startWithPragma(text, pragmas) {
   const pragma = `@(${pragmas.join("|")})`;
   const regex = new RegExp(
-    // eslint-disable-next-line regexp/match-any
     [
       `<!--\\s*${pragma}\\s*-->`,
       `\\{\\s*\\/\\*\\s*${pragma}\\s*\\*\\/\\s*\\}`,
@@ -18,14 +20,20 @@ function startWithPragma(text) {
 }
 
 const hasPragma = (text) =>
-  startWithPragma(parseFrontMatter(text).content.trimStart());
+  startWithPragma(parseFrontMatter(text).content.trimStart(), FORMAT_PRAGMAS);
+
+const hasIgnorePragma = (text) =>
+  startWithPragma(
+    parseFrontMatter(text).content.trimStart(),
+    FORMAT_IGNORE_PRAGMAS,
+  );
 
 const insertPragma = (text) => {
   const extracted = parseFrontMatter(text);
-  const pragma = `<!-- @${pragmas[0]} -->`;
+  const pragma = `<!-- @${FORMAT_PRAGMA_TO_INSERT} -->`;
   return extracted.frontMatter
     ? `${extracted.frontMatter.raw}\n\n${pragma}\n\n${extracted.content}`
     : `${pragma}\n\n${extracted.content}`;
 };
 
-export { hasPragma, insertPragma, startWithPragma };
+export { hasIgnorePragma, hasPragma, insertPragma, startWithPragma };
diff --git a/src/language-yaml/parser-yaml.js b/src/language-yaml/parser-yaml.js
index e97d35d93..86ac5a5ef 100644
--- a/src/language-yaml/parser-yaml.js
+++ b/src/language-yaml/parser-yaml.js
@@ -1,7 +1,7 @@
 import { parse as parseYaml } from "yaml-unist-parser/lib/parse.js";
 import createError from "../common/parser-create-error.js";
 import { locEnd, locStart } from "./loc.js";
-import { hasPragma } from "./pragma.js";
+import { hasIgnorePragma, hasPragma } from "./pragma.js";
 
 function parse(text) {
   try {
@@ -33,6 +33,7 @@ export const yaml = {
   astFormat: "yaml",
   parse,
   hasPragma,
+  hasIgnorePragma,
   locStart,
   locEnd,
 };
diff --git a/src/language-yaml/pragma.js b/src/language-yaml/pragma.js
index e868d3089..286ab5af0 100644
--- a/src/language-yaml/pragma.js
+++ b/src/language-yaml/pragma.js
@@ -1,21 +1,24 @@
 import {
   FORMAT_PRAGMA_TO_INSERT,
+  YAML_HAS_IGNORE_PRAGMA_REGEXP,
   YAML_HAS_PRAGMA_REGEXP,
   YAML_IS_PRAGMA_REGEXP,
 } from "../utils/pragma/pragma.evaluate.js";
 
 function isPragma(text) {
-  // FIXME
   return YAML_IS_PRAGMA_REGEXP.test(text);
 }
 
 function hasPragma(text) {
-  // FIXME
   return YAML_HAS_PRAGMA_REGEXP.test(text);
 }
 
+function hasIgnorePragma(text) {
+  return YAML_HAS_IGNORE_PRAGMA_REGEXP.test(text);
+}
+
 function insertPragma(text) {
   return `# @${FORMAT_PRAGMA_TO_INSERT}\n\n${text}`;
 }
 
-export { hasPragma, insertPragma, isPragma };
+export { hasIgnorePragma, hasPragma, insertPragma, isPragma };
diff --git a/src/main/core-options.evaluate.js b/src/main/core-options.evaluate.js
index 921b5c549..ea9c813f2 100644
--- a/src/main/core-options.evaluate.js
+++ b/src/main/core-options.evaluate.js
@@ -44,6 +44,14 @@ import {
 
 /** @type {{ [name: string]: OptionInfo }} */
 const options = {
+  checkIgnorePragma: {
+    category: CATEGORY_SPECIAL,
+    type: "boolean",
+    default: false,
+    description:
+      "Check whether the file's first docblock comment contains '@noprettier' or '@noformat' to determine if it should be formatted.",
+    cliCategory: CATEGORY_OTHER,
+  },
   cursorOffset: {
     category: CATEGORY_SPECIAL,
     type: "int",
@@ -176,10 +184,8 @@ const options = {
     category: CATEGORY_SPECIAL,
     type: "boolean",
     default: false,
-    description: outdent`
-      Require either '@prettier' or '@format' to be present in the file's first docblock comment
-      in order for it to be formatted.
-    `,
+    description:
+      "Require either '@prettier' or '@format' to be present in the file's first docblock comment in order for it to be formatted.",
     cliCategory: CATEGORY_OTHER,
   },
   tabWidth: {
diff --git a/src/main/core.js b/src/main/core.js
index eedc17bf3..193da4fa5 100644
--- a/src/main/core.js
+++ b/src/main/core.js
@@ -311,6 +311,11 @@ async function hasPragma(text, options) {
   return !selectedParser.hasPragma || selectedParser.hasPragma(text);
 }
 
+async function hasIgnorePragma(text, options) {
+  const selectedParser = await resolveParser(options);
+  return selectedParser.hasIgnorePragma?.(text);
+}
+
 async function formatWithCursor(originalText, originalOptions) {
   let { hasBOM, text, options } = normalizeInputAndOptions(
     originalText,
@@ -319,7 +324,8 @@ async function formatWithCursor(originalText, originalOptions) {
 
   if (
     (options.rangeStart >= options.rangeEnd && text !== "") ||
-    (options.requirePragma && !(await hasPragma(text, options)))
+    (options.requirePragma && !(await hasPragma(text, options))) ||
+    (options.checkIgnorePragma && (await hasIgnorePragma(text, options)))
   ) {
     return {
       formatted: originalText,
diff --git a/src/utils/create-mockable.js b/src/utils/create-mockable.js
new file mode 100644
index 000000000..4f7b43bbb
--- /dev/null
+++ b/src/utils/create-mockable.js
@@ -0,0 +1,42 @@
+/**
+@template {{ [key: string]: any }} T
+@template {keyof T} K
+@param {T} implementations
+@returns {{
+  mocked: T,
+  implementations: T,
+  mockImplementation(functionality: K, implementation: T[K]): void,
+  mockImplementations(overrideImplementations: T): void,
+  mockRestore(): void,
+}}
+*/
+function createMockable(implementations) {
+  const mocked = { ...implementations };
+  const mockImplementation = (functionality, implementation) => {
+    if (!Object.hasOwn(implementations, functionality)) {
+      throw new Error(`Unexpected mock '${functionality}'.`);
+    }
+    // @ts-expect-error -- ??
+    mocked[functionality] = implementation;
+  };
+  const mockImplementations = (overrideImplementations) => {
+    for (const [functionality, implementation] of Object.entries(
+      overrideImplementations,
+    )) {
+      mockImplementation(functionality, implementation);
+    }
+  };
+  const mockRestore = () => {
+    Object.assign(mocked, implementations);
+  };
+
+  return {
+    mocked,
+    implementations,
+    mockImplementation,
+    mockImplementations,
+    mockRestore,
+  };
+}
+
+export default createMockable;
diff --git a/src/utils/pragma/pragma.evaluate.js b/src/utils/pragma/pragma.evaluate.js
index 9e7150f8b..483514894 100644
--- a/src/utils/pragma/pragma.evaluate.js
+++ b/src/utils/pragma/pragma.evaluate.js
@@ -1,44 +1,42 @@
-import assert from "node:assert";
-
 export const FORMAT_PRAGMAS = ["format", "prettier"];
+export const FORMAT_IGNORE_PRAGMAS = FORMAT_PRAGMAS.map(
+  (pragma) => `no${pragma}`,
+);
 export const FORMAT_PRAGMA_TO_INSERT = FORMAT_PRAGMAS[0];
 
-// Regular expressions put in this file so they can be evaluate
-
-// This exists because the regexp was rewrite from existing, feel free to remove when updating them
-const assertRegexpEqual = (regexpA, regexpB) => {
-  assert.ok(regexpA.source, regexpB.source);
-};
+// Regular expressions are put in this file so they can be evaluated
 
 export const YAML_IS_PRAGMA_REGEXP = new RegExp(
   String.raw`^\s*@(?:${FORMAT_PRAGMAS.join("|")})\s*$`,
   "u",
 );
-assertRegexpEqual(YAML_IS_PRAGMA_REGEXP, /^\s*@(?:prettier|format)\s*$/u);
 
-export const YAML_HAS_PRAGMA_REGEXP = new RegExp(
-  String.raw`^\s*#[^\S\n]*@(?:${FORMAT_PRAGMAS.join("|")})\s*?(?:\n|$)`,
-  "u",
-);
-assertRegexpEqual(
-  YAML_HAS_PRAGMA_REGEXP,
-  /^\s*#[^\S\n]*@(?:prettier|format)\s*?(?:\n|$)/u,
+export const [YAML_HAS_PRAGMA_REGEXP, YAML_HAS_IGNORE_PRAGMA_REGEXP] = [
+  FORMAT_PRAGMAS,
+  FORMAT_IGNORE_PRAGMAS,
+].map(
+  (pragmas) =>
+    new RegExp(
+      String.raw`^\s*#[^\S\n]*@(?:${pragmas.join("|")})\s*?(?:\n|$)`,
+      "u",
+    ),
 );
 
-export const GRAPHQL_HAS_PRAGMA_REGEXP = new RegExp(
-  String.raw`^\s*#[^\S\n]*@(?:${FORMAT_PRAGMAS.join("|")})\s*(?:\n|$)`,
-  "u",
-);
-assertRegexpEqual(
-  GRAPHQL_HAS_PRAGMA_REGEXP,
-  /^\s*#[^\S\n]*@(?:format|prettier)\s*(?:\n|$)/u,
+export const [GRAPHQL_HAS_PRAGMA_REGEXP, GRAPHQL_HAS_IGNORE_PRAGMA_REGEXP] = [
+  FORMAT_PRAGMAS,
+  FORMAT_IGNORE_PRAGMAS,
+].map(
+  (pragmas) =>
+    new RegExp(
+      String.raw`^\s*#[^\S\n]*@(?:${pragmas.join("|")})\s*(?:\n|$)`,
+      "u",
+    ),
 );
 
-export const HTML_HAS_PRAGMA_REGEXP = new RegExp(
-  String.raw`^\s*<!--\s*@(?:${FORMAT_PRAGMAS.join("|")})\s*-->`,
-  "u",
-);
-assertRegexpEqual(
-  HTML_HAS_PRAGMA_REGEXP,
-  /^\s*<!--\s*@(?:format|prettier)\s*-->/u,
+export const [HTML_HAS_PRAGMA_REGEXP, HTML_HAS_IGNORE_PRAGMA_REGEXP] = [
+  FORMAT_PRAGMAS,
+  FORMAT_IGNORE_PRAGMAS,
+].map(
+  (pragmas) =>
+    new RegExp(String.raw`^\s*<!--\s*@(?:${pragmas.join("|")})\s*-->`, "u"),
 );
diff --git a/tests/config/install-prettier.js b/tests/config/install-prettier.js
index 5a2054e26..2fac432d0 100644
--- a/tests/config/install-prettier.js
+++ b/tests/config/install-prettier.js
@@ -27,7 +27,7 @@ if (!allowedClients.has(client)) {
 
 const directoriesToClean = new Set();
 
-process.on("exit", cleanUp);
+process.once("exit", cleanUp);
 
 function cleanUp() {
   if (directoriesToClean.size === 0) {
diff --git a/tests/config/run-format-test.js b/tests/config/run-format-test.js
index 0e08fcc48..b497d1bf5 100644
--- a/tests/config/run-format-test.js
+++ b/tests/config/run-format-test.js
@@ -438,8 +438,8 @@ function shouldSkipEolTest(code, options) {
   if (code.includes("\r")) {
     return true;
   }
-  const { requirePragma, rangeStart, rangeEnd } = options;
-  if (requirePragma) {
+  const { requirePragma, checkIgnorePragma, rangeStart, rangeEnd } = options;
+  if (requirePragma || checkIgnorePragma) {
     return true;
   }
 
diff --git a/tests/dts/unit/cases/parsers.ts b/tests/dts/unit/cases/parsers.ts
index e3a90b22a..725f6022c 100644
--- a/tests/dts/unit/cases/parsers.ts
+++ b/tests/dts/unit/cases/parsers.ts
@@ -47,6 +47,7 @@ const options: prettier.ParserOptions = {
   rangeEnd: 240,
   rangeStart: 0,
   requirePragma: false,
+  checkIgnorePragma: false,
   tabWidth: 2,
   useTabs: false,
   embeddedLanguageFormatting: "auto",
diff --git a/tests/format/js/multiparser-css/__snapshots__/format.test.js.snap b/tests/format/js/multiparser-css/__snapshots__/format.test.js.snap
index 2fdb0057b..b64f76fdc 100644
--- a/tests/format/js/multiparser-css/__snapshots__/format.test.js.snap
+++ b/tests/format/js/multiparser-css/__snapshots__/format.test.js.snap
@@ -480,56 +480,6 @@ const paragraph3 = css\`
 ================================================================================
 `;
 
-exports[`issue-16692.js format 1`] = `
-====================================options=====================================
-parsers: ["babel", "typescript", "flow"]
-printWidth: 80
-                                                                                | printWidth
-=====================================input======================================
-const c1 = styled.div\`
-    border:    1px     \${solid}      red;
-\`;
-
-const c2 = styled.div\`
- font-size:      var(--font-size-h\${level});
-\`;
-
-const c3 = styled.div\`
-    grid-area:       area-\${area};
-\`;
-
-const c4 = styled.div\`
-    grid-area:       var(--\${one});
-\`;
-
-const c5 = styled.div\`
- font-size:      var(--font-size-h \${level});
-\`;
-
-=====================================output=====================================
-const c1 = styled.div\`
-  border: 1px \${solid} red;
-\`;
-
-const c2 = styled.div\`
-  font-size: var(--font-size-h\${level});
-\`;
-
-const c3 = styled.div\`
-  grid-area: area-\${area};
-\`;
-
-const c4 = styled.div\`
-  grid-area: var(--\${one});
-\`;
-
-const c5 = styled.div\`
-  font-size: var(--font-size-h \${level});
-\`;
-
-================================================================================
-`;
-
 exports[`styled-components.js format 1`] = `
 ====================================options=====================================
 parsers: ["babel", "typescript", "flow"]
diff --git a/tests/format/js/multiparser-css/issue-16692.js b/tests/format/js/multiparser-css/issue-16692.js
deleted file mode 100644
index 40febe8e1..000000000
--- a/tests/format/js/multiparser-css/issue-16692.js
+++ /dev/null
@@ -1,19 +0,0 @@
-const c1 = styled.div`
-    border:    1px     ${solid}      red;
-`;
-
-const c2 = styled.div`
- font-size:      var(--font-size-h${level});
-`;
-
-const c3 = styled.div`
-    grid-area:       area-${area};
-`;
-
-const c4 = styled.div`
-    grid-area:       var(--${one});
-`;
-
-const c5 = styled.div`
- font-size:      var(--font-size-h ${level});
-`;
diff --git a/tests/format/misc/check-ignore-pragma/css/__snapshots__/format.test.js.snap b/tests/format/misc/check-ignore-pragma/css/__snapshots__/format.test.js.snap
new file mode 100644
index 000000000..be079ffac
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/css/__snapshots__/format.test.js.snap
@@ -0,0 +1,75 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`with-noformat-pragma.css - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["css"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+/** @noformat */
+
+.class {    display: none;    }
+
+=====================================output=====================================
+/** @noformat */
+
+.class {    display: none;    }
+
+================================================================================
+`;
+
+exports[`with-noprettier-pragma.css - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["css"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+/** @noprettier */
+
+.class {    display: none;    }
+
+=====================================output=====================================
+/** @noprettier */
+
+.class {    display: none;    }
+
+================================================================================
+`;
+
+exports[`with-noprettier-pragma-comments.css - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["css"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+/** @noprettier -- reason to not format */
+
+.class {    display: none;    }
+
+=====================================output=====================================
+/** @noprettier -- reason to not format */
+
+.class {    display: none;    }
+
+================================================================================
+`;
+
+exports[`without-pragma.css - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["css"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+.class {    display: none;    }
+
+=====================================output=====================================
+.class {
+  display: none;
+}
+
+================================================================================
+`;
diff --git a/tests/format/misc/check-ignore-pragma/css/format.test.js b/tests/format/misc/check-ignore-pragma/css/format.test.js
new file mode 100644
index 000000000..3797def2f
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/css/format.test.js
@@ -0,0 +1 @@
+runFormatTest(import.meta, ["css"], { checkIgnorePragma: true });
diff --git a/tests/format/misc/check-ignore-pragma/css/with-noformat-pragma.css b/tests/format/misc/check-ignore-pragma/css/with-noformat-pragma.css
new file mode 100644
index 000000000..2cf90c4d4
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/css/with-noformat-pragma.css
@@ -0,0 +1,3 @@
+/** @noformat */
+
+.class {    display: none;    }
diff --git a/tests/format/misc/check-ignore-pragma/css/with-noprettier-pragma-comments.css b/tests/format/misc/check-ignore-pragma/css/with-noprettier-pragma-comments.css
new file mode 100644
index 000000000..a9692cb8b
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/css/with-noprettier-pragma-comments.css
@@ -0,0 +1,3 @@
+/** @noprettier -- reason to not format */
+
+.class {    display: none;    }
diff --git a/tests/format/misc/check-ignore-pragma/css/with-noprettier-pragma.css b/tests/format/misc/check-ignore-pragma/css/with-noprettier-pragma.css
new file mode 100644
index 000000000..18173fd32
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/css/with-noprettier-pragma.css
@@ -0,0 +1,3 @@
+/** @noprettier */
+
+.class {    display: none;    }
diff --git a/tests/format/misc/check-ignore-pragma/css/without-pragma.css b/tests/format/misc/check-ignore-pragma/css/without-pragma.css
new file mode 100644
index 000000000..7bac0655f
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/css/without-pragma.css
@@ -0,0 +1 @@
+.class {    display: none;    }
diff --git a/tests/format/misc/check-ignore-pragma/disabled/css/__snapshots__/format.test.js.snap b/tests/format/misc/check-ignore-pragma/disabled/css/__snapshots__/format.test.js.snap
new file mode 100644
index 000000000..aa9d91665
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/css/__snapshots__/format.test.js.snap
@@ -0,0 +1,43 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`with-noformat-pragma.css - {"checkIgnorePragma":false} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: false
+parsers: ["css"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+/** @noformat */
+
+.class {    display: none;    }
+
+=====================================output=====================================
+/** @noformat */
+
+.class {
+  display: none;
+}
+
+================================================================================
+`;
+
+exports[`with-noprettier-pragma.css - {"checkIgnorePragma":false} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: false
+parsers: ["css"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+/** @noprettier */
+
+.class {    display: none;    }
+
+=====================================output=====================================
+/** @noprettier */
+
+.class {
+  display: none;
+}
+
+================================================================================
+`;
diff --git a/tests/format/misc/check-ignore-pragma/disabled/css/format.test.js b/tests/format/misc/check-ignore-pragma/disabled/css/format.test.js
new file mode 100644
index 000000000..b5ff1599d
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/css/format.test.js
@@ -0,0 +1 @@
+runFormatTest(import.meta, ["css"], { checkIgnorePragma: false });
diff --git a/tests/format/misc/check-ignore-pragma/disabled/css/with-noformat-pragma.css b/tests/format/misc/check-ignore-pragma/disabled/css/with-noformat-pragma.css
new file mode 100644
index 000000000..2cf90c4d4
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/css/with-noformat-pragma.css
@@ -0,0 +1,3 @@
+/** @noformat */
+
+.class {    display: none;    }
diff --git a/tests/format/misc/check-ignore-pragma/disabled/css/with-noprettier-pragma.css b/tests/format/misc/check-ignore-pragma/disabled/css/with-noprettier-pragma.css
new file mode 100644
index 000000000..18173fd32
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/css/with-noprettier-pragma.css
@@ -0,0 +1,3 @@
+/** @noprettier */
+
+.class {    display: none;    }
diff --git a/tests/format/misc/check-ignore-pragma/disabled/graphql/__snapshots__/format.test.js.snap b/tests/format/misc/check-ignore-pragma/disabled/graphql/__snapshots__/format.test.js.snap
new file mode 100644
index 000000000..2a90b5bb8
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/graphql/__snapshots__/format.test.js.snap
@@ -0,0 +1,43 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`with-noformat-pragma.graphql - {"checkIgnorePragma":false} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: false
+parsers: ["graphql"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+# @noformat
+
+query Browse($offset:Int){browse(offset:$offset)}
+
+=====================================output=====================================
+# @noformat
+
+query Browse($offset: Int) {
+  browse(offset: $offset)
+}
+
+================================================================================
+`;
+
+exports[`with-noprettier-pragma.graphql - {"checkIgnorePragma":false} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: false
+parsers: ["graphql"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+# @noprettier
+
+query Browse($offset:Int){browse(offset:$offset)}
+
+=====================================output=====================================
+# @noprettier
+
+query Browse($offset: Int) {
+  browse(offset: $offset)
+}
+
+================================================================================
+`;
diff --git a/tests/format/misc/check-ignore-pragma/disabled/graphql/format.test.js b/tests/format/misc/check-ignore-pragma/disabled/graphql/format.test.js
new file mode 100644
index 000000000..88c15fdaa
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/graphql/format.test.js
@@ -0,0 +1 @@
+runFormatTest(import.meta, ["graphql"], { checkIgnorePragma: false });
diff --git a/tests/format/misc/check-ignore-pragma/disabled/graphql/with-noformat-pragma.graphql b/tests/format/misc/check-ignore-pragma/disabled/graphql/with-noformat-pragma.graphql
new file mode 100644
index 000000000..dcf9427af
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/graphql/with-noformat-pragma.graphql
@@ -0,0 +1,3 @@
+# @noformat
+
+query Browse($offset:Int){browse(offset:$offset)}
diff --git a/tests/format/misc/check-ignore-pragma/disabled/graphql/with-noprettier-pragma.graphql b/tests/format/misc/check-ignore-pragma/disabled/graphql/with-noprettier-pragma.graphql
new file mode 100644
index 000000000..2d588e33c
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/graphql/with-noprettier-pragma.graphql
@@ -0,0 +1,3 @@
+# @noprettier
+
+query Browse($offset:Int){browse(offset:$offset)}
diff --git a/tests/format/misc/check-ignore-pragma/disabled/html/__snapshots__/format.test.js.snap b/tests/format/misc/check-ignore-pragma/disabled/html/__snapshots__/format.test.js.snap
new file mode 100644
index 000000000..512af313e
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/html/__snapshots__/format.test.js.snap
@@ -0,0 +1,41 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`with-noformat-pragma.html - {"checkIgnorePragma":false} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: false
+parsers: ["html"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+<!-- @noformat -->
+
+<div
+            >  ABC             </div>
+
+=====================================output=====================================
+<!-- @noformat -->
+
+<div>ABC</div>
+
+================================================================================
+`;
+
+exports[`with-noprettier-pragma.html - {"checkIgnorePragma":false} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: false
+parsers: ["html"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+<!-- @noprettier -->
+
+<div
+            >  ABC             </div>
+
+=====================================output=====================================
+<!-- @noprettier -->
+
+<div>ABC</div>
+
+================================================================================
+`;
diff --git a/tests/format/misc/check-ignore-pragma/disabled/html/format.test.js b/tests/format/misc/check-ignore-pragma/disabled/html/format.test.js
new file mode 100644
index 000000000..019d2f3f7
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/html/format.test.js
@@ -0,0 +1 @@
+runFormatTest(import.meta, ["html"], { checkIgnorePragma: false });
diff --git a/tests/format/misc/check-ignore-pragma/disabled/html/with-noformat-pragma.html b/tests/format/misc/check-ignore-pragma/disabled/html/with-noformat-pragma.html
new file mode 100644
index 000000000..ad1120cc9
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/html/with-noformat-pragma.html
@@ -0,0 +1,4 @@
+<!-- @noformat -->
+
+<div
+            >  ABC             </div>
diff --git a/tests/format/misc/check-ignore-pragma/disabled/html/with-noprettier-pragma.html b/tests/format/misc/check-ignore-pragma/disabled/html/with-noprettier-pragma.html
new file mode 100644
index 000000000..62e483bf9
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/html/with-noprettier-pragma.html
@@ -0,0 +1,4 @@
+<!-- @noprettier -->
+
+<div
+            >  ABC             </div>
diff --git a/tests/format/misc/check-ignore-pragma/disabled/js/__snapshots__/format.test.js.snap b/tests/format/misc/check-ignore-pragma/disabled/js/__snapshots__/format.test.js.snap
new file mode 100644
index 000000000..3620328a4
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/js/__snapshots__/format.test.js.snap
@@ -0,0 +1,71 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`module-with-noformat-pragma.js - {"checkIgnorePragma":false} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: false
+parsers: ["flow", "babel", "typescript"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+/**
+ * @flow
+ * @noformat
+ */
+
+function      foo(bar)
+
+
+{
+
+  return bar +
+    3 +
+  4;
+}
+
+=====================================output=====================================
+/**
+ * @flow
+ * @noformat
+ */
+
+function foo(bar) {
+  return bar + 3 + 4;
+}
+
+================================================================================
+`;
+
+exports[`module-with-noprettier-pragma.js - {"checkIgnorePragma":false} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: false
+parsers: ["flow", "babel", "typescript"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+/**
+ * @flow
+ * @noprettier
+ */
+
+function      foo(bar)
+
+
+{
+
+  return bar +
+    3 +
+  4;
+}
+
+=====================================output=====================================
+/**
+ * @flow
+ * @noprettier
+ */
+
+function foo(bar) {
+  return bar + 3 + 4;
+}
+
+================================================================================
+`;
diff --git a/tests/format/misc/check-ignore-pragma/disabled/js/format.test.js b/tests/format/misc/check-ignore-pragma/disabled/js/format.test.js
new file mode 100644
index 000000000..ed39b1b12
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/js/format.test.js
@@ -0,0 +1,3 @@
+runFormatTest(import.meta, ["flow", "babel", "typescript"], {
+  checkIgnorePragma: false,
+});
diff --git a/tests/format/misc/check-ignore-pragma/disabled/js/module-with-noformat-pragma.js b/tests/format/misc/check-ignore-pragma/disabled/js/module-with-noformat-pragma.js
new file mode 100644
index 000000000..936ea7c49
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/js/module-with-noformat-pragma.js
@@ -0,0 +1,14 @@
+/**
+ * @flow
+ * @noformat
+ */
+
+function      foo(bar)
+
+
+{
+
+  return bar +
+    3 +
+  4;
+}
diff --git a/tests/format/misc/check-ignore-pragma/disabled/js/module-with-noprettier-pragma.js b/tests/format/misc/check-ignore-pragma/disabled/js/module-with-noprettier-pragma.js
new file mode 100644
index 000000000..d7c25b2ea
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/js/module-with-noprettier-pragma.js
@@ -0,0 +1,14 @@
+/**
+ * @flow
+ * @noprettier
+ */
+
+function      foo(bar)
+
+
+{
+
+  return bar +
+    3 +
+  4;
+}
diff --git a/tests/format/misc/check-ignore-pragma/disabled/json5/__snapshots__/format.test.js.snap b/tests/format/misc/check-ignore-pragma/disabled/json5/__snapshots__/format.test.js.snap
new file mode 100644
index 000000000..15b120857
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/json5/__snapshots__/format.test.js.snap
@@ -0,0 +1,39 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`with-noformat-pragma.json5 - {"checkIgnorePragma":false} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: false
+parsers: ["json5"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+/** @noformat */
+
+{hello:       "world"}
+
+=====================================output=====================================
+/** @noformat */
+
+{ hello: "world" }
+
+================================================================================
+`;
+
+exports[`with-noprettier-pragma.json5 - {"checkIgnorePragma":false} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: false
+parsers: ["json5"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+/** @noprettier */
+
+{hello:       "world"}
+
+=====================================output=====================================
+/** @noprettier */
+
+{ hello: "world" }
+
+================================================================================
+`;
diff --git a/tests/format/misc/check-ignore-pragma/disabled/json5/format.test.js b/tests/format/misc/check-ignore-pragma/disabled/json5/format.test.js
new file mode 100644
index 000000000..f18aecc81
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/json5/format.test.js
@@ -0,0 +1 @@
+runFormatTest(import.meta, ["json5"], { checkIgnorePragma: false });
diff --git a/tests/format/misc/check-ignore-pragma/disabled/json5/with-noformat-pragma.json5 b/tests/format/misc/check-ignore-pragma/disabled/json5/with-noformat-pragma.json5
new file mode 100644
index 000000000..37e934665
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/json5/with-noformat-pragma.json5
@@ -0,0 +1,3 @@
+/** @noformat */
+
+{hello:       "world"}
diff --git a/tests/format/misc/check-ignore-pragma/disabled/json5/with-noprettier-pragma.json5 b/tests/format/misc/check-ignore-pragma/disabled/json5/with-noprettier-pragma.json5
new file mode 100644
index 000000000..8cb5196a0
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/json5/with-noprettier-pragma.json5
@@ -0,0 +1,3 @@
+/** @noprettier */
+
+{hello:       "world"}
diff --git a/tests/format/misc/check-ignore-pragma/disabled/markdown/__snapshots__/format.test.js.snap b/tests/format/misc/check-ignore-pragma/disabled/markdown/__snapshots__/format.test.js.snap
new file mode 100644
index 000000000..b0f75946a
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/markdown/__snapshots__/format.test.js.snap
@@ -0,0 +1,93 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`front-matter-with-noformat-pragma.md - {"checkIgnorePragma":false} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: false
+parsers: ["markdown"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+---
+something
+---
+
+<!-- @noformat -->
+
+I     should      be      formatted       !!
+
+=====================================output=====================================
+---
+something
+---
+
+<!-- @noformat -->
+
+I should be formatted !!
+
+================================================================================
+`;
+
+exports[`front-matter-with-noprettier-pragma.md - {"checkIgnorePragma":false} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: false
+parsers: ["markdown"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+---
+something
+---
+
+<!-- @noprettier -->
+
+I     should      be      formatted       !!
+
+=====================================output=====================================
+---
+something
+---
+
+<!-- @noprettier -->
+
+I should be formatted !!
+
+================================================================================
+`;
+
+exports[`with-noformat-pragma.md - {"checkIgnorePragma":false} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: false
+parsers: ["markdown"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+<!-- @noformat -->
+
+I     should      be      formatted       !!
+
+=====================================output=====================================
+<!-- @noformat -->
+
+I should be formatted !!
+
+================================================================================
+`;
+
+exports[`with-noprettier-pragma.md - {"checkIgnorePragma":false} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: false
+parsers: ["markdown"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+<!-- @noprettier -->
+
+I     should      be      formatted       !!
+
+=====================================output=====================================
+<!-- @noprettier -->
+
+I should be formatted !!
+
+================================================================================
+`;
diff --git a/tests/format/misc/check-ignore-pragma/disabled/markdown/format.test.js b/tests/format/misc/check-ignore-pragma/disabled/markdown/format.test.js
new file mode 100644
index 000000000..78fb8e32a
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/markdown/format.test.js
@@ -0,0 +1 @@
+runFormatTest(import.meta, ["markdown"], { checkIgnorePragma: false });
diff --git a/tests/format/misc/check-ignore-pragma/disabled/markdown/front-matter-with-noformat-pragma.md b/tests/format/misc/check-ignore-pragma/disabled/markdown/front-matter-with-noformat-pragma.md
new file mode 100644
index 000000000..8f6ef34dd
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/markdown/front-matter-with-noformat-pragma.md
@@ -0,0 +1,7 @@
+---
+something
+---
+
+<!-- @noformat -->
+
+I     should      be      formatted       !!
diff --git a/tests/format/misc/check-ignore-pragma/disabled/markdown/front-matter-with-noprettier-pragma.md b/tests/format/misc/check-ignore-pragma/disabled/markdown/front-matter-with-noprettier-pragma.md
new file mode 100644
index 000000000..cf7077222
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/markdown/front-matter-with-noprettier-pragma.md
@@ -0,0 +1,7 @@
+---
+something
+---
+
+<!-- @noprettier -->
+
+I     should      be      formatted       !!
diff --git a/tests/format/misc/check-ignore-pragma/disabled/markdown/with-noformat-pragma.md b/tests/format/misc/check-ignore-pragma/disabled/markdown/with-noformat-pragma.md
new file mode 100644
index 000000000..262b32de0
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/markdown/with-noformat-pragma.md
@@ -0,0 +1,3 @@
+<!-- @noformat -->
+
+I     should      be      formatted       !!
diff --git a/tests/format/misc/check-ignore-pragma/disabled/markdown/with-noprettier-pragma.md b/tests/format/misc/check-ignore-pragma/disabled/markdown/with-noprettier-pragma.md
new file mode 100644
index 000000000..956dff08d
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/markdown/with-noprettier-pragma.md
@@ -0,0 +1,3 @@
+<!-- @noprettier -->
+
+I     should      be      formatted       !!
diff --git a/tests/format/misc/check-ignore-pragma/disabled/mdx/__snapshots__/format.test.js.snap b/tests/format/misc/check-ignore-pragma/disabled/mdx/__snapshots__/format.test.js.snap
new file mode 100644
index 000000000..80e248825
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/mdx/__snapshots__/format.test.js.snap
@@ -0,0 +1,39 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`with-noformat-pragma.md - {"checkIgnorePragma":false} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: false
+parsers: ["mdx"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+{/* @noformat */}
+
+I     should     be      formatted       !!
+
+=====================================output=====================================
+{/* @noformat */}
+
+I should be formatted !!
+
+================================================================================
+`;
+
+exports[`with-noprettier-pragma.md - {"checkIgnorePragma":false} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: false
+parsers: ["mdx"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+{/* @noprettier */}
+
+I     should     be      formatted       !!
+
+=====================================output=====================================
+{/* @noprettier */}
+
+I should be formatted !!
+
+================================================================================
+`;
diff --git a/tests/format/misc/check-ignore-pragma/disabled/mdx/format.test.js b/tests/format/misc/check-ignore-pragma/disabled/mdx/format.test.js
new file mode 100644
index 000000000..4e09d6ff8
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/mdx/format.test.js
@@ -0,0 +1 @@
+runFormatTest(import.meta, ["mdx"], { checkIgnorePragma: false });
diff --git a/tests/format/misc/check-ignore-pragma/disabled/mdx/with-noformat-pragma.md b/tests/format/misc/check-ignore-pragma/disabled/mdx/with-noformat-pragma.md
new file mode 100644
index 000000000..585e73ffc
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/mdx/with-noformat-pragma.md
@@ -0,0 +1,3 @@
+{/* @noformat */}
+
+I     should     be      formatted       !!
diff --git a/tests/format/misc/check-ignore-pragma/disabled/mdx/with-noprettier-pragma.md b/tests/format/misc/check-ignore-pragma/disabled/mdx/with-noprettier-pragma.md
new file mode 100644
index 000000000..7f53055cd
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/mdx/with-noprettier-pragma.md
@@ -0,0 +1,3 @@
+{/* @noprettier */}
+
+I     should     be      formatted       !!
diff --git a/tests/format/misc/check-ignore-pragma/disabled/vue/__snapshots__/format.test.js.snap b/tests/format/misc/check-ignore-pragma/disabled/vue/__snapshots__/format.test.js.snap
new file mode 100644
index 000000000..902d00bc0
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/vue/__snapshots__/format.test.js.snap
@@ -0,0 +1,59 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`with-noformat-pragma.vue - {"checkIgnorePragma":false} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: false
+parsers: ["vue"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+<!-- @noformat -->
+<template>
+  <div>This will be pre-compiled</div>
+</template>
+<script>
+const    x      = 1;
+</script>
+<style src="./my-component.css"></style>
+
+=====================================output=====================================
+<!-- @noformat -->
+<template>
+  <div>This will be pre-compiled</div>
+</template>
+<script>
+const x = 1;
+</script>
+<style src="./my-component.css"></style>
+
+================================================================================
+`;
+
+exports[`with-noprettier-pragma.vue - {"checkIgnorePragma":false} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: false
+parsers: ["vue"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+<!-- @noprettier -->
+<template>
+  <div>This will be pre-compiled</div>
+</template>
+<script>
+const    x      = 1;
+</script>
+<style src="./my-component.css"></style>
+
+=====================================output=====================================
+<!-- @noprettier -->
+<template>
+  <div>This will be pre-compiled</div>
+</template>
+<script>
+const x = 1;
+</script>
+<style src="./my-component.css"></style>
+
+================================================================================
+`;
diff --git a/tests/format/misc/check-ignore-pragma/disabled/vue/format.test.js b/tests/format/misc/check-ignore-pragma/disabled/vue/format.test.js
new file mode 100644
index 000000000..a2de0ceb8
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/vue/format.test.js
@@ -0,0 +1 @@
+runFormatTest(import.meta, ["vue"], { checkIgnorePragma: false });
diff --git a/tests/format/misc/check-ignore-pragma/disabled/vue/with-noformat-pragma.vue b/tests/format/misc/check-ignore-pragma/disabled/vue/with-noformat-pragma.vue
new file mode 100644
index 000000000..5d3d18610
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/vue/with-noformat-pragma.vue
@@ -0,0 +1,8 @@
+<!-- @noformat -->
+<template>
+  <div>This will be pre-compiled</div>
+</template>
+<script>
+const    x      = 1;
+</script>
+<style src="./my-component.css"></style>
diff --git a/tests/format/misc/check-ignore-pragma/disabled/vue/with-noprettier-pragma.vue b/tests/format/misc/check-ignore-pragma/disabled/vue/with-noprettier-pragma.vue
new file mode 100644
index 000000000..0150e6dcf
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/vue/with-noprettier-pragma.vue
@@ -0,0 +1,8 @@
+<!-- @noprettier -->
+<template>
+  <div>This will be pre-compiled</div>
+</template>
+<script>
+const    x      = 1;
+</script>
+<style src="./my-component.css"></style>
diff --git a/tests/format/misc/check-ignore-pragma/disabled/yaml/__snapshots__/format.test.js.snap b/tests/format/misc/check-ignore-pragma/disabled/yaml/__snapshots__/format.test.js.snap
new file mode 100644
index 000000000..051da3791
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/yaml/__snapshots__/format.test.js.snap
@@ -0,0 +1,39 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`with-noformat-pragma.yml - {"checkIgnorePragma":false} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: false
+parsers: ["yaml"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+# @noformat
+
+    123
+
+=====================================output=====================================
+# @noformat
+
+123
+
+================================================================================
+`;
+
+exports[`with-noprettier-pragma.yml - {"checkIgnorePragma":false} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: false
+parsers: ["yaml"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+# @noprettier
+
+    123
+
+=====================================output=====================================
+# @noprettier
+
+123
+
+================================================================================
+`;
diff --git a/tests/format/misc/check-ignore-pragma/disabled/yaml/format.test.js b/tests/format/misc/check-ignore-pragma/disabled/yaml/format.test.js
new file mode 100644
index 000000000..fcd34bcc0
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/yaml/format.test.js
@@ -0,0 +1 @@
+runFormatTest(import.meta, ["yaml"], { checkIgnorePragma: false });
diff --git a/tests/format/misc/check-ignore-pragma/disabled/yaml/with-noformat-pragma.yml b/tests/format/misc/check-ignore-pragma/disabled/yaml/with-noformat-pragma.yml
new file mode 100644
index 000000000..af6095ae4
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/yaml/with-noformat-pragma.yml
@@ -0,0 +1,3 @@
+# @noformat
+
+    123
diff --git a/tests/format/misc/check-ignore-pragma/disabled/yaml/with-noprettier-pragma.yml b/tests/format/misc/check-ignore-pragma/disabled/yaml/with-noprettier-pragma.yml
new file mode 100644
index 000000000..ccc87f99d
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/disabled/yaml/with-noprettier-pragma.yml
@@ -0,0 +1,3 @@
+# @noprettier
+
+    123
diff --git a/tests/format/misc/check-ignore-pragma/graphql/__snapshots__/format.test.js.snap b/tests/format/misc/check-ignore-pragma/graphql/__snapshots__/format.test.js.snap
new file mode 100644
index 000000000..20b7eae19
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/graphql/__snapshots__/format.test.js.snap
@@ -0,0 +1,56 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`with-noformat-pragma.graphql - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["graphql"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+# @noformat
+
+query Browse($offset:Int){browse(offset:$offset)}
+
+=====================================output=====================================
+# @noformat
+
+query Browse($offset:Int){browse(offset:$offset)}
+
+================================================================================
+`;
+
+exports[`with-noprettier-pragma.graphql - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["graphql"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+# @noprettier
+
+query Browse($offset:Int){browse(offset:$offset)}
+
+=====================================output=====================================
+# @noprettier
+
+query Browse($offset:Int){browse(offset:$offset)}
+
+================================================================================
+`;
+
+exports[`without-pragma.graphql - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["graphql"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+query Browse($offset:Int){browse(offset:$offset)}
+
+=====================================output=====================================
+query Browse($offset: Int) {
+  browse(offset: $offset)
+}
+
+================================================================================
+`;
diff --git a/tests/format/misc/check-ignore-pragma/graphql/format.test.js b/tests/format/misc/check-ignore-pragma/graphql/format.test.js
new file mode 100644
index 000000000..e734e87e6
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/graphql/format.test.js
@@ -0,0 +1 @@
+runFormatTest(import.meta, ["graphql"], { checkIgnorePragma: true });
diff --git a/tests/format/misc/check-ignore-pragma/graphql/with-noformat-pragma.graphql b/tests/format/misc/check-ignore-pragma/graphql/with-noformat-pragma.graphql
new file mode 100644
index 000000000..dcf9427af
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/graphql/with-noformat-pragma.graphql
@@ -0,0 +1,3 @@
+# @noformat
+
+query Browse($offset:Int){browse(offset:$offset)}
diff --git a/tests/format/misc/check-ignore-pragma/graphql/with-noprettier-pragma.graphql b/tests/format/misc/check-ignore-pragma/graphql/with-noprettier-pragma.graphql
new file mode 100644
index 000000000..2d588e33c
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/graphql/with-noprettier-pragma.graphql
@@ -0,0 +1,3 @@
+# @noprettier
+
+query Browse($offset:Int){browse(offset:$offset)}
diff --git a/tests/format/misc/check-ignore-pragma/graphql/without-pragma.graphql b/tests/format/misc/check-ignore-pragma/graphql/without-pragma.graphql
new file mode 100644
index 000000000..5d2d387a2
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/graphql/without-pragma.graphql
@@ -0,0 +1 @@
+query Browse($offset:Int){browse(offset:$offset)}
diff --git a/tests/format/misc/check-ignore-pragma/html/__snapshots__/format.test.js.snap b/tests/format/misc/check-ignore-pragma/html/__snapshots__/format.test.js.snap
new file mode 100644
index 000000000..7bb850c55
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/html/__snapshots__/format.test.js.snap
@@ -0,0 +1,59 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`with-noformat-pragma.html - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["html"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+<!-- @noformat -->
+
+<div
+            >  ABC             </div>
+
+=====================================output=====================================
+<!-- @noformat -->
+
+<div
+            >  ABC             </div>
+
+================================================================================
+`;
+
+exports[`with-noprettier-pragma.html - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["html"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+<!-- @noprettier -->
+
+<div
+            >  ABC             </div>
+
+=====================================output=====================================
+<!-- @noprettier -->
+
+<div
+            >  ABC             </div>
+
+================================================================================
+`;
+
+exports[`without-pragma.html - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["html"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+<div
+            >  ABC             </div>
+
+=====================================output=====================================
+<div>ABC</div>
+
+================================================================================
+`;
diff --git a/tests/format/misc/check-ignore-pragma/html/format.test.js b/tests/format/misc/check-ignore-pragma/html/format.test.js
new file mode 100644
index 000000000..87db68c17
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/html/format.test.js
@@ -0,0 +1 @@
+runFormatTest(import.meta, ["html"], { checkIgnorePragma: true });
diff --git a/tests/format/misc/check-ignore-pragma/html/with-noformat-pragma.html b/tests/format/misc/check-ignore-pragma/html/with-noformat-pragma.html
new file mode 100644
index 000000000..ad1120cc9
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/html/with-noformat-pragma.html
@@ -0,0 +1,4 @@
+<!-- @noformat -->
+
+<div
+            >  ABC             </div>
diff --git a/tests/format/misc/check-ignore-pragma/html/with-noprettier-pragma.html b/tests/format/misc/check-ignore-pragma/html/with-noprettier-pragma.html
new file mode 100644
index 000000000..62e483bf9
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/html/with-noprettier-pragma.html
@@ -0,0 +1,4 @@
+<!-- @noprettier -->
+
+<div
+            >  ABC             </div>
diff --git a/tests/format/misc/check-ignore-pragma/html/without-pragma.html b/tests/format/misc/check-ignore-pragma/html/without-pragma.html
new file mode 100644
index 000000000..139db13e9
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/html/without-pragma.html
@@ -0,0 +1,2 @@
+<div
+            >  ABC             </div>
diff --git a/tests/format/misc/check-ignore-pragma/js/__snapshots__/format.test.js.snap b/tests/format/misc/check-ignore-pragma/js/__snapshots__/format.test.js.snap
new file mode 100644
index 000000000..d0302ddda
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/js/__snapshots__/format.test.js.snap
@@ -0,0 +1,157 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`module-with-noformat-pragma.js - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["flow", "babel", "typescript"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+/**
+ * @flow
+ * @noformat
+ */
+
+function      foo(bar)
+
+
+{
+
+  return bar +
+    3 +
+  4;
+}
+
+=====================================output=====================================
+/**
+ * @flow
+ * @noformat
+ */
+
+function      foo(bar)
+
+
+{
+
+  return bar +
+    3 +
+  4;
+}
+
+================================================================================
+`;
+
+exports[`module-with-noprettier-pragma.js - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["flow", "babel", "typescript"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+/**
+ * @flow
+ * @noprettier
+ */
+
+function      foo(bar)
+
+
+{
+
+  return bar +
+    3 +
+  4;
+}
+
+=====================================output=====================================
+/**
+ * @flow
+ * @noprettier
+ */
+
+function      foo(bar)
+
+
+{
+
+  return bar +
+    3 +
+  4;
+}
+
+================================================================================
+`;
+
+exports[`module-with-noprettier-pragma-comments.js - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["flow", "babel", "typescript"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+/**
+ * @flow
+ * @noprettier -- reason to not format
+ */
+
+function      foo(bar)
+
+
+{
+
+  return bar +
+    3 +
+  4;
+}
+
+=====================================output=====================================
+/**
+ * @flow
+ * @noprettier -- reason to not format
+ */
+
+function      foo(bar)
+
+
+{
+
+  return bar +
+    3 +
+  4;
+}
+
+================================================================================
+`;
+
+exports[`module-without-pragma.js - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["flow", "babel", "typescript"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+/**
+ * @flow
+ */
+
+function      foo(bar)
+
+
+{
+
+  return bar +
+    3 +
+  4;
+}
+
+=====================================output=====================================
+/**
+ * @flow
+ */
+
+function foo(bar) {
+  return bar + 3 + 4;
+}
+
+================================================================================
+`;
diff --git a/tests/format/misc/check-ignore-pragma/js/format.test.js b/tests/format/misc/check-ignore-pragma/js/format.test.js
new file mode 100644
index 000000000..6bb5567e5
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/js/format.test.js
@@ -0,0 +1,3 @@
+runFormatTest(import.meta, ["flow", "babel", "typescript"], {
+  checkIgnorePragma: true,
+});
diff --git a/tests/format/misc/check-ignore-pragma/js/module-with-noformat-pragma.js b/tests/format/misc/check-ignore-pragma/js/module-with-noformat-pragma.js
new file mode 100644
index 000000000..936ea7c49
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/js/module-with-noformat-pragma.js
@@ -0,0 +1,14 @@
+/**
+ * @flow
+ * @noformat
+ */
+
+function      foo(bar)
+
+
+{
+
+  return bar +
+    3 +
+  4;
+}
diff --git a/tests/format/misc/check-ignore-pragma/js/module-with-noprettier-pragma-comments.js b/tests/format/misc/check-ignore-pragma/js/module-with-noprettier-pragma-comments.js
new file mode 100644
index 000000000..63efe4c9f
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/js/module-with-noprettier-pragma-comments.js
@@ -0,0 +1,14 @@
+/**
+ * @flow
+ * @noprettier -- reason to not format
+ */
+
+function      foo(bar)
+
+
+{
+
+  return bar +
+    3 +
+  4;
+}
diff --git a/tests/format/misc/check-ignore-pragma/js/module-with-noprettier-pragma.js b/tests/format/misc/check-ignore-pragma/js/module-with-noprettier-pragma.js
new file mode 100644
index 000000000..d7c25b2ea
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/js/module-with-noprettier-pragma.js
@@ -0,0 +1,14 @@
+/**
+ * @flow
+ * @noprettier
+ */
+
+function      foo(bar)
+
+
+{
+
+  return bar +
+    3 +
+  4;
+}
diff --git a/tests/format/misc/check-ignore-pragma/js/module-without-pragma.js b/tests/format/misc/check-ignore-pragma/js/module-without-pragma.js
new file mode 100644
index 000000000..8ece37915
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/js/module-without-pragma.js
@@ -0,0 +1,13 @@
+/**
+ * @flow
+ */
+
+function      foo(bar)
+
+
+{
+
+  return bar +
+    3 +
+  4;
+}
diff --git a/tests/format/misc/check-ignore-pragma/json/__snapshots__/format.test.js.snap b/tests/format/misc/check-ignore-pragma/json/__snapshots__/format.test.js.snap
new file mode 100644
index 000000000..736e7028c
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/json/__snapshots__/format.test.js.snap
@@ -0,0 +1,30 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`format-anyway.json - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["json"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+{"allOn": "Single", "Line": "example",
+"noSpace":true,
+  "quote": {
+     "singleQuote": "example",
+                  "indented": true,
+  }
+}
+
+=====================================output=====================================
+{
+  "allOn": "Single",
+  "Line": "example",
+  "noSpace": true,
+  "quote": {
+    "singleQuote": "example",
+    "indented": true
+  }
+}
+
+================================================================================
+`;
diff --git a/tests/format/misc/check-ignore-pragma/json/format-anyway.json b/tests/format/misc/check-ignore-pragma/json/format-anyway.json
new file mode 100644
index 000000000..f0bda3e60
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/json/format-anyway.json
@@ -0,0 +1,7 @@
+{"allOn": "Single", "Line": "example",
+"noSpace":true,
+  "quote": {
+     "singleQuote": "example",
+                  "indented": true,
+  }
+}
diff --git a/tests/format/misc/check-ignore-pragma/json/format.test.js b/tests/format/misc/check-ignore-pragma/json/format.test.js
new file mode 100644
index 000000000..bc67147d3
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/json/format.test.js
@@ -0,0 +1 @@
+runFormatTest(import.meta, ["json"], { checkIgnorePragma: true });
diff --git a/tests/format/misc/check-ignore-pragma/json5/__snapshots__/format.test.js.snap b/tests/format/misc/check-ignore-pragma/json5/__snapshots__/format.test.js.snap
new file mode 100644
index 000000000..8b8d6aca3
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/json5/__snapshots__/format.test.js.snap
@@ -0,0 +1,54 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`with-noformat-pragma.json5 - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["json5"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+/** @noformat */
+
+{hello:       "world"}
+
+=====================================output=====================================
+/** @noformat */
+
+{hello:       "world"}
+
+================================================================================
+`;
+
+exports[`with-noprettier-pragma.json5 - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["json5"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+/** @noprettier */
+
+{hello:       "world"}
+
+=====================================output=====================================
+/** @noprettier */
+
+{hello:       "world"}
+
+================================================================================
+`;
+
+exports[`without-pragma.json5 - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["json5"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+{hello:       "world"}
+
+=====================================output=====================================
+{ hello: "world" }
+
+================================================================================
+`;
diff --git a/tests/format/misc/check-ignore-pragma/json5/format.test.js b/tests/format/misc/check-ignore-pragma/json5/format.test.js
new file mode 100644
index 000000000..1742c639e
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/json5/format.test.js
@@ -0,0 +1 @@
+runFormatTest(import.meta, ["json5"], { checkIgnorePragma: true });
diff --git a/tests/format/misc/check-ignore-pragma/json5/with-noformat-pragma.json5 b/tests/format/misc/check-ignore-pragma/json5/with-noformat-pragma.json5
new file mode 100644
index 000000000..37e934665
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/json5/with-noformat-pragma.json5
@@ -0,0 +1,3 @@
+/** @noformat */
+
+{hello:       "world"}
diff --git a/tests/format/misc/check-ignore-pragma/json5/with-noprettier-pragma.json5 b/tests/format/misc/check-ignore-pragma/json5/with-noprettier-pragma.json5
new file mode 100644
index 000000000..8cb5196a0
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/json5/with-noprettier-pragma.json5
@@ -0,0 +1,3 @@
+/** @noprettier */
+
+{hello:       "world"}
diff --git a/tests/format/misc/check-ignore-pragma/json5/without-pragma.json5 b/tests/format/misc/check-ignore-pragma/json5/without-pragma.json5
new file mode 100644
index 000000000..3a91923f2
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/json5/without-pragma.json5
@@ -0,0 +1 @@
+{hello:       "world"}
diff --git a/tests/format/misc/check-ignore-pragma/markdown/__snapshots__/format.test.js.snap b/tests/format/misc/check-ignore-pragma/markdown/__snapshots__/format.test.js.snap
new file mode 100644
index 000000000..77ac86457
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/markdown/__snapshots__/format.test.js.snap
@@ -0,0 +1,114 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`front-matter-with-noformat-pragma.md - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["markdown"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+---
+something
+---
+
+<!-- @noformat -->
+
+I     won't       format       !!
+
+=====================================output=====================================
+---
+something
+---
+
+<!-- @noformat -->
+
+I     won't       format       !!
+
+================================================================================
+`;
+
+exports[`front-matter-with-noprettier-pragma.md - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["markdown"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+---
+something
+---
+
+<!-- @noprettier -->
+
+I     won't       format       !!
+
+
+=====================================output=====================================
+---
+something
+---
+
+<!-- @noprettier -->
+
+I     won't       format       !!
+
+
+================================================================================
+`;
+
+exports[`with-noformat-pragma.md - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["markdown"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+<!-- @noformat -->
+
+I     won't       format       !!
+
+
+=====================================output=====================================
+<!-- @noformat -->
+
+I     won't       format       !!
+
+
+================================================================================
+`;
+
+exports[`with-noprettier-pragma.md - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["markdown"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+<!-- @noprettier -->
+
+I     won't       format       !!
+
+
+=====================================output=====================================
+<!-- @noprettier -->
+
+I     won't       format       !!
+
+
+================================================================================
+`;
+
+exports[`without-pragma.md - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["markdown"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+I     will      format   !!
+
+=====================================output=====================================
+I will format !!
+
+================================================================================
+`;
diff --git a/tests/format/misc/check-ignore-pragma/markdown/format.test.js b/tests/format/misc/check-ignore-pragma/markdown/format.test.js
new file mode 100644
index 000000000..a22cf38ec
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/markdown/format.test.js
@@ -0,0 +1 @@
+runFormatTest(import.meta, ["markdown"], { checkIgnorePragma: true });
diff --git a/tests/format/misc/check-ignore-pragma/markdown/front-matter-with-noformat-pragma.md b/tests/format/misc/check-ignore-pragma/markdown/front-matter-with-noformat-pragma.md
new file mode 100644
index 000000000..ec03c9150
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/markdown/front-matter-with-noformat-pragma.md
@@ -0,0 +1,7 @@
+---
+something
+---
+
+<!-- @noformat -->
+
+I     won't       format       !!
diff --git a/tests/format/misc/check-ignore-pragma/markdown/front-matter-with-noprettier-pragma.md b/tests/format/misc/check-ignore-pragma/markdown/front-matter-with-noprettier-pragma.md
new file mode 100644
index 000000000..aabe5a93a
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/markdown/front-matter-with-noprettier-pragma.md
@@ -0,0 +1,8 @@
+---
+something
+---
+
+<!-- @noprettier -->
+
+I     won't       format       !!
+
diff --git a/tests/format/misc/check-ignore-pragma/markdown/with-noformat-pragma.md b/tests/format/misc/check-ignore-pragma/markdown/with-noformat-pragma.md
new file mode 100644
index 000000000..fd6c6a5bd
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/markdown/with-noformat-pragma.md
@@ -0,0 +1,4 @@
+<!-- @noformat -->
+
+I     won't       format       !!
+
diff --git a/tests/format/misc/check-ignore-pragma/markdown/with-noprettier-pragma.md b/tests/format/misc/check-ignore-pragma/markdown/with-noprettier-pragma.md
new file mode 100644
index 000000000..ef0590b9d
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/markdown/with-noprettier-pragma.md
@@ -0,0 +1,4 @@
+<!-- @noprettier -->
+
+I     won't       format       !!
+
diff --git a/tests/format/misc/check-ignore-pragma/markdown/without-pragma.md b/tests/format/misc/check-ignore-pragma/markdown/without-pragma.md
new file mode 100644
index 000000000..7aac33895
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/markdown/without-pragma.md
@@ -0,0 +1 @@
+I     will      format   !!
diff --git a/tests/format/misc/check-ignore-pragma/mdx/__snapshots__/format.test.js.snap b/tests/format/misc/check-ignore-pragma/mdx/__snapshots__/format.test.js.snap
new file mode 100644
index 000000000..bd95e8eea
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/mdx/__snapshots__/format.test.js.snap
@@ -0,0 +1,54 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`with-noformat-pragma.md - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["mdx"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+{/* @noformat */}
+
+I     should   NOT   be      formatted       !!
+
+=====================================output=====================================
+{/* @noformat */}
+
+I     should   NOT   be      formatted       !!
+
+================================================================================
+`;
+
+exports[`with-noprettier-pragma.md - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["mdx"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+{/* @noprettier */}
+
+I     should   NOT   be      formatted       !!
+
+=====================================output=====================================
+{/* @noprettier */}
+
+I     should   NOT   be      formatted       !!
+
+================================================================================
+`;
+
+exports[`without-pragma.md - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["mdx"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+I     should      format   !!
+
+=====================================output=====================================
+I should format !!
+
+================================================================================
+`;
diff --git a/tests/format/misc/check-ignore-pragma/mdx/format.test.js b/tests/format/misc/check-ignore-pragma/mdx/format.test.js
new file mode 100644
index 000000000..e478b0c43
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/mdx/format.test.js
@@ -0,0 +1 @@
+runFormatTest(import.meta, ["mdx"], { checkIgnorePragma: true });
diff --git a/tests/format/misc/check-ignore-pragma/mdx/with-noformat-pragma.md b/tests/format/misc/check-ignore-pragma/mdx/with-noformat-pragma.md
new file mode 100644
index 000000000..55fe2cbf3
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/mdx/with-noformat-pragma.md
@@ -0,0 +1,3 @@
+{/* @noformat */}
+
+I     should   NOT   be      formatted       !!
diff --git a/tests/format/misc/check-ignore-pragma/mdx/with-noprettier-pragma.md b/tests/format/misc/check-ignore-pragma/mdx/with-noprettier-pragma.md
new file mode 100644
index 000000000..ca173a475
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/mdx/with-noprettier-pragma.md
@@ -0,0 +1,3 @@
+{/* @noprettier */}
+
+I     should   NOT   be      formatted       !!
diff --git a/tests/format/misc/check-ignore-pragma/mdx/without-pragma.md b/tests/format/misc/check-ignore-pragma/mdx/without-pragma.md
new file mode 100644
index 000000000..1a17925e4
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/mdx/without-pragma.md
@@ -0,0 +1 @@
+I     should      format   !!
diff --git a/tests/format/misc/check-ignore-pragma/vue/__snapshots__/format.test.js.snap b/tests/format/misc/check-ignore-pragma/vue/__snapshots__/format.test.js.snap
new file mode 100644
index 000000000..bcefddd8e
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/vue/__snapshots__/format.test.js.snap
@@ -0,0 +1,86 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`with-noformat-pragma.vue - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["vue"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+<!-- @noformat -->
+<template>
+  <div>This will be pre-compiled</div>
+</template>
+<script>
+const    x      = 1;
+</script>
+<style src="./my-component.css"></style>
+
+=====================================output=====================================
+<!-- @noformat -->
+<template>
+  <div>This will be pre-compiled</div>
+</template>
+<script>
+const    x      = 1;
+</script>
+<style src="./my-component.css"></style>
+
+================================================================================
+`;
+
+exports[`with-noprettier-pragma.vue - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["vue"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+<!-- @noprettier -->
+<template>
+  <div>This will be pre-compiled</div>
+</template>
+<script>
+const    x      = 1;
+</script>
+<style src="./my-component.css"></style>
+
+=====================================output=====================================
+<!-- @noprettier -->
+<template>
+  <div>This will be pre-compiled</div>
+</template>
+<script>
+const    x      = 1;
+</script>
+<style src="./my-component.css"></style>
+
+================================================================================
+`;
+
+exports[`without-pragma.vue - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["vue"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+<template>
+  <div>This will be pre-compiled</div>
+</template>
+<script>
+const    x      = 1;
+</script>
+<style src="./my-component.css"></style>
+
+=====================================output=====================================
+<template>
+  <div>This will be pre-compiled</div>
+</template>
+<script>
+const x = 1;
+</script>
+<style src="./my-component.css"></style>
+
+================================================================================
+`;
diff --git a/tests/format/misc/check-ignore-pragma/vue/format.test.js b/tests/format/misc/check-ignore-pragma/vue/format.test.js
new file mode 100644
index 000000000..0513f628c
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/vue/format.test.js
@@ -0,0 +1 @@
+runFormatTest(import.meta, ["vue"], { checkIgnorePragma: true });
diff --git a/tests/format/misc/check-ignore-pragma/vue/with-noformat-pragma.vue b/tests/format/misc/check-ignore-pragma/vue/with-noformat-pragma.vue
new file mode 100644
index 000000000..5d3d18610
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/vue/with-noformat-pragma.vue
@@ -0,0 +1,8 @@
+<!-- @noformat -->
+<template>
+  <div>This will be pre-compiled</div>
+</template>
+<script>
+const    x      = 1;
+</script>
+<style src="./my-component.css"></style>
diff --git a/tests/format/misc/check-ignore-pragma/vue/with-noprettier-pragma.vue b/tests/format/misc/check-ignore-pragma/vue/with-noprettier-pragma.vue
new file mode 100644
index 000000000..0150e6dcf
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/vue/with-noprettier-pragma.vue
@@ -0,0 +1,8 @@
+<!-- @noprettier -->
+<template>
+  <div>This will be pre-compiled</div>
+</template>
+<script>
+const    x      = 1;
+</script>
+<style src="./my-component.css"></style>
diff --git a/tests/format/misc/check-ignore-pragma/vue/without-pragma.vue b/tests/format/misc/check-ignore-pragma/vue/without-pragma.vue
new file mode 100644
index 000000000..a7810952c
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/vue/without-pragma.vue
@@ -0,0 +1,7 @@
+<template>
+  <div>This will be pre-compiled</div>
+</template>
+<script>
+const    x      = 1;
+</script>
+<style src="./my-component.css"></style>
diff --git a/tests/format/misc/check-ignore-pragma/yaml/__snapshots__/format.test.js.snap b/tests/format/misc/check-ignore-pragma/yaml/__snapshots__/format.test.js.snap
new file mode 100644
index 000000000..d17897f09
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/yaml/__snapshots__/format.test.js.snap
@@ -0,0 +1,56 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`with-noformat-pragma.yml - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["yaml"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+# @noformat
+
+    123
+
+=====================================output=====================================
+# @noformat
+
+    123
+
+================================================================================
+`;
+
+exports[`with-noprettier-pragma.yml - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["yaml"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+# @noprettier
+
+    123
+
+=====================================output=====================================
+# @noprettier
+
+    123
+
+================================================================================
+`;
+
+exports[`without-pragma.yml - {"checkIgnorePragma":true} format 1`] = `
+====================================options=====================================
+checkIgnorePragma: true
+parsers: ["yaml"]
+printWidth: 80
+                                                                                | printWidth
+=====================================input======================================
+
+
+    123
+
+=====================================output=====================================
+123
+
+================================================================================
+`;
diff --git a/tests/format/misc/check-ignore-pragma/yaml/format.test.js b/tests/format/misc/check-ignore-pragma/yaml/format.test.js
new file mode 100644
index 000000000..3c3bcc7a7
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/yaml/format.test.js
@@ -0,0 +1 @@
+runFormatTest(import.meta, ["yaml"], { checkIgnorePragma: true });
diff --git a/tests/format/misc/check-ignore-pragma/yaml/with-noformat-pragma.yml b/tests/format/misc/check-ignore-pragma/yaml/with-noformat-pragma.yml
new file mode 100644
index 000000000..af6095ae4
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/yaml/with-noformat-pragma.yml
@@ -0,0 +1,3 @@
+# @noformat
+
+    123
diff --git a/tests/format/misc/check-ignore-pragma/yaml/with-noprettier-pragma.yml b/tests/format/misc/check-ignore-pragma/yaml/with-noprettier-pragma.yml
new file mode 100644
index 000000000..ccc87f99d
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/yaml/with-noprettier-pragma.yml
@@ -0,0 +1,3 @@
+# @noprettier
+
+    123
diff --git a/tests/format/misc/check-ignore-pragma/yaml/without-pragma.yml b/tests/format/misc/check-ignore-pragma/yaml/without-pragma.yml
new file mode 100644
index 000000000..c4a580e43
--- /dev/null
+++ b/tests/format/misc/check-ignore-pragma/yaml/without-pragma.yml
@@ -0,0 +1,3 @@
+
+
+    123
diff --git a/tests/integration/__tests__/__snapshots__/arg-parsing.js.snap b/tests/integration/__tests__/__snapshots__/arg-parsing.js.snap
index 068855c88..58cb29f51 100644
--- a/tests/integration/__tests__/__snapshots__/arg-parsing.js.snap
+++ b/tests/integration/__tests__/__snapshots__/arg-parsing.js.snap
@@ -1,63 +1,102 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`allow overriding flags (stderr) 1`] = `""`;
-
-exports[`allow overriding flags (write) 1`] = `[]`;
-
-exports[`boolean flags do not swallow the next argument (stderr) 1`] = `""`;
-
-exports[`boolean flags do not swallow the next argument (stdout) 1`] = `"console.log('could be single quote and without semi');"`;
-
-exports[`boolean flags do not swallow the next argument (write) 1`] = `[]`;
-
-exports[`deprecated option values are warned (stderr) 1`] = `"[warn] --jsx-bracket-same-line is deprecated."`;
-
-exports[`deprecated option values are warned (stdout) 1`] = `"console.log("could be single quote and without semi");"`;
-
-exports[`deprecated option values are warned (write) 1`] = `[]`;
+exports[`allow overriding flags  1`] = `
+{
+  "stderr": "",
+  "write": [],
+}
+`;
 
-exports[`negated options work (stderr) 1`] = `""`;
+exports[`boolean flags do not swallow the next argument  1`] = `
+{
+  "stderr": "",
+  "stdout": "console.log('could be single quote and without semi');",
+  "write": [],
+}
+`;
 
-exports[`negated options work (stdout) 1`] = `"console.log("could be single quote and without semi")"`;
+exports[`deprecated option values are warned  1`] = `
+{
+  "stderr": "[warn] --jsx-bracket-same-line is deprecated.",
+  "stdout": "console.log("could be single quote and without semi");",
+  "write": [],
+}
+`;
 
-exports[`negated options work (write) 1`] = `[]`;
+exports[`negated options work  1`] = `
+{
+  "stderr": "",
+  "stdout": "console.log("could be single quote and without semi")",
+  "write": [],
+}
+`;
 
-exports[`number file/dir (stdout) 1`] = `"1/file-in-dir-named-1.js"`;
+exports[`number file/dir  1`] = `
+{
+  "stdout": "1/file-in-dir-named-1.js",
+}
+`;
 
-exports[`number file/dir (stdout) 2`] = `"2.2/file-in-dir-named-2.2.js"`;
+exports[`number file/dir  2`] = `
+{
+  "stdout": "2.2/file-in-dir-named-2.2.js",
+}
+`;
 
-exports[`number file/dir (stdout) 3`] = `"3"`;
+exports[`number file/dir  3`] = `
+{
+  "stdout": "3",
+}
+`;
 
-exports[`number file/dir (stdout) 4`] = `"4.44"`;
+exports[`number file/dir  4`] = `
+{
+  "stdout": "4.44",
+}
+`;
 
-exports[`number file/dir (stdout) 5`] = `
-"1/file-in-dir-named-1.js
+exports[`number file/dir  5`] = `
+{
+  "stdout": "1/file-in-dir-named-1.js
 2.2/file-in-dir-named-2.2.js
 3
-4.44"
+4.44",
+}
 `;
 
-exports[`options with \`cliName\` should not allow to pass directly (stderr) 1`] = `
-"[warn] Ignored unknown option --filepath=file.js.
-[error] No parser and no file path given, couldn't infer a parser."
+exports[`options with \`cliName\` should not allow to pass directly  1`] = `
+{
+  "stdout": "prettier();",
+}
 `;
 
-exports[`options with \`cliName\` should not allow to pass directly (stdout) 1`] = `"prettier();"`;
-
-exports[`options with \`cliName\` should not allow to pass directly (stdout) 2`] = `""`;
-
-exports[`unknown negated options are warned (stderr) 1`] = `"[warn] Ignored unknown option --no-unknown."`;
-
-exports[`unknown negated options are warned (stdout) 1`] = `"console.log("could be single quote and without semi");"`;
-
-exports[`unknown negated options are warned (write) 1`] = `[]`;
-
-exports[`unknown options are warned (stderr) 1`] = `"[warn] Ignored unknown option --unknown."`;
-
-exports[`unknown options are warned (stdout) 1`] = `"console.log("could be single quote and without semi");"`;
+exports[`options with \`cliName\` should not allow to pass directly  2`] = `
+{
+  "stderr": "[warn] Ignored unknown option --filepath=file.js.
+[error] No parser and no file path given, couldn't infer a parser.",
+  "stdout": "",
+}
+`;
 
-exports[`unknown options are warned (write) 1`] = `[]`;
+exports[`unknown negated options are warned  1`] = `
+{
+  "stderr": "[warn] Ignored unknown option --no-unknown.",
+  "stdout": "console.log("could be single quote and without semi");",
+  "write": [],
+}
+`;
 
-exports[`unknown options not suggestion \`_\` (stderr) 1`] = `"[warn] Ignored unknown option -a. Did you mean -c?"`;
+exports[`unknown options are warned  1`] = `
+{
+  "stderr": "[warn] Ignored unknown option --unknown.",
+  "stdout": "console.log("could be single quote and without semi");",
+  "write": [],
+}
+`;
 
-exports[`unknown options not suggestion \`_\` (stdout) 1`] = `"console.log("could be single quote and without semi");"`;
+exports[`unknown options not suggestion \`_\`  1`] = `
+{
+  "stderr": "[warn] Ignored unknown option -a. Did you mean -c?",
+  "stdout": "console.log("could be single quote and without semi");",
+}
+`;
diff --git a/tests/integration/__tests__/__snapshots__/check.js.snap b/tests/integration/__tests__/__snapshots__/check.js.snap
index 1c64b954c..39b0e8fb2 100644
--- a/tests/integration/__tests__/__snapshots__/check.js.snap
+++ b/tests/integration/__tests__/__snapshots__/check.js.snap
@@ -1,33 +1,41 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`--checks should print the number of files that need formatting (stderr) 1`] = `
-"[warn] unformatted.js
+exports[`--checks should print the number of files that need formatting  1`] = `
+{
+  "stderr": "[warn] unformatted.js
 [warn] unformatted2.js
-[warn] Code style issues found in 2 files. Run Prettier with --write to fix."
+[warn] Code style issues found in 2 files. Run Prettier with --write to fix.",
+  "stdout": "Checking formatting...",
+  "write": [],
+}
 `;
 
-exports[`--checks should print the number of files that need formatting (stdout) 1`] = `"Checking formatting..."`;
-
-exports[`--checks should print the number of files that need formatting (write) 1`] = `[]`;
-
-exports[`--checks works in CI just as in a non-TTY mode (stderr) 1`] = `
-"[warn] unformatted.js
-[warn] Code style issues found in the above file. Run Prettier with --write to fix."
+exports[`--checks works in CI just as in a non-TTY mode  1`] = `
+{
+  "stderr": "[warn] unformatted.js
+[warn] Code style issues found in the above file. Run Prettier with --write to fix.",
+  "stdout": "Checking formatting...",
+  "write": [],
+}
 `;
 
-exports[`--checks works in CI just as in a non-TTY mode (stderr) 2`] = `
-"[warn] unformatted.js
-[warn] Code style issues found in the above file. Run Prettier with --write to fix."
+exports[`--checks works in CI just as in a non-TTY mode  2`] = `
+{
+  "stderr": "[warn] unformatted.js
+[warn] Code style issues found in the above file. Run Prettier with --write to fix.",
+  "stdout": "Checking formatting...",
+  "write": [],
+}
 `;
 
-exports[`--checks works in CI just as in a non-TTY mode (stdout) 1`] = `"Checking formatting..."`;
-
-exports[`--checks works in CI just as in a non-TTY mode (stdout) 2`] = `"Checking formatting..."`;
-
-exports[`--checks works in CI just as in a non-TTY mode (write) 1`] = `[]`;
-
-exports[`--checks works in CI just as in a non-TTY mode (write) 2`] = `[]`;
-
-exports[`checks stdin with --check (write) 1`] = `[]`;
+exports[`checks stdin with --check  1`] = `
+{
+  "write": [],
+}
+`;
 
-exports[`checks stdin with -c (alias for --check) (write) 1`] = `[]`;
+exports[`checks stdin with -c (alias for --check)  1`] = `
+{
+  "write": [],
+}
+`;
diff --git a/tests/integration/__tests__/__snapshots__/config-invalid.js.snap b/tests/integration/__tests__/__snapshots__/config-invalid.js.snap
index 105c5d0cf..fbdb89234 100644
--- a/tests/integration/__tests__/__snapshots__/config-invalid.js.snap
+++ b/tests/integration/__tests__/__snapshots__/config-invalid.js.snap
@@ -1,71 +1,85 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`resolves external configuration from package.json (stderr) 1`] = `
-"[error] Invalid configuration for file "<cli>/config-external-config-syntax-error/syntax-error.js":
-[error] THIS ERROR MESSAGE MUST COME FROM THIS syntax-error.js FILE"
+exports[`resolves external configuration from package.json  1`] = `
+{
+  "stderr": "[error] Invalid configuration for file "<cli>/config-external-config-syntax-error/syntax-error.js":
+[error] THIS ERROR MESSAGE MUST COME FROM THIS syntax-error.js FILE",
+  "stdout": "",
+  "write": [],
+}
 `;
 
-exports[`resolves external configuration from package.json (stdout) 1`] = `""`;
-
-exports[`resolves external configuration from package.json (write) 1`] = `[]`;
-
-exports[`show warning with kebab-case option key (stderr) 1`] = `"[warn] Ignored unknown option { "print-width": 3 }. Did you mean printWidth?"`;
-
-exports[`show warning with kebab-case option key (stdout) 1`] = `""`;
-
-exports[`show warning with kebab-case option key (write) 1`] = `[]`;
-
-exports[`show warning with unknown option (stderr) 1`] = `"[warn] Ignored unknown option { hello: "world" }."`;
-
-exports[`show warning with unknown option (stdout) 1`] = `""`;
-
-exports[`show warning with unknown option (write) 1`] = `[]`;
-
-exports[`throw error for unsupported extension (stderr) 1`] = `
-"[error] Invalid configuration:
-[error] No loader specified for extension ".unsupported""
+exports[`show warning with kebab-case option key  1`] = `
+{
+  "stderr": "[warn] Ignored unknown option { "print-width": 3 }. Did you mean printWidth?",
+  "stdout": "",
+  "write": [],
+}
 `;
 
-exports[`throw error for unsupported extension (stdout) 1`] = `""`;
-
-exports[`throw error for unsupported extension (write) 1`] = `[]`;
-
-exports[`throw error with invalid config format (stdout) 1`] = `""`;
-
-exports[`throw error with invalid config format (stdout) 2`] = `""`;
-
-exports[`throw error with invalid config format (write) 1`] = `[]`;
-
-exports[`throw error with invalid config format (write) 2`] = `[]`;
-
-exports[`throw error with invalid config option (int) (stderr) 1`] = `"[error] Invalid tabWidth value. Expected an integer, but received 0.5."`;
+exports[`show warning with unknown option  1`] = `
+{
+  "stderr": "[warn] Ignored unknown option { hello: "world" }.",
+  "stdout": "",
+  "write": [],
+}
+`;
 
-exports[`throw error with invalid config option (int) (stdout) 1`] = `""`;
+exports[`throw error for unsupported extension  1`] = `
+{
+  "stderr": "[error] Invalid configuration:
+[error] No loader specified for extension ".unsupported"",
+  "stdout": "",
+  "write": [],
+}
+`;
 
-exports[`throw error with invalid config option (int) (write) 1`] = `[]`;
+exports[`throw error with invalid config format  1`] = `
+{
+  "stdout": "",
+  "write": [],
+}
+`;
 
-exports[`throw error with invalid config option (trailingComma) (stderr) 1`] = `"[error] Invalid trailingComma value. Expected "all", "es5" or "none", but received "wow"."`;
+exports[`throw error with invalid config format  2`] = `
+{
+  "stdout": "",
+  "write": [],
+}
+`;
 
-exports[`throw error with invalid config option (trailingComma) (stdout) 1`] = `""`;
+exports[`throw error with invalid config option (int)  1`] = `
+{
+  "stderr": "[error] Invalid tabWidth value. Expected an integer, but received 0.5.",
+  "stdout": "",
+  "write": [],
+}
+`;
 
-exports[`throw error with invalid config option (trailingComma) (write) 1`] = `[]`;
+exports[`throw error with invalid config option (trailingComma)  1`] = `
+{
+  "stderr": "[error] Invalid trailingComma value. Expected "all", "es5" or "none", but received "wow".",
+  "stdout": "",
+  "write": [],
+}
+`;
 
-exports[`throw error with invalid config precedence option (configPrecedence) (stderr) 1`] = `
-"[error] Invalid --config-precedence value. Expected one of the following values, but received "option/configPrecedence".
+exports[`throw error with invalid config precedence option (configPrecedence)  1`] = `
+{
+  "stderr": "[error] Invalid --config-precedence value. Expected one of the following values, but received "option/configPrecedence".
 [error] - "cli-override"
 [error] - "file-override"
-[error] - "prefer-file""
+[error] - "prefer-file"",
+  "stdout": "",
+  "write": [],
+}
 `;
 
-exports[`throw error with invalid config precedence option (configPrecedence) (stdout) 1`] = `""`;
-
-exports[`throw error with invalid config precedence option (configPrecedence) (write) 1`] = `[]`;
-
-exports[`throw error with invalid config target (directory) (stderr) 1`] = `
-"[error] Invalid configuration:
-[error] Unable to read '<cli>/config/invalid/folder/.prettierrc': EISDIR: illegal operation on a directory, read"
+exports[`throw error with invalid config target (directory)  1`] = `
+{
+  "stderr": "[error] Invalid configuration:
+[error] Unable to read '<cli>/config/invalid/folder/.prettierrc': EISDIR: illegal operation on a directory, read",
+  "stdout": "",
+  "write": [],
+}
 `;
-
-exports[`throw error with invalid config target (directory) (stdout) 1`] = `""`;
-
-exports[`throw error with invalid config target (directory) (write) 1`] = `[]`;
diff --git a/tests/integration/__tests__/__snapshots__/config-resolution.js.snap b/tests/integration/__tests__/__snapshots__/config-resolution.js.snap
index 34277cde9..a86f36b2e 100644
--- a/tests/integration/__tests__/__snapshots__/config-resolution.js.snap
+++ b/tests/integration/__tests__/__snapshots__/config-resolution.js.snap
@@ -1,47 +1,74 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`accepts configuration from --config (stderr) 1`] = `""`;
-
-exports[`accepts configuration from --config (stdout) 1`] = `
-"function js() {
+exports[`accepts configuration from --config  1`] = `
+{
+  "stderr": "",
+  "stdout": "function js() {
  console.log("js/file.js should have tab width 8 (1 if CLI)")
-}"
+}",
+  "write": [],
+}
 `;
 
-exports[`accepts configuration from --config (write) 1`] = `[]`;
-
-exports[`prints error message when no file found with --find-config-path (stderr) 1`] = `"[error] Can not find configure file for "../--non-exits-filename--"."`;
-
-exports[`prints error message when no file found with --find-config-path (write) 1`] = `[]`;
-
-exports[`resolves configuration file with --find-config-path file (stderr) 1`] = `""`;
-
-exports[`resolves configuration file with --find-config-path file (stdout) 1`] = `".prettierrc"`;
-
-exports[`resolves configuration file with --find-config-path file (write) 1`] = `[]`;
-
-exports[`resolves external configuration from package.json (cjs package) (stdout) 1`] = `"console.log("should have no semi")"`;
-
-exports[`resolves external configuration from package.json (esm file) (stdout) 1`] = `"console.log("should have no semi")"`;
-
-exports[`resolves external configuration from package.json (esm package with TLA) (stdout) 1`] = `"console.log("should have no semi")"`;
-
-exports[`resolves external configuration from package.json (esm package) (stdout) 1`] = `"console.log("should have no semi")"`;
-
-exports[`resolves json configuration file with --find-config-path file (stderr) 1`] = `""`;
+exports[`prints error message when no file found with --find-config-path  1`] = `
+{
+  "stderr": "[error] Can not find configure file for "../--non-exits-filename--".",
+  "write": [],
+}
+`;
 
-exports[`resolves json configuration file with --find-config-path file (stdout) 1`] = `"rc-json/.prettierrc.json"`;
+exports[`resolves configuration file with --find-config-path file  1`] = `
+{
+  "stderr": "",
+  "stdout": ".prettierrc",
+  "write": [],
+}
+`;
 
-exports[`resolves json configuration file with --find-config-path file (write) 1`] = `[]`;
+exports[`resolves external configuration from package.json (cjs package)  1`] = `
+{
+  "stdout": "console.log("should have no semi")",
+}
+`;
 
-exports[`resolves toml configuration file with --find-config-path file (stderr) 1`] = `""`;
+exports[`resolves external configuration from package.json (esm file)  1`] = `
+{
+  "stdout": "console.log("should have no semi")",
+}
+`;
 
-exports[`resolves toml configuration file with --find-config-path file (stdout) 1`] = `"rc-toml/.prettierrc.toml"`;
+exports[`resolves external configuration from package.json (esm package with TLA)  1`] = `
+{
+  "stdout": "console.log("should have no semi")",
+}
+`;
 
-exports[`resolves toml configuration file with --find-config-path file (write) 1`] = `[]`;
+exports[`resolves external configuration from package.json (esm package)  1`] = `
+{
+  "stdout": "console.log("should have no semi")",
+}
+`;
 
-exports[`resolves yaml configuration file with --find-config-path file (stderr) 1`] = `""`;
+exports[`resolves json configuration file with --find-config-path file  1`] = `
+{
+  "stderr": "",
+  "stdout": "rc-json/.prettierrc.json",
+  "write": [],
+}
+`;
 
-exports[`resolves yaml configuration file with --find-config-path file (stdout) 1`] = `"rc-yaml/.prettierrc.yaml"`;
+exports[`resolves toml configuration file with --find-config-path file  1`] = `
+{
+  "stderr": "",
+  "stdout": "rc-toml/.prettierrc.toml",
+  "write": [],
+}
+`;
 
-exports[`resolves yaml configuration file with --find-config-path file (write) 1`] = `[]`;
+exports[`resolves yaml configuration file with --find-config-path file  1`] = `
+{
+  "stderr": "",
+  "stdout": "rc-yaml/.prettierrc.yaml",
+  "write": [],
+}
+`;
diff --git a/tests/integration/__tests__/__snapshots__/cursor-offset.js.snap b/tests/integration/__tests__/__snapshots__/cursor-offset.js.snap
index bdc131454..a0c2b2fdf 100644
--- a/tests/integration/__tests__/__snapshots__/cursor-offset.js.snap
+++ b/tests/integration/__tests__/__snapshots__/cursor-offset.js.snap
@@ -1,7 +1,8 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`cursorOffset should not be affected by full-width character (stdout) 1`] = `
-"const x = [
+exports[`cursorOffset should not be affected by full-width character  1`] = `
+{
+  "stdout": "const x = [
   "中文",
   "中文",
   "中文",
@@ -13,13 +14,15 @@ exports[`cursorOffset should not be affected by full-width character (stdout) 1`
   "中文",
   "中文",
   "中文",
-];"
+];",
+  "write": [],
+}
 `;
 
-exports[`cursorOffset should not be affected by full-width character (write) 1`] = `[]`;
-
-exports[`write cursorOffset to stderr with --cursor-offset <int> (stderr) 1`] = `"1"`;
-
-exports[`write cursorOffset to stderr with --cursor-offset <int> (stdout) 1`] = `"1;"`;
-
-exports[`write cursorOffset to stderr with --cursor-offset <int> (write) 1`] = `[]`;
+exports[`write cursorOffset to stderr with --cursor-offset <int>  1`] = `
+{
+  "stderr": "1",
+  "stdout": "1;",
+  "write": [],
+}
+`;
diff --git a/tests/integration/__tests__/__snapshots__/debug-check.js.snap b/tests/integration/__tests__/__snapshots__/debug-check.js.snap
index 3726d090d..e2142a52e 100644
--- a/tests/integration/__tests__/__snapshots__/debug-check.js.snap
+++ b/tests/integration/__tests__/__snapshots__/debug-check.js.snap
@@ -1,33 +1,46 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`checks stdin with --debug-check (write) 1`] = `[]`;
-
-exports[`doesn't crash when --debug-check is passed (write) 1`] = `[]`;
+exports[`checks stdin with --debug-check  1`] = `
+{
+  "write": [],
+}
+`;
 
-exports[`should not exit non-zero for already prettified code with --debug-check + --check (stderr) 1`] = `""`;
+exports[`doesn't crash when --debug-check is passed  1`] = `
+{
+  "write": [],
+}
+`;
 
-exports[`should not exit non-zero for already prettified code with --debug-check + --check (stdout) 1`] = `
-"Checking formatting...
+exports[`should not exit non-zero for already prettified code with --debug-check + --check  1`] = `
+{
+  "stderr": "",
+  "stdout": "Checking formatting...
 issue-4599.js
-All matched files use Prettier code style!"
+All matched files use Prettier code style!",
+  "write": [],
+}
 `;
 
-exports[`should not exit non-zero for already prettified code with --debug-check + --check (write) 1`] = `[]`;
-
-exports[`should not exit non-zero for already prettified code with --debug-check + --list-different (stderr) 1`] = `""`;
-
-exports[`should not exit non-zero for already prettified code with --debug-check + --list-different (stdout) 1`] = `"issue-4599.js"`;
-
-exports[`should not exit non-zero for already prettified code with --debug-check + --list-different (write) 1`] = `[]`;
-
-exports[`should not exit non-zero for jsx style element with spread attribute (stderr) 1`] = `""`;
-
-exports[`should not exit non-zero for jsx style element with spread attribute (stdout) 1`] = `"issue-15094.jsx"`;
+exports[`should not exit non-zero for already prettified code with --debug-check + --list-different  1`] = `
+{
+  "stderr": "",
+  "stdout": "issue-4599.js",
+  "write": [],
+}
+`;
 
-exports[`should not exit non-zero for jsx style element with spread attribute (write) 1`] = `[]`;
+exports[`should not exit non-zero for jsx style element with spread attribute  1`] = `
+{
+  "stderr": "",
+  "stdout": "issue-15094.jsx",
+  "write": [],
+}
+`;
 
-exports[`show diff for 2+ error files with --debug-check (stderr) 1`] = `
-"[error] a.debug-check: prettier(input) !== prettier(prettier(input))
+exports[`show diff for 2+ error files with --debug-check  1`] = `
+{
+  "stderr": "[error] a.debug-check: prettier(input) !== prettier(prettier(input))
 [error] Index: 
 [error] ===================================================================
 [error] --- 	
@@ -48,9 +61,8 @@ exports[`show diff for 2+ error files with --debug-check (stderr) 1`] = `
 [error]  world
 [error] +world
 [error] +world
-[error] "
+[error] ",
+  "stdout": "",
+  "write": [],
+}
 `;
-
-exports[`show diff for 2+ error files with --debug-check (stdout) 1`] = `""`;
-
-exports[`show diff for 2+ error files with --debug-check (write) 1`] = `[]`;
diff --git a/tests/integration/__tests__/__snapshots__/debug-print-comments.js.snap b/tests/integration/__tests__/__snapshots__/debug-print-comments.js.snap
index 089c3914a..2b5693202 100644
--- a/tests/integration/__tests__/__snapshots__/debug-print-comments.js.snap
+++ b/tests/integration/__tests__/__snapshots__/debug-print-comments.js.snap
@@ -1,7 +1,8 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`prints information for debugging comment attachment with --debug-print-comments (stdout) 1`] = `
-"[
+exports[`prints information for debugging comment attachment with --debug-print-comments  1`] = `
+{
+  "stdout": "[
   {
     "type": "CommentBlock",
     "value": " 1 ",
@@ -44,7 +45,7 @@ exports[`prints information for debugging comment attachment with --debug-print-
     "trailing": true,
     "nodeDescription": "ExpressionStatement"
   }
-]"
+]",
+  "write": [],
+}
 `;
-
-exports[`prints information for debugging comment attachment with --debug-print-comments (write) 1`] = `[]`;
diff --git a/tests/integration/__tests__/__snapshots__/early-exit.js.snap b/tests/integration/__tests__/__snapshots__/early-exit.js.snap
index 081db3989..d04a83b9e 100644
--- a/tests/integration/__tests__/__snapshots__/early-exit.js.snap
+++ b/tests/integration/__tests__/__snapshots__/early-exit.js.snap
@@ -1,33 +1,33 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`show detailed usage with --help l (alias) (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help l (alias) (stdout) 1`] = `
-"-l, --list-different
-
-  Print the names of files that are different from Prettier's formatting (see also --check)."
+exports[`show detailed usage with --help l (alias)  1`] = `
+{
+  "stderr": "",
+  "stdout": "-l, --list-different
+
+  Print the names of files that are different from Prettier's formatting (see also --check).",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help l (alias) (write) 1`] = `[]`;
-
-exports[`show detailed usage with plugin options (manual resolution) (stderr) 1`] = `""`;
-
-exports[`show detailed usage with plugin options (manual resolution) (stdout) 1`] = `
-"--tab-width <int>
+exports[`show detailed usage with plugin options (manual resolution)  1`] = `
+{
+  "stderr": "",
+  "stdout": "--tab-width <int>
 
   Number of spaces per indentation level.
 
 Default: 2
 Plugin defaults:
-* ../plugins/automatic/node_modules/prettier-plugin-bar/index.js: 4"
+* ../plugins/automatic/node_modules/prettier-plugin-bar/index.js: 4",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with plugin options (manual resolution) (write) 1`] = `[]`;
-
-exports[`show usage with --help (stderr) 1`] = `""`;
-
-exports[`show usage with --help (stdout) 1`] = `
-"Usage: prettier [options] [file/dir/glob ...]
+exports[`show usage with --help  1`] = `
+{
+  "stderr": "",
+  "stdout": "Usage: prettier [options] [file/dir/glob ...]
 
 By default, output is written to stdout.
 Stdin is read if it is piped to Prettier and no files are given.
@@ -128,6 +128,8 @@ Other options:
   --cache-location <path>  Path to the cache file.
   --cache-strategy <metadata|content>
                            Strategy for the cache to use for detecting changed files.
+  --check-ignore-pragma    Check whether the file's first docblock comment contains '@noprettier' or '@noformat' to determine if it should be formatted.
+                           Defaults to false.
   --no-color               Do not colorize error messages.
   --no-error-on-unmatched-pattern
                            Prevent errors when pattern is unmatched.
@@ -142,26 +144,28 @@ Other options:
   --log-level <silent|error|warn|log|debug>
                            What level of logs to report.
                            Defaults to log.
-  --require-pragma         Require either '@prettier' or '@format' to be present in the file's first docblock comment
-                           in order for it to be formatted.
+  --require-pragma         Require either '@prettier' or '@format' to be present in the file's first docblock comment in order for it to be formatted.
                            Defaults to false.
   --stdin-filepath <path>  Path to the file to pretend that stdin comes from.
   --support-info           Print support information as JSON.
   -v, --version            Print Prettier version.
 
-"
+",
+  "write": [],
+}
 `;
 
-exports[`show usage with --help (write) 1`] = `[]`;
-
-exports[`show version with --version (stderr) 1`] = `""`;
-
-exports[`show version with --version (write) 1`] = `[]`;
-
-exports[`show warning with --help not-found (typo) (stderr) 1`] = `"[warn] Unknown flag "parserr", did you mean "parser"?"`;
+exports[`show version with --version  1`] = `
+{
+  "stderr": "",
+  "write": [],
+}
+`;
 
-exports[`show warning with --help not-found (typo) (stdout) 1`] = `
-"--parser <flow|babel|babel-flow|babel-ts|typescript|acorn|espree|meriyah|css|less|scss|json|json5|jsonc|json-stringify|graphql|markdown|mdx|vue|yaml|glimmer|html|angular|lwc|mjml>
+exports[`show warning with --help not-found (typo)  1`] = `
+{
+  "stderr": "[warn] Unknown flag "parserr", did you mean "parser"?",
+  "stdout": "--parser <flow|babel|babel-flow|babel-ts|typescript|acorn|espree|meriyah|css|less|scss|json|json5|jsonc|json-stringify|graphql|markdown|mdx|vue|yaml|glimmer|html|angular|lwc|mjml>
 
   Which parser to use.
 
@@ -191,15 +195,15 @@ Valid options:
   html             HTML
   angular          Angular
   lwc              Lightning Web Components
-  mjml             MJML"
+  mjml             MJML",
+  "write": [],
+}
 `;
 
-exports[`show warning with --help not-found (typo) (write) 1`] = `[]`;
-
-exports[`throw error and show usage with something unexpected (stderr) 1`] = `""`;
-
-exports[`throw error and show usage with something unexpected (stdout) 1`] = `
-"Usage: prettier [options] [file/dir/glob ...]
+exports[`throw error and show usage with something unexpected  1`] = `
+{
+  "stderr": "",
+  "stdout": "Usage: prettier [options] [file/dir/glob ...]
 
 By default, output is written to stdout.
 Stdin is read if it is piped to Prettier and no files are given.
@@ -300,6 +304,8 @@ Other options:
   --cache-location <path>  Path to the cache file.
   --cache-strategy <metadata|content>
                            Strategy for the cache to use for detecting changed files.
+  --check-ignore-pragma    Check whether the file's first docblock comment contains '@noprettier' or '@noformat' to determine if it should be formatted.
+                           Defaults to false.
   --no-color               Do not colorize error messages.
   --no-error-on-unmatched-pattern
                            Prevent errors when pattern is unmatched.
@@ -314,44 +320,53 @@ Other options:
   --log-level <silent|error|warn|log|debug>
                            What level of logs to report.
                            Defaults to log.
-  --require-pragma         Require either '@prettier' or '@format' to be present in the file's first docblock comment
-                           in order for it to be formatted.
+  --require-pragma         Require either '@prettier' or '@format' to be present in the file's first docblock comment in order for it to be formatted.
                            Defaults to false.
   --stdin-filepath <path>  Path to the file to pretend that stdin comes from.
   --support-info           Print support information as JSON.
   -v, --version            Print Prettier version.
 
-"
+",
+  "write": [],
+}
 `;
 
-exports[`throw error and show usage with something unexpected (write) 1`] = `[]`;
-
-exports[`throw error with --check + --list-different (stderr) 1`] = `"[error] Cannot use --check and --list-different together."`;
-
-exports[`throw error with --check + --list-different (stdout) 1`] = `""`;
-
-exports[`throw error with --check + --list-different (write) 1`] = `[]`;
-
-exports[`throw error with --file-info + multiple files (stderr) 1`] = `"[error] Cannot use --file-info with multiple files"`;
-
-exports[`throw error with --file-info + multiple files (stdout) 1`] = `""`;
-
-exports[`throw error with --file-info + multiple files (write) 1`] = `[]`;
-
-exports[`throw error with --find-config-path + multiple files (stderr) 1`] = `"[error] Cannot use --find-config-path with multiple files"`;
-
-exports[`throw error with --find-config-path + multiple files (stdout) 1`] = `""`;
-
-exports[`throw error with --find-config-path + multiple files (write) 1`] = `[]`;
-
-exports[`throw error with --help not-found (stderr) 1`] = `"[error] Invalid --help value. Expected a flag, but received "not-found"."`;
-
-exports[`throw error with --help not-found (stdout) 1`] = `""`;
+exports[`throw error with --check + --list-different  1`] = `
+{
+  "stderr": "[error] Cannot use --check and --list-different together.",
+  "stdout": "",
+  "write": [],
+}
+`;
 
-exports[`throw error with --help not-found (write) 1`] = `[]`;
+exports[`throw error with --file-info + multiple files  1`] = `
+{
+  "stderr": "[error] Cannot use --file-info with multiple files",
+  "stdout": "",
+  "write": [],
+}
+`;
 
-exports[`throw error with --write + --debug-check (stderr) 1`] = `"[error] Cannot use --write and --debug-check together."`;
+exports[`throw error with --find-config-path + multiple files  1`] = `
+{
+  "stderr": "[error] Cannot use --find-config-path with multiple files",
+  "stdout": "",
+  "write": [],
+}
+`;
 
-exports[`throw error with --write + --debug-check (stdout) 1`] = `""`;
+exports[`throw error with --help not-found  1`] = `
+{
+  "stderr": "[error] Invalid --help value. Expected a flag, but received "not-found".",
+  "stdout": "",
+  "write": [],
+}
+`;
 
-exports[`throw error with --write + --debug-check (write) 1`] = `[]`;
+exports[`throw error with --write + --debug-check  1`] = `
+{
+  "stderr": "[error] Cannot use --write and --debug-check together.",
+  "stdout": "",
+  "write": [],
+}
+`;
diff --git a/tests/integration/__tests__/__snapshots__/error-on-unmatched-pattern.js.snap b/tests/integration/__tests__/__snapshots__/error-on-unmatched-pattern.js.snap
index 9df1e5734..0a1d40ec9 100644
--- a/tests/integration/__tests__/__snapshots__/error-on-unmatched-pattern.js.snap
+++ b/tests/integration/__tests__/__snapshots__/error-on-unmatched-pattern.js.snap
@@ -1,37 +1,41 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`error on unmatched pattern (stderr) 1`] = `"[error] No files matching the pattern were found: "**/*.toml"."`;
-
-exports[`error on unmatched pattern (stdout) 1`] = `""`;
-
-exports[`error on unmatched pattern (write) 1`] = `[]`;
-
-exports[`error on unmatched pattern when 2nd glob has no match (stderr) 1`] = `"[error] No files matching the pattern were found: "**/*.toml"."`;
+exports[`error on unmatched pattern  1`] = `
+{
+  "stderr": "[error] No files matching the pattern were found: "**/*.toml".",
+  "stdout": "",
+  "write": [],
+}
+`;
 
-exports[`error on unmatched pattern when 2nd glob has no match (stdout) 1`] = `
-"const hello = "there";
+exports[`error on unmatched pattern when 2nd glob has no match  1`] = `
+{
+  "stderr": "[error] No files matching the pattern were found: "**/*.toml".",
+  "stdout": "const hello = "there";
 {
   "hello": "there"
 }
-hello: there"
+hello: there",
+  "write": [],
+}
 `;
 
-exports[`error on unmatched pattern when 2nd glob has no match (write) 1`] = `[]`;
-
-exports[`no error on unmatched pattern (stderr) 1`] = `""`;
-
-exports[`no error on unmatched pattern (stdout) 1`] = `"const hello = "there";"`;
-
-exports[`no error on unmatched pattern (write) 1`] = `[]`;
-
-exports[`no error on unmatched pattern when 2nd glob has no match (stderr) 1`] = `""`;
+exports[`no error on unmatched pattern  1`] = `
+{
+  "stderr": "",
+  "stdout": "const hello = "there";",
+  "write": [],
+}
+`;
 
-exports[`no error on unmatched pattern when 2nd glob has no match (stdout) 1`] = `
-"const hello = "there";
+exports[`no error on unmatched pattern when 2nd glob has no match  1`] = `
+{
+  "stderr": "",
+  "stdout": "const hello = "there";
 {
   "hello": "there"
 }
-hello: there"
+hello: there",
+  "write": [],
+}
 `;
-
-exports[`no error on unmatched pattern when 2nd glob has no match (write) 1`] = `[]`;
diff --git a/tests/integration/__tests__/__snapshots__/file-info.js.snap b/tests/integration/__tests__/__snapshots__/file-info.js.snap
index 998a69e31..ac7edf07c 100644
--- a/tests/integration/__tests__/__snapshots__/file-info.js.snap
+++ b/tests/integration/__tests__/__snapshots__/file-info.js.snap
@@ -1,75 +1,103 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`extracts file-info for a file in not_node_modules (stderr) 1`] = `""`;
-
-exports[`extracts file-info for a file in not_node_modules (stdout) 1`] = `"{ "ignored": false, "inferredParser": "babel" }"`;
-
-exports[`extracts file-info for a file in not_node_modules (write) 1`] = `[]`;
-
-exports[`extracts file-info for a js file (stderr) 1`] = `""`;
-
-exports[`extracts file-info for a js file (stdout) 1`] = `"{ "ignored": false, "inferredParser": "babel" }"`;
-
-exports[`extracts file-info for a js file (write) 1`] = `[]`;
-
-exports[`extracts file-info for a known markdown file with no extension (stderr) 1`] = `""`;
-
-exports[`extracts file-info for a known markdown file with no extension (stdout) 1`] = `"{ "ignored": false, "inferredParser": "markdown" }"`;
-
-exports[`extracts file-info for a known markdown file with no extension (write) 1`] = `[]`;
-
-exports[`extracts file-info for a markdown file (stderr) 1`] = `""`;
-
-exports[`extracts file-info for a markdown file (stdout) 1`] = `"{ "ignored": false, "inferredParser": "markdown" }"`;
-
-exports[`extracts file-info for a markdown file (write) 1`] = `[]`;
-
-exports[`extracts file-info with ignored=false for a file in node_modules when --with-node-modules provided (stderr) 1`] = `""`;
-
-exports[`extracts file-info with ignored=false for a file in node_modules when --with-node-modules provided (stdout) 1`] = `"{ "ignored": false, "inferredParser": "babel" }"`;
-
-exports[`extracts file-info with ignored=false for a file in node_modules when --with-node-modules provided (write) 1`] = `[]`;
-
-exports[`extracts file-info with ignored=true for a file in .prettierignore (stderr) 1`] = `""`;
-
-exports[`extracts file-info with ignored=true for a file in .prettierignore (stdout) 1`] = `"{ "ignored": true, "inferredParser": null }"`;
-
-exports[`extracts file-info with ignored=true for a file in .prettierignore (write) 1`] = `[]`;
-
-exports[`extracts file-info with ignored=true for a file in a hand-picked ignore file (stderr) 1`] = `""`;
-
-exports[`extracts file-info with ignored=true for a file in a hand-picked ignore file (stdout) 1`] = `"{ "ignored": true, "inferredParser": null }"`;
-
-exports[`extracts file-info with ignored=true for a file in a hand-picked ignore file (write) 1`] = `[]`;
-
-exports[`extracts file-info with inferredParser=foo when a plugin is hand-picked (stderr) 1`] = `""`;
-
-exports[`extracts file-info with inferredParser=foo when a plugin is hand-picked (stdout) 1`] = `"{ "ignored": false, "inferredParser": "foo" }"`;
-
-exports[`extracts file-info with inferredParser=foo when a plugin is hand-picked (write) 1`] = `[]`;
-
-exports[`extracts file-info with inferredParser=null for file.foo (stderr) 1`] = `""`;
-
-exports[`extracts file-info with inferredParser=null for file.foo (stdout) 1`] = `"{ "ignored": false, "inferredParser": null }"`;
-
-exports[`extracts file-info with inferredParser=null for file.foo (write) 1`] = `[]`;
-
-exports[`extracts file-info with with ignored=true for a file in node_modules (stderr) 1`] = `""`;
-
-exports[`extracts file-info with with ignored=true for a file in node_modules (stdout) 1`] = `"{ "ignored": true, "inferredParser": null }"`;
-
-exports[`extracts file-info with with ignored=true for a file in node_modules (write) 1`] = `[]`;
-
-exports[`file-info should not try resolve config with --no-config (stdout) 1`] = `"{ "ignored": false, "inferredParser": "babel" }"`;
-
-exports[`file-info should try resolve config (stderr) 1`] = `""`;
-
-exports[`file-info should try resolve config (stdout) 1`] = `"{ "ignored": false, "inferredParser": "override-js-parser" }"`;
-
-exports[`file-info should try resolve config (write) 1`] = `[]`;
-
-exports[`non-exists ignore path (stderr) 1`] = `""`;
-
-exports[`non-exists ignore path (stdout) 1`] = `"{ "ignored": false, "inferredParser": "babel" }"`;
-
-exports[`non-exists ignore path (write) 1`] = `[]`;
+exports[`extracts file-info for a file in not_node_modules  1`] = `
+{
+  "stderr": "",
+  "stdout": "{ "ignored": false, "inferredParser": "babel" }",
+  "write": [],
+}
+`;
+
+exports[`extracts file-info for a js file  1`] = `
+{
+  "stderr": "",
+  "stdout": "{ "ignored": false, "inferredParser": "babel" }",
+  "write": [],
+}
+`;
+
+exports[`extracts file-info for a known markdown file with no extension  1`] = `
+{
+  "stderr": "",
+  "stdout": "{ "ignored": false, "inferredParser": "markdown" }",
+  "write": [],
+}
+`;
+
+exports[`extracts file-info for a markdown file  1`] = `
+{
+  "stderr": "",
+  "stdout": "{ "ignored": false, "inferredParser": "markdown" }",
+  "write": [],
+}
+`;
+
+exports[`extracts file-info with ignored=false for a file in node_modules when --with-node-modules provided  1`] = `
+{
+  "stderr": "",
+  "stdout": "{ "ignored": false, "inferredParser": "babel" }",
+  "write": [],
+}
+`;
+
+exports[`extracts file-info with ignored=true for a file in .prettierignore  1`] = `
+{
+  "stderr": "",
+  "stdout": "{ "ignored": true, "inferredParser": null }",
+  "write": [],
+}
+`;
+
+exports[`extracts file-info with ignored=true for a file in a hand-picked ignore file  1`] = `
+{
+  "stderr": "",
+  "stdout": "{ "ignored": true, "inferredParser": null }",
+  "write": [],
+}
+`;
+
+exports[`extracts file-info with inferredParser=foo when a plugin is hand-picked  1`] = `
+{
+  "stderr": "",
+  "stdout": "{ "ignored": false, "inferredParser": "foo" }",
+  "write": [],
+}
+`;
+
+exports[`extracts file-info with inferredParser=null for file.foo  1`] = `
+{
+  "stderr": "",
+  "stdout": "{ "ignored": false, "inferredParser": null }",
+  "write": [],
+}
+`;
+
+exports[`extracts file-info with with ignored=true for a file in node_modules  1`] = `
+{
+  "stderr": "",
+  "stdout": "{ "ignored": true, "inferredParser": null }",
+  "write": [],
+}
+`;
+
+exports[`file-info should not try resolve config with --no-config  1`] = `
+{
+  "stdout": "{ "ignored": false, "inferredParser": "babel" }",
+}
+`;
+
+exports[`file-info should try resolve config  1`] = `
+{
+  "stderr": "",
+  "stdout": "{ "ignored": false, "inferredParser": "override-js-parser" }",
+  "write": [],
+}
+`;
+
+exports[`non-exists ignore path  1`] = `
+{
+  "stderr": "",
+  "stdout": "{ "ignored": false, "inferredParser": "babel" }",
+  "write": [],
+}
+`;
diff --git a/tests/integration/__tests__/__snapshots__/help-options.js.snap b/tests/integration/__tests__/__snapshots__/help-options.js.snap
index 7181ae900..ae0086b71 100644
--- a/tests/integration/__tests__/__snapshots__/help-options.js.snap
+++ b/tests/integration/__tests__/__snapshots__/help-options.js.snap
@@ -1,9 +1,9 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`show detailed usage with --help arrow-parens (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help arrow-parens (stdout) 1`] = `
-"--arrow-parens <always|avoid>
+exports[`show detailed usage with --help arrow-parens  1`] = `
+{
+  "stderr": "",
+  "stdout": "--arrow-parens <always|avoid>
 
   Include parentheses around a sole arrow function parameter.
 
@@ -12,109 +12,121 @@ Valid options:
   always   Always include parens. Example: \`(x) => x\`
   avoid    Omit parens when possible. Example: \`x => x\`
 
-Default: always"
+Default: always",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help arrow-parens (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help bracket-same-line (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help bracket-same-line (stdout) 1`] = `
-"--bracket-same-line
+exports[`show detailed usage with --help bracket-same-line  1`] = `
+{
+  "stderr": "",
+  "stdout": "--bracket-same-line
 
   Put > of opening tags on the last line instead of on a new line.
 
-Default: false"
+Default: false",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help bracket-same-line (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help bracket-spacing (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help bracket-spacing (stdout) 1`] = `
-"--bracket-spacing
+exports[`show detailed usage with --help bracket-spacing  1`] = `
+{
+  "stderr": "",
+  "stdout": "--bracket-spacing
 
   Print spaces between brackets.
 
-Default: true"
+Default: true",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help bracket-spacing (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help cache (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help cache (stdout) 1`] = `
-"--cache
+exports[`show detailed usage with --help cache  1`] = `
+{
+  "stderr": "",
+  "stdout": "--cache
 
   Only format changed files. Cannot use with --stdin-filepath.
 
-Default: false"
+Default: false",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help cache (write) 1`] = `[]`;
+exports[`show detailed usage with --help cache-location  1`] = `
+{
+  "stderr": "",
+  "stdout": "--cache-location <path>
 
-exports[`show detailed usage with --help cache-location (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help cache-location (stdout) 1`] = `
-"--cache-location <path>
-
-  Path to the cache file."
+  Path to the cache file.",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help cache-location (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help cache-strategy (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help cache-strategy (stdout) 1`] = `
-"--cache-strategy <metadata|content>
+exports[`show detailed usage with --help cache-strategy  1`] = `
+{
+  "stderr": "",
+  "stdout": "--cache-strategy <metadata|content>
 
   Strategy for the cache to use for detecting changed files.
 
 Valid options:
 
   metadata   Use the file metadata such as timestamps as cache keys
-  content    Use the file content as cache keys"
+  content    Use the file content as cache keys",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help cache-strategy (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help check (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help check (stdout) 1`] = `
-"-c, --check
+exports[`show detailed usage with --help check  1`] = `
+{
+  "stderr": "",
+  "stdout": "-c, --check
 
   Check if the given files are formatted, print a human-friendly summary
-  message and paths to unformatted files (see also --list-different)."
+  message and paths to unformatted files (see also --list-different).",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help check (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help color (stderr) 1`] = `""`;
+exports[`show detailed usage with --help check-ignore-pragma  1`] = `
+{
+  "stderr": "",
+  "stdout": "--check-ignore-pragma
 
-exports[`show detailed usage with --help color (stdout) 1`] = `
-"--color
+  Check whether the file's first docblock comment contains '@noprettier' or '@noformat' to determine if it should be formatted.
 
-  Colorize error messages.
-
-Default: true"
+Default: false",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help color (write) 1`] = `[]`;
+exports[`show detailed usage with --help color  1`] = `
+{
+  "stderr": "",
+  "stdout": "--color
 
-exports[`show detailed usage with --help config (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help config (stdout) 1`] = `
-"--config <path>
+  Colorize error messages.
 
-  Path to a Prettier configuration file (.prettierrc, package.json, prettier.config.js)."
+Default: true",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help config (write) 1`] = `[]`;
+exports[`show detailed usage with --help config  1`] = `
+{
+  "stderr": "",
+  "stdout": "--config <path>
 
-exports[`show detailed usage with --help config-precedence (stderr) 1`] = `""`;
+  Path to a Prettier configuration file (.prettierrc, package.json, prettier.config.js).",
+  "write": [],
+}
+`;
 
-exports[`show detailed usage with --help config-precedence (stdout) 1`] = `
-"--config-precedence <cli-override|file-override|prefer-file>
+exports[`show detailed usage with --help config-precedence  1`] = `
+{
+  "stderr": "",
+  "stdout": "--config-precedence <cli-override|file-override|prefer-file>
 
   Define in which order config files and CLI options should be evaluated.
 
@@ -125,39 +137,39 @@ Valid options:
   prefer-file     If a config file is found will evaluate it and ignore other CLI options.
                   If no config file is found CLI options will evaluate as normal.
 
-Default: cli-override"
+Default: cli-override",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help config-precedence (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help cursor-offset (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help cursor-offset (stdout) 1`] = `
-"--cursor-offset <int>
+exports[`show detailed usage with --help cursor-offset  1`] = `
+{
+  "stderr": "",
+  "stdout": "--cursor-offset <int>
 
   Print (to stderr) where a cursor at the given position would move to after formatting.
 
-Default: -1"
+Default: -1",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help cursor-offset (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help editorconfig (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help editorconfig (stdout) 1`] = `
-"--editorconfig
+exports[`show detailed usage with --help editorconfig  1`] = `
+{
+  "stderr": "",
+  "stdout": "--editorconfig
 
   Take .editorconfig into account when parsing configuration.
 
-Default: true"
+Default: true",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help editorconfig (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help embedded-language-formatting (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help embedded-language-formatting (stdout) 1`] = `
-"--embedded-language-formatting <auto|off>
+exports[`show detailed usage with --help embedded-language-formatting  1`] = `
+{
+  "stderr": "",
+  "stdout": "--embedded-language-formatting <auto|off>
 
   Control how Prettier formats quoted code embedded in the file.
 
@@ -166,15 +178,15 @@ Valid options:
   auto   Format embedded code if Prettier can automatically identify it.
   off    Never automatically format embedded code.
 
-Default: auto"
+Default: auto",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help embedded-language-formatting (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help end-of-line (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help end-of-line (stdout) 1`] = `
-"--end-of-line <lf|crlf|cr|auto>
+exports[`show detailed usage with --help end-of-line  1`] = `
+{
+  "stderr": "",
+  "stdout": "--end-of-line <lf|crlf|cr|auto>
 
   Which end of line characters to apply.
 
@@ -186,15 +198,15 @@ Valid options:
   auto   Maintain existing
          (mixed values within one file are normalised by looking at what's used after the first line)
 
-Default: lf"
+Default: lf",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help end-of-line (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help experimental-operator-position (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help experimental-operator-position (stdout) 1`] = `
-"--experimental-operator-position <start|end>
+exports[`show detailed usage with --help experimental-operator-position  1`] = `
+{
+  "stderr": "",
+  "stdout": "--experimental-operator-position <start|end>
 
   Where to print operators when binary expressions wrap lines.
 
@@ -203,60 +215,60 @@ Valid options:
   start   Print operators at the start of new lines.
   end     Print operators at the end of previous lines.
 
-Default: end"
+Default: end",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help experimental-operator-position (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help experimental-ternaries (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help experimental-ternaries (stdout) 1`] = `
-"--experimental-ternaries
+exports[`show detailed usage with --help experimental-ternaries  1`] = `
+{
+  "stderr": "",
+  "stdout": "--experimental-ternaries
 
   Use curious ternaries, with the question mark after the condition.
 
-Default: false"
+Default: false",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help experimental-ternaries (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help file-info (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help file-info (stdout) 1`] = `
-"--file-info <path>
+exports[`show detailed usage with --help file-info  1`] = `
+{
+  "stderr": "",
+  "stdout": "--file-info <path>
 
   Extract the following info (as JSON) for a given file path. Reported fields:
   * ignored (boolean) - true if file path is filtered by --ignore-path
-  * inferredParser (string | null) - name of parser inferred from file path"
+  * inferredParser (string | null) - name of parser inferred from file path",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help file-info (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help find-config-path (stderr) 1`] = `""`;
+exports[`show detailed usage with --help find-config-path  1`] = `
+{
+  "stderr": "",
+  "stdout": "--find-config-path <path>
 
-exports[`show detailed usage with --help find-config-path (stdout) 1`] = `
-"--find-config-path <path>
-
-  Find and print the path to a configuration file for the given input file."
+  Find and print the path to a configuration file for the given input file.",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help find-config-path (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help help (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help help (stdout) 1`] = `
-"-h, --help <flag>
+exports[`show detailed usage with --help help  1`] = `
+{
+  "stderr": "",
+  "stdout": "-h, --help <flag>
 
   Show CLI usage, or details about the given flag.
-  Example: --help write"
+  Example: --help write",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help help (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help html-whitespace-sensitivity (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help html-whitespace-sensitivity (stdout) 1`] = `
-"--html-whitespace-sensitivity <css|strict|ignore>
+exports[`show detailed usage with --help html-whitespace-sensitivity  1`] = `
+{
+  "stderr": "",
+  "stdout": "--html-whitespace-sensitivity <css|strict|ignore>
 
   How to handle whitespaces in HTML.
 
@@ -266,72 +278,72 @@ Valid options:
   strict   Whitespaces are considered sensitive.
   ignore   Whitespaces are considered insensitive.
 
-Default: css"
+Default: css",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help html-whitespace-sensitivity (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help ignore-path (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help ignore-path (stdout) 1`] = `
-"--ignore-path <path>
+exports[`show detailed usage with --help ignore-path  1`] = `
+{
+  "stderr": "",
+  "stdout": "--ignore-path <path>
 
   Path to a file with patterns describing files to ignore.
   Multiple values are accepted.
 
-Default: [.gitignore, .prettierignore]"
+Default: [.gitignore, .prettierignore]",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help ignore-path (write) 1`] = `[]`;
+exports[`show detailed usage with --help ignore-unknown  1`] = `
+{
+  "stderr": "",
+  "stdout": "-u, --ignore-unknown
 
-exports[`show detailed usage with --help ignore-unknown (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help ignore-unknown (stdout) 1`] = `
-"-u, --ignore-unknown
-
-  Ignore unknown files."
+  Ignore unknown files.",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help ignore-unknown (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help insert-pragma (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help insert-pragma (stdout) 1`] = `
-"--insert-pragma
+exports[`show detailed usage with --help insert-pragma  1`] = `
+{
+  "stderr": "",
+  "stdout": "--insert-pragma
 
   Insert @format pragma into file's first docblock comment.
 
-Default: false"
+Default: false",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help insert-pragma (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help jsx-single-quote (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help jsx-single-quote (stdout) 1`] = `
-"--jsx-single-quote
+exports[`show detailed usage with --help jsx-single-quote  1`] = `
+{
+  "stderr": "",
+  "stdout": "--jsx-single-quote
 
   Use single quotes in JSX.
 
-Default: false"
+Default: false",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help jsx-single-quote (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help list-different (stderr) 1`] = `""`;
+exports[`show detailed usage with --help list-different  1`] = `
+{
+  "stderr": "",
+  "stdout": "-l, --list-different
 
-exports[`show detailed usage with --help list-different (stdout) 1`] = `
-"-l, --list-different
-
-  Print the names of files that are different from Prettier's formatting (see also --check)."
+  Print the names of files that are different from Prettier's formatting (see also --check).",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help list-different (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help log-level (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help log-level (stdout) 1`] = `
-"--log-level <silent|error|warn|log|debug>
+exports[`show detailed usage with --help log-level  1`] = `
+{
+  "stderr": "",
+  "stdout": "--log-level <silent|error|warn|log|debug>
 
   What level of logs to report.
 
@@ -343,85 +355,85 @@ Valid options:
   log      
   debug    
 
-Default: log"
+Default: log",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help log-level (write) 1`] = `[]`;
+exports[`show detailed usage with --help no-bracket-spacing  1`] = `
+{
+  "stderr": "",
+  "stdout": "--no-bracket-spacing
 
-exports[`show detailed usage with --help no-bracket-spacing (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help no-bracket-spacing (stdout) 1`] = `
-"--no-bracket-spacing
-
-  Do not print spaces between brackets."
+  Do not print spaces between brackets.",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help no-bracket-spacing (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help no-color (stderr) 1`] = `""`;
+exports[`show detailed usage with --help no-color  1`] = `
+{
+  "stderr": "",
+  "stdout": "--no-color
 
-exports[`show detailed usage with --help no-color (stdout) 1`] = `
-"--no-color
-
-  Do not colorize error messages."
+  Do not colorize error messages.",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help no-color (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help no-config (stderr) 1`] = `""`;
+exports[`show detailed usage with --help no-config  1`] = `
+{
+  "stderr": "",
+  "stdout": "--no-config
 
-exports[`show detailed usage with --help no-config (stdout) 1`] = `
-"--no-config
-
-  Do not look for a configuration file."
+  Do not look for a configuration file.",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help no-config (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help no-editorconfig (stderr) 1`] = `""`;
+exports[`show detailed usage with --help no-editorconfig  1`] = `
+{
+  "stderr": "",
+  "stdout": "--no-editorconfig
 
-exports[`show detailed usage with --help no-editorconfig (stdout) 1`] = `
-"--no-editorconfig
-
-  Don't take .editorconfig into account when parsing configuration."
+  Don't take .editorconfig into account when parsing configuration.",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help no-editorconfig (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help no-error-on-unmatched-pattern (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help no-error-on-unmatched-pattern (stdout) 1`] = `
-"--no-error-on-unmatched-pattern
+exports[`show detailed usage with --help no-error-on-unmatched-pattern  1`] = `
+{
+  "stderr": "",
+  "stdout": "--no-error-on-unmatched-pattern
 
-  Prevent errors when pattern is unmatched."
+  Prevent errors when pattern is unmatched.",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help no-error-on-unmatched-pattern (write) 1`] = `[]`;
+exports[`show detailed usage with --help no-experimental-ternaries  1`] = `
+{
+  "stderr": "",
+  "stdout": "--no-experimental-ternaries
 
-exports[`show detailed usage with --help no-experimental-ternaries (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help no-experimental-ternaries (stdout) 1`] = `
-"--no-experimental-ternaries
-
-  Default behavior of ternaries; keep question marks on the same line as the consequent."
+  Default behavior of ternaries; keep question marks on the same line as the consequent.",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help no-experimental-ternaries (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help no-semi (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help no-semi (stdout) 1`] = `
-"--no-semi
+exports[`show detailed usage with --help no-semi  1`] = `
+{
+  "stderr": "",
+  "stdout": "--no-semi
 
-  Do not print semicolons, except at the beginning of lines which may need them."
+  Do not print semicolons, except at the beginning of lines which may need them.",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help no-semi (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help object-wrap (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help object-wrap (stdout) 1`] = `
-"--object-wrap <preserve|collapse>
+exports[`show detailed usage with --help object-wrap  1`] = `
+{
+  "stderr": "",
+  "stdout": "--object-wrap <preserve|collapse>
 
   How to wrap object literals.
 
@@ -430,15 +442,15 @@ Valid options:
   preserve   Keep as multi-line, if there is a newline between the opening brace and first property.
   collapse   Fit to a single line when possible.
 
-Default: preserve"
+Default: preserve",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help object-wrap (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help parser (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help parser (stdout) 1`] = `
-"--parser <flow|babel|babel-flow|babel-ts|typescript|acorn|espree|meriyah|css|less|scss|json|json5|jsonc|json-stringify|graphql|markdown|mdx|vue|yaml|glimmer|html|angular|lwc|mjml>
+exports[`show detailed usage with --help parser  1`] = `
+{
+  "stderr": "",
+  "stdout": "--parser <flow|babel|babel-flow|babel-ts|typescript|acorn|espree|meriyah|css|less|scss|json|json5|jsonc|json-stringify|graphql|markdown|mdx|vue|yaml|glimmer|html|angular|lwc|mjml>
 
   Which parser to use.
 
@@ -468,39 +480,39 @@ Valid options:
   html             HTML
   angular          Angular
   lwc              Lightning Web Components
-  mjml             MJML"
+  mjml             MJML",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help parser (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help plugin (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help plugin (stdout) 1`] = `
-"--plugin <path>
+exports[`show detailed usage with --help plugin  1`] = `
+{
+  "stderr": "",
+  "stdout": "--plugin <path>
 
   Add a plugin. Multiple plugins can be passed as separate \`--plugin\`s.
 
-Default: []"
+Default: []",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help plugin (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help print-width (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help print-width (stdout) 1`] = `
-"--print-width <int>
+exports[`show detailed usage with --help print-width  1`] = `
+{
+  "stderr": "",
+  "stdout": "--print-width <int>
 
   The line length where Prettier will try wrap.
 
-Default: 80"
+Default: 80",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help print-width (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help prose-wrap (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help prose-wrap (stdout) 1`] = `
-"--prose-wrap <always|never|preserve>
+exports[`show detailed usage with --help prose-wrap  1`] = `
+{
+  "stderr": "",
+  "stdout": "--prose-wrap <always|never|preserve>
 
   How to wrap prose.
 
@@ -510,15 +522,15 @@ Valid options:
   never      Do not wrap prose.
   preserve   Wrap prose as-is.
 
-Default: preserve"
+Default: preserve",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help prose-wrap (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help quote-props (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help quote-props (stdout) 1`] = `
-"--quote-props <as-needed|consistent|preserve>
+exports[`show detailed usage with --help quote-props  1`] = `
+{
+  "stderr": "",
+  "stdout": "--quote-props <as-needed|consistent|preserve>
 
   Change when properties in objects are quoted.
 
@@ -528,122 +540,121 @@ Valid options:
   consistent   If at least one property in an object requires quotes, quote all properties.
   preserve     Respect the input use of quotes in object properties.
 
-Default: as-needed"
+Default: as-needed",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help quote-props (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help range-end (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help range-end (stdout) 1`] = `
-"--range-end <int>
+exports[`show detailed usage with --help range-end  1`] = `
+{
+  "stderr": "",
+  "stdout": "--range-end <int>
 
   Format code ending at a given character offset (exclusive).
   The range will extend forwards to the end of the selected statement.
 
-Default: Infinity"
+Default: Infinity",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help range-end (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help range-start (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help range-start (stdout) 1`] = `
-"--range-start <int>
+exports[`show detailed usage with --help range-start  1`] = `
+{
+  "stderr": "",
+  "stdout": "--range-start <int>
 
   Format code starting at a given character offset.
   The range will extend backwards to the start of the first line containing the selected statement.
 
-Default: 0"
+Default: 0",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help range-start (write) 1`] = `[]`;
+exports[`show detailed usage with --help require-pragma  1`] = `
+{
+  "stderr": "",
+  "stdout": "--require-pragma
 
-exports[`show detailed usage with --help require-pragma (stderr) 1`] = `""`;
+  Require either '@prettier' or '@format' to be present in the file's first docblock comment in order for it to be formatted.
 
-exports[`show detailed usage with --help require-pragma (stdout) 1`] = `
-"--require-pragma
-
-  Require either '@prettier' or '@format' to be present in the file's first docblock comment
-  in order for it to be formatted.
-
-Default: false"
+Default: false",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help require-pragma (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help semi (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help semi (stdout) 1`] = `
-"--semi
+exports[`show detailed usage with --help semi  1`] = `
+{
+  "stderr": "",
+  "stdout": "--semi
 
   Print semicolons.
 
-Default: true"
+Default: true",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help semi (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help single-attribute-per-line (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help single-attribute-per-line (stdout) 1`] = `
-"--single-attribute-per-line
+exports[`show detailed usage with --help single-attribute-per-line  1`] = `
+{
+  "stderr": "",
+  "stdout": "--single-attribute-per-line
 
   Enforce single attribute per line in HTML, Vue and JSX.
 
-Default: false"
+Default: false",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help single-attribute-per-line (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help single-quote (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help single-quote (stdout) 1`] = `
-"--single-quote
+exports[`show detailed usage with --help single-quote  1`] = `
+{
+  "stderr": "",
+  "stdout": "--single-quote
 
   Use single quotes instead of double quotes.
 
-Default: false"
+Default: false",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help single-quote (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help stdin-filepath (stderr) 1`] = `""`;
+exports[`show detailed usage with --help stdin-filepath  1`] = `
+{
+  "stderr": "",
+  "stdout": "--stdin-filepath <path>
 
-exports[`show detailed usage with --help stdin-filepath (stdout) 1`] = `
-"--stdin-filepath <path>
-
-  Path to the file to pretend that stdin comes from."
+  Path to the file to pretend that stdin comes from.",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help stdin-filepath (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help support-info (stderr) 1`] = `""`;
+exports[`show detailed usage with --help support-info  1`] = `
+{
+  "stderr": "",
+  "stdout": "--support-info
 
-exports[`show detailed usage with --help support-info (stdout) 1`] = `
-"--support-info
-
-  Print support information as JSON."
+  Print support information as JSON.",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help support-info (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help tab-width (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help tab-width (stdout) 1`] = `
-"--tab-width <int>
+exports[`show detailed usage with --help tab-width  1`] = `
+{
+  "stderr": "",
+  "stdout": "--tab-width <int>
 
   Number of spaces per indentation level.
 
-Default: 2"
+Default: 2",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help tab-width (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help trailing-comma (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help trailing-comma (stdout) 1`] = `
-"--trailing-comma <all|es5|none>
+exports[`show detailed usage with --help trailing-comma  1`] = `
+{
+  "stderr": "",
+  "stdout": "--trailing-comma <all|es5|none>
 
   Print trailing commas wherever possible when multi-line.
 
@@ -653,61 +664,61 @@ Valid options:
   es5    Trailing commas where valid in ES5 (objects, arrays, etc.)
   none   No trailing commas.
 
-Default: all"
+Default: all",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help trailing-comma (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help use-tabs (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help use-tabs (stdout) 1`] = `
-"--use-tabs
+exports[`show detailed usage with --help use-tabs  1`] = `
+{
+  "stderr": "",
+  "stdout": "--use-tabs
 
   Indent with tabs instead of spaces.
 
-Default: false"
+Default: false",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help use-tabs (write) 1`] = `[]`;
+exports[`show detailed usage with --help version  1`] = `
+{
+  "stderr": "",
+  "stdout": "-v, --version
 
-exports[`show detailed usage with --help version (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help version (stdout) 1`] = `
-"-v, --version
-
-  Print Prettier version."
+  Print Prettier version.",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help version (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help vue-indent-script-and-style (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help vue-indent-script-and-style (stdout) 1`] = `
-"--vue-indent-script-and-style
+exports[`show detailed usage with --help vue-indent-script-and-style  1`] = `
+{
+  "stderr": "",
+  "stdout": "--vue-indent-script-and-style
 
   Indent script and style tags in Vue files.
 
-Default: false"
+Default: false",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help vue-indent-script-and-style (write) 1`] = `[]`;
-
-exports[`show detailed usage with --help with-node-modules (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help with-node-modules (stdout) 1`] = `
-"--with-node-modules
+exports[`show detailed usage with --help with-node-modules  1`] = `
+{
+  "stderr": "",
+  "stdout": "--with-node-modules
 
-  Process files inside 'node_modules' directory."
+  Process files inside 'node_modules' directory.",
+  "write": [],
+}
 `;
 
-exports[`show detailed usage with --help with-node-modules (write) 1`] = `[]`;
+exports[`show detailed usage with --help write  1`] = `
+{
+  "stderr": "",
+  "stdout": "-w, --write
 
-exports[`show detailed usage with --help write (stderr) 1`] = `""`;
-
-exports[`show detailed usage with --help write (stdout) 1`] = `
-"-w, --write
-
-  Edit files in-place. (Beware!)"
+  Edit files in-place. (Beware!)",
+  "write": [],
+}
 `;
-
-exports[`show detailed usage with --help write (write) 1`] = `[]`;
diff --git a/tests/integration/__tests__/__snapshots__/ignore-absolute-path.js.snap b/tests/integration/__tests__/__snapshots__/ignore-absolute-path.js.snap
index bf1f4a62e..2e6692d95 100644
--- a/tests/integration/__tests__/__snapshots__/ignore-absolute-path.js.snap
+++ b/tests/integration/__tests__/__snapshots__/ignore-absolute-path.js.snap
@@ -1,7 +1,9 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`support absolute filename (stderr) 1`] = `""`;
-
-exports[`support absolute filename (stdout) 1`] = `"regular-module.js"`;
-
-exports[`support absolute filename (write) 1`] = `[]`;
+exports[`support absolute filename  1`] = `
+{
+  "stderr": "",
+  "stdout": "regular-module.js",
+  "write": [],
+}
+`;
diff --git a/tests/integration/__tests__/__snapshots__/ignore-emoji.js.snap b/tests/integration/__tests__/__snapshots__/ignore-emoji.js.snap
index 51dddc337..892c0dfe3 100644
--- a/tests/integration/__tests__/__snapshots__/ignore-emoji.js.snap
+++ b/tests/integration/__tests__/__snapshots__/ignore-emoji.js.snap
@@ -1,13 +1,17 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`ignores file name contains emoji (stderr) 1`] = `""`;
+exports[`ignores file name contains emoji  1`] = `
+{
+  "stderr": "",
+  "stdout": "not-ignored.js",
+  "write": [],
+}
+`;
 
-exports[`ignores file name contains emoji (stdout) 1`] = `"not-ignored.js"`;
-
-exports[`ignores file name contains emoji (write) 1`] = `[]`;
-
-exports[`stdin (stderr) 1`] = `""`;
-
-exports[`stdin (stdout) 1`] = `".name {                         display: none; }"`;
-
-exports[`stdin (write) 1`] = `[]`;
+exports[`stdin  1`] = `
+{
+  "stderr": "",
+  "stdout": ".name {                         display: none; }",
+  "write": [],
+}
+`;
diff --git a/tests/integration/__tests__/__snapshots__/ignore-in-subdirectories.js.snap b/tests/integration/__tests__/__snapshots__/ignore-in-subdirectories.js.snap
index 49a61e6a4..1b5e10523 100644
--- a/tests/integration/__tests__/__snapshots__/ignore-in-subdirectories.js.snap
+++ b/tests/integration/__tests__/__snapshots__/ignore-in-subdirectories.js.snap
@@ -1,33 +1,47 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`formats files when executing in a subdirectory (stderr) 1`] = `""`;
-
-exports[`formats files when executing in a subdirectory (stderr) 2`] = `""`;
-
-exports[`formats files when executing in a subdirectory (stdout) 1`] = `"should-not-ignore.js"`;
-
-exports[`formats files when executing in a subdirectory (stdout) 2`] = `"should-not-ignore.js"`;
-
-exports[`formats files when executing in a subdirectory (write) 1`] = `[]`;
-
-exports[`formats files when executing in a subdirectory (write) 2`] = `[]`;
-
-exports[`formats files when executing in a subdirectory and using stdin (stderr) 1`] = `""`;
-
-exports[`formats files when executing in a subdirectory and using stdin (write) 1`] = `[]`;
-
-exports[`ignore files when executing in a subdirectory and using stdin (stderr) 1`] = `""`;
-
-exports[`ignore files when executing in a subdirectory and using stdin (write) 1`] = `[]`;
-
-exports[`ignores files when executing in a subdirectory (stderr) 1`] = `""`;
-
-exports[`ignores files when executing in a subdirectory (stderr) 2`] = `""`;
-
-exports[`ignores files when executing in a subdirectory (stdout) 1`] = `""`;
-
-exports[`ignores files when executing in a subdirectory (stdout) 2`] = `""`;
-
-exports[`ignores files when executing in a subdirectory (write) 1`] = `[]`;
-
-exports[`ignores files when executing in a subdirectory (write) 2`] = `[]`;
+exports[`formats files when executing in a subdirectory  1`] = `
+{
+  "stderr": "",
+  "stdout": "should-not-ignore.js",
+  "write": [],
+}
+`;
+
+exports[`formats files when executing in a subdirectory  2`] = `
+{
+  "stderr": "",
+  "stdout": "should-not-ignore.js",
+  "write": [],
+}
+`;
+
+exports[`formats files when executing in a subdirectory and using stdin  1`] = `
+{
+  "stderr": "",
+  "write": [],
+}
+`;
+
+exports[`ignore files when executing in a subdirectory and using stdin  1`] = `
+{
+  "stderr": "",
+  "write": [],
+}
+`;
+
+exports[`ignores files when executing in a subdirectory  1`] = `
+{
+  "stderr": "",
+  "stdout": "",
+  "write": [],
+}
+`;
+
+exports[`ignores files when executing in a subdirectory  2`] = `
+{
+  "stderr": "",
+  "stdout": "",
+  "write": [],
+}
+`;
diff --git a/tests/integration/__tests__/__snapshots__/ignore-relative-path.js.snap b/tests/integration/__tests__/__snapshots__/ignore-relative-path.js.snap
index 376ed1f25..484ba1562 100644
--- a/tests/integration/__tests__/__snapshots__/ignore-relative-path.js.snap
+++ b/tests/integration/__tests__/__snapshots__/ignore-relative-path.js.snap
@@ -1,11 +1,11 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`support relative paths (stderr) 1`] = `""`;
-
-exports[`support relative paths (stdout) 1`] = `
-"shouldNotBeIgnored.js
+exports[`support relative paths  1`] = `
+{
+  "stderr": "",
+  "stdout": "shouldNotBeIgnored.js
 level1-glob/level2-glob/level3-glob/shouldNotBeIgnored.scss
-level1-glob/shouldNotBeIgnored.js"
+level1-glob/shouldNotBeIgnored.js",
+  "write": [],
+}
 `;
-
-exports[`support relative paths (write) 1`] = `[]`;
diff --git a/tests/integration/__tests__/__snapshots__/ignore-unknown.js.snap b/tests/integration/__tests__/__snapshots__/ignore-unknown.js.snap
index 23f58051d..89d9bc6e7 100644
--- a/tests/integration/__tests__/__snapshots__/ignore-unknown.js.snap
+++ b/tests/integration/__tests__/__snapshots__/ignore-unknown.js.snap
@@ -1,64 +1,75 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`Ignored file (stderr) 1`] = `""`;
-
-exports[`Ignored file (stdout) 1`] = `""`;
-
-exports[`Ignored file (write) 1`] = `[]`;
-
-exports[`None exist file (stderr) 1`] = `"[error] No files matching the pattern were found: "non-exist-file"."`;
-
-exports[`None exist file (stdout) 1`] = `""`;
-
-exports[`None exist file (write) 1`] = `[]`;
-
-exports[`Not matching pattern (stderr) 1`] = `"[error] No files matching the pattern were found: "*.non-exist-pattern"."`;
-
-exports[`Not matching pattern (stdout) 1`] = `""`;
-
-exports[`Not matching pattern (write) 1`] = `[]`;
-
-exports[`ignore-unknown alias (stdout) 1`] = `
-"javascript.js
-override.as-js-file"
+exports[`Ignored file  1`] = `
+{
+  "stderr": "",
+  "stdout": "",
+  "write": [],
+}
 `;
 
-exports[`ignore-unknown check (stderr) 1`] = `
-"[warn] javascript.js
-[warn] override.as-js-file
-[warn] Code style issues found in 2 files. Run Prettier with --write to fix."
+exports[`None exist file  1`] = `
+{
+  "stderr": "[error] No files matching the pattern were found: "non-exist-file".",
+  "stdout": "",
+  "write": [],
+}
 `;
 
-exports[`ignore-unknown check (stdout) 1`] = `"Checking formatting..."`;
+exports[`Not matching pattern  1`] = `
+{
+  "stderr": "[error] No files matching the pattern were found: "*.non-exist-pattern".",
+  "stdout": "",
+  "write": [],
+}
+`;
 
-exports[`ignore-unknown check (write) 1`] = `[]`;
+exports[`ignore-unknown alias  1`] = `
+{
+  "stdout": "javascript.js
+override.as-js-file",
+}
+`;
 
-exports[`ignore-unknown dir (stdout) 1`] = `
-"javascript.js
-override.as-js-file"
+exports[`ignore-unknown check  1`] = `
+{
+  "stderr": "[warn] javascript.js
+[warn] override.as-js-file
+[warn] Code style issues found in 2 files. Run Prettier with --write to fix.",
+  "stdout": "Checking formatting...",
+  "write": [],
+}
 `;
 
-exports[`ignore-unknown pattern (stdout) 1`] = `
-"javascript.js
-override.as-js-file"
+exports[`ignore-unknown dir  1`] = `
+{
+  "stdout": "javascript.js
+override.as-js-file",
+}
 `;
 
-exports[`ignore-unknown write (stdout) 1`] = `
-"javascript.js
-override.as-js-file"
+exports[`ignore-unknown pattern  1`] = `
+{
+  "stdout": "javascript.js
+override.as-js-file",
+}
 `;
 
-exports[`ignore-unknown write (write) 1`] = `
-[
-  {
-    "content": "const foo = "bar";
+exports[`ignore-unknown write  1`] = `
+{
+  "stdout": "javascript.js
+override.as-js-file",
+  "write": [
+    {
+      "content": "const foo = "bar";
 ",
-    "filename": "javascript.js",
-  },
-  {
-    "content": "const foo = "bar";
+      "filename": "javascript.js",
+    },
+    {
+      "content": "const foo = "bar";
 ",
-    "filename": "override.as-js-file",
-  },
-]
+      "filename": "override.as-js-file",
+    },
+  ],
+}
 `;
diff --git a/tests/integration/__tests__/__snapshots__/ignore-vcs-files.js.snap b/tests/integration/__tests__/__snapshots__/ignore-vcs-files.js.snap
index 857af8156..b3b5cad0d 100644
--- a/tests/integration/__tests__/__snapshots__/ignore-vcs-files.js.snap
+++ b/tests/integration/__tests__/__snapshots__/ignore-vcs-files.js.snap
@@ -1,7 +1,9 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`ignores files in version control systems (stderr) 1`] = `""`;
-
-exports[`ignores files in version control systems (stdout) 1`] = `"file.js"`;
-
-exports[`ignores files in version control systems (write) 1`] = `[]`;
+exports[`ignores files in version control systems  1`] = `
+{
+  "stderr": "",
+  "stdout": "file.js",
+  "write": [],
+}
+`;
diff --git a/tests/integration/__tests__/__snapshots__/infer-parser.js.snap b/tests/integration/__tests__/__snapshots__/infer-parser.js.snap
index a08d690bb..d1b0d7683 100644
--- a/tests/integration/__tests__/__snapshots__/infer-parser.js.snap
+++ b/tests/integration/__tests__/__snapshots__/infer-parser.js.snap
@@ -1,116 +1,178 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`--check with unknown path and no parser multiple files (stderr) 1`] = `
-"[error] No parser could be inferred for file "<cli>/infer-parser/FOO".
+exports[`--check with unknown path and no parser multiple files  1`] = `
+{
+  "stderr": "[error] No parser could be inferred for file "<cli>/infer-parser/FOO".
 [warn] foo.js
-[warn] Code style issues found in the above file. Run Prettier with --write to fix."
+[warn] Code style issues found in the above file. Run Prettier with --write to fix.",
+  "stdout": "Checking formatting...",
+}
 `;
 
-exports[`--check with unknown path and no parser multiple files (stdout) 1`] = `"Checking formatting..."`;
-
-exports[`--check with unknown path and no parser specific file (stderr) 1`] = `"[error] No parser could be inferred for file "<cli>/infer-parser/FOO"."`;
-
-exports[`--check with unknown path and no parser specific file (stdout) 1`] = `
-"Checking formatting...
-All matched files use Prettier code style!"
+exports[`--check with unknown path and no parser specific file  1`] = `
+{
+  "stderr": "[error] No parser could be inferred for file "<cli>/infer-parser/FOO".",
+  "stdout": "Checking formatting...
+All matched files use Prettier code style!",
+}
 `;
 
-exports[`--list-different with unknown path and no parser multiple files (stderr) 1`] = `"[error] No parser could be inferred for file "<cli>/infer-parser/FOO"."`;
-
-exports[`--list-different with unknown path and no parser specific file (stderr) 1`] = `"[error] No parser could be inferred for file "<cli>/infer-parser/FOO"."`;
-
-exports[`--write and --check with unknown path and no parser multiple files (stderr) 1`] = `
-"[error] No parser could be inferred for file "<cli>/infer-parser/FOO".
-[warn] foo.js
-[warn] Code style issues fixed in the above file."
+exports[`--list-different with unknown path and no parser multiple files  1`] = `
+{
+  "stderr": "[error] No parser could be inferred for file "<cli>/infer-parser/FOO".",
+}
 `;
 
-exports[`--write and --check with unknown path and no parser multiple files (stdout) 1`] = `"Checking formatting..."`;
+exports[`--list-different with unknown path and no parser specific file  1`] = `
+{
+  "stderr": "[error] No parser could be inferred for file "<cli>/infer-parser/FOO".",
+}
+`;
 
-exports[`--write and --check with unknown path and no parser multiple files (write) 1`] = `
-[
-  {
-    "content": "foo();
+exports[`--write and --check with unknown path and no parser multiple files  1`] = `
+{
+  "stderr": "[error] No parser could be inferred for file "<cli>/infer-parser/FOO".
+[warn] foo.js
+[warn] Code style issues fixed in the above file.",
+  "stdout": "Checking formatting...",
+  "write": [
+    {
+      "content": "foo();
 ",
-    "filename": "foo.js",
-  },
-]
+      "filename": "foo.js",
+    },
+  ],
+}
 `;
 
-exports[`--write and --check with unknown path and no parser specific file (stderr) 1`] = `"[error] No parser could be inferred for file "<cli>/infer-parser/FOO"."`;
-
-exports[`--write and --check with unknown path and no parser specific file (stdout) 1`] = `
-"Checking formatting...
-All matched files use Prettier code style!"
+exports[`--write and --check with unknown path and no parser specific file  1`] = `
+{
+  "stderr": "[error] No parser could be inferred for file "<cli>/infer-parser/FOO".",
+  "stdout": "Checking formatting...
+All matched files use Prettier code style!",
+}
 `;
 
-exports[`--write and --list-different with unknown path and no parser multiple files (stderr) 1`] = `"[error] No parser could be inferred for file "<cli>/infer-parser/FOO"."`;
-
-exports[`--write and --list-different with unknown path and no parser multiple files (stdout) 1`] = `"foo.js"`;
-
-exports[`--write and --list-different with unknown path and no parser multiple files (write) 1`] = `
-[
-  {
-    "content": "foo();
+exports[`--write and --list-different with unknown path and no parser multiple files  1`] = `
+{
+  "stderr": "[error] No parser could be inferred for file "<cli>/infer-parser/FOO".",
+  "stdout": "foo.js",
+  "write": [
+    {
+      "content": "foo();
 ",
-    "filename": "foo.js",
-  },
-]
+      "filename": "foo.js",
+    },
+  ],
+}
 `;
 
-exports[`--write and --list-different with unknown path and no parser specific file (stderr) 1`] = `"[error] No parser could be inferred for file "<cli>/infer-parser/FOO"."`;
-
-exports[`--write with unknown path and no parser multiple files (stderr) 1`] = `"[error] No parser could be inferred for file "<cli>/infer-parser/FOO"."`;
-
-exports[`--write with unknown path and no parser multiple files (stdout) 1`] = `"foo.js 0ms"`;
+exports[`--write and --list-different with unknown path and no parser specific file  1`] = `
+{
+  "stderr": "[error] No parser could be inferred for file "<cli>/infer-parser/FOO".",
+}
+`;
 
-exports[`--write with unknown path and no parser multiple files (write) 1`] = `
-[
-  {
-    "content": "foo();
+exports[`--write with unknown path and no parser multiple files  1`] = `
+{
+  "stderr": "[error] No parser could be inferred for file "<cli>/infer-parser/FOO".",
+  "stdout": "foo.js 0ms",
+  "write": [
+    {
+      "content": "foo();
 ",
-    "filename": "foo.js",
-  },
-]
+      "filename": "foo.js",
+    },
+  ],
+}
 `;
 
-exports[`--write with unknown path and no parser specific file (stderr) 1`] = `"[error] No parser could be inferred for file "<cli>/infer-parser/FOO"."`;
+exports[`--write with unknown path and no parser specific file  1`] = `
+{
+  "stderr": "[error] No parser could be inferred for file "<cli>/infer-parser/FOO".",
+}
+`;
 
-exports[`Interpreters (stdout) 1`] = `"{ "ignored": false, "inferredParser": "babel" }"`;
+exports[`Interpreters  1`] = `
+{
+  "stdout": "{ "ignored": false, "inferredParser": "babel" }",
+}
+`;
 
-exports[`Known/Unknown (stdout) 1`] = `"known.js"`;
+exports[`Known/Unknown  1`] = `
+{
+  "stdout": "known.js",
+}
+`;
 
-exports[`isSupported (stdout) 1`] = `
-"{
+exports[`isSupported  1`] = `
+{
+  "stdout": "{
   "ignored": false,
   "inferredParser": "parser-name-inferred-from-language-is-supported"
-}"
+}",
+}
 `;
 
-exports[`isSupported (stdout) 2`] = `
-"content from file
-formatted by 'parser-name-inferred-from-language-is-supported' parser"
+exports[`isSupported  2`] = `
+{
+  "stdout": "content from file
+formatted by 'parser-name-inferred-from-language-is-supported' parser",
+}
 `;
 
-exports[`isSupported (stdout) 3`] = `
-"content from stdin
-formatted by 'parser-name-inferred-from-language-is-supported' parser"
+exports[`isSupported  3`] = `
+{
+  "stdout": "content from stdin
+formatted by 'parser-name-inferred-from-language-is-supported' parser",
+}
 `;
 
-exports[`stdin no path and no parser --check logs error but exits with 0 (stderr) 1`] = `"[error] No parser and no file path given, couldn't infer a parser."`;
-
-exports[`stdin no path and no parser --list-different logs error but exits with 0 (stderr) 1`] = `"[error] No parser and no file path given, couldn't infer a parser."`;
+exports[`stdin no path and no parser --check logs error but exits with 0  1`] = `
+{
+  "stderr": "[error] No parser and no file path given, couldn't infer a parser.",
+}
+`;
 
-exports[`stdin no path and no parser logs error and exits with 2 (stderr) 1`] = `"[error] No parser and no file path given, couldn't infer a parser."`;
+exports[`stdin no path and no parser --list-different logs error but exits with 0  1`] = `
+{
+  "stderr": "[error] No parser and no file path given, couldn't infer a parser.",
+}
+`;
 
-exports[`stdin with unknown path and no parser --check logs error but exits with 0 (stderr) 1`] = `"[error] No parser could be inferred for file "<cli>/infer-parser/foo"."`;
+exports[`stdin no path and no parser logs error and exits with 2  1`] = `
+{
+  "stderr": "[error] No parser and no file path given, couldn't infer a parser.",
+}
+`;
 
-exports[`stdin with unknown path and no parser --list-different logs error but exits with 0 (stderr) 1`] = `"[error] No parser could be inferred for file "<cli>/infer-parser/foo"."`;
+exports[`stdin with unknown path and no parser --check logs error but exits with 0  1`] = `
+{
+  "stderr": "[error] No parser could be inferred for file "<cli>/infer-parser/foo".",
+}
+`;
 
-exports[`stdin with unknown path and no parser logs error and exits with 2 (stderr) 1`] = `"[error] No parser could be inferred for file "<cli>/infer-parser/foo"."`;
+exports[`stdin with unknown path and no parser --list-different logs error but exits with 0  1`] = `
+{
+  "stderr": "[error] No parser could be inferred for file "<cli>/infer-parser/foo".",
+}
+`;
 
-exports[`unknown path and no parser multiple files (stderr) 1`] = `"[error] No parser could be inferred for file "<cli>/infer-parser/FOO"."`;
+exports[`stdin with unknown path and no parser logs error and exits with 2  1`] = `
+{
+  "stderr": "[error] No parser could be inferred for file "<cli>/infer-parser/foo".",
+}
+`;
 
-exports[`unknown path and no parser multiple files (stdout) 1`] = `"foo();"`;
+exports[`unknown path and no parser multiple files  1`] = `
+{
+  "stderr": "[error] No parser could be inferred for file "<cli>/infer-parser/FOO".",
+  "stdout": "foo();",
+}
+`;
 
-exports[`unknown path and no parser specific file (stderr) 1`] = `"[error] No parser could be inferred for file "<cli>/infer-parser/FOO"."`;
+exports[`unknown path and no parser specific file  1`] = `
+{
+  "stderr": "[error] No parser could be inferred for file "<cli>/infer-parser/FOO".",
+}
+`;
diff --git a/tests/integration/__tests__/__snapshots__/infer-plugins-ext-dir.js.snap b/tests/integration/__tests__/__snapshots__/infer-plugins-ext-dir.js.snap
index d3a28a619..881e1405e 100644
--- a/tests/integration/__tests__/__snapshots__/infer-plugins-ext-dir.js.snap
+++ b/tests/integration/__tests__/__snapshots__/infer-plugins-ext-dir.js.snap
@@ -1,17 +1,49 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`infer file ext that supported by only plugins basic (stderr) 1`] = `""`;
-
-exports[`infer file ext that supported by only plugins with config option (stderr) 1`] = `""`;
-
-exports[`infer file ext that supported by only plugins with defaultOptions (stderr) 1`] = `""`;
-
-exports[`infer file ext that supported by only plugins with multiple config for nested dir (stderr) 1`] = `""`;
-
-exports[`infer file ext that supported by only plugins with multiple config for nested dir 2 (stderr) 1`] = `""`;
-
-exports[`infer file ext that supported by only plugins with multiple config for nested dir 2 (stderr) 2`] = `""`;
-
-exports[`infer file ext that supported by only plugins with overrides and defaultOptions (stderr) 1`] = `""`;
-
-exports[`infer file ext that supported by only plugins with overrides options (stderr) 1`] = `""`;
+exports[`infer file ext that supported by only plugins basic  1`] = `
+{
+  "stderr": "",
+}
+`;
+
+exports[`infer file ext that supported by only plugins with config option  1`] = `
+{
+  "stderr": "",
+}
+`;
+
+exports[`infer file ext that supported by only plugins with defaultOptions  1`] = `
+{
+  "stderr": "",
+}
+`;
+
+exports[`infer file ext that supported by only plugins with multiple config for nested dir  1`] = `
+{
+  "stderr": "",
+}
+`;
+
+exports[`infer file ext that supported by only plugins with multiple config for nested dir 2  1`] = `
+{
+  "stderr": "",
+}
+`;
+
+exports[`infer file ext that supported by only plugins with multiple config for nested dir 2  2`] = `
+{
+  "stderr": "",
+}
+`;
+
+exports[`infer file ext that supported by only plugins with overrides and defaultOptions  1`] = `
+{
+  "stderr": "",
+}
+`;
+
+exports[`infer file ext that supported by only plugins with overrides options  1`] = `
+{
+  "stderr": "",
+}
+`;
diff --git a/tests/integration/__tests__/__snapshots__/invalid-ignore.js.snap b/tests/integration/__tests__/__snapshots__/invalid-ignore.js.snap
index 15f1e1e69..c75f612f8 100644
--- a/tests/integration/__tests__/__snapshots__/invalid-ignore.js.snap
+++ b/tests/integration/__tests__/__snapshots__/invalid-ignore.js.snap
@@ -1,7 +1,9 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`throw error with invalid ignore (stderr) 1`] = `"[error] Unable to read '.prettierignore': EISDIR: illegal operation on a directory, read"`;
-
-exports[`throw error with invalid ignore (stdout) 1`] = `""`;
-
-exports[`throw error with invalid ignore (write) 1`] = `[]`;
+exports[`throw error with invalid ignore  1`] = `
+{
+  "stderr": "[error] Unable to read '.prettierignore': EISDIR: illegal operation on a directory, read",
+  "stdout": "",
+  "write": [],
+}
+`;
diff --git a/tests/integration/__tests__/__snapshots__/line-after-filepath-with-errors.js.snap b/tests/integration/__tests__/__snapshots__/line-after-filepath-with-errors.js.snap
index 54cd7779d..f311c79c0 100644
--- a/tests/integration/__tests__/__snapshots__/line-after-filepath-with-errors.js.snap
+++ b/tests/integration/__tests__/__snapshots__/line-after-filepath-with-errors.js.snap
@@ -1,7 +1,8 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`Line breaking after filepath with errors (stderr) 1`] = `
-"[error] invalid-1.js: SyntaxError: Unexpected token (1:8)
+exports[`Line breaking after filepath with errors  1`] = `
+{
+  "stderr": "[error] invalid-1.js: SyntaxError: Unexpected token (1:8)
 [error] > 1 | foo (+-) bar
 [error]     |        ^
 [error]   2 |
@@ -9,11 +10,20 @@ exports[`Line breaking after filepath with errors (stderr) 1`] = `
 [error] > 1 | foo (+-) bar
 [error]     |        ^
 [error]   2 |
-[error] No parser could be inferred for file "<cli>/syntax-errors/invalid-2.unknown"."
+[error] No parser could be inferred for file "<cli>/syntax-errors/invalid-2.unknown".",
+  "stdout": "invalid-1.js
+invalid-2.js
+invalid-2.unknown
+valid-1.js
+[[Clear text(process.stdout): valid-1.js]]
+function foo() {}",
+  "write": [],
+}
 `;
 
-exports[`Line breaking after filepath with errors (stderr) 2`] = `
-"[error] invalid-1.js: SyntaxError: Unexpected token (1:8)
+exports[`Line breaking after filepath with errors  2`] = `
+{
+  "stderr": "[error] invalid-1.js: SyntaxError: Unexpected token (1:8)
 [error] > 1 | foo (+-) bar
 [error]     |        ^
 [error]   2 |
@@ -21,11 +31,19 @@ exports[`Line breaking after filepath with errors (stderr) 2`] = `
 [error] > 1 | foo (+-) bar
 [error]     |        ^
 [error]   2 |
-[error] No parser could be inferred for file "<cli>/syntax-errors/invalid-2.unknown"."
+[error] No parser could be inferred for file "<cli>/syntax-errors/invalid-2.unknown".",
+  "stdout": "invalid-1.js
+invalid-2.js
+invalid-2.unknown
+valid-1.js
+[[Clear text(process.stdout): valid-1.js]]",
+  "write": [],
+}
 `;
 
-exports[`Line breaking after filepath with errors (stderr) 3`] = `
-"[error] invalid-1.js: SyntaxError: Unexpected token (1:8)
+exports[`Line breaking after filepath with errors  3`] = `
+{
+  "stderr": "[error] invalid-1.js: SyntaxError: Unexpected token (1:8)
 [error] > 1 | foo (+-) bar
 [error]     |        ^
 [error]   2 |
@@ -33,11 +51,21 @@ exports[`Line breaking after filepath with errors (stderr) 3`] = `
 [error] > 1 | foo (+-) bar
 [error]     |        ^
 [error]   2 |
-[error] No parser could be inferred for file "<cli>/syntax-errors/invalid-2.unknown"."
+[error] No parser could be inferred for file "<cli>/syntax-errors/invalid-2.unknown".",
+  "stdout": "Checking formatting...
+invalid-1.js
+invalid-2.js
+invalid-2.unknown
+valid-1.js
+[[Clear text(process.stdout): valid-1.js]]
+All matched files use Prettier code style!",
+  "write": [],
+}
 `;
 
-exports[`Line breaking after filepath with errors (stderr) 4`] = `
-"[error] invalid-1.js: SyntaxError: Unexpected token (1:8)
+exports[`Line breaking after filepath with errors  4`] = `
+{
+  "stderr": "[error] invalid-1.js: SyntaxError: Unexpected token (1:8)
 [error] > 1 | foo (+-) bar
 [error]     |        ^
 [error]   2 |
@@ -45,51 +73,14 @@ exports[`Line breaking after filepath with errors (stderr) 4`] = `
 [error] > 1 | foo (+-) bar
 [error]     |        ^
 [error]   2 |
-[error] No parser could be inferred for file "<cli>/syntax-errors/invalid-2.unknown"."
-`;
-
-exports[`Line breaking after filepath with errors (stdout) 1`] = `
-"invalid-1.js
-invalid-2.js
-invalid-2.unknown
-valid-1.js
-[[called readline.clearLine(process.stdout)]]
-function foo() {}"
-`;
-
-exports[`Line breaking after filepath with errors (stdout) 2`] = `
-"invalid-1.js
-invalid-2.js
-invalid-2.unknown
-valid-1.js
-[[called readline.clearLine(process.stdout)]]
-"
-`;
-
-exports[`Line breaking after filepath with errors (stdout) 3`] = `
-"Checking formatting...
-invalid-1.js
-invalid-2.js
-invalid-2.unknown
-valid-1.js
-[[called readline.clearLine(process.stdout)]]
-All matched files use Prettier code style!"
-`;
-
-exports[`Line breaking after filepath with errors (stdout) 4`] = `
-"invalid-1.js
+[error] No parser could be inferred for file "<cli>/syntax-errors/invalid-2.unknown".",
+  "stdout": "invalid-1.js
 invalid-2.js
 invalid-2.unknown
-[[called readline.clearLine(process.stdout)]]
+[[Clear text(process.stdout): invalid-2.unknown]]
 valid-1.js
-[[called readline.clearLine(process.stdout)]]
-valid-1.js 0ms (unchanged)"
+[[Clear text(process.stdout): valid-1.js]]
+valid-1.js 0ms (unchanged)",
+  "write": [],
+}
 `;
-
-exports[`Line breaking after filepath with errors (write) 1`] = `[]`;
-
-exports[`Line breaking after filepath with errors (write) 2`] = `[]`;
-
-exports[`Line breaking after filepath with errors (write) 3`] = `[]`;
-
-exports[`Line breaking after filepath with errors (write) 4`] = `[]`;
diff --git a/tests/integration/__tests__/__snapshots__/list-different.js.snap b/tests/integration/__tests__/__snapshots__/list-different.js.snap
index a751bdfec..57e599866 100644
--- a/tests/integration/__tests__/__snapshots__/list-different.js.snap
+++ b/tests/integration/__tests__/__snapshots__/list-different.js.snap
@@ -1,17 +1,29 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`--list-different works in CI just as in a non-TTY mode (stderr) 1`] = `""`;
-
-exports[`--list-different works in CI just as in a non-TTY mode (stderr) 2`] = `""`;
-
-exports[`--list-different works in CI just as in a non-TTY mode (stdout) 1`] = `"unformatted.js"`;
-
-exports[`--list-different works in CI just as in a non-TTY mode (stdout) 2`] = `"unformatted.js"`;
-
-exports[`--list-different works in CI just as in a non-TTY mode (write) 1`] = `[]`;
-
-exports[`--list-different works in CI just as in a non-TTY mode (write) 2`] = `[]`;
-
-exports[`checks stdin with --list-different (write) 1`] = `[]`;
-
-exports[`checks stdin with -l (alias for --list-different) (write) 1`] = `[]`;
+exports[`--list-different works in CI just as in a non-TTY mode  1`] = `
+{
+  "stderr": "",
+  "stdout": "unformatted.js",
+  "write": [],
+}
+`;
+
+exports[`--list-different works in CI just as in a non-TTY mode  2`] = `
+{
+  "stderr": "",
+  "stdout": "unformatted.js",
+  "write": [],
+}
+`;
+
+exports[`checks stdin with --list-different  1`] = `
+{
+  "write": [],
+}
+`;
+
+exports[`checks stdin with -l (alias for --list-different)  1`] = `
+{
+  "write": [],
+}
+`;
diff --git a/tests/integration/__tests__/__snapshots__/log-level.js.snap b/tests/integration/__tests__/__snapshots__/log-level.js.snap
index 211202bb6..f11b8c066 100644
--- a/tests/integration/__tests__/__snapshots__/log-level.js.snap
+++ b/tests/integration/__tests__/__snapshots__/log-level.js.snap
@@ -1,24 +1,26 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`--write with --log-level=silent doesn't log filenames (stderr) 1`] = `""`;
-
-exports[`--write with --log-level=silent doesn't log filenames (stdout) 1`] = `""`;
-
-exports[`--write with --log-level=silent doesn't log filenames (write) 1`] = `
-[
-  {
-    "content": "var x = 1;
+exports[`--write with --log-level=silent doesn't log filenames  1`] = `
+{
+  "stderr": "",
+  "stdout": "",
+  "write": [
+    {
+      "content": "var x = 1;
 ",
-    "filename": "unformatted.js",
-  },
-]
+      "filename": "unformatted.js",
+    },
+  ],
+}
 `;
 
-exports[`Should use default level logger to log \`--log-level\` error (stderr) 1`] = `
-"[error] Invalid --log-level value. Expected one of the following values, but received "a-unknown-log-level".
+exports[`Should use default level logger to log \`--log-level\` error  1`] = `
+{
+  "stderr": "[error] Invalid --log-level value. Expected one of the following values, but received "a-unknown-log-level".
 [error] - "debug"
 [error] - "error"
 [error] - "log"
 [error] - "silent"
-[error] - "warn""
+[error] - "warn"",
+}
 `;
diff --git a/tests/integration/__tests__/__snapshots__/patterns-dirs.js.snap b/tests/integration/__tests__/__snapshots__/patterns-dirs.js.snap
index 4d644e8be..7c39e8e56 100644
--- a/tests/integration/__tests__/__snapshots__/patterns-dirs.js.snap
+++ b/tests/integration/__tests__/__snapshots__/patterns-dirs.js.snap
@@ -1,7 +1,8 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`1: prettier dir1 dir2 (stdout) 1`] = `
-"dir1/a1.js
+exports[`1: prettier dir1 dir2  1`] = `
+{
+  "stdout": "dir1/a1.js
 dir1/b1.js
 dir1/nested1/an1.css
 dir1/nested1/an1.js
@@ -10,11 +11,13 @@ dir2/a2.js
 dir2/b2.js
 dir2/nested2/an2.js
 dir2/nested2/bn2.js
-dir2/node-shebang"
+dir2/node-shebang",
+}
 `;
 
-exports[`1a - with *.foo plugin: prettier dir1 dir2 --plugin=../../plugins/extensions/plugin.cjs (stdout) 1`] = `
-"dir1/a1.foo
+exports[`1a - with *.foo plugin: prettier dir1 dir2 --plugin=../../plugins/extensions/plugin.cjs  1`] = `
+{
+  "stdout": "dir1/a1.foo
 dir1/a1.js
 dir1/b1.js
 dir1/nested1/an1.css
@@ -25,23 +28,25 @@ dir2/a2.js
 dir2/b2.js
 dir2/nested2/an2.js
 dir2/nested2/bn2.js
-dir2/node-shebang"
+dir2/node-shebang",
+}
 `;
 
-exports[`1c: prettier dir1 empty (stderr) 1`] = `""`;
-
-exports[`1c: prettier dir1 empty (stdout) 1`] = `
-"dir1/a1.js
+exports[`1c: prettier dir1 empty  1`] = `
+{
+  "stderr": "",
+  "stdout": "dir1/a1.js
 dir1/b1.js
 dir1/nested1/an1.css
 dir1/nested1/an1.js
-dir1/nested1/bn1.js"
+dir1/nested1/bn1.js",
+}
 `;
 
-exports[`2: prettier dir1 'dir2/**/*' (stderr) 1`] = `"[error] No parser could be inferred for file "<cli>/patterns-dirs/dir2/a2.foo"."`;
-
-exports[`2: prettier dir1 'dir2/**/*' (stdout) 1`] = `
-"dir1/a1.js
+exports[`2: prettier dir1 'dir2/**/*'  1`] = `
+{
+  "stderr": "[error] No parser could be inferred for file "<cli>/patterns-dirs/dir2/a2.foo".",
+  "stdout": "dir1/a1.js
 dir1/b1.js
 dir1/nested1/an1.css
 dir1/nested1/an1.js
@@ -50,26 +55,26 @@ dir2/a2.js
 dir2/b2.js
 dir2/nested2/an2.js
 dir2/nested2/bn2.js
-dir2/node-shebang"
+dir2/node-shebang",
+}
 `;
 
-exports[`3: prettier nonexistent-dir 'dir2/**/*' (stderr) 1`] = `
-"[error] No files matching the pattern were found: "nonexistent-dir".
-[error] No parser could be inferred for file "<cli>/patterns-dirs/dir2/a2.foo"."
-`;
-
-exports[`3: prettier nonexistent-dir 'dir2/**/*' (stdout) 1`] = `
-"dir2/a2.js
+exports[`3: prettier nonexistent-dir 'dir2/**/*'  1`] = `
+{
+  "stderr": "[error] No files matching the pattern were found: "nonexistent-dir".
+[error] No parser could be inferred for file "<cli>/patterns-dirs/dir2/a2.foo".",
+  "stdout": "dir2/a2.js
 dir2/b2.js
 dir2/nested2/an2.js
 dir2/nested2/bn2.js
-dir2/node-shebang"
+dir2/node-shebang",
+}
 `;
 
-exports[`4: prettier . 'dir2/**/*' (stderr) 1`] = `""`;
-
-exports[`4: prettier . 'dir2/**/*' (stdout) 1`] = `
-"!dir/a.js
+exports[`4: prettier . 'dir2/**/*'  1`] = `
+{
+  "stderr": "",
+  "stdout": "!dir/a.js
 dir1/a1.js
 dir1/b1.js
 dir1/nested1/an1.css
@@ -79,32 +84,40 @@ dir2/a2.js
 dir2/b2.js
 dir2/nested2/an2.js
 dir2/nested2/bn2.js
-dir2/node-shebang"
+dir2/node-shebang",
+}
 `;
 
-exports[`Negative patterns 1: prettier dir1 '!dir1/nested1' (stdout) 1`] = `
-"dir1/a1.js
-dir1/b1.js"
+exports[`Negative patterns 1: prettier dir1 '!dir1/nested1'  1`] = `
+{
+  "stdout": "dir1/a1.js
+dir1/b1.js",
+}
 `;
 
-exports[`Negative patterns 1a: prettier dir1 '!dir1/nested1/*' (stdout) 1`] = `
-"dir1/a1.js
-dir1/b1.js"
+exports[`Negative patterns 1a: prettier dir1 '!dir1/nested1/*'  1`] = `
+{
+  "stdout": "dir1/a1.js
+dir1/b1.js",
+}
 `;
 
-exports[`Negative patterns 2: prettier . '!dir1/nested1' (stdout) 1`] = `
-"!dir/a.js
+exports[`Negative patterns 2: prettier . '!dir1/nested1'  1`] = `
+{
+  "stdout": "!dir/a.js
 dir1/a1.js
 dir1/b1.js
 dir2/a2.js
 dir2/b2.js
 dir2/nested2/an2.js
 dir2/nested2/bn2.js
-dir2/node-shebang"
+dir2/node-shebang",
+}
 `;
 
-exports[`Negative patterns 3: prettier . '!dir1/nested1/an1.js' (stdout) 1`] = `
-"!dir/a.js
+exports[`Negative patterns 3: prettier . '!dir1/nested1/an1.js'  1`] = `
+{
+  "stdout": "!dir/a.js
 dir1/a1.js
 dir1/b1.js
 dir1/nested1/an1.css
@@ -113,19 +126,27 @@ dir2/a2.js
 dir2/b2.js
 dir2/nested2/an2.js
 dir2/nested2/bn2.js
-dir2/node-shebang"
+dir2/node-shebang",
+}
 `;
 
-exports[`Negative patterns 4: prettier '!nonexistent-dir1 !nonexistent-dir2' (stderr) 1`] = `"[error] No matching files. Patterns: !nonexistent-dir1 !nonexistent-dir2"`;
-
-exports[`Negative patterns 4: prettier '!nonexistent-dir1 !nonexistent-dir2' (stdout) 1`] = `""`;
-
-exports[`Negative patterns with explicit files: prettier dir1/a1.js dir2/a2.js '!dir1/*' (stderr) 1`] = `"[error] Explicitly specified file was ignored due to negative glob patterns: "dir1/a1.js"."`;
+exports[`Negative patterns 4: prettier '!nonexistent-dir1 !nonexistent-dir2'  1`] = `
+{
+  "stderr": "[error] No matching files. Patterns: !nonexistent-dir1 !nonexistent-dir2",
+  "stdout": "",
+}
+`;
 
-exports[`Negative patterns with explicit files: prettier dir1/a1.js dir2/a2.js '!dir1/*' (stdout) 1`] = `"dir2/a2.js"`;
+exports[`Negative patterns with explicit files: prettier dir1/a1.js dir2/a2.js '!dir1/*'  1`] = `
+{
+  "stderr": "[error] Explicitly specified file was ignored due to negative glob patterns: "dir1/a1.js".",
+  "stdout": "dir2/a2.js",
+}
+`;
 
-exports[`Trailing slash 1: prettier ./ (stdout) 1`] = `
-"!dir/a.js
+exports[`Trailing slash 1: prettier ./  1`] = `
+{
+  "stdout": "!dir/a.js
 dir1/a1.js
 dir1/b1.js
 dir1/nested1/an1.css
@@ -135,11 +156,13 @@ dir2/a2.js
 dir2/b2.js
 dir2/nested2/an2.js
 dir2/nested2/bn2.js
-dir2/node-shebang"
+dir2/node-shebang",
+}
 `;
 
-exports[`Trailing slash 2: prettier .// (stdout) 1`] = `
-"!dir/a.js
+exports[`Trailing slash 2: prettier .//  1`] = `
+{
+  "stdout": "!dir/a.js
 dir1/a1.js
 dir1/b1.js
 dir1/nested1/an1.css
@@ -149,35 +172,43 @@ dir2/a2.js
 dir2/b2.js
 dir2/nested2/an2.js
 dir2/nested2/bn2.js
-dir2/node-shebang"
+dir2/node-shebang",
+}
 `;
 
-exports[`Trailing slash 3: prettier dir1/ (stdout) 1`] = `
-"dir1/a1.js
+exports[`Trailing slash 3: prettier dir1/  1`] = `
+{
+  "stdout": "dir1/a1.js
 dir1/b1.js
 dir1/nested1/an1.css
 dir1/nested1/an1.js
-dir1/nested1/bn1.js"
+dir1/nested1/bn1.js",
+}
 `;
 
-exports[`Trailing slash 4: prettier dir1// (stdout) 1`] = `
-"dir1/a1.js
+exports[`Trailing slash 4: prettier dir1//  1`] = `
+{
+  "stdout": "dir1/a1.js
 dir1/b1.js
 dir1/nested1/an1.css
 dir1/nested1/an1.js
-dir1/nested1/bn1.js"
+dir1/nested1/bn1.js",
+}
 `;
 
-exports[`Trailing slash 5: prettier .//dir2/..//./dir1// (stdout) 1`] = `
-"dir1/a1.js
+exports[`Trailing slash 5: prettier .//dir2/..//./dir1//  1`] = `
+{
+  "stdout": "dir1/a1.js
 dir1/b1.js
 dir1/nested1/an1.css
 dir1/nested1/an1.js
-dir1/nested1/bn1.js"
+dir1/nested1/bn1.js",
+}
 `;
 
-exports[`Trailing slash run in sub dir 1: prettier .. (stdout) 1`] = `
-"../!dir/a.js
+exports[`Trailing slash run in sub dir 1: prettier ..  1`] = `
+{
+  "stdout": "../!dir/a.js
 ../dir1/a1.js
 ../dir1/b1.js
 ../dir1/nested1/an1.css
@@ -187,11 +218,13 @@ a2.js
 b2.js
 nested2/an2.js
 nested2/bn2.js
-node-shebang"
+node-shebang",
+}
 `;
 
-exports[`Trailing slash run in sub dir 2: prettier ../ (stdout) 1`] = `
-"../!dir/a.js
+exports[`Trailing slash run in sub dir 2: prettier ../  1`] = `
+{
+  "stdout": "../!dir/a.js
 ../dir1/a1.js
 ../dir1/b1.js
 ../dir1/nested1/an1.css
@@ -201,33 +234,41 @@ a2.js
 b2.js
 nested2/an2.js
 nested2/bn2.js
-node-shebang"
+node-shebang",
+}
 `;
 
-exports[`Trailing slash run in sub dir 3: prettier ../dir1 (stdout) 1`] = `
-"../dir1/a1.js
+exports[`Trailing slash run in sub dir 3: prettier ../dir1  1`] = `
+{
+  "stdout": "../dir1/a1.js
 ../dir1/b1.js
 ../dir1/nested1/an1.css
 ../dir1/nested1/an1.js
-../dir1/nested1/bn1.js"
+../dir1/nested1/bn1.js",
+}
 `;
 
-exports[`Trailing slash run in sub dir 4: prettier ../dir1/ (stdout) 1`] = `
-"../dir1/a1.js
+exports[`Trailing slash run in sub dir 4: prettier ../dir1/  1`] = `
+{
+  "stdout": "../dir1/a1.js
 ../dir1/b1.js
 ../dir1/nested1/an1.css
 ../dir1/nested1/an1.js
-../dir1/nested1/bn1.js"
+../dir1/nested1/bn1.js",
+}
 `;
 
-exports[`plugins \`*\` (stderr) 1`] = `"[error] No parser could be inferred for file "<cli>/dirs/plugins/unknown.unknown"."`;
-
-exports[`plugins \`*\` (stdout) 1`] = `
-"javascript.js
-plugin.uppercase-rocks"
+exports[`plugins \`*\`  1`] = `
+{
+  "stderr": "[error] No parser could be inferred for file "<cli>/dirs/plugins/unknown.unknown".",
+  "stdout": "javascript.js
+plugin.uppercase-rocks",
+}
 `;
 
-exports[`plugins \`.\` (stdout) 1`] = `
-"javascript.js
-plugin.uppercase-rocks"
+exports[`plugins \`.\`  1`] = `
+{
+  "stdout": "javascript.js
+plugin.uppercase-rocks",
+}
 `;
diff --git a/tests/integration/__tests__/__snapshots__/patterns-glob.js.snap b/tests/integration/__tests__/__snapshots__/patterns-glob.js.snap
index c01feeb03..8d3ec1a16 100644
--- a/tests/integration/__tests__/__snapshots__/patterns-glob.js.snap
+++ b/tests/integration/__tests__/__snapshots__/patterns-glob.js.snap
@@ -1,101 +1,115 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`fixtures-1: Should match all files (stderr) 1`] = `""`;
-
-exports[`fixtures-1: Should match all files (stdout) 1`] = `
-"!file.js
+exports[`fixtures-1: Should match all files  1`] = `
+{
+  "stderr": "",
+  "stdout": "!file.js
 a.js
-b.js"
+b.js",
+  "write": [],
+}
 `;
 
-exports[`fixtures-1: Should match all files (write) 1`] = `[]`;
-
-exports[`fixtures-1: Should match files except \`a.js\` (stderr) 1`] = `""`;
-
-exports[`fixtures-1: Should match files except \`a.js\` (stdout) 1`] = `
-"!file.js
-b.js"
+exports[`fixtures-1: Should match files except \`a.js\`  1`] = `
+{
+  "stderr": "",
+  "stdout": "!file.js
+b.js",
+  "write": [],
+}
 `;
 
-exports[`fixtures-1: Should match files except \`a.js\` (write) 1`] = `[]`;
-
-exports[`fixtures-2: Should match \`a.js\` and \`!b.js\` (stderr) 1`] = `""`;
-
-exports[`fixtures-2: Should match \`a.js\` and \`!b.js\` (stdout) 1`] = `
-"!b.js
-a.js"
+exports[`fixtures-2: Should match \`a.js\` and \`!b.js\`  1`] = `
+{
+  "stderr": "",
+  "stdout": "!b.js
+a.js",
+  "write": [],
+}
 `;
 
-exports[`fixtures-2: Should match \`a.js\` and \`!b.js\` (write) 1`] = `[]`;
-
-exports[`fixtures-2: Should match all js files and all supported files in the '!dir.js' directory (stderr) 1`] = `""`;
-
-exports[`fixtures-2: Should match all js files and all supported files in the '!dir.js' directory (stdout) 1`] = `
-"!b.js
+exports[`fixtures-2: Should match all js files and all supported files in the '!dir.js' directory  1`] = `
+{
+  "stderr": "",
+  "stdout": "!b.js
 a.js
 !dir.js/1.css
-!dir.js/2.css"
+!dir.js/2.css",
+  "write": [],
+}
 `;
 
-exports[`fixtures-2: Should match all js files and all supported files in the '!dir.js' directory (write) 1`] = `[]`;
-
-exports[`fixtures-2: Should only match \`!b.js\` (stderr) 1`] = `""`;
-
-exports[`fixtures-2: Should only match \`!b.js\` (stdout) 1`] = `"!b.js"`;
-
-exports[`fixtures-2: Should only match \`!b.js\` (write) 1`] = `[]`;
-
-exports[`fixtures-3: Should exclude \`.svn\` (existing) (stderr) 1`] = `""`;
-
-exports[`fixtures-3: Should exclude \`.svn\` (existing) (stdout) 1`] = `"outside.js"`;
-
-exports[`fixtures-3: Should exclude \`.svn\` (existing) (write) 1`] = `[]`;
-
-exports[`fixtures-3: Should exclude \`.svn\` (nonexisting) (stderr) 1`] = `""`;
-
-exports[`fixtures-3: Should exclude \`.svn\` (nonexisting) (stdout) 1`] = `"outside.js"`;
+exports[`fixtures-2: Should only match \`!b.js\`  1`] = `
+{
+  "stderr": "",
+  "stdout": "!b.js",
+  "write": [],
+}
+`;
 
-exports[`fixtures-3: Should exclude \`.svn\` (nonexisting) (write) 1`] = `[]`;
+exports[`fixtures-3: Should exclude \`.svn\` (existing)  1`] = `
+{
+  "stderr": "",
+  "stdout": "outside.js",
+  "write": [],
+}
+`;
 
-exports[`fixtures-3: Should match \`outside.js\`, \`dir/inside.js\` and \`dir/node_modules/in-node_modules.js\` (stderr) 1`] = `""`;
+exports[`fixtures-3: Should exclude \`.svn\` (nonexisting)  1`] = `
+{
+  "stderr": "",
+  "stdout": "outside.js",
+  "write": [],
+}
+`;
 
-exports[`fixtures-3: Should match \`outside.js\`, \`dir/inside.js\` and \`dir/node_modules/in-node_modules.js\` (stdout) 1`] = `
-"dir/inside.js
+exports[`fixtures-3: Should match \`outside.js\`, \`dir/inside.js\` and \`dir/node_modules/in-node_modules.js\`  1`] = `
+{
+  "stderr": "",
+  "stdout": "dir/inside.js
 dir/node_modules/in-node_modules.js
-outside.js"
+outside.js",
+  "write": [],
+}
 `;
 
-exports[`fixtures-3: Should match \`outside.js\`, \`dir/inside.js\` and \`dir/node_modules/in-node_modules.js\` (write) 1`] = `[]`;
-
-exports[`fixtures-3: Should only match \`outside.js\` and \`dir/inside.js\` (stderr) 1`] = `""`;
-
-exports[`fixtures-3: Should only match \`outside.js\` and \`dir/inside.js\` (stdout) 1`] = `
-"dir/inside.js
-outside.js"
+exports[`fixtures-3: Should only match \`outside.js\` and \`dir/inside.js\`  1`] = `
+{
+  "stderr": "",
+  "stdout": "dir/inside.js
+outside.js",
+  "write": [],
+}
 `;
 
-exports[`fixtures-3: Should only match \`outside.js\` and \`dir/inside.js\` (write) 1`] = `[]`;
-
-exports[`fixtures-4: Should match \`level-1.js\` #2 (stderr) 1`] = `""`;
-
-exports[`fixtures-4: Should match \`level-1.js\` #2 (stdout) 1`] = `"0/level-1.js"`;
-
-exports[`fixtures-4: Should match \`level-1.js\` #2 (write) 1`] = `[]`;
-
-exports[`fixtures-4: Should match \`level-1.js\` #3 (stderr) 1`] = `""`;
-
-exports[`fixtures-4: Should match \`level-1.js\` #3 (stdout) 1`] = `"0/level-1.js"`;
-
-exports[`fixtures-4: Should match \`level-1.js\` #3 (write) 1`] = `[]`;
-
-exports[`fixtures-4: Should match \`level-1.js\` (stderr) 1`] = `""`;
-
-exports[`fixtures-4: Should match \`level-1.js\` (stdout) 1`] = `"0/level-1.js"`;
-
-exports[`fixtures-4: Should match \`level-1.js\` (write) 1`] = `[]`;
+exports[`fixtures-4: Should match \`level-1.js\`  1`] = `
+{
+  "stderr": "",
+  "stdout": "0/level-1.js",
+  "write": [],
+}
+`;
 
-exports[`should not ignore file paths contains object prototype keys (stderr) 1`] = `""`;
+exports[`fixtures-4: Should match \`level-1.js\` #2  1`] = `
+{
+  "stderr": "",
+  "stdout": "0/level-1.js",
+  "write": [],
+}
+`;
 
-exports[`should not ignore file paths contains object prototype keys (stdout) 1`] = `"constructor/should-be-formatted.js"`;
+exports[`fixtures-4: Should match \`level-1.js\` #3  1`] = `
+{
+  "stderr": "",
+  "stdout": "0/level-1.js",
+  "write": [],
+}
+`;
 
-exports[`should not ignore file paths contains object prototype keys (write) 1`] = `[]`;
+exports[`should not ignore file paths contains object prototype keys  1`] = `
+{
+  "stderr": "",
+  "stdout": "constructor/should-be-formatted.js",
+  "write": [],
+}
+`;
diff --git a/tests/integration/__tests__/__snapshots__/patterns.js.snap b/tests/integration/__tests__/__snapshots__/patterns.js.snap
index 68b304f5d..34d65b1c4 100644
--- a/tests/integration/__tests__/__snapshots__/patterns.js.snap
+++ b/tests/integration/__tests__/__snapshots__/patterns.js.snap
@@ -1,81 +1,83 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`multiple patterns (stderr) 1`] = `""`;
-
-exports[`multiple patterns (stdout) 1`] = `
-"directory/file.js
+exports[`multiple patterns  1`] = `
+{
+  "stderr": "",
+  "stdout": "directory/file.js
 directory/nested-directory/nested-directory-file.js
 other-directory/file.js
-other-directory/nested-directory/nested-directory-file.js"
+other-directory/nested-directory/nested-directory-file.js",
+  "write": [],
+}
 `;
 
-exports[`multiple patterns (write) 1`] = `[]`;
-
-exports[`multiple patterns by with ignore pattern, doesn't ignore node_modules with --with-node-modules flag (stderr) 1`] = `""`;
-
-exports[`multiple patterns by with ignore pattern, doesn't ignore node_modules with --with-node-modules flag (stdout) 1`] = `
-"node_modules/node-module.js
+exports[`multiple patterns by with ignore pattern, doesn't ignore node_modules with --with-node-modules flag  1`] = `
+{
+  "stderr": "",
+  "stdout": "node_modules/node-module.js
 other-directory/file.js
 other-directory/nested-directory/nested-directory-file.js
 other-regular-modules.js
-regular-module.js"
+regular-module.js",
+  "write": [],
+}
 `;
 
-exports[`multiple patterns by with ignore pattern, doesn't ignore node_modules with --with-node-modules flag (write) 1`] = `[]`;
-
-exports[`multiple patterns by with ignore pattern, ignores node_modules by default (stderr) 1`] = `""`;
-
-exports[`multiple patterns by with ignore pattern, ignores node_modules by default (stdout) 1`] = `
-"other-directory/file.js
+exports[`multiple patterns by with ignore pattern, ignores node_modules by default  1`] = `
+{
+  "stderr": "",
+  "stdout": "other-directory/file.js
 other-directory/nested-directory/nested-directory-file.js
 other-regular-modules.js
-regular-module.js"
+regular-module.js",
+  "write": [],
+}
 `;
 
-exports[`multiple patterns by with ignore pattern, ignores node_modules by default (write) 1`] = `[]`;
-
-exports[`multiple patterns by with ignore pattern, ignores node_modules by with ./**/*.js (stderr) 1`] = `""`;
-
-exports[`multiple patterns by with ignore pattern, ignores node_modules by with ./**/*.js (stdout) 1`] = `
-"other-directory/file.js
+exports[`multiple patterns by with ignore pattern, ignores node_modules by with ./**/*.js  1`] = `
+{
+  "stderr": "",
+  "stdout": "other-directory/file.js
 other-directory/nested-directory/nested-directory-file.js
 other-regular-modules.js
-regular-module.js"
+regular-module.js",
+  "write": [],
+}
 `;
 
-exports[`multiple patterns by with ignore pattern, ignores node_modules by with ./**/*.js (write) 1`] = `[]`;
-
-exports[`multiple patterns with ignore nested directories pattern (stderr) 1`] = `""`;
-
-exports[`multiple patterns with ignore nested directories pattern (stdout) 1`] = `
-"directory/file.js
+exports[`multiple patterns with ignore nested directories pattern  1`] = `
+{
+  "stderr": "",
+  "stdout": "directory/file.js
 other-directory/file.js
 other-regular-modules.js
-regular-module.js"
+regular-module.js",
+  "write": [],
+}
 `;
 
-exports[`multiple patterns with ignore nested directories pattern (write) 1`] = `[]`;
-
-exports[`multiple patterns with non exists pattern (stderr) 1`] = `"[error] No files matching the pattern were found: "non-existent.js"."`;
-
-exports[`multiple patterns with non exists pattern (stdout) 1`] = `
-"directory/file.js
-directory/nested-directory/nested-directory-file.js"
+exports[`multiple patterns with non exists pattern  1`] = `
+{
+  "stderr": "[error] No files matching the pattern were found: "non-existent.js".",
+  "stdout": "directory/file.js
+directory/nested-directory/nested-directory-file.js",
+  "write": [],
+}
 `;
 
-exports[`multiple patterns with non exists pattern (write) 1`] = `[]`;
-
-exports[`multiple patterns, throw error and exit with non zero code on non existing files (stderr) 1`] = `
-"[error] No files matching the pattern were found: "non-existent.js".
-[error] No files matching the pattern were found: "other-non-existent.js"."
+exports[`multiple patterns, throw error and exit with non zero code on non existing files  1`] = `
+{
+  "stderr": "[error] No files matching the pattern were found: "non-existent.js".
+[error] No files matching the pattern were found: "other-non-existent.js".",
+  "stdout": "",
+  "write": [],
+}
 `;
 
-exports[`multiple patterns, throw error and exit with non zero code on non existing files (stdout) 1`] = `""`;
-
-exports[`multiple patterns, throw error and exit with non zero code on non existing files (write) 1`] = `[]`;
-
-exports[`no errors on empty patterns (stderr) 1`] = `""`;
-
-exports[`no errors on empty patterns (stdout) 1`] = `""`;
-
-exports[`no errors on empty patterns (write) 1`] = `[]`;
+exports[`no errors on empty patterns  1`] = `
+{
+  "stderr": "",
+  "stdout": "",
+  "write": [],
+}
+`;
diff --git a/tests/integration/__tests__/__snapshots__/piped-output.js.snap b/tests/integration/__tests__/__snapshots__/piped-output.js.snap
index 2f1fd39f5..238b7c087 100644
--- a/tests/integration/__tests__/__snapshots__/piped-output.js.snap
+++ b/tests/integration/__tests__/__snapshots__/piped-output.js.snap
@@ -1,108 +1,100 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`no file diffs with --check + formatted file (stderr) 1`] = `""`;
-
-exports[`no file diffs with --check + formatted file (stderr) 2`] = `""`;
-
-exports[`no file diffs with --check + formatted file (stdout) 1`] = `
-"Checking formatting...
+exports[`no file diffs with --check + formatted file  1`] = `
+{
+  "stderr": "",
+  "stdout": "Checking formatting...
 formatted.js
-[[called readline.clearLine(process.stdout)]]
-All matched files use Prettier code style!"
+[[Clear text(process.stdout): formatted.js]]
+All matched files use Prettier code style!",
+  "write": [],
+}
 `;
 
-exports[`no file diffs with --check + formatted file (stdout) 2`] = `
-"Checking formatting...
-All matched files use Prettier code style!"
+exports[`no file diffs with --check + formatted file  2`] = `
+{
+  "stderr": "",
+  "stdout": "Checking formatting...
+All matched files use Prettier code style!",
+  "write": [],
+}
 `;
 
-exports[`no file diffs with --check + formatted file (write) 1`] = `[]`;
-
-exports[`no file diffs with --check + formatted file (write) 2`] = `[]`;
-
-exports[`no file diffs with --list-different + formatted file (stderr) 1`] = `""`;
-
-exports[`no file diffs with --list-different + formatted file (stderr) 2`] = `""`;
-
-exports[`no file diffs with --list-different + formatted file (stdout) 1`] = `
-"formatted.js
-[[called readline.clearLine(process.stdout)]]
-"
+exports[`no file diffs with --list-different + formatted file  1`] = `
+{
+  "stderr": "",
+  "stdout": "formatted.js
+[[Clear text(process.stdout): formatted.js]]",
+  "write": [],
+}
 `;
 
-exports[`no file diffs with --list-different + formatted file (stdout) 2`] = `""`;
-
-exports[`no file diffs with --list-different + formatted file (write) 1`] = `[]`;
-
-exports[`no file diffs with --list-different + formatted file (write) 2`] = `[]`;
-
-exports[`output with --check + unformatted differs when piped (stderr) 1`] = `
-"[warn] unformatted.js
-[warn] Code style issues fixed in the above file."
+exports[`no file diffs with --list-different + formatted file  2`] = `
+{
+  "stderr": "",
+  "stdout": "",
+  "write": [],
+}
 `;
 
-exports[`output with --check + unformatted differs when piped (stderr) 2`] = `
-"[warn] unformatted.js
-[warn] Code style issues fixed in the above file."
-`;
-
-exports[`output with --check + unformatted differs when piped (stdout) 1`] = `
-"Checking formatting...
+exports[`output with --check + unformatted differs when piped  1`] = `
+{
+  "stderr": "[warn] unformatted.js
+[warn] Code style issues fixed in the above file.",
+  "stdout": "Checking formatting...
 unformatted.js
-[[called readline.clearLine(process.stdout)]]
-"
-`;
-
-exports[`output with --check + unformatted differs when piped (stdout) 2`] = `"Checking formatting..."`;
-
-exports[`output with --check + unformatted differs when piped (write) 1`] = `
-[
-  {
-    "content": "var x = 1;
+[[Clear text(process.stdout): unformatted.js]]",
+  "write": [
+    {
+      "content": "var x = 1;
 ",
-    "filename": "unformatted.js",
-  },
-]
+      "filename": "unformatted.js",
+    },
+  ],
+}
 `;
 
-exports[`output with --check + unformatted differs when piped (write) 2`] = `
-[
-  {
-    "content": "var x = 1;
+exports[`output with --check + unformatted differs when piped  2`] = `
+{
+  "stderr": "[warn] unformatted.js
+[warn] Code style issues fixed in the above file.",
+  "stdout": "Checking formatting...",
+  "write": [
+    {
+      "content": "var x = 1;
 ",
-    "filename": "unformatted.js",
-  },
-]
+      "filename": "unformatted.js",
+    },
+  ],
+}
 `;
 
-exports[`output with --list-different + unformatted differs when piped (stderr) 1`] = `""`;
-
-exports[`output with --list-different + unformatted differs when piped (stderr) 2`] = `""`;
-
-exports[`output with --list-different + unformatted differs when piped (stdout) 1`] = `
-"unformatted.js
-[[called readline.clearLine(process.stdout)]]
-unformatted.js"
-`;
-
-exports[`output with --list-different + unformatted differs when piped (stdout) 2`] = `"unformatted.js"`;
-
-exports[`output with --list-different + unformatted differs when piped (write) 1`] = `
-[
-  {
-    "content": "var x = 1;
+exports[`output with --list-different + unformatted differs when piped  1`] = `
+{
+  "stderr": "",
+  "stdout": "unformatted.js
+[[Clear text(process.stdout): unformatted.js]]
+unformatted.js",
+  "write": [
+    {
+      "content": "var x = 1;
 ",
-    "filename": "unformatted.js",
-  },
-]
+      "filename": "unformatted.js",
+    },
+  ],
+}
 `;
 
-exports[`output with --list-different + unformatted differs when piped (write) 2`] = `
-[
-  {
-    "content": "var x = 1;
+exports[`output with --list-different + unformatted differs when piped  2`] = `
+{
+  "stderr": "",
+  "stdout": "unformatted.js",
+  "write": [
+    {
+      "content": "var x = 1;
 ",
-    "filename": "unformatted.js",
-  },
-]
+      "filename": "unformatted.js",
+    },
+  ],
+}
 `;
diff --git a/tests/integration/__tests__/__snapshots__/plugin-options-string.js.snap b/tests/integration/__tests__/__snapshots__/plugin-options-string.js.snap
index ab661da8b..8d7b67977 100644
--- a/tests/integration/__tests__/__snapshots__/plugin-options-string.js.snap
+++ b/tests/integration/__tests__/__snapshots__/plugin-options-string.js.snap
@@ -1,17 +1,17 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`show detailed external option with \`--help foo-string\` (stderr) 1`] = `""`;
-
-exports[`show detailed external option with \`--help foo-string\` (stdout) 1`] = `
-"--foo-string <string>
+exports[`show detailed external option with \`--help foo-string\`  1`] = `
+{
+  "stderr": "",
+  "stdout": "--foo-string <string>
 
   foo description
 
-Default: bar"
+Default: bar",
+  "write": [],
+}
 `;
 
-exports[`show detailed external option with \`--help foo-string\` (write) 1`] = `[]`;
-
 exports[`show external options with \`--help\` 1`] = `
 "Snapshot Diff:
 - First value
diff --git a/tests/integration/__tests__/__snapshots__/plugin-options.js.snap b/tests/integration/__tests__/__snapshots__/plugin-options.js.snap
index 7fcf36735..dd11d788f 100644
--- a/tests/integration/__tests__/__snapshots__/plugin-options.js.snap
+++ b/tests/integration/__tests__/__snapshots__/plugin-options.js.snap
@@ -1,9 +1,9 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`include plugin's parsers to the values of the \`parser\` option\` (stderr) 1`] = `""`;
-
-exports[`include plugin's parsers to the values of the \`parser\` option\` (stdout) 1`] = `
-"--parser <flow|babel|babel-flow|babel-ts|typescript|acorn|espree|meriyah|css|less|scss|json|json5|jsonc|json-stringify|graphql|markdown|mdx|vue|yaml|glimmer|html|angular|lwc|mjml|foo-parser>
+exports[`include plugin's parsers to the values of the \`parser\` option\`  1`] = `
+{
+  "stderr": "",
+  "stdout": "--parser <flow|babel|babel-flow|babel-ts|typescript|acorn|espree|meriyah|css|less|scss|json|json5|jsonc|json-stringify|graphql|markdown|mdx|vue|yaml|glimmer|html|angular|lwc|mjml|foo-parser>
 
   Which parser to use.
 
@@ -34,15 +34,15 @@ Valid options:
   angular          Angular
   lwc              Lightning Web Components
   mjml             MJML
-  foo-parser       foo (plugin: ./plugin.cjs)"
+  foo-parser       foo (plugin: ./plugin.cjs)",
+  "write": [],
+}
 `;
 
-exports[`include plugin's parsers to the values of the \`parser\` option\` (write) 1`] = `[]`;
-
-exports[`show detailed external option with \`--help foo-option\` (stderr) 1`] = `""`;
-
-exports[`show detailed external option with \`--help foo-option\` (stdout) 1`] = `
-"--foo-option <bar|baz>
+exports[`show detailed external option with \`--help foo-option\`  1`] = `
+{
+  "stderr": "",
+  "stdout": "--foo-option <bar|baz>
 
   foo description
 
@@ -51,11 +51,11 @@ Valid options:
   bar   bar description
   baz   baz description
 
-Default: bar"
+Default: bar",
+  "write": [],
+}
 `;
 
-exports[`show detailed external option with \`--help foo-option\` (write) 1`] = `[]`;
-
 exports[`show external options with \`--help\` 1`] = `
 "Snapshot Diff:
 - First value
diff --git a/tests/integration/__tests__/__snapshots__/print-code.js.snap b/tests/integration/__tests__/__snapshots__/print-code.js.snap
index 2740292b5..c2f8e2d43 100644
--- a/tests/integration/__tests__/__snapshots__/print-code.js.snap
+++ b/tests/integration/__tests__/__snapshots__/print-code.js.snap
@@ -1,14 +1,18 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`Line breaking after filepath with errors (stdout) 1`] = `
-"ignored.js
-[[called readline.clearLine(process.stdout)]]
+exports[`Line breaking after filepath with errors  1`] = `
+{
+  "stdout": "ignored.js
+[[Clear text(process.stdout): ignored.js]]
 foo(
-)"
+)",
+}
 `;
 
-exports[`Line breaking after filepath with errors (stdout) 2`] = `
-"not-ignored.js
-[[called readline.clearLine(process.stdout)]]
-foo();"
+exports[`Line breaking after filepath with errors  2`] = `
+{
+  "stdout": "not-ignored.js
+[[Clear text(process.stdout): not-ignored.js]]
+foo();",
+}
 `;
diff --git a/tests/integration/__tests__/__snapshots__/schema.js.snap b/tests/integration/__tests__/__snapshots__/schema.js.snap
index a1b8700b6..ffc13de67 100644
--- a/tests/integration/__tests__/__snapshots__/schema.js.snap
+++ b/tests/integration/__tests__/__snapshots__/schema.js.snap
@@ -35,6 +35,11 @@ exports[`schema 1`] = `
           "description": "Print spaces between brackets.",
           "type": "boolean",
         },
+        "checkIgnorePragma": {
+          "default": false,
+          "description": "Check whether the file's first docblock comment contains '@noprettier' or '@noformat' to determine if it should be formatted.",
+          "type": "boolean",
+        },
         "cursorOffset": {
           "default": -1,
           "description": "Print (to stderr) where a cursor at the given position would move to after formatting.",
@@ -404,8 +409,7 @@ The range will extend backwards to the start of the first line containing the se
         },
         "requirePragma": {
           "default": false,
-          "description": "Require either '@prettier' or '@format' to be present in the file's first docblock comment
-in order for it to be formatted.",
+          "description": "Require either '@prettier' or '@format' to be present in the file's first docblock comment in order for it to be formatted.",
           "type": "boolean",
         },
         "semi": {
diff --git a/tests/integration/__tests__/__snapshots__/skip-folders.js.snap b/tests/integration/__tests__/__snapshots__/skip-folders.js.snap
index 9ffde8599..b386f801a 100644
--- a/tests/integration/__tests__/__snapshots__/skip-folders.js.snap
+++ b/tests/integration/__tests__/__snapshots__/skip-folders.js.snap
@@ -1,15 +1,17 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`skip folders passed specifically (stdout) 1`] = `
-"a/file.js
-b/file.js"
+exports[`skip folders passed specifically  1`] = `
+{
+  "stdout": "a/file.js
+b/file.js",
+  "write": [],
+}
 `;
 
-exports[`skip folders passed specifically (write) 1`] = `[]`;
-
-exports[`skips folders in glob (stdout) 1`] = `
-"a/file.js
-b/file.js"
+exports[`skips folders in glob  1`] = `
+{
+  "stdout": "a/file.js
+b/file.js",
+  "write": [],
+}
 `;
-
-exports[`skips folders in glob (write) 1`] = `[]`;
diff --git a/tests/integration/__tests__/__snapshots__/stdin-filepath.js.snap b/tests/integration/__tests__/__snapshots__/stdin-filepath.js.snap
index 0ef4e1161..c973fe43e 100644
--- a/tests/integration/__tests__/__snapshots__/stdin-filepath.js.snap
+++ b/tests/integration/__tests__/__snapshots__/stdin-filepath.js.snap
@@ -1,85 +1,88 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`apply editorconfig for stdin-filepath with a deep path (stderr) 1`] = `""`;
-
-exports[`apply editorconfig for stdin-filepath with a deep path (stderr) 2`] = `""`;
-
-exports[`apply editorconfig for stdin-filepath with a deep path (stdout) 1`] = `
-"function f() {
+exports[`apply editorconfig for stdin-filepath with a deep path  1`] = `
+{
+  "stderr": "",
+  "stdout": "function f() {
 	console.log("should be indented with a tab")
-}"
+}",
+  "write": [],
+}
 `;
 
-exports[`apply editorconfig for stdin-filepath with a deep path (stdout) 2`] = `
-"function f() {
+exports[`apply editorconfig for stdin-filepath with a deep path  2`] = `
+{
+  "stderr": "",
+  "stdout": "function f() {
 	console.log("should be indented with a tab")
-}"
+}",
+  "write": [],
+}
 `;
 
-exports[`apply editorconfig for stdin-filepath with a deep path (write) 1`] = `[]`;
-
-exports[`apply editorconfig for stdin-filepath with a deep path (write) 2`] = `[]`;
-
-exports[`apply editorconfig for stdin-filepath with nonexistent directory (stderr) 1`] = `""`;
-
-exports[`apply editorconfig for stdin-filepath with nonexistent directory (stdout) 1`] = `
-"function f() {
+exports[`apply editorconfig for stdin-filepath with nonexistent directory  1`] = `
+{
+  "stderr": "",
+  "stdout": "function f() {
 	console.log("should be indented with a tab")
-}"
+}",
+  "write": [],
+}
 `;
 
-exports[`apply editorconfig for stdin-filepath with nonexistent directory (write) 1`] = `[]`;
-
-exports[`apply editorconfig for stdin-filepath with nonexistent file (stderr) 1`] = `""`;
-
-exports[`apply editorconfig for stdin-filepath with nonexistent file (stdout) 1`] = `
-"function f() {
+exports[`apply editorconfig for stdin-filepath with nonexistent file  1`] = `
+{
+  "stderr": "",
+  "stdout": "function f() {
 	console.log("should be indented with a tab")
-}"
+}",
+  "write": [],
+}
 `;
 
-exports[`apply editorconfig for stdin-filepath with nonexistent file (write) 1`] = `[]`;
-
-exports[`don’t apply editorconfig outside project for stdin-filepath with nonexistent directory (stderr) 1`] = `""`;
-
-exports[`don’t apply editorconfig outside project for stdin-filepath with nonexistent directory (stdout) 1`] = `
-"function f() {
+exports[`don’t apply editorconfig outside project for stdin-filepath with nonexistent directory  1`] = `
+{
+  "stderr": "",
+  "stdout": "function f() {
   console.log("should be indented with 2 spaces")
-}"
+}",
+  "write": [],
+}
 `;
 
-exports[`don’t apply editorconfig outside project for stdin-filepath with nonexistent directory (write) 1`] = `[]`;
-
-exports[`format correctly if stdin content compatible with stdin-filepath (stderr) 1`] = `""`;
-
-exports[`format correctly if stdin content compatible with stdin-filepath (stdout) 1`] = `
-".name {
+exports[`format correctly if stdin content compatible with stdin-filepath  1`] = `
+{
+  "stderr": "",
+  "stdout": ".name {
   display: none;
-}"
+}",
+  "write": [],
+}
 `;
 
-exports[`format correctly if stdin content compatible with stdin-filepath (write) 1`] = `[]`;
-
-exports[`gracefully handle stdin-filepath with nonexistent directory (stderr) 1`] = `""`;
-
-exports[`gracefully handle stdin-filepath with nonexistent directory (stdout) 1`] = `
-".name {
+exports[`gracefully handle stdin-filepath with nonexistent directory  1`] = `
+{
+  "stderr": "",
+  "stdout": ".name {
   display: none;
-}"
+}",
+  "write": [],
+}
 `;
 
-exports[`gracefully handle stdin-filepath with nonexistent directory (write) 1`] = `[]`;
-
-exports[`output file as-is if stdin-filepath matched patterns in ignore-path (stderr) 1`] = `""`;
-
-exports[`output file as-is if stdin-filepath matched patterns in ignore-path (write) 1`] = `[]`;
+exports[`output file as-is if stdin-filepath matched patterns in ignore-path  1`] = `
+{
+  "stderr": "",
+  "write": [],
+}
+`;
 
-exports[`throw error if stdin content incompatible with stdin-filepath (stderr) 1`] = `
-"[error] abc.js: SyntaxError: Unexpected token (1:1)
+exports[`throw error if stdin content incompatible with stdin-filepath  1`] = `
+{
+  "stderr": "[error] abc.js: SyntaxError: Unexpected token (1:1)
 [error] > 1 | .name { display: none; }
-[error]     | ^"
+[error]     | ^",
+  "stdout": "",
+  "write": [],
+}
 `;
-
-exports[`throw error if stdin content incompatible with stdin-filepath (stdout) 1`] = `""`;
-
-exports[`throw error if stdin content incompatible with stdin-filepath (write) 1`] = `[]`;
diff --git a/tests/integration/__tests__/__snapshots__/support-info.js.snap b/tests/integration/__tests__/__snapshots__/support-info.js.snap
index 3b27103b4..1f829af67 100644
--- a/tests/integration/__tests__/__snapshots__/support-info.js.snap
+++ b/tests/integration/__tests__/__snapshots__/support-info.js.snap
@@ -106,6 +106,10 @@ exports[`API getSupportInfo() 1`] = `
       "default": true,
       "type": "boolean",
     },
+    "checkIgnorePragma": {
+      "default": false,
+      "type": "boolean",
+    },
     "cursorOffset": {
       "default": -1,
       "range": {
@@ -300,10 +304,10 @@ exports[`API getSupportInfo() 1`] = `
 }
 `;
 
-exports[`CLI --support-info (stderr) 1`] = `""`;
-
-exports[`CLI --support-info (stdout) 1`] = `
-"{
+exports[`CLI --support-info  1`] = `
+{
+  "stderr": "",
+  "stdout": "{
   "languages": [
     {
       "aceMode": "html",
@@ -843,6 +847,14 @@ exports[`CLI --support-info (stdout) 1`] = `
       "pluginDefaults": {},
       "type": "boolean"
     },
+    {
+      "category": "Special",
+      "default": false,
+      "description": "Check whether the file's first docblock comment contains '@noprettier' or '@noformat' to determine if it should be formatted.",
+      "name": "checkIgnorePragma",
+      "pluginDefaults": {},
+      "type": "boolean"
+    },
     {
       "category": "Special",
       "default": -1,
@@ -1097,7 +1109,7 @@ exports[`CLI --support-info (stdout) 1`] = `
     {
       "category": "Special",
       "default": false,
-      "description": "Require either '@prettier' or '@format' to be present in the file's first docblock comment\\nin order for it to be formatted.",
+      "description": "Require either '@prettier' or '@format' to be present in the file's first docblock comment in order for it to be formatted.",
       "name": "requirePragma",
       "pluginDefaults": {},
       "type": "boolean"
@@ -1172,7 +1184,7 @@ exports[`CLI --support-info (stdout) 1`] = `
       "type": "boolean"
     }
   ]
-}"
+}",
+  "write": [],
+}
 `;
-
-exports[`CLI --support-info (write) 1`] = `[]`;
diff --git a/tests/integration/__tests__/__snapshots__/syntax-error.js.snap b/tests/integration/__tests__/__snapshots__/syntax-error.js.snap
index a2ff88d88..6296e8fbe 100644
--- a/tests/integration/__tests__/__snapshots__/syntax-error.js.snap
+++ b/tests/integration/__tests__/__snapshots__/syntax-error.js.snap
@@ -1,11 +1,11 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`exits with non-zero code when input has a syntax error (stderr) 1`] = `
-"[error] stdin: SyntaxError: Missing semicolon. (1:2)
+exports[`exits with non-zero code when input has a syntax error  1`] = `
+{
+  "stderr": "[error] stdin: SyntaxError: Missing semicolon. (1:2)
 [error] > 1 | a.2
-[error]     |  ^"
+[error]     |  ^",
+  "stdout": "",
+  "write": [],
+}
 `;
-
-exports[`exits with non-zero code when input has a syntax error (stdout) 1`] = `""`;
-
-exports[`exits with non-zero code when input has a syntax error (write) 1`] = `[]`;
diff --git a/tests/integration/__tests__/__snapshots__/with-config-precedence.js.snap b/tests/integration/__tests__/__snapshots__/with-config-precedence.js.snap
index 7a3cc13ed..53dcae0d9 100644
--- a/tests/integration/__tests__/__snapshots__/with-config-precedence.js.snap
+++ b/tests/integration/__tests__/__snapshots__/with-config-precedence.js.snap
@@ -1,63 +1,78 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`CLI --stdin-filepath works with --config-precedence cli-override (stdout) 1`] = `"let x: keyof Y = foo<typeof X>()"`;
-
-exports[`CLI --stdin-filepath works with --config-precedence cli-override (write) 1`] = `[]`;
-
-exports[`CLI --stdin-filepath works with --config-precedence file-override (stdout) 1`] = `"let x: keyof Y = foo<typeof X>();"`;
-
-exports[`CLI --stdin-filepath works with --config-precedence file-override (write) 1`] = `[]`;
-
-exports[`CLI --stdin-filepath works with --config-precedence prefer-file (stdout) 1`] = `"let x: keyof Y = foo<typeof X>();"`;
+exports[`CLI --stdin-filepath works with --config-precedence cli-override  1`] = `
+{
+  "stdout": "let x: keyof Y = foo<typeof X>()",
+  "write": [],
+}
+`;
 
-exports[`CLI --stdin-filepath works with --config-precedence prefer-file (write) 1`] = `[]`;
+exports[`CLI --stdin-filepath works with --config-precedence file-override  1`] = `
+{
+  "stdout": "let x: keyof Y = foo<typeof X>();",
+  "write": [],
+}
+`;
 
-exports[`CLI overrides are still applied when no config is found with --config-precedence file-override (stderr) 1`] = `""`;
+exports[`CLI --stdin-filepath works with --config-precedence prefer-file  1`] = `
+{
+  "stdout": "let x: keyof Y = foo<typeof X>();",
+  "write": [],
+}
+`;
 
-exports[`CLI overrides are still applied when no config is found with --config-precedence file-override (stdout) 1`] = `
-"function noConfigJs() {
+exports[`CLI overrides are still applied when no config is found with --config-precedence file-override  1`] = `
+{
+  "stderr": "",
+  "stdout": "function noConfigJs() {
       console.log("no-config/file.js should have no semicolons")
-}"
+}",
+  "write": [],
+}
 `;
 
-exports[`CLI overrides are still applied when no config is found with --config-precedence file-override (write) 1`] = `[]`;
-
-exports[`CLI overrides gets applied when no config exists with --config-precedence prefer-file (stderr) 1`] = `""`;
-
-exports[`CLI overrides gets applied when no config exists with --config-precedence prefer-file (stdout) 1`] = `
-"function noConfigJs() {
+exports[`CLI overrides gets applied when no config exists with --config-precedence prefer-file  1`] = `
+{
+  "stderr": "",
+  "stdout": "function noConfigJs() {
        console.log(
               "no-config/file.js should have no semicolons",
        );
-}"
+}",
+  "write": [],
+}
 `;
 
-exports[`CLI overrides gets applied when no config exists with --config-precedence prefer-file (write) 1`] = `[]`;
-
-exports[`CLI overrides gets ignored when config exists with --config-precedence prefer-file (stderr) 1`] = `""`;
-
-exports[`CLI overrides gets ignored when config exists with --config-precedence prefer-file (stdout) 1`] = `
-"function js() {
+exports[`CLI overrides gets ignored when config exists with --config-precedence prefer-file  1`] = `
+{
+  "stderr": "",
+  "stdout": "function js() {
         console.log("js/file.js should have tab width 8 (1 if CLI)");
-}"
+}",
+  "write": [],
+}
 `;
 
-exports[`CLI overrides gets ignored when config exists with --config-precedence prefer-file (write) 1`] = `[]`;
-
-exports[`CLI validate options with --config-precedence cli-override (stderr) 1`] = `"[error] Invalid printWidth value. Expected an integer, but received 0.5."`;
-
-exports[`CLI validate options with --config-precedence cli-override (stdout) 1`] = `""`;
-
-exports[`CLI validate options with --config-precedence cli-override (write) 1`] = `[]`;
-
-exports[`CLI validate options with --config-precedence file-override (stderr) 1`] = `"[error] Invalid printWidth value. Expected an integer, but received 0.5."`;
-
-exports[`CLI validate options with --config-precedence file-override (stdout) 1`] = `""`;
-
-exports[`CLI validate options with --config-precedence file-override (write) 1`] = `[]`;
-
-exports[`CLI validate options with --config-precedence prefer-file (stderr) 1`] = `"[error] Invalid printWidth value. Expected an integer, but received 0.5."`;
+exports[`CLI validate options with --config-precedence cli-override  1`] = `
+{
+  "stderr": "[error] Invalid printWidth value. Expected an integer, but received 0.5.",
+  "stdout": "",
+  "write": [],
+}
+`;
 
-exports[`CLI validate options with --config-precedence prefer-file (stdout) 1`] = `""`;
+exports[`CLI validate options with --config-precedence file-override  1`] = `
+{
+  "stderr": "[error] Invalid printWidth value. Expected an integer, but received 0.5.",
+  "stdout": "",
+  "write": [],
+}
+`;
 
-exports[`CLI validate options with --config-precedence prefer-file (write) 1`] = `[]`;
+exports[`CLI validate options with --config-precedence prefer-file  1`] = `
+{
+  "stderr": "[error] Invalid printWidth value. Expected an integer, but received 0.5.",
+  "stdout": "",
+  "write": [],
+}
+`;
diff --git a/tests/integration/__tests__/__snapshots__/with-node-modules.js.snap b/tests/integration/__tests__/__snapshots__/with-node-modules.js.snap
index ee53f965c..5e8abe0dd 100644
--- a/tests/integration/__tests__/__snapshots__/with-node-modules.js.snap
+++ b/tests/integration/__tests__/__snapshots__/with-node-modules.js.snap
@@ -1,50 +1,50 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`doesn't ignore node_modules with --with-node-modules flag (stderr) 1`] = `""`;
-
-exports[`doesn't ignore node_modules with --with-node-modules flag (stdout) 1`] = `
-"nested/node_modules/node-module.js
+exports[`doesn't ignore node_modules with --with-node-modules flag  1`] = `
+{
+  "stderr": "",
+  "stdout": "nested/node_modules/node-module.js
 node_modules/node-module.js
 not_node_modules/file.js
-regular-module.js"
+regular-module.js",
+  "write": [],
+}
 `;
 
-exports[`doesn't ignore node_modules with --with-node-modules flag (write) 1`] = `[]`;
-
-exports[`doesn't ignore node_modules with --with-node-modules flag for file list (stderr) 1`] = `""`;
-
-exports[`doesn't ignore node_modules with --with-node-modules flag for file list (stdout) 1`] = `
-"node_modules/node-module.js
+exports[`doesn't ignore node_modules with --with-node-modules flag for file list  1`] = `
+{
+  "stderr": "",
+  "stdout": "node_modules/node-module.js
 not_node_modules/file.js
 nested/node_modules/node-module.js
-regular-module.js"
+regular-module.js",
+  "write": [],
+}
 `;
 
-exports[`doesn't ignore node_modules with --with-node-modules flag for file list (write) 1`] = `[]`;
-
-exports[`ignores node_modules by default (stderr) 1`] = `""`;
-
-exports[`ignores node_modules by default (stdout) 1`] = `
-"not_node_modules/file.js
-regular-module.js"
+exports[`ignores node_modules by default  1`] = `
+{
+  "stderr": "",
+  "stdout": "not_node_modules/file.js
+regular-module.js",
+  "write": [],
+}
 `;
 
-exports[`ignores node_modules by default (write) 1`] = `[]`;
-
-exports[`ignores node_modules by default for file list (stderr) 1`] = `""`;
-
-exports[`ignores node_modules by default for file list (stdout) 1`] = `
-"not_node_modules/file.js
-regular-module.js"
+exports[`ignores node_modules by default for file list  1`] = `
+{
+  "stderr": "",
+  "stdout": "not_node_modules/file.js
+regular-module.js",
+  "write": [],
+}
 `;
 
-exports[`ignores node_modules by default for file list (write) 1`] = `[]`;
-
-exports[`ignores node_modules by with ./**/*.js (stderr) 1`] = `""`;
-
-exports[`ignores node_modules by with ./**/*.js (stdout) 1`] = `
-"not_node_modules/file.js
-regular-module.js"
+exports[`ignores node_modules by with ./**/*.js  1`] = `
+{
+  "stderr": "",
+  "stdout": "not_node_modules/file.js
+regular-module.js",
+  "write": [],
+}
 `;
-
-exports[`ignores node_modules by with ./**/*.js (write) 1`] = `[]`;
diff --git a/tests/integration/__tests__/__snapshots__/with-parser-inference.js.snap b/tests/integration/__tests__/__snapshots__/with-parser-inference.js.snap
index 10abdc79d..5a32a72f0 100644
--- a/tests/integration/__tests__/__snapshots__/with-parser-inference.js.snap
+++ b/tests/integration/__tests__/__snapshots__/with-parser-inference.js.snap
@@ -1,29 +1,31 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`infers postcss parser (stderr) 1`] = `""`;
-
-exports[`infers postcss parser (stdout) 1`] = `
-"/* JavaScript */
+exports[`infers postcss parser  1`] = `
+{
+  "stderr": "",
+  "stdout": "/* JavaScript */
 "use strict";
 /* Stylesheet */
 * {
   outline: none;
-}"
+}",
+  "write": [],
+}
 `;
 
-exports[`infers postcss parser (write) 1`] = `[]`;
-
-exports[`infers postcss parser with --check (stderr) 1`] = `""`;
-
-exports[`infers postcss parser with --check (stdout) 1`] = `
-"Checking formatting...
-All matched files use Prettier code style!"
+exports[`infers postcss parser with --check  1`] = `
+{
+  "stderr": "",
+  "stdout": "Checking formatting...
+All matched files use Prettier code style!",
+  "write": [],
+}
 `;
 
-exports[`infers postcss parser with --check (write) 1`] = `[]`;
-
-exports[`infers postcss parser with --list-different (stderr) 1`] = `""`;
-
-exports[`infers postcss parser with --list-different (stdout) 1`] = `""`;
-
-exports[`infers postcss parser with --list-different (write) 1`] = `[]`;
+exports[`infers postcss parser with --list-different  1`] = `
+{
+  "stderr": "",
+  "stdout": "",
+  "write": [],
+}
+`;
diff --git a/tests/integration/__tests__/__snapshots__/with-shebang.js.snap b/tests/integration/__tests__/__snapshots__/with-shebang.js.snap
index cd5382c89..4f57f17a6 100644
--- a/tests/integration/__tests__/__snapshots__/with-shebang.js.snap
+++ b/tests/integration/__tests__/__snapshots__/with-shebang.js.snap
@@ -1,10 +1,10 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`preserves shebang (stderr) 1`] = `""`;
-
-exports[`preserves shebang (stdout) 1`] = `
-"#!/usr/bin/env node
-"use strict";"
+exports[`preserves shebang  1`] = `
+{
+  "stderr": "",
+  "stdout": "#!/usr/bin/env node
+"use strict";",
+  "write": [],
+}
 `;
-
-exports[`preserves shebang (write) 1`] = `[]`;
diff --git a/tests/integration/__tests__/__snapshots__/write.js.snap b/tests/integration/__tests__/__snapshots__/write.js.snap
index 15a6f0caa..ddeed125f 100644
--- a/tests/integration/__tests__/__snapshots__/write.js.snap
+++ b/tests/integration/__tests__/__snapshots__/write.js.snap
@@ -1,41 +1,45 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
-exports[`do not write file with --write + formatted file (stderr) 1`] = `""`;
-
-exports[`do not write file with --write + formatted file (stdout) 1`] = `"formatted.js 0ms (unchanged)"`;
+exports[`do not write file with --write + formatted file  1`] = `
+{
+  "stderr": "",
+  "stdout": "formatted.js 0ms (unchanged)",
+}
+`;
 
-exports[`do not write file with --write + invalid file (stderr) 1`] = `
-"[error] invalid.js: SyntaxError: Unexpected token (1:17)
+exports[`do not write file with --write + invalid file  1`] = `
+{
+  "stderr": "[error] invalid.js: SyntaxError: Unexpected token (1:17)
 [error] > 1 | this is invalid!
-[error]     |                 ^"
+[error]     |                 ^",
+  "stdout": "",
+}
 `;
 
-exports[`do not write file with --write + invalid file (stdout) 1`] = `""`;
-
-exports[`write file with --write + unformatted file (stderr) 1`] = `""`;
-
-exports[`write file with --write + unformatted file (stdout) 1`] = `"unformatted.js 0ms"`;
-
-exports[`write file with --write + unformatted file (write) 1`] = `
-[
-  {
-    "content": "var x = 1;
+exports[`write file with --write + unformatted file  1`] = `
+{
+  "stderr": "",
+  "stdout": "unformatted.js 0ms",
+  "write": [
+    {
+      "content": "var x = 1;
 ",
-    "filename": "unformatted.js",
-  },
-]
+      "filename": "unformatted.js",
+    },
+  ],
+}
 `;
 
-exports[`write file with -w + unformatted file (stderr) 1`] = `""`;
-
-exports[`write file with -w + unformatted file (stdout) 1`] = `"unformatted.js 0ms"`;
-
-exports[`write file with -w + unformatted file (write) 1`] = `
-[
-  {
-    "content": "var x = 1;
+exports[`write file with -w + unformatted file  1`] = `
+{
+  "stderr": "",
+  "stdout": "unformatted.js 0ms",
+  "write": [
+    {
+      "content": "var x = 1;
 ",
-    "filename": "unformatted.js",
-  },
-]
+      "filename": "unformatted.js",
+    },
+  ],
+}
 `;
diff --git a/tests/integration/__tests__/cli.js b/tests/integration/__tests__/cli.js
index c60790b54..3f442e738 100644
--- a/tests/integration/__tests__/cli.js
+++ b/tests/integration/__tests__/cli.js
@@ -1,8 +1,10 @@
 import fs from "node:fs";
-import { prettierCli } from "../env.js";
+import { prettierCliEntry } from "../env.js";
 
 describe("CLI", () => {
   test("CLI should be executable.", () => {
-    expect(() => fs.accessSync(prettierCli, fs.constants.X_OK)).not.toThrow();
+    expect(() =>
+      fs.accessSync(prettierCliEntry, fs.constants.X_OK),
+    ).not.toThrow();
   });
 });
diff --git a/tests/integration/__tests__/config-file-typescript.js b/tests/integration/__tests__/config-file-typescript.js
index 585ea19ac..d1962f3ae 100644
--- a/tests/integration/__tests__/config-file-typescript.js
+++ b/tests/integration/__tests__/config-file-typescript.js
@@ -59,12 +59,10 @@ if (NODE_JS_MAJOR_VERSION >= 22) {
 }
 
 if (NODE_JS_MAJOR_VERSION === 22) {
-  test("Should throw errors when flags are missing", async () => {
-    await runCli(
-      "cli/config/ts/auto-discovery/",
-      ["--stdin-filepath", "foo.js"],
-      { input: code },
-    ).test({
+  test("Should throw errors when flags are missing", () => {
+    runCli("cli/config/ts/auto-discovery/", ["--stdin-filepath", "foo.js"], {
+      input: code,
+    }).test({
       status: "non-zero",
       stdout: "",
       write: [],
@@ -74,26 +72,24 @@ if (NODE_JS_MAJOR_VERSION === 22) {
 }
 
 if (NODE_JS_MAJOR_VERSION < 22) {
-  test("Should throw errors when Node.js < 22", async () => {
-    await runCli(
-      "cli/config/ts/auto-discovery/",
-      ["--stdin-filepath", "foo.js"],
-      { input: code },
-    ).test({
+  test("Should throw errors when Node.js < 22", () => {
+    runCli("cli/config/ts/auto-discovery/", ["--stdin-filepath", "foo.js"], {
+      input: code,
+    }).test({
       status: "non-zero",
       stdout: "",
       write: [],
       stderr: expect.stringMatching(/Unknown file extension ".ts" for/u),
     });
 
-    // https://github.com/nodejs/node/issues/41103
-    await expect(() =>
-      runCli("cli/config/ts/auto-discovery/", ["--stdin-filepath", "foo.js"], {
-        input: code,
-        nodeOptions: NODE_TS_SUPPORT_FLAGS,
-      }),
-    ).rejects.toThrow(
-      /Initiated Worker with invalid execArgv flags: --experimental-strip-types/u,
-    );
+    runCli("cli/config/ts/auto-discovery/", ["--stdin-filepath", "foo.js"], {
+      input: code,
+      nodeOptions: NODE_TS_SUPPORT_FLAGS,
+    }).test({
+      status: "non-zero",
+      stdout: "",
+      write: [],
+      stderr: expect.stringMatching(/bad option: --experimental-strip-types/u),
+    });
   });
 }
diff --git a/tests/integration/__tests__/mockable.js b/tests/integration/__tests__/mockable.js
index 68b5f53ea..c4e34e484 100644
--- a/tests/integration/__tests__/mockable.js
+++ b/tests/integration/__tests__/mockable.js
@@ -1,7 +1,12 @@
-import prettier from "../../config/prettier-entry.js";
+import url from "node:url";
+import { prettierCliMockableEntry } from "../env.js";
 
-const { mockable } = prettier.__debug;
+async function getCliMockable() {
+  const cli = await import(url.pathToFileURL(prettierCliMockableEntry));
+  return cli.mockable;
+}
 
-test("isCI", () => {
-  expect(typeof mockable.isCI()).toBe("boolean");
+test("isCI", async () => {
+  const mockable = await getCliMockable();
+  expect(typeof mockable.implementations.isCI()).toBe("boolean");
 });
diff --git a/tests/integration/__tests__/patterns-dirs.js b/tests/integration/__tests__/patterns-dirs.js
index 2a31ef1f1..95da23000 100644
--- a/tests/integration/__tests__/patterns-dirs.js
+++ b/tests/integration/__tests__/patterns-dirs.js
@@ -129,41 +129,61 @@ describe("plugins `*`", () => {
 if (path.sep === "/") {
   // Don't use snapshots in these tests as they're conditionally executed on non-Windows only.
 
-  const base = path.resolve(__dirname, "../cli/patterns-dirs");
+  const base = path.resolve(__dirname, "../cli/patterns-backslashes");
+  const directoryA = path.join(base, "test-a\\");
+  const directoryB = path.join(base, String.raw`test-b\?`);
 
-  describe("Backslashes in names", () => {
-    // We can't commit these dirs without causing problems on Windows.
-
-    beforeAll(() => {
-      fs.mkdirSync(path.resolve(base, "test-a\\"));
-      fs.writeFileSync(path.resolve(base, "test-a\\", "test.js"), "x");
-      fs.mkdirSync(path.resolve(base, String.raw`test-b\?`));
-      fs.writeFileSync(
-        path.resolve(base, String.raw`test-b\?`, "test.js"),
-        "x",
-      );
-    });
-
-    afterAll(() => {
-      fs.unlinkSync(path.resolve(base, "test-a\\", "test.js"));
-      fs.rmdirSync(path.resolve(base, "test-a\\"));
-      fs.unlinkSync(path.resolve(base, String.raw`test-b\?`, "test.js"));
-      fs.rmdirSync(path.resolve(base, String.raw`test-b\?`));
-    });
+  fs.rmSync(directoryA, { force: true, recursive: true });
+  fs.rmSync(directoryB, { force: true, recursive: true });
+  for (const directory of [directoryA, directoryB]) {
+    fs.mkdirSync(directory);
+    fs.writeFileSync(path.join(directory, "test.js"), "x");
+  }
 
-    testPatterns("", [String.raw`test-a\/test.js`], {
-      stdout: String.raw`test-a\/test.js`,
-    });
-    testPatterns("", ["test-a\\"], { stdout: String.raw`test-a\/test.js` });
-    testPatterns("", ["test-a*/*"], { stdout: String.raw`test-a\/test.js` });
+  describe("Backslashes in names", () => {
+    testPatterns(
+      "",
+      [String.raw`test-a\/test.js`],
+      {
+        stdout: String.raw`test-a\/test.js`,
+      },
+      base,
+    );
+    testPatterns(
+      "",
+      ["test-a\\"],
+      { stdout: String.raw`test-a\/test.js` },
+      base,
+    );
+    testPatterns(
+      "",
+      ["test-a*/*"],
+      { stdout: String.raw`test-a\/test.js` },
+      base,
+    );
 
-    testPatterns("", [String.raw`test-b\?/test.js`], {
-      stdout: String.raw`test-b\?/test.js`,
-    });
-    testPatterns("", [String.raw`test-b\?`], {
-      stdout: String.raw`test-b\?/test.js`,
-    });
-    testPatterns("", ["test-b*/*"], { stdout: String.raw`test-b\?/test.js` });
+    testPatterns(
+      "",
+      [String.raw`test-b\?/test.js`],
+      {
+        stdout: String.raw`test-b\?/test.js`,
+      },
+      base,
+    );
+    testPatterns(
+      "",
+      [String.raw`test-b\?`],
+      {
+        stdout: String.raw`test-b\?/test.js`,
+      },
+      base,
+    );
+    testPatterns(
+      "",
+      ["test-b*/*"],
+      { stdout: String.raw`test-b\?/test.js` },
+      base,
+    );
   });
 }
 
@@ -191,28 +211,23 @@ function isSymlinkSupported() {
   const base = path.join(__dirname, "../cli/patterns-symlinks");
   const directoryA = path.join(base, "test-a");
   const directoryB = path.join(base, "test-b");
-  const clean = () => {
-    fs.rmSync(directoryA, { force: true, recursive: true });
-    fs.rmSync(directoryB, { force: true, recursive: true });
-  };
-  beforeAll(() => {
-    clean();
-    fs.mkdirSync(directoryA);
-    fs.mkdirSync(directoryB);
-    fs.writeFileSync(path.join(directoryA, "a.js"), "x");
-    fs.writeFileSync(path.join(directoryB, "b.js"), "x");
-    fs.symlinkSync(directoryA, path.join(directoryA, "symlink-to-directory-a"));
-    fs.symlinkSync(directoryB, path.join(directoryA, "symlink-to-directory-b"));
-    fs.symlinkSync(
-      path.join(directoryA, "a.js"),
-      path.join(directoryA, "symlink-to-file-a"),
-    );
-    fs.symlinkSync(
-      path.join(directoryB, "b.js"),
-      path.join(directoryA, "symlink-to-file-b"),
-    );
-  });
-  afterAll(clean);
+
+  fs.rmSync(directoryA, { force: true, recursive: true });
+  fs.rmSync(directoryB, { force: true, recursive: true });
+  fs.mkdirSync(directoryA);
+  fs.mkdirSync(directoryB);
+  fs.writeFileSync(path.join(directoryA, "a.js"), "x");
+  fs.writeFileSync(path.join(directoryB, "b.js"), "x");
+  fs.symlinkSync(directoryA, path.join(directoryA, "symlink-to-directory-a"));
+  fs.symlinkSync(directoryB, path.join(directoryA, "symlink-to-directory-b"));
+  fs.symlinkSync(
+    path.join(directoryA, "a.js"),
+    path.join(directoryA, "symlink-to-file-a"),
+  );
+  fs.symlinkSync(
+    path.join(directoryB, "b.js"),
+    path.join(directoryA, "symlink-to-file-b"),
+  );
 
   test("file struct", async () => {
     const getFileStruct = async (directory) =>
diff --git a/tests/integration/cli-worker.js b/tests/integration/cli-worker.js
index 79d7cff75..a70c802bb 100644
--- a/tests/integration/cli-worker.js
+++ b/tests/integration/cli-worker.js
@@ -1,9 +1,10 @@
-import fs from "node:fs";
 import path from "node:path";
-import readline from "node:readline";
 import url from "node:url";
-import { parentPort, workerData } from "node:worker_threads";
-import { prettierCli, prettierMainEntry } from "./env.js";
+import {
+  prettierCliEntry,
+  prettierCliMockableEntry,
+  prettierMainEntry,
+} from "./env.js";
 
 const normalizeToPosix =
   path.sep === "\\"
@@ -19,90 +20,96 @@ const replaceAll = (text, find, replacement) =>
     ? text.replaceAll(find, replacement)
     : text.split(find).join(replacement);
 
-async function run() {
-  const { options } = workerData;
-
-  Date.now = () => 0;
+async function getApiMockable() {
+  const prettier = await import(url.pathToFileURL(prettierMainEntry));
+  return prettier.__debug.mockable;
+}
 
-  /*
-    A fake non-existing directory to test plugin search won't crash.
+async function getCliMockable() {
+  const cli = await import(url.pathToFileURL(prettierCliMockableEntry));
+  return cli.mockable;
+}
 
-    See:
-    - `isDirectory` function in `src/common/load-plugins.js`
-    - Test file `./__tests__/plugin-virtual-directory.js`
-    - Pull request #5819
-  */
-  const originalStat = fs.promises.stat;
-  fs.promises.statSync = (filename) =>
-    originalStat(
-      path.basename(filename) === "virtualDirectory"
-        ? import.meta.url
-        : filename,
-    );
+async function mockImplementations(options) {
+  const [apiMockable, cliMockable] = await Promise.all([
+    getApiMockable(),
+    getCliMockable(),
+  ]);
 
-  readline.clearLine = (stream) => {
-    stream.write(
-      `\n[[called readline.clearLine(${
+  cliMockable.mockImplementations({
+    clearStreamText(stream, text) {
+      const streamName =
         stream === process.stdout
           ? "process.stdout"
           : stream === process.stderr
             ? "process.stderr"
-            : "unknown stream"
-      })]]\n`,
-    );
-  };
-
-  process.stdin.isTTY = Boolean(options.isTTY);
-  process.stdout.isTTY = Boolean(options.stdoutIsTTY);
-
-  const prettier = await import(url.pathToFileURL(prettierMainEntry));
-  const { mockable } = prettier.__debug;
+            : "unknown stream";
+      stream.write(`\n[[Clear text(${streamName}): ${text}]]\n`);
+    },
+    // Time measure in format test
+    getTimestamp: () => 0,
+    isCI: () => Boolean(options.ci),
+    isStreamTTY: (stream) =>
+      stream === process.stdin
+        ? Boolean(options.isTTY)
+        : stream === process.stdout
+          ? Boolean(options.stdoutIsTTY)
+          : stream.isTTY,
+    // eslint-disable-next-line require-await
+    async writeFormattedFile(filename, content) {
+      filename = normalizeToPosix(path.relative(process.cwd(), filename));
+      if (
+        options.mockWriteFileErrors &&
+        hasOwn(options.mockWriteFileErrors, filename)
+      ) {
+        throw new Error(
+          options.mockWriteFileErrors[filename] + " (mocked error)",
+        );
+      }
+      process.send({
+        type: "cli:write-file",
+        data: { filename, content },
+      });
+    },
+  });
 
-  // We cannot use `jest.setMock("get-stream", impl)` here, because in the
-  // production build everything is bundled into one file so there is no
-  // "get-stream" module to mock.
-  // eslint-disable-next-line require-await
-  mockable.getStdin = async () => options.input || "";
-  mockable.isCI = () => Boolean(options.ci);
-  mockable.getPrettierConfigSearchStopDirectory = () =>
-    url.fileURLToPath(new URL("./cli", import.meta.url));
-  // eslint-disable-next-line require-await
-  mockable.writeFormattedFile = async (filename, content) => {
-    filename = normalizeToPosix(path.relative(process.cwd(), filename));
-    if (
-      options.mockWriteFileErrors &&
-      hasOwn(options.mockWriteFileErrors, filename)
-    ) {
-      throw new Error(
-        options.mockWriteFileErrors[filename] + " (mocked error)",
-      );
-    }
+  apiMockable.mockImplementations({
+    getPrettierConfigSearchStopDirectory: () =>
+      url.fileURLToPath(new URL("./cli", import.meta.url)),
+  });
+}
 
-    parentPort.postMessage({
-      action: "write-file",
-      data: { filename, content },
-    });
-  };
+async function run(options) {
+  await mockImplementations(options);
 
-  const { __promise: promise } = await import(url.pathToFileURL(prettierCli));
+  const { __promise: promise } = await import(
+    url.pathToFileURL(prettierCliEntry)
+  );
   await promise;
 }
 
-parentPort.on("message", async () => {
-  const originalExit = process.exit;
-
-  // https://github.com/nodejs/node/issues/30491
-  process.stdout.cork();
-  process.stderr.cork();
-  process.exit = (code) => {
-    process.stdout.end();
-    process.stderr.end();
-    originalExit(code ?? process.exitCode ?? 0);
-  };
-
+process.once("message", async (data) => {
   try {
-    await run();
+    await run(data);
+  } catch (error) {
+    // For easier debugging
+    // eslint-disable-next-line no-console
+    console.error(error);
+    process.send({ type: "worker:fault", error });
+    throw error;
   } finally {
+    // On MacOS, if we exit too quick the stdio won't received on main thread
+    if (process.platform === "darwin") {
+      await Promise.all(
+        ["stdout", "stderr"].map(
+          (stream) =>
+            new Promise((resolve) => {
+              process[stream].once("finish", resolve);
+              process[stream].end();
+            }),
+        ),
+      );
+    }
     process.exit();
   }
 });
diff --git a/tests/integration/cli/patterns-backslashes/.gitignore b/tests/integration/cli/patterns-backslashes/.gitignore
new file mode 100644
index 000000000..e53c48ff5
--- /dev/null
+++ b/tests/integration/cli/patterns-backslashes/.gitignore
@@ -0,0 +1,2 @@
+# dynamically created by tests
+test-*
diff --git a/tests/integration/env.js b/tests/integration/env.js
index fd9cc5036..cd6ade912 100644
--- a/tests/integration/env.js
+++ b/tests/integration/env.js
@@ -6,7 +6,7 @@ const { __dirname, require } = createEsmUtils(import.meta);
 const isProduction = process.env.NODE_ENV === "production";
 const { PRETTIER_DIR } = process.env;
 const { bin } = require(path.join(PRETTIER_DIR, "package.json"));
-const prettierCli = path.join(
+const prettierCliEntry = path.join(
   PRETTIER_DIR,
   typeof bin === "object" ? bin.prettier : bin,
 );
@@ -17,4 +17,14 @@ const prettierMainEntry = isProduction
 
 const projectRoot = path.join(__dirname, "../..");
 
-export { isProduction, prettierCli, prettierMainEntry, projectRoot };
+const prettierCliMockableEntry = isProduction
+  ? path.join(PRETTIER_DIR, "./internal/legacy-cli.mjs")
+  : path.join(PRETTIER_DIR, "./src/cli/index.js");
+
+export {
+  isProduction,
+  prettierCliEntry,
+  prettierCliMockableEntry,
+  prettierMainEntry,
+  projectRoot,
+};
diff --git a/tests/integration/run-cli.js b/tests/integration/run-cli.js
index ec580dce4..b0547a203 100644
--- a/tests/integration/run-cli.js
+++ b/tests/integration/run-cli.js
@@ -1,35 +1,47 @@
+import childProcess from "node:child_process";
 import path from "node:path";
 import url from "node:url";
-import { Worker } from "node:worker_threads";
 
-const CLI_WORKER_FILE = new URL("./cli-worker.js", import.meta.url);
+/**
+@typedef {{
+  isTTY?: boolean,
+  stdoutIsTTY?: boolean,
+  ci?: boolean,
+  mockWriteFileErrors?: Record<string, string>,
+  nodeOptions?: string[],
+  input?: string,
+}} CliTestOptions
+*/
+
+// Though the doc says `childProcess.fork` accepts `URL`, but seems not true
+// TODO: Use `URL` directly when we drop support for Node.js v14
+const CLI_WORKER_FILE = url.fileURLToPath(
+  new URL("./cli-worker.js", import.meta.url),
+);
 const INTEGRATION_TEST_DIRECTORY = url.fileURLToPath(
   new URL("./", import.meta.url),
 );
-
-const streamToString = (stream) =>
-  new Promise((resolve, reject) => {
-    let result = "";
-
-    stream.on("data", (data) => {
-      result += data.toString();
-    });
-
-    stream.on("end", () => {
-      resolve(result);
-    });
-
-    stream.on("error", (error) => {
-      reject(error);
-    });
-  });
-
+const IS_CI = Boolean(process.env.CI);
 const removeFinalNewLine = (string) =>
   string.endsWith("\n") ? string.slice(0, -1) : string;
-
 const SUPPORTS_DISABLE_WARNING_FLAG =
   Number(process.versions.node.split(".")[0]) >= 20;
-
+const promiseWithResolvers = Promise.withResolvers
+  ? Promise.withResolvers.bind(Promise)
+  : () => {
+      let resolve;
+      let reject;
+      const promise = new Promise(
+        (_resolve, _reject) => ([resolve, reject] = [_resolve, _reject]),
+      );
+      return { promise, resolve, reject };
+    };
+
+/**
+ * @param {string} dir
+ * @param {string[]} args
+ * @param {CliTestOptions} options
+ */
 function runCliWorker(dir, args, options) {
   const result = {
     status: undefined,
@@ -37,11 +49,34 @@ function runCliWorker(dir, args, options) {
     stderr: "",
     write: [],
   };
+  const { promise, resolve, reject } = promiseWithResolvers();
+  const createEpipeErrorHandler = (event) => (error) => {
+    if (!error) {
+      return;
+    }
 
-  const nodeOptions = options?.nodeOptions ?? [];
+    // It can fail with `write EPIPE` error when running node with unsupported flags like `--experimental-strip-types`
+    // Let's ignore and wait for the `close` event
+    if (
+      error.code === "EPIPE" &&
+      error.syscall === "write" &&
+      nodeOptions.length > 0
+    ) {
+      if (IS_CI) {
+        // eslint-disable-next-line no-console
+        console.error(
+          Object.assign(error, { event, dir, args, options, worker }),
+        );
+      }
+      return;
+    }
+
+    reject(error);
+  };
 
-  const worker = new Worker(CLI_WORKER_FILE, {
-    argv: args,
+  const nodeOptions = options?.nodeOptions ?? [];
+  const worker = childProcess.fork(CLI_WORKER_FILE, args, {
+    cwd: dir,
     execArgv: [
       "--trace-deprecation",
       ...(SUPPORTS_DISABLE_WARNING_FLAG
@@ -49,98 +84,97 @@ function runCliWorker(dir, args, options) {
         : []),
       ...nodeOptions,
     ],
-    stdout: true,
-    stderr: true,
+    stdio: [options.input ? "pipe" : "ignore", "pipe", "pipe", "ipc"],
     env: {
       ...process.env,
       NO_COLOR: "1",
     },
-    workerData: {
-      dir,
-      options,
-    },
-    trackUnmanagedFds: false,
+    serialization: "advanced",
   });
 
-  worker.on("message", ({ action, data }) => {
-    if (action === "write-file") {
-      result.write.push(data);
+  worker.on("message", (message) => {
+    if (message.type === "cli:write-file") {
+      result.write.push(message.data);
+    } else if (message.type === "worker:fault") {
+      reject(message.error);
     }
   });
 
-  return new Promise((resolve, reject) => {
-    worker.on("exit", async (code) => {
-      result.status = code;
-      result.stdout = removeFinalNewLine(await streamToString(worker.stdout));
-      result.stderr = removeFinalNewLine(await streamToString(worker.stderr));
-      resolve(result);
+  for (const stream of ["stdout", "stderr"]) {
+    worker[stream].on("data", (data) => {
+      result[stream] += data.toString();
     });
+  }
 
-    worker.on("error", (error) => {
-      reject(error);
-    });
+  const removeStdioFinalNewLine = () => {
+    for (const stream of ["stdout", "stderr"]) {
+      result[stream] = removeFinalNewLine(result[stream]);
+    }
+  };
+
+  worker.once("close", (code) => {
+    result.status = code;
+    removeStdioFinalNewLine();
+    resolve(result);
+  });
+
+  worker.once("error", (error) => {
+    reject(error);
+  });
+
+  worker.once("spawn", () => {
+    if (options.input) {
+      worker.stdin.once("error", createEpipeErrorHandler("worker.stdin.end()"));
+      worker.stdin.end(options.input);
+    }
 
-    worker.postMessage("run");
+    worker.send(options, createEpipeErrorHandler("worker.send()"));
   });
+
+  return promise;
 }
 
-async function runPrettierCli(dir, args, options) {
+function runPrettierCli(dir, args, options) {
   dir = path.resolve(INTEGRATION_TEST_DIRECTORY, dir);
   args = Array.isArray(args) ? args : [args];
 
-  // Worker doesn't support `chdir`
-  const cwd = process.cwd();
-  process.chdir(dir);
-
-  try {
-    return await runCliWorker(dir, args, options);
-  } finally {
-    process.chdir(cwd);
-  }
+  return runCliWorker(dir, args, options);
 }
 
-let runningCli;
+/**
+ * @param {string} dir
+ * @param {string[]} [args]
+ * @param {CliTestOptions} [options]
+ */
 function runCli(dir, args = [], options = {}) {
-  let promise;
+  const promise = runPrettierCli(dir, args, options);
   const getters = {
     get status() {
-      return run().then(({ status }) => status);
+      return promise.then(({ status }) => status);
     },
     get stdout() {
-      return run().then(({ stdout }) => stdout);
+      return promise.then(({ stdout }) => stdout);
     },
     get stderr() {
-      return run().then(({ stderr }) => stderr);
+      return promise.then(({ stderr }) => stderr);
     },
     get write() {
-      return run().then(({ write }) => write);
+      return promise.then(({ write }) => write);
     },
     test: testResult,
     then(onFulfilled, onRejected) {
-      return run().then(onFulfilled, onRejected);
+      return promise.then(onFulfilled, onRejected);
     },
   };
 
   return getters;
 
-  function run() {
-    if (runningCli) {
-      throw new Error("Please wait for previous CLI to exit.");
-    }
-
-    if (!promise) {
-      promise = runPrettierCli(dir, args, options).finally(() => {
-        runningCli = undefined;
-      });
-      runningCli = promise;
-    }
-    return promise;
-  }
-
   function testResult(testOptions) {
-    for (const name of ["status", "stdout", "stderr", "write"]) {
-      test(`${options.title || ""}(${name})`, async () => {
-        const result = await run();
+    test(options.title || "", async () => {
+      const result = await promise;
+
+      let snapshot;
+      for (const name of ["status", "stdout", "stderr", "write"]) {
         let value = result[name];
         // \r is trimmed from jest snapshots by default;
         // manually replacing this character with /*CR*/ to test its true presence
@@ -161,10 +195,15 @@ function runCli(dir, args = [], options = {}) {
             expect(value).toEqual(testOptions[name]);
           }
         } else {
-          expect(value).toMatchSnapshot();
+          snapshot = snapshot ?? {};
+          snapshot[name] = value;
         }
-      });
-    }
+      }
+
+      if (snapshot) {
+        expect(snapshot).toMatchSnapshot();
+      }
+    });
 
     return getters;
   }
diff --git a/website/docusaurus.config.js b/website/docusaurus.config.js
index 30d627db5..7fb3f039f 100644
--- a/website/docusaurus.config.js
+++ b/website/docusaurus.config.js
@@ -4,6 +4,7 @@ import fs from "node:fs";
 import { createRequire } from "node:module";
 import { load as parseYaml } from "js-yaml";
 import { themes as prismThemes } from "prism-react-renderer";
+import llmsTxtPlugin from "./plugins/llms-txt-plugin.mjs";
 
 const require = createRequire(import.meta.url);
 
@@ -258,7 +259,7 @@ const config = {
         darkTheme: prismThemes.dracula,
       },
     },
-
+  plugins: [llmsTxtPlugin],
   future: {
     experimental_faster: {
       swcJsLoader: true,
diff --git a/website/playground/Playground.jsx b/website/playground/Playground.jsx
index 2b4762cb8..0357fd837 100644
--- a/website/playground/Playground.jsx
+++ b/website/playground/Playground.jsx
@@ -45,6 +45,8 @@ const ENABLED_OPTIONS = [
   "htmlWhitespaceSensitivity",
   "insertPragma",
   "requirePragma",
+  // TODO: Enable this after release 3.6
+  // "checkIgnorePragma",
   "vueIndentScriptAndStyle",
   "embeddedLanguageFormatting",
   "bracketSameLine",
diff --git a/website/plugins/llms-txt-plugin.mjs b/website/plugins/llms-txt-plugin.mjs
new file mode 100644
index 000000000..dd60b5c9c
--- /dev/null
+++ b/website/plugins/llms-txt-plugin.mjs
@@ -0,0 +1,100 @@
+// https://github.com/facebook/docusaurus/issues/10899
+// https://github.com/defi-wonderland/handbook/blob/dev/plugins/llmsTxtPlugin.ts
+import fs from "node:fs/promises";
+import path from "node:path";
+
+export default function llmsTxtPlugin(context) {
+  return {
+    name: "llms-txt-plugin",
+    async loadContent() {
+      const { siteDir } = context;
+      const contentDir = path.join(siteDir, "versioned_docs/version-stable");
+      const allMdx = [];
+      const docsRecords = [];
+
+      const getMdxFiles = async (dir, relativePath = "", depth = 0) => {
+        const entries = await fs.readdir(dir, {
+          withFileTypes: true,
+        });
+
+        entries.sort((a, b) => {
+          if (a.isDirectory() && !b.isDirectory()) {
+            return -1;
+          }
+          if (!a.isDirectory() && b.isDirectory()) {
+            return 1;
+          }
+          return a.name.localeCompare(b.name);
+        });
+
+        for (const entry of entries) {
+          const fullPath = path.join(dir, entry.name);
+          const currentRelativePath = path.join(relativePath, entry.name);
+
+          if (entry.isDirectory()) {
+            const dirName = entry.name
+              .split("-")
+              .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
+              .join(" ");
+            const headingLevel = "#".repeat(depth + 2);
+            allMdx.push(`\n${headingLevel} ${dirName}\n`);
+            await getMdxFiles(fullPath, currentRelativePath, depth + 1);
+          } else if (entry.name.endsWith(".md")) {
+            const content = await fs.readFile(fullPath, "utf8");
+            let title = entry.name.replace(".md", "");
+            let description = "";
+
+            const frontmatterMatch = content.match(/^---\n(.*?)\n---/su);
+            if (frontmatterMatch) {
+              const titleMatch = frontmatterMatch[1].match(/title:\s*(.+)/u);
+              const descriptionMatch =
+                frontmatterMatch[1].match(/description:\s*(.+)/u);
+
+              if (titleMatch) {
+                title = titleMatch[1].trim();
+              }
+              if (descriptionMatch) {
+                description = descriptionMatch[1].trim();
+              }
+            }
+
+            const headingLevel = "#".repeat(depth + 3);
+            allMdx.push(`\n${headingLevel} ${title}\n\n${content}`);
+
+            // Add to docs records for llms.txt
+            docsRecords.push({
+              title,
+              path: currentRelativePath.replaceAll("\\", "/"),
+              description,
+            });
+          }
+        }
+      };
+
+      await getMdxFiles(contentDir);
+      return { allMdx, docsRecords };
+    },
+    async postBuild({ content, outDir }) {
+      const { allMdx, docsRecords } = content;
+
+      // Write concatenated MDX content
+      const concatenatedPath = path.join(outDir, "llms-full.txt");
+      await fs.writeFile(concatenatedPath, allMdx.join("\n\n---\n\n"));
+
+      // Create llms.txt with the requested format
+      const llmsTxt = `# ${
+        context.siteConfig.title
+      }\n\n## Documentation\n\n${docsRecords
+        .map(
+          (doc) =>
+            `- [${doc.title}](${context.siteConfig.url}/docs/${doc.path.replace(
+              ".md",
+              "",
+            )}): ${doc.description}`,
+        )
+        .join("\n")}`;
+      const llmsTxtPath = path.join(outDir, "llms.txt");
+      await fs.writeFile(llmsTxtPath, llmsTxt);
+    },
+  };
+}
diff --git a/yarn.lock b/yarn.lock
index d0d568c7b..47dd283d3 100644
--- a/yarn.lock
+++ b/yarn.lock
@@ -15,12 +15,12 @@ __metadata:
   languageName: node
   linkType: hard
 
-"@angular/compiler@npm:19.2.5":
-  version: 19.2.5
-  resolution: "@angular/compiler@npm:19.2.5"
+"@angular/compiler@npm:19.2.7":
+  version: 19.2.7
+  resolution: "@angular/compiler@npm:19.2.7"
   dependencies:
     tslib: "npm:^2.3.0"
-  checksum: 10/3a36f13228a49fe7e4c8630df47a6220ef5164b62a5c3e7d883f811bcffce0319fcdcc1bdf20d358fb37ebf52be6a1b73cebaa0565b86e540eb0f21ac0979e5b
+  checksum: 10/b6545922029a74387a6680f84147a9d16c222ad16e601ccde5696231332a278357ba43d593157b71859f9f1631c3178423f552fcf70ef8dcb3d66cbf1bffea71
   languageName: node
   linkType: hard
 
@@ -5558,9 +5558,9 @@ __metadata:
   languageName: node
   linkType: hard
 
-"jest-light-runner@npm:0.6.0":
-  version: 0.6.0
-  resolution: "jest-light-runner@npm:0.6.0"
+"jest-light-runner@npm:0.7.8":
+  version: 0.7.8
+  resolution: "jest-light-runner@npm:0.7.8"
   dependencies:
     "@jest/expect": "npm:^30.0.0-alpha.1"
     "@jest/fake-timers": "npm:^30.0.0-alpha.1"
@@ -5568,11 +5568,12 @@ __metadata:
     jest-each: "npm:^30.0.0-alpha.1"
     jest-mock: "npm:^30.0.0-alpha.1"
     jest-snapshot: "npm:^30.0.0-alpha.1"
+    p-limit: "npm:^6.2.0"
     supports-color: "npm:^9.2.1"
-    tinypool: "npm:^0.8.1"
+    tinypool: "npm:0.8.4"
   peerDependencies:
     jest: ^27.5.0 || ^28.0.0 || ^29.0.0|| ^30.0.0-0
-  checksum: 10/74103180fa2b997e46b7ba08e3afa6b673dd35d0c15fcecf825f9b7768c53c4f416bcdb261285b234375caaf45dd7cab397d5def7d95271c8d75ac59237fbf86
+  checksum: 10/e0e4057c7f5bbf3fcb559b1aa92966ec4323df94af3f00c8306426c1a92e5eca3106c8ea737a46c47baf4ea8da0255330f6e1bf0c107fec52a8e6dc5a02a6067
   languageName: node
   linkType: hard
 
@@ -6724,6 +6725,15 @@ __metadata:
   languageName: node
   linkType: hard
 
+"p-limit@npm:^6.2.0":
+  version: 6.2.0
+  resolution: "p-limit@npm:6.2.0"
+  dependencies:
+    yocto-queue: "npm:^1.1.1"
+  checksum: 10/70e8df3e5f1c173c9bd9fa8390a3c5c2797505240ae42973536992b1f5f59a922153c2f35ff1bf36fb72a0f025b0f13fca062a4233e830adad446960d56b4d84
+  languageName: node
+  linkType: hard
+
 "p-locate@npm:^4.1.0":
   version: 4.1.0
   resolution: "p-locate@npm:4.1.0"
@@ -7067,7 +7077,7 @@ __metadata:
   version: 0.0.0-use.local
   resolution: "prettier@workspace:."
   dependencies:
-    "@angular/compiler": "npm:19.2.5"
+    "@angular/compiler": "npm:19.2.7"
     "@babel/code-frame": "npm:7.26.2"
     "@babel/generator": "npm:7.27.0"
     "@babel/parser": "npm:7.27.0"
@@ -7137,7 +7147,7 @@ __metadata:
     iterate-directory-up: "npm:1.1.1"
     jest: "npm:30.0.0-alpha.7"
     jest-docblock: "npm:30.0.0-alpha.7"
-    jest-light-runner: "npm:0.6.0"
+    jest-light-runner: "npm:0.7.8"
     jest-snapshot-serializer-ansi: "npm:2.2.1"
     jest-snapshot-serializer-raw: "npm:2.0.0"
     jest-watch-typeahead: "npm:2.2.2"
@@ -8295,7 +8305,7 @@ __metadata:
   languageName: node
   linkType: hard
 
-"tinypool@npm:^0.8.1":
+"tinypool@npm:0.8.4":
   version: 0.8.4
   resolution: "tinypool@npm:0.8.4"
   checksum: 10/7365944c2532f240111443e7012be31a634faf1a02db08a91db3aa07361c26a374d0be00a0f2ea052c4bee39c107ba67f1f814c108d9d51dfc725c559c1a9c03
@@ -8938,6 +8948,13 @@ __metadata:
   languageName: node
   linkType: hard
 
+"yocto-queue@npm:^1.1.1":
+  version: 1.2.1
+  resolution: "yocto-queue@npm:1.2.1"
+  checksum: 10/0843d6c2c0558e5c06e98edf9c17942f25c769e21b519303a5c2adefd5b738c9b2054204dc856ac0cd9d134b1bc27d928ce84fd23c9e2423b7e013d5a6f50577
+  languageName: node
+  linkType: hard
+
 "zeptomatch-escape@npm:^1.0.0":
   version: 1.0.1
   resolution: "zeptomatch-escape@npm:1.0.1"
