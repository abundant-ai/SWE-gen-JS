diff --git a/demos/er.html b/demos/er.html
index 026357efa..68aaf18a2 100644
--- a/demos/er.html
+++ b/demos/er.html
@@ -15,31 +15,47 @@
 
   <body>
     <pre class="mermaid">
-      erDiagram
-        title: This is a title
-        accDescription_ Test a description
-
-        CUSTOMER ||--o{ ORDER : places
-        ORDER ||--|{ LINE-ITEM : contains
-        CUSTOMER }|..|{ DELIVERY-ADDRESS : uses
-
-        DELIVERY-ADDRESS {
-          int customerId
-          string addressLine1
-          string addressLine2
-          string city
-          string county
-          string state
-          string region
-          string country
-          string postalCode
-        }
+
+erDiagram
+  %% title This is a title
+  %% accDescription Test a description
+
+  "Person . CUSTOMER"||--o{ ORDER : places
+
+  ORDER ||--|{ "€£LINE_ITEM ¥" : contains
+
+  "Person . CUSTOMER" }|..|{ "Address//StreetAddress::[DELIVERY ADDRESS]" : uses
+
+  "Address//StreetAddress::[DELIVERY ADDRESS]" {
+      int customerID FK
+      string line1 "this is the first address line comment"
+      string line2
+      string city
+      string region
+      string state
+      string postal_code
+      string country
+      }
+
+      "a_~`!@#$^&*()-_=+[]{}|/;:'.?¡⁄™€£‹¢›∞ﬁ§‡•°ª·º‚≠±œŒ∑„®†ˇ¥Á¨ˆˆØπ∏“«»åÅßÍ∂ÎƒÏ©˙Ó∆Ô˚¬Ò…ÚæÆΩ¸≈π˛çÇ√◊∫ı˜µÂ≤¯≥˘÷¿" {
+        string name "this is an entity with an absurd name just to show characters that are now acceptable as long as the name is in double quotes"
+      }
+
+      "€£LINE_ITEM ¥" {
+        int orderID FK
+        int currencyId FK
+        number price
+        number quantity
+        number adjustment
+        number final_price
+      }
     </pre>
 
     <script type="module">
       import mermaid from '../src/mermaid';
       mermaid.initialize({
-        theme: 'base',
+        theme: 'default',
+
         // themeCSS: '.node rect { fill: red; }',
         logLevel: 3,
         securityLevel: 'loose',
diff --git a/package.json b/package.json
index bbe4045be..1639f460b 100644
--- a/package.json
+++ b/package.json
@@ -65,6 +65,7 @@
   },
   "dependencies": {
     "@braintree/sanitize-url": "^6.0.0",
+    "@types/uuid": "^8.3.4",
     "d3": "^7.0.0",
     "dagre": "^0.8.5",
     "dagre-d3": "^0.6.4",
@@ -75,7 +76,8 @@
     "lodash": "^4.17.21",
     "moment-mini": "^2.24.0",
     "non-layered-tidy-tree-layout": "^2.0.2",
-    "stylis": "^4.1.2"
+    "stylis": "^4.1.2",
+    "uuid": "^9.0.0"
   },
   "devDependencies": {
     "@applitools/eyes-cypress": "^3.25.7",
diff --git a/src/diagrams/er/erRenderer.js b/src/diagrams/er/erRenderer.js
index d1258a547..a6277f27d 100644
--- a/src/diagrams/er/erRenderer.js
+++ b/src/diagrams/er/erRenderer.js
@@ -1,7 +1,5 @@
 import graphlib from 'graphlib';
 import { line, curveBasis, select } from 'd3';
-// import erDb from './erDb';
-// import erParser from './parser/erDiagram';
 import dagre from 'dagre';
 import { getConfig } from '../../config';
 import { log } from '../../logger';
@@ -9,9 +7,17 @@ import erMarkers from './erMarkers';
 import { configureSvgSize } from '../../setupGraphViewbox';
 import addSVGAccessibilityFields from '../../accessibility';
 import { parseGenericTypes } from '../common/common';
+import { v4 as uuid4 } from 'uuid';
 
+/** Regex used to remove chars from the entity name so the result can be used in an id */
+const BAD_ID_CHARS_REGEXP = /[^A-Za-z0-9]([\W])*/g;
+
+// Configuration
 let conf = {};
 
+// Map so we can look up the id of an entity based on the name
+let entityNameIds = new Map();
+
 /**
  * Allows the top-level API module to inject config specific to this renderer, storing it in the
  * local conf object. Note that generic config still needs to be retrieved using getConfig()
@@ -31,8 +37,10 @@ export const setConf = function (cnf) {
  *
  * @param groupNode The svg group node for the entity
  * @param entityTextNode The svg node for the entity label text
- * @param attributes An array of attributes defined for the entity (each attribute has a type and a name)
- * @returns {object} The bounding box of the entity, after attributes have been added. The bounding box has a .width and .height
+ * @param attributes An array of attributes defined for the entity (each attribute has a type and a
+ *   name)
+ * @returns {object} The bounding box of the entity, after attributes have been added. The bounding
+ *   box has a .width and .height
  */
 const drawAttributes = (groupNode, entityTextNode, attributes) => {
   const heightPadding = conf.entityPadding / 3; // Padding internal to attribute boxes
@@ -288,7 +296,7 @@ const drawAttributes = (groupNode, entityTextNode, attributes) => {
       heightOffset += attributeNode.height + heightPadding * 2;
 
       // Flip the attribute style for row banding
-      attribStyle = attribStyle == 'attributeBoxOdd' ? 'attributeBoxEven' : 'attributeBoxOdd';
+      attribStyle = attribStyle === 'attributeBoxOdd' ? 'attributeBoxEven' : 'attributeBoxOdd';
     });
   } else {
     // Ensure the entity box is a decent size without any attributes
@@ -313,15 +321,18 @@ const drawEntities = function (svgNode, entities, graph) {
   const keys = Object.keys(entities);
   let firstOne;
 
-  keys.forEach(function (id) {
+  keys.forEach(function (entityName) {
+    const entityId = generateId(entityName, 'entity');
+    entityNameIds.set(entityName, entityId);
+
     // Create a group for each entity
-    const groupNode = svgNode.append('g').attr('id', id);
+    const groupNode = svgNode.append('g').attr('id', entityId);
 
-    firstOne = firstOne === undefined ? id : firstOne;
+    firstOne = firstOne === undefined ? entityId : firstOne;
 
     // Label the entity - this is done first so that we can get the bounding box
     // which then determines the size of the rectangle
-    const textId = 'entity-' + id;
+    const textId = 'text-' + entityId;
     const textNode = groupNode
       .append('text')
       .attr('class', 'er entityLabel')
@@ -334,12 +345,12 @@ const drawEntities = function (svgNode, entities, graph) {
         'style',
         'font-family: ' + getConfig().fontFamily + '; font-size: ' + conf.fontSize + 'px'
       )
-      .text(id);
+      .text(entityName);
 
     const { width: entityWidth, height: entityHeight } = drawAttributes(
       groupNode,
       textNode,
-      entities[id].attributes
+      entities[entityName].attributes
     );
 
     // Draw the rectangle - insert it before the text so that the text is not obscured
@@ -356,12 +367,12 @@ const drawEntities = function (svgNode, entities, graph) {
 
     const rectBBox = rectNode.node().getBBox();
 
-    // Add the entity to the graph
-    graph.setNode(id, {
+    // Add the entity to the graph using the entityId
+    graph.setNode(entityId, {
       width: rectBBox.width,
       height: rectBBox.height,
       shape: 'rect',
-      id: id,
+      id: entityId,
     });
   });
   return firstOne;
@@ -382,9 +393,16 @@ const adjustEntities = function (svgNode, graph) {
         );
     }
   });
-  return;
 };
 
+/**
+ * Construct a name for an edge based on the names of the 2 entities and the role (relationship)
+ * between them. Remove any spaces from it
+ *
+ * @param rel - A (parsed) relationship (e.g. one of the objects in the list returned by
+ *   erDb.getRelationships)
+ * @returns {string}
+ */
 const getEdgeName = function (rel) {
   return (rel.entityA + rel.roleA + rel.entityB).replace(/\s/g, '');
 };
@@ -393,12 +411,17 @@ const getEdgeName = function (rel) {
  * Add each relationship to the graph
  *
  * @param relationships The relationships to be added
- * @param g The graph
+ * @param {Graph} g The graph
  * @returns {Array} The array of relationships
  */
 const addRelationships = function (relationships, g) {
   relationships.forEach(function (r) {
-    g.setEdge(r.entityA, r.entityB, { relationship: r }, getEdgeName(r));
+    g.setEdge(
+      entityNameIds.get(r.entityA),
+      entityNameIds.get(r.entityB),
+      { relationship: r },
+      getEdgeName(r)
+    );
   });
   return relationships;
 }; // addRelationships
@@ -418,7 +441,11 @@ const drawRelationshipFromLayout = function (svg, rel, g, insert, diagObj) {
   relCnt++;
 
   // Find the edge relating to this relationship
-  const edge = g.edge(rel.entityA, rel.entityB, getEdgeName(rel));
+  const edge = g.edge(
+    entityNameIds.get(rel.entityA),
+    entityNameIds.get(rel.entityB),
+    getEdgeName(rel)
+  );
 
   // Get a function that will generate the line path
   const lineFunction = line()
@@ -535,8 +562,6 @@ const drawRelationshipFromLayout = function (svg, rel, g, insert, diagObj) {
     .attr('height', labelBBox.height)
     .attr('fill', 'white')
     .attr('fill-opacity', '85%');
-
-  return;
 };
 
 /**
@@ -552,7 +577,7 @@ export const draw = function (text, id, _version, diagObj) {
   log.info('Drawing ER diagram');
   //  diag.db.clear();
   const securityLevel = getConfig().securityLevel;
-  // Handle root and Document for when rendering in sanbox mode
+  // Handle root and Document for when rendering in sandbox mode
   let sandboxElement;
   if (securityLevel === 'sandbox') {
     sandboxElement = select('#i' + id);
@@ -581,7 +606,7 @@ export const draw = function (text, id, _version, diagObj) {
   // 1. Create all the entities in the svg node at 0,0, but with the correct dimensions (allowing for text content)
   // 2. Make sure they are all added to the graph
   // 3. Add all the edges (relationships) to the graph as well
-  // 4. Let dagre do its magic to layout the graph.  This assigns:
+  // 4. Let dagre do its magic to lay out the graph.  This assigns:
   //    - the centre co-ordinates for each node, bearing in mind the dimensions and edge relationships
   //    - the path co-ordinates for each edge
   //    But it has no impact on the svg child nodes - the diagram remains with every entity rooted at 0,0
@@ -647,6 +672,35 @@ export const draw = function (text, id, _version, diagObj) {
   addSVGAccessibilityFields(diagObj.db, svg, id);
 }; // draw
 
+/**
+ * Return a unique id based on the given string. Start with the prefix, then a hyphen, then the
+ * simplified str, then a hyphen, then a unique uuid. (Hyphens are only included if needed.)
+ * Although the official XML standard for ids says that many more characters are valid in the id,
+ * this keeps things simple by accepting only A-Za-z0-9.
+ *
+ * @param {string} [str?=''] Given string to use as the basis for the id. Default is `''`
+ * @param {string} [prefix?=''] String to put at the start, followed by '-'. Default is `''`
+ * @param str
+ * @param prefix
+ * @returns {string}
+ * @see https://www.w3.org/TR/xml/#NT-Name
+ */
+export function generateId(str = '', prefix = '') {
+  const simplifiedStr = str.replace(BAD_ID_CHARS_REGEXP, '');
+  return `${strWithHyphen(prefix)}${strWithHyphen(simplifiedStr)}${uuid4()}`;
+}
+
+/**
+ * Append a hyphen to a string only if the string isn't empty
+ *
+ * @param {string} str
+ * @returns {string}
+ * @todo This could be moved into a string utility file/class.
+ */
+function strWithHyphen(str = '') {
+  return str.length > 0 ? `${str}-` : '';
+}
+
 export default {
   setConf,
   draw,
diff --git a/src/diagrams/er/parser/erDiagram.jison b/src/diagrams/er/parser/erDiagram.jison
index ceae4f18c..6294599b5 100644
--- a/src/diagrams/er/parser/erDiagram.jison
+++ b/src/diagrams/er/parser/erDiagram.jison
@@ -24,6 +24,7 @@ accDescr\s*"{"\s*                                { this.begin("acc_descr_multili
 [\n]+                           return 'NEWLINE';
 \s+                             /* skip whitespace */
 [\s]+                           return 'SPACE';
+\"[^"%\r\n\v\b\\]+\"            return 'ENTITY_NAME';
 \"[^"]*\"                       return 'WORD';
 "erDiagram"                     return 'ER_DIAGRAM';
 "{"                             { this.begin("block"); return 'BLOCK_START'; }
@@ -102,8 +103,8 @@ statement
     ;
 
 entityName
-    : 'ALPHANUM' { $$ = $1; /*console.log('Entity: ' + $1);*/ }
-    | 'ALPHANUM' '.' entityName { $$ = $1 + $2 + $3; }
+    : 'ALPHANUM'      { $$ = $1; }
+    | 'ENTITY_NAME'      { $$ = $1.replace(/"/g, ''); }
     ;
 
 attributes
@@ -156,6 +157,7 @@ relType
 
 role
     : 'WORD'      { $$ = $1.replace(/"/g, ''); }
+    | 'ENTITY_NAME' { $$ = $1.replace(/"/g, ''); }
     | 'ALPHANUM'  { $$ = $1; }
     ;
 
diff --git a/yarn.lock b/yarn.lock
index d973df0a7..bfd6ae18e 100644
--- a/yarn.lock
+++ b/yarn.lock
@@ -2187,6 +2187,11 @@
   resolved "https://registry.yarnpkg.com/@types/unist/-/unist-2.0.6.tgz#250a7b16c3b91f672a24552ec64678eeb1d3a08d"
   integrity sha512-PBjIUxZHOuj0R15/xuwJYjFi+KZdNFrehocChv4g5hu6aFroHue8m0lBP0POdK2nKzbw0cgV1mws8+V/JAcEkQ==
 
+"@types/uuid@^8.3.4":
+  version "8.3.4"
+  resolved "https://registry.yarnpkg.com/@types/uuid/-/uuid-8.3.4.tgz#bd86a43617df0594787d38b735f55c805becf1bc"
+  integrity sha512-c/I8ZRb51j+pYGAu5CrFMRxqZ2ke4y2grEBO5AUjgSkSk+qT2Ea+OdWElz/OiMf5MNpn2b17kuVBwZLQJXzihw==
+
 "@types/yauzl@^2.9.1":
   version "2.10.0"
   resolved "https://registry.yarnpkg.com/@types/yauzl/-/yauzl-2.10.0.tgz#b3248295276cf8c6f153ebe6a9aba0c988cb2599"
@@ -10157,6 +10162,11 @@ uuid@^3.3.2:
   resolved "https://registry.yarnpkg.com/uuid/-/uuid-3.4.0.tgz#b23e4358afa8a202fe7a100af1f5f883f02007ee"
   integrity sha512-HjSDRw6gZE5JMggctHBcjVak08+KEVhSIiDzFnT9S9aegmp85S/bReBVTb4QTFaRNptJ9kuYaNhnbNEOkbKb/A==
 
+uuid@^9.0.0:
+  version "9.0.0"
+  resolved "https://registry.yarnpkg.com/uuid/-/uuid-9.0.0.tgz#592f550650024a38ceb0c562f2f6aa435761efb5"
+  integrity sha512-MXcSTerfPa4uqyzStbRoTgt5XIe3x5+42+q1sDuy3R5MDk66URdLMOZe5aPX/SQd+kuYAh0FdP/pO28IkQyTeg==
+
 uvu@^0.5.0:
   version "0.5.6"
   resolved "https://registry.yarnpkg.com/uvu/-/uvu-0.5.6.tgz#2754ca20bcb0bb59b64e9985e84d2e81058502df"
