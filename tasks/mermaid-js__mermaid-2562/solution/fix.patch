diff --git a/cypress/platform/css1.html b/cypress/platform/css1.html
new file mode 100644
index 000000000..f02892123
--- /dev/null
+++ b/cypress/platform/css1.html
@@ -0,0 +1,39 @@
+<!DOCTYPE html>
+<html>
+<head>
+  <meta charset="utf-8">
+  <meta http-equiv="X-UA-Compatible" content="IE=edge">
+  <title>Mermaid Quick Test Page</title>
+  <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo=">
+  <style>
+    body {
+      font-family: 'trebuchet ms', verdana, arial;
+    }
+  </style>
+</head>
+<body>
+  <div class="mermaid2">
+  %%{init: { 'themeCSS': '} * { background: lightblue }' } }%%
+  flowchart TD
+    a --> b
+  </div>
+  <div class="mermaid">
+   %%{init:{"theme":"base", "themeVariables": {"primaryColor":"#411d4e", "titleColor":"white", "darkMode":true}}}%%
+    flowchart LR
+    subgraph A
+        a --> b
+    end
+    subgraph B
+        i -->f
+    end
+    A --> B
+  </div>
+  <script src="./mermaid.js"></script>
+  <script>
+     function showFullFirstSquad(elemName) {
+       console.log('show ' + elemName);
+     }
+     mermaid.initialize({ startOnLoad: true, securityLevel: 'loose', logLevel: 0 });
+  </script>
+</body>
+</html>
diff --git a/src/defaultConfig.js b/src/defaultConfig.js
index 92d8b5771..305ba0867 100644
--- a/src/defaultConfig.js
+++ b/src/defaultConfig.js
@@ -37,6 +37,7 @@ const config = {
   themeCSS: undefined,
   /* **maxTextSize** - The maximum allowed size of the users text diamgram */
   maxTextSize: 50000,
+  darkMode: false,
 
   /**
    * | Parameter  | Description                                            | Type   | Required | Values                      |
diff --git a/src/mermaidAPI.js b/src/mermaidAPI.js
index 0e73b3032..e51f22468 100755
--- a/src/mermaidAPI.js
+++ b/src/mermaidAPI.js
@@ -60,7 +60,7 @@ import { attachFunctions } from './interactionDb';
 import { log, setLogLevel } from './logger';
 import getStyles from './styles';
 import theme from './themes';
-import utils, { directiveSanitizer, assignWithDepth } from './utils';
+import utils, { directiveSanitizer, assignWithDepth, sanitizeCss } from './utils';
 
 /**
  * @param text
@@ -223,6 +223,7 @@ const render = function (id, _txt, cb, container) {
   let txt = _txt;
   const graphInit = utils.detectInit(txt);
   if (graphInit) {
+    directiveSanitizer(graphInit);
     configApi.addDirective(graphInit);
   }
   let cnf = configApi.getConfig();
@@ -533,6 +534,9 @@ const handleDirective = function (p, directive, type) {
         p.setWrap(directive.type === 'wrap');
       }
       break;
+    case 'themeCss':
+      log.warn('themeCss encountered');
+      break;
     default:
       log.warn(
         `Unhandled directive: source: '%%{${directive.type}: ${JSON.stringify(
diff --git a/src/utils.js b/src/utils.js
index 90a087f9f..012fb98d3 100644
--- a/src/utils.js
+++ b/src/utils.js
@@ -974,6 +974,11 @@ export const directiveSanitizer = (args) => {
           log.debug('sanitize deleting constr option', key);
           delete args[key];
         }
+
+        if (key.indexOf('themeCSS') >= 0) {
+          log.debug('sanitizing themeCss option');
+          args[key] = sanitizeCss(args[key]);
+        }
         if (configKeys.indexOf(key) < 0) {
           log.debug('sanitize deleting option', key);
           delete args[key];
@@ -987,6 +992,16 @@ export const directiveSanitizer = (args) => {
     }
   }
 };
+export const sanitizeCss = (str) => {
+  const stringsearch = 'o';
+  const startCnt = (str.match(/\{/g) || []).length;
+  const endCnt = (str.match(/\}/g) || []).length;
+  if (startCnt !== endCnt) {
+    return '{ /* ERROR: Unbalanced CSS */ }';
+  }
+  // Todo add more checks here
+  return str;
+};
 
 export default {
   assignWithDepth,
@@ -1013,4 +1028,5 @@ export default {
   entityDecode,
   initIdGeneratior,
   directiveSanitizer,
+  sanitizeCss,
 };
