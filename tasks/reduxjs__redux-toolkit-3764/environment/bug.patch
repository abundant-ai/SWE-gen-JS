diff --git a/packages/rtk-codemods/.eslintrc.js b/packages/rtk-codemods/.eslintrc.js
index 475aa701..dc8ae105 100644
--- a/packages/rtk-codemods/.eslintrc.js
+++ b/packages/rtk-codemods/.eslintrc.js
@@ -4,7 +4,7 @@ module.exports = {
   },
 
   plugins: ['prettier', 'node'],
-  extends: ['eslint:recommended', 'plugin:prettier/recommended'],
+  extends: ['eslint:recommended', 'plugin:prettier/recommended', 'plugin:node/recommended'],
   env: {
     node: true,
   },
diff --git a/packages/rtk-codemods/jest.config.js b/packages/rtk-codemods/jest.config.js
new file mode 100644
index 00000000..75b5631c
--- /dev/null
+++ b/packages/rtk-codemods/jest.config.js
@@ -0,0 +1,6 @@
+module.exports = {
+  testEnvironment: 'node',
+  automock: false,
+  // roots: ['v2.0/__tests__'],
+  transform: { '\\.ts$': ['ts-jest'] },
+};
diff --git a/packages/rtk-codemods/package.json b/packages/rtk-codemods/package.json
index 84c528e3..7f1fa0b7 100644
--- a/packages/rtk-codemods/package.json
+++ b/packages/rtk-codemods/package.json
@@ -3,8 +3,8 @@
   "version": "0.0.3",
   "scripts": {
     "lint": "eslint --cache .",
-    "test": "vitest",
-    "test:coverage": "vitest --coverage",
+    "test": "codemod-cli test",
+    "test:coverage": "codemod-cli test --coverage",
     "update-docs": "codemod-cli update-docs"
   },
   "bin": "./bin/cli.js",
@@ -22,8 +22,10 @@
     "codemod"
   ],
   "dependencies": {
+    "@types/jest": "^27",
     "@types/jscodeshift": "^0.11.5",
     "codemod-cli": "^3.2.0",
+    "ts-node": "10.4.0",
     "typescript": "^4.8.0"
   },
   "devDependencies": {
@@ -31,10 +33,12 @@
     "eslint-config-prettier": "^8.3.0",
     "eslint-plugin-node": "^11.1.0",
     "eslint-plugin-prettier": "^3.4.0",
-    "prettier": "^2.2.1"
+    "jest": "^27",
+    "prettier": "^2.2.1",
+    "ts-jest": "^27"
   },
   "engines": {
-    "node": ">= 16"
+    "node": ">= 14"
   },
   "publishConfig": {
     "access": "public"
diff --git a/packages/rtk-codemods/transformTestUtils.ts b/packages/rtk-codemods/transformTestUtils.ts
deleted file mode 100644
index b49314cc..00000000
--- a/packages/rtk-codemods/transformTestUtils.ts
+++ /dev/null
@@ -1,61 +0,0 @@
-import { describe, vi } from 'vitest';
-import type { Transform } from 'jscodeshift';
-import globby from 'globby';
-import fs from 'fs-extra';
-import path from 'path';
-import { runInlineTest } from 'jscodeshift/dist/testUtils';
-
-export function runTransformTest(
-  name: string,
-  transform: Transform,
-  parser: string,
-  fixturePath: string
-) {
-  describe(name, function () {
-    globby
-      .sync('**/*.input.*', {
-        cwd: fixturePath,
-        absolute: true,
-      })
-      .map((entry) => entry.slice(fixturePath.length))
-      .forEach((filename) => {
-        let extension = path.extname(filename);
-        let testName = filename.replace(`.input${extension}`, '');
-        let testInputPath = path.join(fixturePath, `${testName}${extension}`);
-        let inputPath = path.join(fixturePath, `${testName}.input${extension}`);
-        let outputPath = path.join(fixturePath, `${testName}.output${extension}`);
-        let optionsPath = path.join(fixturePath, `${testName}.options.json`);
-        let options = fs.pathExistsSync(optionsPath) ? fs.readFileSync(optionsPath) : '{}';
-
-        describe(testName, function () {
-          beforeEach(function () {
-            process.env.CODEMOD_CLI_ARGS = options;
-          });
-
-          afterEach(function () {
-            process.env.CODEMOD_CLI_ARGS = '';
-          });
-
-          it('transforms correctly', function () {
-            runInlineTest(
-              transform,
-              {},
-              { path: testInputPath, source: fs.readFileSync(inputPath, 'utf8') },
-              fs.readFileSync(outputPath, 'utf8'),
-              { parser }
-            );
-          });
-
-          it('is idempotent', function () {
-            runInlineTest(
-              transform,
-              {},
-              { path: testInputPath, source: fs.readFileSync(outputPath, 'utf8') },
-              fs.readFileSync(outputPath, 'utf8'),
-              { parser }
-            );
-          });
-        });
-      });
-  });
-}
diff --git a/packages/rtk-codemods/transforms/createReducerBuilder/createReducerBuilder.test.ts b/packages/rtk-codemods/transforms/createReducerBuilder/createReducerBuilder.test.ts
deleted file mode 100644
index 2f1ca8f2..00000000
--- a/packages/rtk-codemods/transforms/createReducerBuilder/createReducerBuilder.test.ts
+++ /dev/null
@@ -1,11 +0,0 @@
-import path from 'path';
-import transform, { parser } from './index';
-
-import { runTransformTest } from '../../transformTestUtils';
-
-runTransformTest(
-  'createReducerBuilder',
-  transform,
-  parser,
-  path.join(__dirname, '__testfixtures__')
-);
diff --git a/packages/rtk-codemods/transforms/createReducerBuilder/test.js b/packages/rtk-codemods/transforms/createReducerBuilder/test.js
new file mode 100644
index 00000000..1d370a60
--- /dev/null
+++ b/packages/rtk-codemods/transforms/createReducerBuilder/test.js
@@ -0,0 +1,10 @@
+'use strict';
+require('ts-node').register();
+
+const { runTransformTest } = require('codemod-cli');
+
+runTransformTest({
+  name: 'createReducerBuilder',
+  path: require.resolve('./index.ts'),
+  fixtureDir: `${__dirname}/__testfixtures__/`,
+});
diff --git a/packages/rtk-codemods/transforms/createSliceBuilder/createSliceBuilder.test.ts b/packages/rtk-codemods/transforms/createSliceBuilder/createSliceBuilder.test.ts
deleted file mode 100644
index 348bc3d4..00000000
--- a/packages/rtk-codemods/transforms/createSliceBuilder/createSliceBuilder.test.ts
+++ /dev/null
@@ -1,6 +0,0 @@
-import path from 'path';
-import transform, { parser } from './index';
-
-import { runTransformTest } from '../../transformTestUtils';
-
-runTransformTest('createSliceBuilder', transform, parser, path.join(__dirname, '__testfixtures__'));
diff --git a/packages/rtk-codemods/transforms/createSliceBuilder/test.js b/packages/rtk-codemods/transforms/createSliceBuilder/test.js
new file mode 100644
index 00000000..930f4a6e
--- /dev/null
+++ b/packages/rtk-codemods/transforms/createSliceBuilder/test.js
@@ -0,0 +1,9 @@
+'use strict';
+
+const { runTransformTest } = require('codemod-cli');
+
+runTransformTest({
+  name: 'createSliceBuilder',
+  path: require.resolve('./index.ts'),
+  fixtureDir: `${__dirname}/__testfixtures__/`,
+});
diff --git a/packages/rtk-codemods/vitest.config.ts b/packages/rtk-codemods/vitest.config.ts
deleted file mode 100644
index b744c564..00000000
--- a/packages/rtk-codemods/vitest.config.ts
+++ /dev/null
@@ -1,13 +0,0 @@
-import { defineConfig } from 'vitest/config';
-
-export default defineConfig({
-  test: {
-    globals: true,
-    setupFiles: [],
-    include: ['./transforms/**/*.(spec|test).[jt]s?(x)'],
-    alias: {},
-    deps: {
-      interopDefault: true,
-    },
-  },
-});
diff --git a/packages/toolkit/src/entities/models.ts b/packages/toolkit/src/entities/models.ts
index f0ad94d6..068dfc22 100644
--- a/packages/toolkit/src/entities/models.ts
+++ b/packages/toolkit/src/entities/models.ts
@@ -1,179 +1,182 @@
-import type { UncheckedIndexedAccess } from '../uncheckedindexed'
-import type { PayloadAction } from '../createAction'
-import type { GetSelectorsOptions } from './state_selectors'
-import type { CastAny, Id as Compute } from '../tsHelpers'
-
-/**
- * @public
- */
-export type EntityId = number | string
-
-/**
- * @public
- */
-export type Comparer<T> = (a: T, b: T) => number
-
-/**
- * @public
- */
-export type IdSelector<T, Id extends EntityId> = (model: T) => Id
-
-/**
- * @public
- */
-export type Update<T, Id extends EntityId> = { id: Id; changes: Partial<T> }
-
-/**
- * @public
- */
-export interface EntityState<T, Id extends EntityId> {
-  ids: Id[]
-  entities: Record<Id, T>
-}
-
-/**
- * @public
- */
-export interface EntityDefinition<T, Id extends EntityId> {
-  selectId: IdSelector<T, Id>
-  sortComparer: false | Comparer<T>
-}
-
-export type PreventAny<S, T, Id extends EntityId> = CastAny<
-  S,
-  EntityState<T, Id>
->
-
-/**
- * @public
- */
-export interface EntityStateAdapter<T, Id extends EntityId> {
-  addOne<S extends EntityState<T, Id>>(
-    state: PreventAny<S, T, Id>,
-    entity: T
-  ): S
-  addOne<S extends EntityState<T, Id>>(
-    state: PreventAny<S, T, Id>,
-    action: PayloadAction<T>
-  ): S
-
-  addMany<S extends EntityState<T, Id>>(
-    state: PreventAny<S, T, Id>,
-    entities: readonly T[] | Record<Id, T>
-  ): S
-  addMany<S extends EntityState<T, Id>>(
-    state: PreventAny<S, T, Id>,
-    entities: PayloadAction<readonly T[] | Record<Id, T>>
-  ): S
-
-  setOne<S extends EntityState<T, Id>>(
-    state: PreventAny<S, T, Id>,
-    entity: T
-  ): S
-  setOne<S extends EntityState<T, Id>>(
-    state: PreventAny<S, T, Id>,
-    action: PayloadAction<T>
-  ): S
-  setMany<S extends EntityState<T, Id>>(
-    state: PreventAny<S, T, Id>,
-    entities: readonly T[] | Record<Id, T>
-  ): S
-  setMany<S extends EntityState<T, Id>>(
-    state: PreventAny<S, T, Id>,
-    entities: PayloadAction<readonly T[] | Record<Id, T>>
-  ): S
-  setAll<S extends EntityState<T, Id>>(
-    state: PreventAny<S, T, Id>,
-    entities: readonly T[] | Record<Id, T>
-  ): S
-  setAll<S extends EntityState<T, Id>>(
-    state: PreventAny<S, T, Id>,
-    entities: PayloadAction<readonly T[] | Record<Id, T>>
-  ): S
-
-  removeOne<S extends EntityState<T, Id>>(
-    state: PreventAny<S, T, Id>,
-    key: Id
-  ): S
-  removeOne<S extends EntityState<T, Id>>(
-    state: PreventAny<S, T, Id>,
-    key: PayloadAction<Id>
-  ): S
-
-  removeMany<S extends EntityState<T, Id>>(
-    state: PreventAny<S, T, Id>,
-    keys: readonly Id[]
-  ): S
-  removeMany<S extends EntityState<T, Id>>(
-    state: PreventAny<S, T, Id>,
-    keys: PayloadAction<readonly Id[]>
-  ): S
-
-  removeAll<S extends EntityState<T, Id>>(state: PreventAny<S, T, Id>): S
-
-  updateOne<S extends EntityState<T, Id>>(
-    state: PreventAny<S, T, Id>,
-    update: Update<T, Id>
-  ): S
-  updateOne<S extends EntityState<T, Id>>(
-    state: PreventAny<S, T, Id>,
-    update: PayloadAction<Update<T, Id>>
-  ): S
-
-  updateMany<S extends EntityState<T, Id>>(
-    state: PreventAny<S, T, Id>,
-    updates: ReadonlyArray<Update<T, Id>>
-  ): S
-  updateMany<S extends EntityState<T, Id>>(
-    state: PreventAny<S, T, Id>,
-    updates: PayloadAction<ReadonlyArray<Update<T, Id>>>
-  ): S
-
-  upsertOne<S extends EntityState<T, Id>>(
-    state: PreventAny<S, T, Id>,
-    entity: T
-  ): S
-  upsertOne<S extends EntityState<T, Id>>(
-    state: PreventAny<S, T, Id>,
-    entity: PayloadAction<T>
-  ): S
-
-  upsertMany<S extends EntityState<T, Id>>(
-    state: PreventAny<S, T, Id>,
-    entities: readonly T[] | Record<Id, T>
-  ): S
-  upsertMany<S extends EntityState<T, Id>>(
-    state: PreventAny<S, T, Id>,
-    entities: PayloadAction<readonly T[] | Record<Id, T>>
-  ): S
-}
-
-/**
- * @public
- */
-export interface EntitySelectors<T, V, Id extends EntityId> {
-  selectIds: (state: V) => Id[]
-  selectEntities: (state: V) => Record<Id, T>
-  selectAll: (state: V) => T[]
-  selectTotal: (state: V) => number
-  selectById: (state: V, id: Id) => Compute<UncheckedIndexedAccess<T>>
-}
-
-/**
- * @public
- */
-export interface EntityAdapter<T, Id extends EntityId>
-  extends EntityStateAdapter<T, Id> {
-  selectId: IdSelector<T, Id>
-  sortComparer: false | Comparer<T>
-  getInitialState(): EntityState<T, Id>
-  getInitialState<S extends object>(state: S): EntityState<T, Id> & S
-  getSelectors(
-    selectState?: undefined,
-    options?: GetSelectorsOptions
-  ): EntitySelectors<T, EntityState<T, Id>, Id>
-  getSelectors<V>(
-    selectState: (state: V) => EntityState<T, Id>,
-    options?: GetSelectorsOptions
-  ): EntitySelectors<T, V, Id>
-}
+import type { UncheckedIndexedAccess } from '../uncheckedindexed'
+import type { Draft } from 'immer'
+import type { PayloadAction } from '../createAction'
+import type { GetSelectorsOptions } from './state_selectors'
+import type { CastAny, Id as Compute } from '../tsHelpers'
+
+/**
+ * @public
+ */
+export type EntityId = number | string
+
+/**
+ * @public
+ */
+export type Comparer<T> = (a: T, b: T) => number
+
+/**
+ * @public
+ */
+export type IdSelector<T, Id extends EntityId> = (model: T) => Id
+
+/**
+ * @public
+ */
+export type Update<T, Id extends EntityId> = { id: Id; changes: Partial<T> }
+
+/**
+ * @public
+ */
+export interface EntityState<T, Id extends EntityId> {
+  ids: Id[]
+  entities: Record<Id, T>
+}
+
+/**
+ * @public
+ */
+export interface EntityDefinition<T, Id extends EntityId> {
+  selectId: IdSelector<T, Id>
+  sortComparer: false | Comparer<T>
+}
+
+export type PreventAny<S, T, Id extends EntityId> = CastAny<
+  S,
+  EntityState<T, Id>
+  >
+
+export type DraftableEntityState<T, Id extends EntityId> = EntityState<T, Id> | Draft<EntityState<T, Id>>
+
+/**
+ * @public
+ */
+export interface EntityStateAdapter<T, Id extends EntityId> {
+  addOne<S extends DraftableEntityState<T, Id>>(
+    state: PreventAny<S, T, Id>,
+    entity: T
+  ): S
+  addOne<S extends DraftableEntityState<T, Id>>(
+    state: PreventAny<S, T, Id>,
+    action: PayloadAction<T>
+  ): S
+
+  addMany<S extends DraftableEntityState<T, Id>>(
+    state: PreventAny<S, T, Id>,
+    entities: readonly T[] | Record<Id, T>
+  ): S
+  addMany<S extends DraftableEntityState<T, Id>>(
+    state: PreventAny<S, T, Id>,
+    entities: PayloadAction<readonly T[] | Record<Id, T>>
+  ): S
+
+  setOne<S extends DraftableEntityState<T, Id>>(
+    state: PreventAny<S, T, Id>,
+    entity: T
+  ): S
+  setOne<S extends DraftableEntityState<T, Id>>(
+    state: PreventAny<S, T, Id>,
+    action: PayloadAction<T>
+  ): S
+  setMany<S extends DraftableEntityState<T, Id>>(
+    state: PreventAny<S, T, Id>,
+    entities: readonly T[] | Record<Id, T>
+  ): S
+  setMany<S extends DraftableEntityState<T, Id>>(
+    state: PreventAny<S, T, Id>,
+    entities: PayloadAction<readonly T[] | Record<Id, T>>
+  ): S
+  setAll<S extends DraftableEntityState<T, Id>>(
+    state: PreventAny<S, T, Id>,
+    entities: readonly T[] | Record<Id, T>
+  ): S
+  setAll<S extends DraftableEntityState<T, Id>>(
+    state: PreventAny<S, T, Id>,
+    entities: PayloadAction<readonly T[] | Record<Id, T>>
+  ): S
+
+  removeOne<S extends DraftableEntityState<T, Id>>(
+    state: PreventAny<S, T, Id>,
+    key: Id
+  ): S
+  removeOne<S extends DraftableEntityState<T, Id>>(
+    state: PreventAny<S, T, Id>,
+    key: PayloadAction<Id>
+  ): S
+
+  removeMany<S extends DraftableEntityState<T, Id>>(
+    state: PreventAny<S, T, Id>,
+    keys: readonly Id[]
+  ): S
+  removeMany<S extends DraftableEntityState<T, Id>>(
+    state: PreventAny<S, T, Id>,
+    keys: PayloadAction<readonly Id[]>
+  ): S
+
+  removeAll<S extends DraftableEntityState<T, Id>>(state: PreventAny<S, T, Id>): S
+
+  updateOne<S extends DraftableEntityState<T, Id>>(
+    state: PreventAny<S, T, Id>,
+    update: Update<T, Id>
+  ): S
+  updateOne<S extends DraftableEntityState<T, Id>>(
+    state: PreventAny<S, T, Id>,
+    update: PayloadAction<Update<T, Id>>
+  ): S
+
+  updateMany<S extends DraftableEntityState<T, Id>>(
+    state: PreventAny<S, T, Id>,
+    updates: ReadonlyArray<Update<T, Id>>
+  ): S
+  updateMany<S extends DraftableEntityState<T, Id>>(
+    state: PreventAny<S, T, Id>,
+    updates: PayloadAction<ReadonlyArray<Update<T, Id>>>
+  ): S
+
+  upsertOne<S extends DraftableEntityState<T, Id>>(
+    state: PreventAny<S, T, Id>,
+    entity: T
+  ): S
+  upsertOne<S extends DraftableEntityState<T, Id>>(
+    state: PreventAny<S, T, Id>,
+    entity: PayloadAction<T>
+  ): S
+
+  upsertMany<S extends DraftableEntityState<T, Id>>(
+    state: PreventAny<S, T, Id>,
+    entities: readonly T[] | Record<Id, T>
+  ): S
+  upsertMany<S extends DraftableEntityState<T, Id>>(
+    state: PreventAny<S, T, Id>,
+    entities: PayloadAction<readonly T[] | Record<Id, T>>
+  ): S
+}
+
+/**
+ * @public
+ */
+export interface EntitySelectors<T, V, Id extends EntityId> {
+  selectIds: (state: V) => Id[]
+  selectEntities: (state: V) => Record<Id, T>
+  selectAll: (state: V) => T[]
+  selectTotal: (state: V) => number
+  selectById: (state: V, id: Id) => Compute<UncheckedIndexedAccess<T>>
+}
+
+/**
+ * @public
+ */
+export interface EntityAdapter<T, Id extends EntityId>
+  extends EntityStateAdapter<T, Id> {
+  selectId: IdSelector<T, Id>
+  sortComparer: false | Comparer<T>
+  getInitialState(): EntityState<T, Id>
+  getInitialState<S extends object>(state: S): EntityState<T, Id> & S
+  getSelectors(
+    selectState?: undefined,
+    options?: GetSelectorsOptions
+  ): EntitySelectors<T, EntityState<T, Id>, Id>
+  getSelectors<V>(
+    selectState: (state: V) => EntityState<T, Id>,
+    options?: GetSelectorsOptions
+  ): EntitySelectors<T, V, Id>
+}
diff --git a/packages/toolkit/src/entities/sorted_state_adapter.ts b/packages/toolkit/src/entities/sorted_state_adapter.ts
index 7d735136..91645d1a 100644
--- a/packages/toolkit/src/entities/sorted_state_adapter.ts
+++ b/packages/toolkit/src/entities/sorted_state_adapter.ts
@@ -1,168 +1,168 @@
-import type {
-  EntityState,
-  IdSelector,
-  Comparer,
-  EntityStateAdapter,
-  Update,
-  EntityId,
-} from './models'
-import { createStateOperator } from './state_adapter'
-import { createUnsortedStateAdapter } from './unsorted_state_adapter'
-import {
-  selectIdValue,
-  ensureEntitiesArray,
-  splitAddedUpdatedEntities,
-} from './utils'
-
-export function createSortedStateAdapter<T, Id extends EntityId>(
-  selectId: IdSelector<T, Id>,
-  sort: Comparer<T>
-): EntityStateAdapter<T, Id> {
-  type R = EntityState<T, Id>
-
-  const { removeOne, removeMany, removeAll } =
-    createUnsortedStateAdapter(selectId)
-
-  function addOneMutably(entity: T, state: R): void {
-    return addManyMutably([entity], state)
-  }
-
-  function addManyMutably(
-    newEntities: readonly T[] | Record<Id, T>,
-    state: R
-  ): void {
-    newEntities = ensureEntitiesArray(newEntities)
-
-    const models = newEntities.filter(
-      (model) => !(selectIdValue(model, selectId) in state.entities)
-    )
-
-    if (models.length !== 0) {
-      merge(models, state)
-    }
-  }
-
-  function setOneMutably(entity: T, state: R): void {
-    return setManyMutably([entity], state)
-  }
-
-  function setManyMutably(
-    newEntities: readonly T[] | Record<Id, T>,
-    state: R
-  ): void {
-    newEntities = ensureEntitiesArray(newEntities)
-    if (newEntities.length !== 0) {
-      merge(newEntities, state)
-    }
-  }
-
-  function setAllMutably(
-    newEntities: readonly T[] | Record<Id, T>,
-    state: R
-  ): void {
-    newEntities = ensureEntitiesArray(newEntities)
-    state.entities = {} as Record<Id, T>
-    state.ids = []
-
-    addManyMutably(newEntities, state)
-  }
-
-  function updateOneMutably(update: Update<T, Id>, state: R): void {
-    return updateManyMutably([update], state)
-  }
-
-  function updateManyMutably(
-    updates: ReadonlyArray<Update<T, Id>>,
-    state: R
-  ): void {
-    let appliedUpdates = false
-
-    for (let update of updates) {
-      const entity: T | undefined = state.entities[update.id]
-      if (!entity) {
-        continue
-      }
-
-      appliedUpdates = true
-
-      Object.assign(entity, update.changes)
-      const newId = selectId(entity)
-      if (update.id !== newId) {
-        delete state.entities[update.id]
-        state.entities[newId] = entity
-      }
-    }
-
-    if (appliedUpdates) {
-      resortEntities(state)
-    }
-  }
-
-  function upsertOneMutably(entity: T, state: R): void {
-    return upsertManyMutably([entity], state)
-  }
-
-  function upsertManyMutably(
-    newEntities: readonly T[] | Record<Id, T>,
-    state: R
-  ): void {
-    const [added, updated] = splitAddedUpdatedEntities<T, Id>(
-      newEntities,
-      selectId,
-      state
-    )
-
-    updateManyMutably(updated, state)
-    addManyMutably(added, state)
-  }
-
-  function areArraysEqual(a: readonly unknown[], b: readonly unknown[]) {
-    if (a.length !== b.length) {
-      return false
-    }
-
-    for (let i = 0; i < a.length && i < b.length; i++) {
-      if (a[i] === b[i]) {
-        continue
-      }
-      return false
-    }
-    return true
-  }
-
-  function merge(models: readonly T[], state: R): void {
-    // Insert/overwrite all new/updated
-    models.forEach((model) => {
-      state.entities[selectId(model)] = model
-    })
-
-    resortEntities(state)
-  }
-
-  function resortEntities(state: R) {
-    const allEntities = Object.values(state.entities) as T[]
-    allEntities.sort(sort)
-
-    const newSortedIds = allEntities.map(selectId)
-    const { ids } = state
-
-    if (!areArraysEqual(ids, newSortedIds)) {
-      state.ids = newSortedIds
-    }
-  }
-
-  return {
-    removeOne,
-    removeMany,
-    removeAll,
-    addOne: createStateOperator(addOneMutably),
-    updateOne: createStateOperator(updateOneMutably),
-    upsertOne: createStateOperator(upsertOneMutably),
-    setOne: createStateOperator(setOneMutably),
-    setMany: createStateOperator(setManyMutably),
-    setAll: createStateOperator(setAllMutably),
-    addMany: createStateOperator(addManyMutably),
-    updateMany: createStateOperator(updateManyMutably),
-    upsertMany: createStateOperator(upsertManyMutably),
-  }
-}
+import type {
+  IdSelector,
+  Comparer,
+  EntityStateAdapter,
+  Update,
+  EntityId,
+  DraftableEntityState
+} from './models'
+import { createStateOperator } from './state_adapter'
+import { createUnsortedStateAdapter } from './unsorted_state_adapter'
+import {
+  selectIdValue,
+  ensureEntitiesArray,
+  splitAddedUpdatedEntities,
+} from './utils'
+
+export function createSortedStateAdapter<T, Id extends EntityId>(
+  selectId: IdSelector<T, Id>,
+  sort: Comparer<T>
+): EntityStateAdapter<T, Id> {
+  type R = DraftableEntityState<T, Id>
+
+  const { removeOne, removeMany, removeAll } =
+    createUnsortedStateAdapter(selectId)
+
+  function addOneMutably(entity: T, state: R): void {
+    return addManyMutably([entity], state)
+  }
+
+  function addManyMutably(
+    newEntities: readonly T[] | Record<Id, T>,
+    state: R
+  ): void {
+    newEntities = ensureEntitiesArray(newEntities)
+
+    const models = newEntities.filter(
+      (model) => !(selectIdValue(model, selectId) in state.entities)
+    )
+
+    if (models.length !== 0) {
+      merge(models, state)
+    }
+  }
+
+  function setOneMutably(entity: T, state: R): void {
+    return setManyMutably([entity], state)
+  }
+
+  function setManyMutably(
+    newEntities: readonly T[] | Record<Id, T>,
+    state: R
+  ): void {
+    newEntities = ensureEntitiesArray(newEntities)
+    if (newEntities.length !== 0) {
+      merge(newEntities, state)
+    }
+  }
+
+  function setAllMutably(
+    newEntities: readonly T[] | Record<Id, T>,
+    state: R
+  ): void {
+    newEntities = ensureEntitiesArray(newEntities)
+    state.entities = {} as Record<Id, T>
+    state.ids = []
+
+    addManyMutably(newEntities, state)
+  }
+
+  function updateOneMutably(update: Update<T, Id>, state: R): void {
+    return updateManyMutably([update], state)
+  }
+
+  function updateManyMutably(
+    updates: ReadonlyArray<Update<T, Id>>,
+    state: R
+  ): void {
+    let appliedUpdates = false
+
+    for (let update of updates) {
+      const entity: T | undefined = (state.entities as Record<Id, T>)[update.id]
+      if (!entity) {
+        continue
+      }
+
+      appliedUpdates = true
+
+      Object.assign(entity, update.changes)
+      const newId = selectId(entity)
+      if (update.id !== newId) {
+        delete (state.entities as Record<Id, T>)[update.id];
+        (state.entities as Record<Id, T>)[newId] = entity
+      }
+    }
+
+    if (appliedUpdates) {
+      resortEntities(state)
+    }
+  }
+
+  function upsertOneMutably(entity: T, state: R): void {
+    return upsertManyMutably([entity], state)
+  }
+
+  function upsertManyMutably(
+    newEntities: readonly T[] | Record<Id, T>,
+    state: R
+  ): void {
+    const [added, updated] = splitAddedUpdatedEntities<T, Id>(
+      newEntities,
+      selectId,
+      state
+    )
+
+    updateManyMutably(updated, state)
+    addManyMutably(added, state)
+  }
+
+  function areArraysEqual(a: readonly unknown[], b: readonly unknown[]) {
+    if (a.length !== b.length) {
+      return false
+    }
+
+    for (let i = 0; i < a.length && i < b.length; i++) {
+      if (a[i] === b[i]) {
+        continue
+      }
+      return false
+    }
+    return true
+  }
+
+  function merge(models: readonly T[], state: R): void {
+    // Insert/overwrite all new/updated
+    models.forEach((model) => {
+      (state.entities as Record<Id, T>)[selectId(model)] = model
+    })
+
+    resortEntities(state)
+  }
+
+  function resortEntities(state: R) {
+    const allEntities = Object.values(state.entities) as T[]
+    allEntities.sort(sort)
+
+    const newSortedIds = allEntities.map(selectId)
+    const { ids } = state
+
+    if (!areArraysEqual(ids, newSortedIds)) {
+      state.ids = newSortedIds
+    }
+  }
+
+  return {
+    removeOne,
+    removeMany,
+    removeAll,
+    addOne: createStateOperator(addOneMutably),
+    updateOne: createStateOperator(updateOneMutably),
+    upsertOne: createStateOperator(upsertOneMutably),
+    setOne: createStateOperator(setOneMutably),
+    setMany: createStateOperator(setManyMutably),
+    setAll: createStateOperator(setAllMutably),
+    addMany: createStateOperator(addManyMutably),
+    updateMany: createStateOperator(updateManyMutably),
+    upsertMany: createStateOperator(upsertManyMutably),
+  }
+}
diff --git a/packages/toolkit/src/entities/state_adapter.ts b/packages/toolkit/src/entities/state_adapter.ts
index c37c56f2..93738d21 100644
--- a/packages/toolkit/src/entities/state_adapter.ts
+++ b/packages/toolkit/src/entities/state_adapter.ts
@@ -1,17 +1,19 @@
 import { produce as createNextState, isDraft } from 'immer'
-import type { EntityId, EntityState, PreventAny } from './models'
+import type {  Draft } from 'immer'
+import type { EntityId, DraftableEntityState, PreventAny } from './models'
 import type { PayloadAction } from '../createAction'
 import { isFSA } from '../createAction'
-import { IsAny } from '../tsHelpers'
+
+export const isDraftTyped = isDraft as <T>(value: T | Draft<T>) => value is Draft<T>
 
 export function createSingleArgumentStateOperator<T, Id extends EntityId>(
-  mutator: (state: EntityState<T, Id>) => void
+  mutator: (state: DraftableEntityState<T, Id>) => void
 ) {
   const operator = createStateOperator(
-    (_: undefined, state: EntityState<T, Id>) => mutator(state)
+    (_: undefined, state: DraftableEntityState<T, Id>) => mutator(state)
   )
 
-  return function operation<S extends EntityState<T, Id>>(
+  return function operation<S extends DraftableEntityState<T, Id>>(
     state: PreventAny<S, T, Id>
   ): S {
     return operator(state as S, undefined)
@@ -19,9 +21,9 @@ export function createSingleArgumentStateOperator<T, Id extends EntityId>(
 }
 
 export function createStateOperator<T, Id extends EntityId, R>(
-  mutator: (arg: R, state: EntityState<T, Id>) => void
+  mutator: (arg: R, state: DraftableEntityState<T, Id>) => void
 ) {
-  return function operation<S extends EntityState<T, Id>>(
+  return function operation<S extends DraftableEntityState<T, Id>>(
     state: S,
     arg: R | PayloadAction<R>
   ): S {
@@ -31,7 +33,7 @@ export function createStateOperator<T, Id extends EntityId, R>(
       return isFSA(arg)
     }
 
-    const runMutator = (draft: EntityState<T, Id>) => {
+    const runMutator = (draft: DraftableEntityState<T, Id>) => {
       if (isPayloadActionArgument(arg)) {
         mutator(arg.payload, draft)
       } else {
@@ -39,7 +41,7 @@ export function createStateOperator<T, Id extends EntityId, R>(
       }
     }
 
-    if (isDraft(state)) {
+    if (isDraftTyped<DraftableEntityState<T, Id>>(state)) {
       // we must already be inside a `createNextState` call, likely because
       // this is being wrapped in `createReducer` or `createSlice`.
       // It's safe to just pass the draft to the mutator.
@@ -47,11 +49,8 @@ export function createStateOperator<T, Id extends EntityId, R>(
 
       // since it's a draft, we'll just return it
       return state
-    } else {
-      // @ts-ignore createNextState() produces an Immutable<Draft<S>> rather
-      // than an Immutable<S>, and TypeScript cannot find out how to reconcile
-      // these two types.
-      return createNextState(state, runMutator)
     }
+    
+    return createNextState(state, runMutator)
   }
 }
diff --git a/packages/toolkit/src/entities/tests/entity_slice_enhancer.test.ts b/packages/toolkit/src/entities/tests/entity_slice_enhancer.test.ts
new file mode 100644
index 00000000..9e8e3808
--- /dev/null
+++ b/packages/toolkit/src/entities/tests/entity_slice_enhancer.test.ts
@@ -0,0 +1,57 @@
+import { createEntityAdapter, createSlice } from "../..";
+import type { PayloadAction, Slice, SliceCaseReducers, UnknownAction } from "../..";
+import type { EntityId, EntityState, IdSelector } from "../models";
+import type { BookModel } from "./fixtures/book";
+
+describe('Entity Slice Enhancer', () => {
+  let slice: Slice<EntityState<BookModel, BookModel['id']>>;
+
+  beforeEach(() => {
+    const indieSlice = entitySliceEnhancer({
+      name: 'book',
+      selectId: (book: BookModel) => book.id
+    })
+    slice = indieSlice
+  })
+
+  it('exposes oneAdded', () => {
+    const book = {
+      id: '0',
+      title: 'Der Steppenwolf',
+      author: 'Herman Hesse'
+    }
+    const action = slice.actions.oneAdded(book)
+    const oneAdded = slice.reducer(undefined, action as UnknownAction)
+    expect(oneAdded.entities['0']).toBe(book)
+  })
+})
+
+interface EntitySliceArgs<T, Id extends EntityId> {
+  name: string
+  selectId: IdSelector<T, Id>
+  modelReducer?: SliceCaseReducers<T>
+}
+
+function entitySliceEnhancer<T, Id extends EntityId>({
+  name,
+  selectId,
+  modelReducer
+}: EntitySliceArgs<T, Id>) {
+  const modelAdapter = createEntityAdapter({
+    selectId
+  });
+
+  return createSlice({
+    name,
+    initialState: modelAdapter.getInitialState(),
+    reducers: {
+      oneAdded(state, action: PayloadAction<T>) {
+        modelAdapter.addOne(
+          state,
+          action.payload
+        )
+      },
+      ...modelReducer
+    }
+  })
+}
diff --git a/packages/toolkit/src/entities/tests/entity_state.test.ts b/packages/toolkit/src/entities/tests/entity_state.test.ts
index f28048de..65accf47 100644
--- a/packages/toolkit/src/entities/tests/entity_state.test.ts
+++ b/packages/toolkit/src/entities/tests/entity_state.test.ts
@@ -6,7 +6,7 @@ import { createSlice } from '../../createSlice'
 import type { BookModel } from './fixtures/book'
 
 describe('Entity State', () => {
-  let adapter: EntityAdapter<string, BookModel>
+  let adapter: EntityAdapter<BookModel, string>
 
   beforeEach(() => {
     adapter = createEntityAdapter({
diff --git a/packages/toolkit/src/entities/unsorted_state_adapter.ts b/packages/toolkit/src/entities/unsorted_state_adapter.ts
index 77697e16..1b74a014 100644
--- a/packages/toolkit/src/entities/unsorted_state_adapter.ts
+++ b/packages/toolkit/src/entities/unsorted_state_adapter.ts
@@ -1,9 +1,10 @@
+import type { Draft } from 'immer'
 import type {
-  EntityState,
   EntityStateAdapter,
   IdSelector,
   Update,
   EntityId,
+  DraftableEntityState
 } from './models'
 import {
   createStateOperator,
@@ -18,7 +19,7 @@ import {
 export function createUnsortedStateAdapter<T, Id extends EntityId>(
   selectId: IdSelector<T, Id>
 ): EntityStateAdapter<T, Id> {
-  type R = EntityState<T, Id>
+  type R = DraftableEntityState<T, Id>
 
   function addOneMutably(entity: T, state: R): void {
     const key = selectIdValue(entity, selectId)
@@ -27,8 +28,8 @@ export function createUnsortedStateAdapter<T, Id extends EntityId>(
       return
     }
 
-    state.ids.push(key)
-    state.entities[key] = entity
+    state.ids.push(key as Id & Draft<Id>);
+    (state.entities as Record<Id, T>)[key] = entity
   }
 
   function addManyMutably(
@@ -45,9 +46,9 @@ export function createUnsortedStateAdapter<T, Id extends EntityId>(
   function setOneMutably(entity: T, state: R): void {
     const key = selectIdValue(entity, selectId)
     if (!(key in state.entities)) {
-      state.ids.push(key)
+      state.ids.push(key as Id & Draft<Id>);
     }
-    state.entities[key] = entity
+    (state.entities as Record<Id, T>)[key] = entity
   }
 
   function setManyMutably(
@@ -81,13 +82,13 @@ export function createUnsortedStateAdapter<T, Id extends EntityId>(
 
     keys.forEach((key) => {
       if (key in state.entities) {
-        delete state.entities[key]
+        delete (state.entities as Record<Id, T>)[key]
         didMutate = true
       }
     })
 
     if (didMutate) {
-      state.ids = state.ids.filter((id) => id in state.entities)
+      state.ids = (state.ids as Id[]).filter((id) => id in state.entities) as Id[] | Draft<Id[]>
     }
   }
 
@@ -103,7 +104,7 @@ export function createUnsortedStateAdapter<T, Id extends EntityId>(
     update: Update<T, Id>,
     state: R
   ): boolean {
-    const original: T | undefined = state.entities[update.id]
+    const original: T | undefined = (state.entities as Record<Id, T>)[update.id]
     if (original === undefined) {
       return false
     }
@@ -113,10 +114,10 @@ export function createUnsortedStateAdapter<T, Id extends EntityId>(
 
     if (hasNewKey) {
       keys[update.id] = newKey
-      delete state.entities[update.id]
+      delete (state.entities as Record<Id, T>)[update.id]
     }
 
-    state.entities[newKey] = updated
+    (state.entities as Record<Id, T>)[newKey] = updated
 
     return hasNewKey
   }
diff --git a/packages/toolkit/src/entities/utils.ts b/packages/toolkit/src/entities/utils.ts
index 8c86f618..71435e3a 100644
--- a/packages/toolkit/src/entities/utils.ts
+++ b/packages/toolkit/src/entities/utils.ts
@@ -1,4 +1,4 @@
-import type { EntityState, IdSelector, Update, EntityId } from './models'
+import type { IdSelector, Update, EntityId, DraftableEntityState } from './models'
 
 export function selectIdValue<T, Id extends EntityId>(
   entity: T,
@@ -33,7 +33,7 @@ export function ensureEntitiesArray<T, Id extends EntityId>(
 export function splitAddedUpdatedEntities<T, Id extends EntityId>(
   newEntities: readonly T[] | Record<Id, T>,
   selectId: IdSelector<T, Id>,
-  state: EntityState<T, Id>
+  state: DraftableEntityState<T, Id>
 ): [T[], Update<T, Id>[]] {
   newEntities = ensureEntitiesArray(newEntities)
 
diff --git a/yarn.lock b/yarn.lock
index c7444afa..e74fb26b 100644
--- a/yarn.lock
+++ b/yarn.lock
@@ -6926,13 +6926,17 @@ __metadata:
   version: 0.0.0-use.local
   resolution: "@reduxjs/rtk-codemods@workspace:packages/rtk-codemods"
   dependencies:
+    "@types/jest": ^27
     "@types/jscodeshift": ^0.11.5
     codemod-cli: ^3.2.0
     eslint: ^7.25.0
     eslint-config-prettier: ^8.3.0
     eslint-plugin-node: ^11.1.0
     eslint-plugin-prettier: ^3.4.0
+    jest: ^27
     prettier: ^2.2.1
+    ts-jest: ^27
+    ts-node: 10.4.0
     typescript: ^4.8.0
   bin:
     rtk-codemods: ./bin/cli.js
@@ -19103,7 +19107,7 @@ fsevents@^1.2.7:
   languageName: node
   linkType: hard
 
-"jest-util@npm:^27.5.1":
+"jest-util@npm:^27.0.0, jest-util@npm:^27.5.1":
   version: 27.5.1
   resolution: "jest-util@npm:27.5.1"
   dependencies:
@@ -19271,7 +19275,7 @@ fsevents@^1.2.7:
   languageName: node
   linkType: hard
 
-"jest@npm:^27.4.3":
+"jest@npm:^27, jest@npm:^27.4.3":
   version: 27.5.1
   resolution: "jest@npm:27.5.1"
   dependencies:
@@ -19589,6 +19593,15 @@ fsevents@^1.2.7:
   languageName: node
   linkType: hard
 
+"json5@npm:2.x, json5@npm:^2.1.2, json5@npm:^2.2.0, json5@npm:^2.2.1":
+  version: 2.2.1
+  resolution: "json5@npm:2.2.1"
+  bin:
+    json5: lib/cli.js
+  checksum: 74b8a23b102a6f2bf2d224797ae553a75488b5adbaee9c9b6e5ab8b510a2fc6e38f876d4c77dea672d4014a44b2399e15f2051ac2b37b87f74c0c7602003543b
+  languageName: node
+  linkType: hard
+
 "json5@npm:^1.0.1":
   version: 1.0.1
   resolution: "json5@npm:1.0.1"
@@ -19600,15 +19613,6 @@ fsevents@^1.2.7:
   languageName: node
   linkType: hard
 
-"json5@npm:^2.1.2, json5@npm:^2.2.0, json5@npm:^2.2.1":
-  version: 2.2.1
-  resolution: "json5@npm:2.2.1"
-  bin:
-    json5: lib/cli.js
-  checksum: 74b8a23b102a6f2bf2d224797ae553a75488b5adbaee9c9b6e5ab8b510a2fc6e38f876d4c77dea672d4014a44b2399e15f2051ac2b37b87f74c0c7602003543b
-  languageName: node
-  linkType: hard
-
 "json5@npm:^2.2.3":
   version: 2.2.3
   resolution: "json5@npm:2.2.3"
@@ -28218,6 +28222,39 @@ fsevents@^1.2.7:
   languageName: node
   linkType: hard
 
+"ts-jest@npm:^27":
+  version: 27.1.5
+  resolution: "ts-jest@npm:27.1.5"
+  dependencies:
+    bs-logger: 0.x
+    fast-json-stable-stringify: 2.x
+    jest-util: ^27.0.0
+    json5: 2.x
+    lodash.memoize: 4.x
+    make-error: 1.x
+    semver: 7.x
+    yargs-parser: 20.x
+  peerDependencies:
+    "@babel/core": ">=7.0.0-beta.0 <8"
+    "@types/jest": ^27.0.0
+    babel-jest: ">=27.0.0 <28"
+    jest: ^27.0.0
+    typescript: ">=3.8 <5.0"
+  peerDependenciesMeta:
+    "@babel/core":
+      optional: true
+    "@types/jest":
+      optional: true
+    babel-jest:
+      optional: true
+    esbuild:
+      optional: true
+  bin:
+    ts-jest: cli.js
+  checksum: 3ef51c538b82f49b3f529331c1a017871a2f90e7a9a6e69333304755036d121818c6b120e2ce32dd161ff8bb2487efec0c790753ecd39b46a9ed1ce0d241464c
+  languageName: node
+  linkType: hard
+
 "ts-jest@npm:^29":
   version: 29.0.5
   resolution: "ts-jest@npm:29.0.5"
@@ -30638,7 +30675,7 @@ fsevents@^1.2.7:
   languageName: node
   linkType: hard
 
-"yargs-parser@npm:20.2.9, yargs-parser@npm:^20.2.2":
+"yargs-parser@npm:20.2.9, yargs-parser@npm:20.x, yargs-parser@npm:^20.2.2":
   version: 20.2.9
   resolution: "yargs-parser@npm:20.2.9"
   checksum: 8bb69015f2b0ff9e17b2c8e6bfe224ab463dd00ca211eece72a4cd8a906224d2703fb8a326d36fdd0e68701e201b2a60ed7cf81ce0fd9b3799f9fe7745977ae3
