diff --git a/packages/nx/src/plugins/js/index.ts b/packages/nx/src/plugins/js/index.ts
index 99ff689c15..70a584d5e2 100644
--- a/packages/nx/src/plugins/js/index.ts
+++ b/packages/nx/src/plugins/js/index.ts
@@ -2,7 +2,10 @@ import { execSync } from 'child_process';
 import { mkdirSync, readFileSync, writeFileSync } from 'fs';
 import { dirname, join } from 'path';
 import { performance } from 'perf_hooks';
-import { ProjectGraph } from '../../config/project-graph';
+import {
+  ProjectGraph,
+  ProjectGraphExternalNode,
+} from '../../config/project-graph';
 import { hashArray } from '../../hasher/file-hasher';
 import {
   CreateDependencies,
@@ -32,6 +35,7 @@ export const name = 'nx/js/dependencies-and-lockfile';
 
 // Separate in-memory caches
 let cachedExternalNodes: ProjectGraph['externalNodes'] | undefined;
+let cachedKeyMap: Map<string, any> | undefined;
 
 export const createNodesV2: CreateNodesV2 = [
   combineGlobPatterns(LOCKFILES),
@@ -65,23 +69,25 @@ function internalCreateNodes(
   const lockFileHash = getLockFileHash(lockFileContents);
 
   if (!lockFileNeedsReprocessing(lockFileHash, externalNodesHashFile)) {
-    const nodes = readCachedExternalNodes();
+    const { nodes, keyMap } = readCachedExternalNodes();
     cachedExternalNodes = nodes;
+    cachedKeyMap = keyMap;
 
     return {
       externalNodes: nodes,
     };
   }
 
-  const externalNodes = getLockFileNodes(
+  const { nodes: externalNodes, keyMap } = getLockFileNodes(
     packageManager,
     lockFileContents,
     lockFileHash,
     context
   );
   cachedExternalNodes = externalNodes;
+  cachedKeyMap = keyMap;
 
-  writeExternalNodesCache(lockFileHash, externalNodes);
+  writeExternalNodesCache(lockFileHash, externalNodes, keyMap);
 
   return {
     externalNodes,
@@ -117,7 +123,8 @@ export const createDependencies: CreateDependencies = (
         packageManager,
         lockFileContents,
         lockFileHash,
-        ctx
+        ctx,
+        cachedKeyMap
       );
 
       writeDependenciesCache(lockFileHash, lockfileDependencies);
@@ -142,6 +149,49 @@ function getLockFileHash(lockFileContents: string) {
   return hashArray([nxVersion, lockFileContents]);
 }
 
+// Serialize keyMap to JSON-friendly format
+function serializeKeyMap(keyMap: Map<string, any>): Record<string, any> {
+  const serialized: Record<string, any> = {};
+  for (const [key, value] of keyMap.entries()) {
+    if (value instanceof Set) {
+      // pnpm: Map<string, Set<ProjectGraphExternalNode>>
+      serialized[key] = Array.from(value).map((node) => node.name);
+    } else if (value && typeof value === 'object' && 'name' in value) {
+      // npm/yarn: Map<string, ProjectGraphExternalNode>
+      serialized[key] = value.name;
+    } else {
+      serialized[key] = value;
+    }
+  }
+  return serialized;
+}
+
+// Deserialize keyMap from JSON format using ctx.externalNodes
+function deserializeKeyMap(
+  serialized: Record<string, any>,
+  externalNodes: Record<string, ProjectGraphExternalNode>
+): Map<string, any> {
+  const keyMap = new Map<string, any>();
+  for (const [key, value] of Object.entries(serialized)) {
+    if (Array.isArray(value)) {
+      // pnpm: reconstruct Set<ProjectGraphExternalNode>
+      const nodes = value
+        .map((nodeName) => externalNodes[nodeName])
+        .filter(Boolean);
+      keyMap.set(key, new Set(nodes));
+    } else if (typeof value === 'string') {
+      // npm/yarn: reconstruct ProjectGraphExternalNode
+      const node = externalNodes[value];
+      if (node) {
+        keyMap.set(key, node);
+      }
+    } else {
+      keyMap.set(key, value);
+    }
+  }
+  return keyMap;
+}
+
 function lockFileNeedsReprocessing(lockHash: string, hashFilePath: string) {
   try {
     return readFileSync(hashFilePath).toString() !== lockHash;
@@ -153,15 +203,24 @@ function lockFileNeedsReprocessing(lockHash: string, hashFilePath: string) {
 // External nodes cache functions
 function writeExternalNodesCache(
   hash: string,
-  nodes: ProjectGraph['externalNodes']
+  nodes: ProjectGraph['externalNodes'],
+  keyMap: Map<string, any>
 ) {
   mkdirSync(dirname(externalNodesHashFile), { recursive: true });
-  writeFileSync(externalNodesCache, JSON.stringify(nodes, null, 2));
+  const serializedKeyMap = serializeKeyMap(keyMap);
+  const cacheData = { nodes, keyMap: serializedKeyMap };
+  writeFileSync(externalNodesCache, JSON.stringify(cacheData, null, 2));
   writeFileSync(externalNodesHashFile, hash);
 }
 
-function readCachedExternalNodes(): ProjectGraph['externalNodes'] {
-  return JSON.parse(readFileSync(externalNodesCache).toString());
+function readCachedExternalNodes(): {
+  nodes: ProjectGraph['externalNodes'];
+  keyMap: Map<string, any>;
+} {
+  const { nodes, keyMap } = JSON.parse(
+    readFileSync(externalNodesCache, 'utf-8')
+  );
+  return { nodes, keyMap: deserializeKeyMap(keyMap, nodes) };
 }
 
 // Dependencies cache functions
diff --git a/packages/nx/src/plugins/js/lock-file/lock-file.ts b/packages/nx/src/plugins/js/lock-file/lock-file.ts
index f1dbcce76b..ce6ee4fc85 100644
--- a/packages/nx/src/plugins/js/lock-file/lock-file.ts
+++ b/packages/nx/src/plugins/js/lock-file/lock-file.ts
@@ -74,7 +74,10 @@ export function getLockFileNodes(
   contents: string,
   lockFileHash: string,
   context: CreateNodesContextV2
-): Record<string, ProjectGraphExternalNode> {
+): {
+  nodes: Record<string, ProjectGraphExternalNode>;
+  keyMap: Map<string, any>;
+} {
   try {
     if (packageManager === 'yarn') {
       const packageJson = readJsonFile(
@@ -92,7 +95,8 @@ export function getLockFileNodes(
       const lockFilePath = getLockFilePath(packageManager);
       if (lockFilePath.endsWith(BUN_TEXT_LOCK_FILE)) {
         // Use new text-based parser
-        return getBunTextLockfileNodes(contents, lockFileHash);
+        const nodes = getBunTextLockfileNodes(contents, lockFileHash);
+        return { nodes, keyMap: new Map() };
       } else {
         // Fallback to yarn parser for binary format
         const packageJson = readJsonFile(
@@ -120,25 +124,47 @@ export function getLockFileDependencies(
   packageManager: PackageManager,
   contents: string,
   lockFileHash: string,
-  context: CreateDependenciesContext
+  context: CreateDependenciesContext,
+  keyMap: Map<string, any>
 ): RawProjectGraphDependency[] {
   try {
     if (packageManager === 'yarn') {
-      return getYarnLockfileDependencies(contents, lockFileHash, context);
+      return getYarnLockfileDependencies(
+        contents,
+        lockFileHash,
+        context,
+        keyMap
+      );
     }
     if (packageManager === 'pnpm') {
-      return getPnpmLockfileDependencies(contents, lockFileHash, context);
+      return getPnpmLockfileDependencies(
+        contents,
+        lockFileHash,
+        context,
+        keyMap
+      );
     }
     if (packageManager === 'npm') {
-      return getNpmLockfileDependencies(contents, lockFileHash, context);
+      return getNpmLockfileDependencies(
+        contents,
+        lockFileHash,
+        context,
+        keyMap
+      );
     }
     if (packageManager === 'bun') {
       const lockFilePath = getLockFilePath(packageManager);
       if (lockFilePath.endsWith(BUN_TEXT_LOCK_FILE)) {
+        // Bun parser doesn't use keyMap
         return getBunTextLockfileDependencies(contents, lockFileHash, context);
       } else {
         // Fallback to yarn parser for binary format
-        return getYarnLockfileDependencies(contents, lockFileHash, context);
+        return getYarnLockfileDependencies(
+          contents,
+          lockFileHash,
+          context,
+          keyMap
+        );
       }
     }
   } catch (e) {
diff --git a/packages/nx/src/plugins/js/lock-file/npm-parser.ts b/packages/nx/src/plugins/js/lock-file/npm-parser.ts
index f9b8817cc6..1f8e7a4cab 100644
--- a/packages/nx/src/plugins/js/lock-file/npm-parser.ts
+++ b/packages/nx/src/plugins/js/lock-file/npm-parser.ts
@@ -56,9 +56,6 @@ type NpmLockFile = {
   packages?: Record<string, NpmDependencyV3>;
   dependencies?: Record<string, NpmDependencyV1>;
 };
-
-// we use key => node map to avoid duplicate work when parsing keys
-let keyMap = new Map<string, ProjectGraphExternalNode>();
 let currentLockFileHash: string;
 
 let parsedLockFile: NpmLockFile;
@@ -68,7 +65,6 @@ function parsePackageLockFile(lockFileContent: string, lockFileHash: string) {
     return parsedLockFile;
   }
 
-  keyMap.clear();
   const results = JSON.parse(lockFileContent) as NpmLockFile;
   parsedLockFile = results;
   currentLockFileHash = lockFileHash;
@@ -78,20 +74,23 @@ function parsePackageLockFile(lockFileContent: string, lockFileHash: string) {
 export function getNpmLockfileNodes(
   lockFileContent: string,
   lockFileHash: string
-) {
+): {
+  nodes: Record<string, ProjectGraphExternalNode>;
+  keyMap: Map<string, ProjectGraphExternalNode>;
+} {
   const data = parsePackageLockFile(
     lockFileContent,
     lockFileHash
   ) as NpmLockFile;
 
-  // we use key => node map to avoid duplicate work when parsing keys
-  return getNodes(data, keyMap);
+  return getNodes(data);
 }
 
 export function getNpmLockfileDependencies(
   lockFileContent: string,
   lockFileHash: string,
-  ctx: CreateDependenciesContext
+  ctx: CreateDependenciesContext,
+  keyMap: Map<string, ProjectGraphExternalNode>
 ) {
   const data = parsePackageLockFile(
     lockFileContent,
@@ -101,10 +100,11 @@ export function getNpmLockfileDependencies(
   return getDependencies(data, keyMap, ctx);
 }
 
-function getNodes(
-  data: NpmLockFile,
-  keyMap: Map<string, ProjectGraphExternalNode>
-) {
+function getNodes(data: NpmLockFile): {
+  nodes: Record<string, ProjectGraphExternalNode>;
+  keyMap: Map<string, ProjectGraphExternalNode>;
+} {
+  const keyMap = new Map<string, ProjectGraphExternalNode>();
   const nodes: Map<string, Map<string, ProjectGraphExternalNode>> = new Map();
 
   if (data.lockfileVersion > 1) {
@@ -164,7 +164,7 @@ function getNodes(
       results[node.name] = node;
     });
   }
-  return results;
+  return { nodes: results, keyMap };
 }
 
 function addV1Node(
diff --git a/packages/nx/src/plugins/js/lock-file/pnpm-parser.ts b/packages/nx/src/plugins/js/lock-file/pnpm-parser.ts
index ea71cd45f5..b4155eeecb 100644
--- a/packages/nx/src/plugins/js/lock-file/pnpm-parser.ts
+++ b/packages/nx/src/plugins/js/lock-file/pnpm-parser.ts
@@ -30,9 +30,6 @@ import { getCatalogManager } from '../../../utils/catalog';
 import { findNodeMatchingVersion } from './project-graph-pruning';
 import { join } from 'path';
 import { getWorkspacePackagesFromGraph } from '../utils/get-workspace-packages-from-graph';
-
-// we use key => node map to avoid duplicate work when parsing keys
-let keyMap = new Map<string, Set<ProjectGraphExternalNode>>();
 let currentLockFileHash: string;
 
 let parsedLockFile: Lockfile;
@@ -45,7 +42,6 @@ function parsePnpmLockFile(
     return parsedLockFile;
   }
 
-  keyMap.clear();
   const results = parseAndNormalizePnpmLockfile(lockFileContent);
   parsedLockFile = results;
   currentLockFileHash = lockFileHash;
@@ -55,7 +51,10 @@ function parsePnpmLockFile(
 export function getPnpmLockfileNodes(
   lockFileContent: string,
   lockFileHash: string
-): Record<string, ProjectGraphExternalNode> {
+): {
+  nodes: Record<string, ProjectGraphExternalNode>;
+  keyMap: Map<string, Set<ProjectGraphExternalNode>>;
+} {
   const data = parsePnpmLockFile(lockFileContent, lockFileHash);
   if (+data.lockfileVersion.toString() >= 10) {
     console.warn(
@@ -63,13 +62,14 @@ export function getPnpmLockfileNodes(
     );
   }
   const isV5 = isV5Syntax(data);
-  return getNodes(data, keyMap, isV5);
+  return getNodes(data, isV5);
 }
 
 export function getPnpmLockfileDependencies(
   lockFileContent: string,
   lockFileHash: string,
-  ctx: CreateDependenciesContext
+  ctx: CreateDependenciesContext,
+  keyMap: Map<string, Set<ProjectGraphExternalNode>>
 ) {
   const data = parsePnpmLockFile(lockFileContent, lockFileHash);
   if (+data.lockfileVersion.toString() >= 10) {
@@ -129,9 +129,12 @@ function isAliasVersion(depVersion: string) {
 
 function getNodes(
   data: Lockfile,
-  keyMap: Map<string, Set<ProjectGraphExternalNode>>,
   isV5: boolean
-): Record<string, ProjectGraphExternalNode> {
+): {
+  nodes: Record<string, ProjectGraphExternalNode>;
+  keyMap: Map<string, Set<ProjectGraphExternalNode>>;
+} {
+  const keyMap = new Map<string, Set<ProjectGraphExternalNode>>();
   const nodes: Map<string, Map<string, ProjectGraphExternalNode>> = new Map();
 
   const maybeAliasedPackageVersions = new Map<string, string>(); // <version, alias>
@@ -331,7 +334,7 @@ function getNodes(
       results[node.name] = node;
     });
   }
-  return results;
+  return { nodes: results, keyMap };
 }
 
 function getHoistedVersion(
diff --git a/packages/nx/src/plugins/js/lock-file/yarn-parser.ts b/packages/nx/src/plugins/js/lock-file/yarn-parser.ts
index 22c79f4106..eb21340210 100644
--- a/packages/nx/src/plugins/js/lock-file/yarn-parser.ts
+++ b/packages/nx/src/plugins/js/lock-file/yarn-parser.ts
@@ -43,9 +43,6 @@ type YarnDependency = {
 let currentLockFileHash: string;
 let cachedParsedLockFile;
 
-// we use key => node map to avoid duplicate work when parsing keys
-let keyMap = new Map<string, ProjectGraphExternalNode>();
-
 function parseLockFile(lockFileContent: string, lockFileHash: string) {
   if (currentLockFileHash === lockFileHash) {
     return cachedParsedLockFile;
@@ -54,7 +51,6 @@ function parseLockFile(lockFileContent: string, lockFileHash: string) {
   const { parseSyml } =
     require('@yarnpkg/parsers') as typeof import('@yarnpkg/parsers');
 
-  keyMap.clear();
   const result = parseSyml(lockFileContent);
   cachedParsedLockFile = result;
   currentLockFileHash = lockFileHash;
@@ -65,7 +61,10 @@ export function getYarnLockfileNodes(
   lockFileContent: string,
   lockFileHash: string,
   packageJson: NormalizedPackageJson
-) {
+): {
+  nodes: Record<string, ProjectGraphExternalNode>;
+  keyMap: Map<string, ProjectGraphExternalNode>;
+} {
   const { __metadata, ...dependencies } = parseLockFile(
     lockFileContent,
     lockFileHash
@@ -82,7 +81,8 @@ export function getYarnLockfileNodes(
 export function getYarnLockfileDependencies(
   lockFileContent: string,
   lockFileHash: string,
-  ctx: CreateDependenciesContext
+  ctx: CreateDependenciesContext,
+  keyMap: Map<string, ProjectGraphExternalNode>
 ) {
   const { __metadata, ...dependencies } = parseLockFile(
     lockFileContent,
@@ -94,7 +94,7 @@ export function getYarnLockfileDependencies(
   // yarn classic splits keys when parsing so we need to stich them back together
   const groupedDependencies = groupDependencies(dependencies, isBerry);
 
-  return getDependencies(groupedDependencies, ctx);
+  return getDependencies(groupedDependencies, ctx, keyMap);
 }
 
 function getPackageNameKeyPairs(keys: string): Map<string, Set<string>> {
@@ -114,7 +114,11 @@ function getNodes(
   dependencies: Record<string, YarnDependency>,
   packageJson: NormalizedPackageJson,
   isBerry: boolean
-) {
+): {
+  nodes: Record<string, ProjectGraphExternalNode>;
+  keyMap: Map<string, ProjectGraphExternalNode>;
+} {
+  const keyMap = new Map<string, ProjectGraphExternalNode>();
   const nodes: Map<string, Map<string, ProjectGraphExternalNode>> = new Map();
   const combinedDeps = {
     ...packageJson.dependencies,
@@ -190,7 +194,7 @@ function getNodes(
       externalNodes[node.name] = node;
     });
   }
-  return externalNodes;
+  return { nodes: externalNodes, keyMap };
 }
 
 function findHoistedNode(
@@ -296,7 +300,8 @@ function getHoistedVersion(packageName: string): string {
 
 function getDependencies(
   dependencies: Record<string, YarnDependency>,
-  ctx: CreateDependenciesContext
+  ctx: CreateDependenciesContext,
+  keyMap: Map<string, ProjectGraphExternalNode>
 ) {
   const projectGraphDependencies: RawProjectGraphDependency[] = [];
   Object.keys(dependencies).forEach((keys) => {
