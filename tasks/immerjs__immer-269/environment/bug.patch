diff --git a/__tests__/flow/.flowconfig b/.flowconfig
similarity index 62%
rename from __tests__/flow/.flowconfig
rename to .flowconfig
index 3d2de4f..b06faed 100644
--- a/__tests__/flow/.flowconfig
+++ b/.flowconfig
@@ -1,8 +1,8 @@
-[include]
-../../dist
+[ignore]
+.*/node_modules
 
-[lints]
-untyped-import=error
+[include]
+__tests__/flow
 
 [options]
 suppress_comment= \\(.\\|\n\\)*\\$ExpectError
diff --git a/.vscode/settings.json b/.vscode/settings.json
deleted file mode 100644
index f9a4c68..0000000
--- a/.vscode/settings.json
+++ /dev/null
@@ -1,3 +0,0 @@
-{
-  "javascript.validate.enable": false
-}
diff --git a/__tests__/flow/flow.js.flow b/__tests__/flow/flow.js.flow
index 2e40774..b2e21fc 100644
--- a/__tests__/flow/flow.js.flow
+++ b/__tests__/flow/flow.js.flow
@@ -1,12 +1,5 @@
 // @flow
-import produce, {
-    setAutoFreeze,
-    setUseProxies,
-    produce as produce2,
-    applyPatches,
-    Patch,
-    original
-} from "../../dist/immer.js"
+import produce, {setAutoFreeze, setUseProxies, produce as produce2, applyPatches, Patch, original} from "../../src/index"
 
 setAutoFreeze(true)
 setUseProxies(true)
@@ -27,11 +20,9 @@ const result2 = produce({x: 3}, draft => {
 
 console.log(result2.x)
 
-const f = produce(
-    (draft): {x: number} => {
-        return {x: 4}
-    }
-)
+const f = produce((draft): {x: number} => {
+    return {x: 4}
+})
 f({x: 3})
 
 const f2 = produce((draft): void => {})
@@ -74,11 +65,9 @@ produce({x: 3}, [])
 
 {
     // curried f & no initial arg
-    const f2 = produce(
-        (state: {x: number}, increment: number): void => {
-            state.x += increment
-        }
-    )
+    const f2 = produce((state: {x: number}, increment: number): void => {
+        state.x += increment
+    })
 
     f2({x: 5}, 3)
 
@@ -100,13 +89,9 @@ produce({x: 3}, [])
 
 {
     let p: Patch[] = []
-    produce(
-        {},
-        d => {},
-        (patches, inverse) => {
-            p = patches
-        }
-    )
+    produce({ }, d=> {}, (patches, inverse) => {
+        p = patches
+    })
     applyPatches({}, p)
 }
 
@@ -123,11 +108,11 @@ produce({x: 3}, [])
 
 {
     produce([1], draftState => {
-        const a = original(draftState)
+        const a = original(draftState);
         if (a) {
-            const b: number = a[0]
+            const b: number = a[0];
             // $ExpectError
-            const c: string = a[0]
+            const c: string = a[0];
         }
     })
 }
diff --git a/__tests__/flow/ts.ts b/__tests__/flow/ts.ts
new file mode 100644
index 0000000..1b2e07f
--- /dev/null
+++ b/__tests__/flow/ts.ts
@@ -0,0 +1,98 @@
+import produce, {setAutoFreeze, setUseProxies, original} from "../../src/index"
+
+setAutoFreeze(true)
+setUseProxies(true)
+
+// we really don't want this code to actually execute..
+const result = produce({x: 3}, draft => {
+    draft.x = 4
+
+    // $ExpectError
+    console.log(draft.y)
+})
+
+console.log(result.x)
+
+const f2 = produce(draft => {})
+f2({x: 3})
+
+// $ExpectError
+setAutoFreeze(3)
+
+// $ExpectError
+console.log(result.y)
+
+// $ExpectError
+produce()
+
+// $ExpectError
+produce({x: 3})
+
+// $ExpectError
+produce({x: 3}, [])
+
+{
+    // curried & initial arg
+    const f = produce(
+        (state, increment: number) => {
+            state.x += increment
+        },
+        {x: 3}
+    )
+
+    // $ExpectError Too few arguments
+    f({x: 5})
+
+    // $ExpectError
+    f({x: 5}, "test")
+
+    f({x: 5}, 3)
+
+    f(undefined, 3)
+}
+
+{
+    // curried f & no initial arg
+    const f2 = produce((state: {x: number}, increment: number) => {
+        state.x += increment
+    })
+
+    f2({x: 5}, 3)
+
+    // $ExpectError
+    f2(undefined, 3)
+}
+
+{
+    // Issue #129
+    const handlers = {
+        ["TEST"]: (draft: {}, {id, value}: {id: string; value: string}) => {
+            draft[id] = {...draft[id], value}
+            return draft
+        }
+    }
+
+    const reducer = (state = {}, {type, payload}: any): any =>
+        handlers[type]
+            ? produce<any, any>(handlers[type])(state, payload)
+            : state
+}
+
+produce({x: 3, z: {}}, draftState => {
+    const a = draftState
+
+    if (a) {
+        a.x
+        // $ExpectError
+        a.y
+    }
+})
+
+produce([1], draftState => {
+    const a = original(draftState)
+    if (a) {
+        // $ExpectError
+        const b: string = a[0]
+        const c: number = a[0]
+    }
+})
diff --git a/__tests__/tsconfig.json b/__tests__/test.tsconfig.json
similarity index 69%
rename from __tests__/tsconfig.json
rename to __tests__/test.tsconfig.json
index 2a050ac..99a15e8 100644
--- a/__tests__/tsconfig.json
+++ b/__tests__/test.tsconfig.json
@@ -2,7 +2,6 @@
   "include": ["./types.ts", "../src/index.d.ts"],
   "compilerOptions": {
     "lib": ["es2015"],
-    "module": "commonjs",
-    "strict": true
+    "module": "commonjs"
   }
 }
diff --git a/__tests__/types.ts b/__tests__/types.ts
index ddef43f..5cec2fb 100644
--- a/__tests__/types.ts
+++ b/__tests__/types.ts
@@ -4,7 +4,7 @@ import produce, {
     Draft,
     Patch,
     DraftTuple
-} from "../dist/immer.js"
+} from "../src/index"
 
 interface State {
     readonly num: number
@@ -90,7 +90,7 @@ it("can update use the non-default export", () => {
 })
 
 it("can apply patches", () => {
-    let patches: Patch[] = []
+    let patches: Patch[]
     produce(
         {x: 3},
         d => {
@@ -118,71 +118,68 @@ declare const exactType: <T, U extends T>(
     expected?: T
 ) => T extends U ? T : 1 & 0
 
-// To remove TS2454 errors.
-declare const _: any
-
 // Tuple
 {
-    let val: [1, 2] = _
+    let val: [1, 2]
     val = exactType(toDraft(val), val)
     val = exactType(fromDraft(toDraft(val)), val)
 }
 
 // Tuple (nested in a tuple)
 {
-    let val: [[1, 2]] = _
+    let val: [[1, 2]]
     val = exactType(toDraft(val), val)
     val = exactType(fromDraft(toDraft(val)), val)
 }
 
 // Tuple (nested in two readonly arrays)
 {
-    let val: ReadonlyArray<ReadonlyArray<[1, 2]>> = _
-    let draft: [1, 2][][] = _
+    let val: ReadonlyArray<ReadonlyArray<[1, 2]>>
+    let draft: [1, 2][][]
     draft = exactType(toDraft(val), draft)
     val = fromDraft(draft)
 }
 
 // Mutable array
 {
-    let val: string[] = _
+    let val: string[]
     val = exactType(toDraft(val), val)
     val = exactType(fromDraft(toDraft(val)), val)
 }
 
 // Mutable array (nested in tuple)
 {
-    let val: [string[]] = _
+    let val: [string[]]
     val = exactType(toDraft(val), val)
     val = exactType(fromDraft(toDraft(val)), val)
 }
 
 // Readonly array
 {
-    let val: ReadonlyArray<string> = _
-    let draft: string[] = _
+    let val: ReadonlyArray<string>
+    let draft: string[]
     draft = exactType(toDraft(val), draft)
     val = fromDraft(draft)
 }
 
 // Readonly array (nested in readonly object)
 {
-    let val: {readonly a: ReadonlyArray<string>} = _
-    let draft: {a: string[]} = _
+    let val: {readonly a: ReadonlyArray<string>}
+    let draft: {a: string[]}
     draft = exactType(toDraft(val), draft)
     val = fromDraft(draft)
 }
 
 // Mutable object
 {
-    let val: {a: 1} = _
+    let val: {a: 1}
     val = exactType(toDraft(val), val)
     val = exactType(fromDraft(toDraft(val)), val)
 }
 
 // Mutable object (nested in mutable object)
 {
-    let val: {a: {b: 1}} = _
+    let val: {a: {b: 1}}
     val = exactType(toDraft(val), val)
     val = exactType(fromDraft(toDraft(val)), val)
 }
@@ -192,7 +189,7 @@ declare const _: any
     interface Foo {
         a: {b: number}
     }
-    let val: Foo = _
+    let val: Foo
     val = exactType(toDraft(val), val)
     val = exactType(fromDraft(toDraft(val)), val)
 }
@@ -205,139 +202,140 @@ declare const _: any
     interface Bar {
         foo: Foo
     }
-    let val: Bar = _
+    let val: Bar
     val = exactType(toDraft(val), val)
     val = exactType(fromDraft(toDraft(val)), val)
 }
 
 // Readonly object
 {
-    let val: Readonly<{a: 1}> = _
-    let draft: {a: 1} = _
+    let val: Readonly<{a: 1}>
+    let draft: {a: 1}
     draft = exactType(toDraft(val), val)
     val = exactType(fromDraft(draft), val)
 }
 
 // Readonly object (nested in tuple)
 {
-    let val: [Readonly<{a: 1}>] = _
-    let draft: DraftTuple<[{a: 1}]> = _
+    let val: [Readonly<{a: 1}>]
+    let draft: DraftTuple<[{a: 1}]>
     draft = exactType(toDraft(val), val)
     val = exactType(fromDraft(draft), val)
 }
 
 // Loose function
 {
-    let val: Function = _
+    let val: Function
     val = exactType(toDraft(val), val)
     val = exactType(fromDraft(toDraft(val)), val)
 }
 
 // Strict function
 {
-    let val: () => void = _
+    let val: () => void
     val = exactType(toDraft(val), val)
     val = exactType(fromDraft(toDraft(val)), val)
 }
 
 // Map instance
 {
-    let val: Map<any, any> = _
+    let val: Map<any, any>
     val = exactType(toDraft(val), val)
     val = exactType(fromDraft(toDraft(val)), val)
 
     // Weak maps
-    let weak: WeakMap<any, any> = _
+    let weak: WeakMap<any, any>
     weak = exactType(toDraft(weak), weak)
     weak = exactType(fromDraft(toDraft(weak)), weak)
 }
 
 // Set instance
 {
-    let val: Set<any> = _
+    let val: Set<any>
     val = exactType(toDraft(val), val)
     val = exactType(fromDraft(toDraft(val)), val)
 
     // Weak sets
-    let weak: WeakSet<any> = _
+    let weak: WeakSet<any>
     weak = exactType(toDraft(weak), weak)
     weak = exactType(fromDraft(toDraft(weak)), weak)
 }
 
 // Promise object
 {
-    let val: Promise<any> = _
+    let val: Promise<any>
     val = exactType(toDraft(val), val)
     val = exactType(fromDraft(toDraft(val)), val)
 }
 
 // Date instance
 {
-    let val: Date = _
+    let val: Date
     val = exactType(toDraft(val), val)
     val = exactType(fromDraft(toDraft(val)), val)
 }
 
 // RegExp instance
 {
-    let val: RegExp = _
+    let val: RegExp
     val = exactType(toDraft(val), val)
     val = exactType(fromDraft(toDraft(val)), val)
 }
 
 // Boxed primitive
 {
-    let val: Boolean = _
+    let val: Boolean
     val = exactType(toDraft(val), val)
     val = exactType(fromDraft(toDraft(val)), val)
 }
 
 // String literal
 {
-    let val: string = _
+    let val: string
     val = exactType(toDraft(val), val)
     val = exactType(fromDraft(toDraft(val)), val)
 }
 
 // Any
 {
-    let val: any = _
+    let val: any
     val = exactType(toDraft(val), val)
     val = exactType(fromDraft(toDraft(val)), val)
 }
 
 // Never
 {
-    let val: never = _ as never
+    let val: never
     val = exactType(toDraft(val), val)
     val = exactType(fromDraft(toDraft(val)), val)
 }
 
 // Unknown
 {
-    let val: unknown = _
-    val = exactType(toDraft(val), val)
-    val = exactType(fromDraft(toDraft(val)), val)
+    // TODO: Uncomment this when Typescript is upgraded to 3.0+
+    // let val: unknown
+    // val = exactType(toDraft(val), val)
+    // val = exactType(fromDraft(toDraft(val)), val)
 }
 
 // Numeral
 {
-    let val: 1 = _
+    let val: 1
     val = exactType(toDraft(val), val)
     val = exactType(fromDraft(toDraft(val)), val)
 }
 
 // Union of numerals
 {
-    let val: 1 | 2 | 3 = _
+    let val: 1 | 2 | 3
     val = exactType(toDraft(val), val)
     val = exactType(fromDraft(toDraft(val)), val)
 }
 
 // Union of tuple, array, object
 {
-    let val: [0] | ReadonlyArray<string> | Readonly<{a: 1}> = _
-    let draft: DraftTuple<[0]> | string[] | {a: 1} = _
+    let val: [0] | ReadonlyArray<string> | Readonly<{a: 1}>
+    let draft: DraftTuple<[0]> | string[] | {a: 1}
     draft = exactType(toDraft(val), val)
     val = exactType(fromDraft(draft), val)
 }
diff --git a/package.json b/package.json
index 9e7b1e2..c3ff623 100644
--- a/package.json
+++ b/package.json
@@ -12,10 +12,10 @@
     "watch": "jest --watch",
     "test": "jest",
     "test:perf": "NODE_ENV=production yarn-or-npm build && cd __performance_tests__ && babel-node add-data.js && babel-node todo.js && babel-node incremental.js",
-    "test:flow": "yarn-or-npm flow check __tests__/flow",
-    "test:dts": "tsc -p __tests__/tsconfig.json --noEmit",
-    "coveralls": "jest --coverage && cat ./coverage/lcov.info | ./node_modules/.bin/coveralls && rm -rf ./coverage",
-    "build": "rimraf dist/ && cross-env NODE_ENV=production rollup -c && cpx 'src/immer.{d.ts,js.flow}' dist -v"
+    "test:flow": "yarn-or-npm flow check",
+    "test:dts": "tsc -p __tests__/test.tsconfig.json --noEmit",
+    "coveralls": "jest --coverage && cat ./coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js && rm -rf ./coverage",
+    "build": "rimraf dist/ && cross-env NODE_ENV=production rollup -c && cpx \"src/immer.{d.ts,js.flow}\" dist"
   },
   "husky": {
     "hooks": {
diff --git a/src/immer.d.ts b/src/index.d.ts
similarity index 100%
rename from src/immer.d.ts
rename to src/index.d.ts
diff --git a/src/immer.js.flow b/src/index.js.flow
similarity index 100%
rename from src/immer.js.flow
rename to src/index.js.flow
