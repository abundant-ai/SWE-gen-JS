diff --git a/.github/dependabot.yml b/.github/dependabot.yml
index 4872c5afd..b31110af1 100644
--- a/.github/dependabot.yml
+++ b/.github/dependabot.yml
@@ -5,3 +5,8 @@ updates:
   schedule:
     interval: daily
   open-pull-requests-limit: 10
+- package-ecosystem: "github-actions"
+  directory: "/"
+  schedule:
+    interval: daily
+  open-pull-requests-limit: 10
diff --git a/.github/workflows/codeql-analysis.yml b/.github/workflows/codeql-analysis.yml
index d148be272..17661cc77 100644
--- a/.github/workflows/codeql-analysis.yml
+++ b/.github/workflows/codeql-analysis.yml
@@ -29,7 +29,9 @@ jobs:
 
     # Initializes the CodeQL tools for scanning.
     - name: Initialize CodeQL
-      uses: github/codeql-action/init@v1
+      uses: github/codeql-action/init@v2
+      with:
+        queries: +security-extended
       # Override language selection by uncommenting this and choosing your languages
       # with:
       #   languages: go, javascript, csharp, python, cpp, java
@@ -37,7 +39,7 @@ jobs:
     # Autobuild attempts to build any compiled languages  (C/C++, C#, or Java).
     # If this step fails, then you should remove it and run the build manually (see below)
     - name: Autobuild
-      uses: github/codeql-action/autobuild@v1
+      uses: github/codeql-action/autobuild@v2
 
     # ‚ÑπÔ∏è Command-line programs to run using the OS shell.
     # üìö https://git.io/JvXDl
@@ -51,4 +53,4 @@ jobs:
     #   make release
 
     - name: Perform CodeQL Analysis
-      uses: github/codeql-action/analyze@v1
+      uses: github/codeql-action/analyze@v2
diff --git a/.gitignore b/.gitignore
index e4ac8a641..5943850da 100644
--- a/.gitignore
+++ b/.gitignore
@@ -5,6 +5,7 @@ node_modules/
 /.idea
 /.awcache
 /.vscode
+/.devcontainer
 *.code-workspace
 
 # bundle
diff --git a/.mocharc.js b/.mocharc.js
deleted file mode 100644
index b9cef9d6d..000000000
--- a/.mocharc.js
+++ /dev/null
@@ -1,7 +0,0 @@
-module.exports = {
-  mochaHooks: {
-    beforeAll: function() {
-      require('reflect-metadata');
-    }
-  }
-};
diff --git a/Readme.md b/Readme.md
index a037af980..a5e43201d 100644
--- a/Readme.md
+++ b/Readme.md
@@ -64,17 +64,20 @@ Nest is an MIT-licensed open source project. It can grow thanks to the sponsors
 <a href="https://github.com/Sanofi-IADC" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/sanofi.png" width="180" valign="middle" /></a></td>
 <td>
 <a href="https://nx.dev" target="_blank"><img src="https://nestjs.com/img/nx-logo.png" height="45" valign="middle" /></a></td>
+    <td>
+<a href="https://valor-software.com/" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/valor-software.png" width="170" valign="middle" /></a></td>
 </tr></table>
 
 #### Gold Sponsors
 
 <table style="text-align:center;"><tr><td>
   <a href="https://careers.labster.com/departments/platform" target="_blank"><img src="https://nestjs.com/img/labster-logo.png" width="170" valign="middle" /></a></td><td>
-<a href="https://weld.app/" target="_blank"><img src="https://nestjs.com/img/weld-logo.svg" width="150" valign="middle" /></a></td>
-  <td>
-<a href="https://valor-software.com/" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/valor-software.png" width="170" valign="middle" /></a></td>
+<a href="https://weld.app/" target="_blank"><img src="https://nestjs.com/img/weld-logo.svg" width="140" valign="middle" /></a></td>
 <td>
-<a href="https://intrinsic.ventures/" target="_blank"><img src="https://nestjs.com/img/intrinisic-logo.png" width="210" valign="middle" /></a></td></</tr></table>
+<a href="https://intrinsic.ventures/" target="_blank"><img src="https://nestjs.com/img/intrinisic-logo.png" width="210" valign="middle" /></a></td>
+ <td>
+<a href="https://jetbrains.com/" target="_blank"><img src="https://nestjs.com/img/jetbrains-logo.svg" width="110" valign="middle" /></a></td><td>
+<a href="https://snyk.co/nestjs" target="_blank"><img src="https://nestjs.com/img/snyk-logo-black.png" width="185" valign="middle" /></a></td></</tr></table>
 
 #### Silver Sponsors
 
diff --git a/hooks/mocha-init-hook.ts b/hooks/mocha-init-hook.ts
new file mode 100644
index 000000000..4a774163f
--- /dev/null
+++ b/hooks/mocha-init-hook.ts
@@ -0,0 +1,7 @@
+export const mochaHooks = (): Mocha.RootHookObject => {
+  return {
+    async beforeAll(this: Mocha.Context) {
+      await import('reflect-metadata');
+    }
+  };
+};
diff --git a/integration/docker-compose.yml b/integration/docker-compose.yml
index 148c32151..6d2bf45fd 100644
--- a/integration/docker-compose.yml
+++ b/integration/docker-compose.yml
@@ -17,13 +17,15 @@ services:
     restart: always
   mqtt:
     container_name: test-mqtt
-    image: toke/mosquitto
+    image: eclipse-mosquitto
+    volumes:
+      - ./mosquitto.conf:/mosquitto/config/mosquitto.conf
     ports:
       - "1883:1883"
       - "9001:9001"
     restart: always
   mysql:
-    image: mysql:8.0.27
+    image: mysql:8.0.28
     environment:
       MYSQL_ROOT_PASSWORD: root
       MYSQL_DATABASE: test
diff --git a/integration/injector/e2e/injector.spec.ts b/integration/injector/e2e/injector.spec.ts
index 95208f618..5fd489676 100644
--- a/integration/injector/e2e/injector.spec.ts
+++ b/integration/injector/e2e/injector.spec.ts
@@ -1,7 +1,10 @@
 import { RuntimeException } from '@nestjs/core/errors/exceptions/runtime.exception';
+import { UnknownDependenciesException } from '@nestjs/core/errors/exceptions/unknown-dependencies.exception';
 import { UnknownExportException } from '@nestjs/core/errors/exceptions/unknown-export.exception';
 import { Test } from '@nestjs/testing';
 import { expect } from 'chai';
+import * as chai from 'chai';
+import * as chaiAsPromised from 'chai-as-promised';
 import {
   DYNAMIC_TOKEN,
   DYNAMIC_VALUE,
@@ -9,6 +12,13 @@ import {
 } from '../src/dynamic/dynamic.module';
 import { ExportsModule } from '../src/exports/exports.module';
 import { InjectModule } from '../src/inject/inject.module';
+import { InjectSameNameModule } from '../src/inject/inject-same-name.module';
+import {
+  SelfInjectionProviderModule,
+  SelfInjectionProviderCustomTokenModule,
+  SelfInjectionForwardProviderModule,
+} from '../src/self-injection/self-injection-provider.module';
+chai.use(chaiAsPromised);
 
 describe('Injector', () => {
   describe('when "providers" and "exports" properties are inconsistent', () => {
@@ -24,6 +34,16 @@ describe('Injector', () => {
     });
   });
 
+  describe("When class injects a provider with the same as class's name", () => {
+    it('should compile with success', async () => {
+      const builder = Test.createTestingModule({
+        imports: [InjectSameNameModule],
+      });
+
+      await expect(builder.compile()).to.eventually.be.fulfilled;
+    });
+  });
+
   describe('when Nest cannot resolve dependencies', () => {
     it(`should fail with "RuntimeException"`, async () => {
       try {
@@ -35,6 +55,42 @@ describe('Injector', () => {
         expect(err).to.be.instanceof(RuntimeException);
       }
     });
+
+    describe('due to self-injection providers', () => {
+      it('should fail with "UnknownDependenciesException" due to self-injection via same class reference', async () => {
+        const builder = Test.createTestingModule({
+          imports: [SelfInjectionProviderModule],
+        });
+
+        await expect(
+          builder.compile(),
+        ).to.eventually.be.rejected.and.be.an.instanceOf(
+          UnknownDependenciesException,
+        );
+      });
+      it('should fail with "UnknownDependenciesException" due to self-injection via forwardRef to the same class reference', async () => {
+        const builder = Test.createTestingModule({
+          imports: [SelfInjectionForwardProviderModule],
+        });
+
+        await expect(
+          builder.compile(),
+        ).to.eventually.be.rejected.and.be.an.instanceOf(
+          UnknownDependenciesException,
+        );
+      });
+      it('should fail with "UnknownDependenciesException" due to self-injection via custom provider', async () => {
+        const builder = Test.createTestingModule({
+          imports: [SelfInjectionProviderCustomTokenModule],
+        });
+
+        await expect(
+          builder.compile(),
+        ).to.eventually.be.rejected.and.be.an.instanceOf(
+          UnknownDependenciesException,
+        );
+      });
+    });
   });
 
   describe('when dynamic module', () => {
diff --git a/integration/injector/e2e/optional-factory-provider-dep.spec.ts b/integration/injector/e2e/optional-factory-provider-dep.spec.ts
new file mode 100644
index 000000000..e5162d03c
--- /dev/null
+++ b/integration/injector/e2e/optional-factory-provider-dep.spec.ts
@@ -0,0 +1,96 @@
+import { UnknownDependenciesException } from '@nestjs/core/errors/exceptions/unknown-dependencies.exception';
+import { Test } from '@nestjs/testing';
+import { expect } from 'chai';
+
+describe('Optional factory provider deps', () => {
+  describe('when dependency is optional', () => {
+    describe('and it is available', () => {
+      it('then it should be injected into the factory function', async () => {
+        const defaultValue = 'DEFAULT_VALUE';
+        const moduleRef = await Test.createTestingModule({
+          providers: [
+            {
+              provide: 'FACTORY',
+              useFactory: dep => dep ?? defaultValue,
+              inject: [{ token: 'MISSING_DEP', optional: true }],
+            },
+            { provide: 'MISSING_DEP', useValue: 'OPTIONAL_DEP_VALUE' },
+          ],
+        }).compile();
+
+        const factoryProvider = moduleRef.get('FACTORY');
+        expect(factoryProvider).to.equal('OPTIONAL_DEP_VALUE');
+      });
+    });
+    describe('otherwise', () => {
+      it('"undefined" should be injected into the factory function', async () => {
+        const defaultValue = 'DEFAULT_VALUE';
+        const moduleRef = await Test.createTestingModule({
+          providers: [
+            {
+              provide: 'FACTORY',
+              useFactory: dep => dep ?? defaultValue,
+              inject: [{ token: 'MISSING_DEP', optional: true }],
+            },
+          ],
+        }).compile();
+
+        const factoryProvider = moduleRef.get('FACTORY');
+        expect(factoryProvider).to.equal(defaultValue);
+      });
+    });
+  });
+  describe('otherwise', () => {
+    describe('and dependency is not registered', () => {
+      it('should error out', async () => {
+        try {
+          const builder = Test.createTestingModule({
+            providers: [
+              {
+                provide: 'FACTORY',
+                useFactory: () => 'RETURNED_VALUE',
+                inject: ['MISSING_DEP'],
+              },
+            ],
+          });
+          await builder.compile();
+        } catch (err) {
+          expect(err).to.be.instanceOf(UnknownDependenciesException);
+        }
+      });
+    });
+  });
+  describe('and dependency is registered but it cannot be instantiated', () => {
+    it('should error out', async () => {
+      try {
+        const builder = Test.createTestingModule({
+          providers: [
+            {
+              provide: 'POSSIBLY_MISSING_DEP',
+              useFactory: () => null,
+              inject: ['MISSING_DEP'],
+            },
+            {
+              provide: 'FACTORY',
+              useFactory: () => 'RETURNED_VALUE',
+              inject: [{ token: 'POSSIBLY_MISSING_DEP', optional: false }],
+            },
+          ],
+        });
+        await builder.compile();
+      } catch (err) {
+        expect(err).to.be.instanceOf(UnknownDependenciesException);
+        expect(err.message).to
+          .equal(`Nest can't resolve dependencies of the POSSIBLY_MISSING_DEP (?). Please make sure that the argument MISSING_DEP at index [0] is available in the RootTestModule context.
+
+Potential solutions:
+- If MISSING_DEP is a provider, is it part of the current RootTestModule?
+- If MISSING_DEP is exported from a separate @Module, is that module imported within RootTestModule?
+  @Module({
+    imports: [ /* the Module containing MISSING_DEP */ ]
+  })
+`);
+      }
+    });
+  });
+});
diff --git a/integration/injector/src/inject/inject-same-name.module.ts b/integration/injector/src/inject/inject-same-name.module.ts
new file mode 100644
index 000000000..f66fd51a7
--- /dev/null
+++ b/integration/injector/src/inject/inject-same-name.module.ts
@@ -0,0 +1,16 @@
+import { Module, Injectable, Inject } from '@nestjs/common';
+
+@Injectable()
+class CoreService {
+  constructor(@Inject(CoreService.name) private readonly coreService: any) {}
+}
+
+@Module({
+  providers: [
+    {
+      provide: CoreService.name,
+      useValue: 'anything',
+    },
+  ],
+})
+export class InjectSameNameModule {}
diff --git a/integration/injector/src/self-injection/self-injection-provider.module.ts b/integration/injector/src/self-injection/self-injection-provider.module.ts
new file mode 100644
index 000000000..6850c75dc
--- /dev/null
+++ b/integration/injector/src/self-injection/self-injection-provider.module.ts
@@ -0,0 +1,40 @@
+import { Module, Injectable, Inject, forwardRef } from '@nestjs/common';
+
+@Injectable()
+class ServiceInjectingItself {
+  constructor(private readonly coreService: ServiceInjectingItself) {}
+}
+
+@Injectable()
+class ServiceInjectingItselfForwared {
+  constructor(
+    @Inject(forwardRef(() => ServiceInjectingItself))
+    private readonly coreService: ServiceInjectingItself,
+  ) {}
+}
+
+@Injectable()
+class ServiceInjectingItselfViaCustomToken {
+  constructor(@Inject('AnotherToken') private readonly coreService: any) {}
+}
+
+@Module({
+  providers: [ServiceInjectingItself],
+})
+export class SelfInjectionProviderModule {}
+
+@Module({
+  providers: [ServiceInjectingItselfForwared],
+})
+export class SelfInjectionForwardProviderModule {}
+
+@Module({
+  providers: [
+    ServiceInjectingItselfViaCustomToken,
+    {
+      provide: 'AnotherToken',
+      useClass: ServiceInjectingItselfViaCustomToken,
+    },
+  ],
+})
+export class SelfInjectionProviderCustomTokenModule {}
diff --git a/integration/microservices/e2e/sum-mqtt.spec.ts b/integration/microservices/e2e/sum-mqtt.spec.ts
index f7ad2f36c..2b2320e67 100644
--- a/integration/microservices/e2e/sum-mqtt.spec.ts
+++ b/integration/microservices/e2e/sum-mqtt.spec.ts
@@ -124,6 +124,44 @@ describe('MQTT transport', () => {
       .expect(201, '15');
   });
 
+  it(`/POST (shared wildcard EVENT #)`, done => {
+    request(server)
+      .post('/shared-wildcard-event')
+      .send([1, 2, 3, 4, 5])
+      .end(() => {
+        setTimeout(() => {
+          expect(MqttController.IS_SHARED_WILDCARD_EVENT_RECEIVED).to.be.true;
+          done();
+        }, 1000);
+      });
+  });
+
+  it(`/POST (shared wildcard MESSAGE #)`, () => {
+    return request(server)
+      .post('/shared-wildcard-message')
+      .send([1, 2, 3, 4, 5])
+      .expect(201, '15');
+  });
+
+  it(`/POST (shared wildcard EVENT +)`, done => {
+    request(server)
+      .post('/shared-wildcard-event2')
+      .send([1, 2, 3, 4, 5])
+      .end(() => {
+        setTimeout(() => {
+          expect(MqttController.IS_SHARED_WILDCARD2_EVENT_RECEIVED).to.be.true;
+          done();
+        }, 1000);
+      });
+  });
+
+  it(`/POST (shared wildcard MESSAGE +)`, () => {
+    return request(server)
+      .post('/shared-wildcard-message2')
+      .send([1, 2, 3, 4, 5])
+      .expect(201, '15');
+  });
+
   afterEach(async () => {
     await app.close();
   });
diff --git a/integration/microservices/e2e/sum-rmq.spec.ts b/integration/microservices/e2e/sum-rmq.spec.ts
index f5f0e0a36..97ac90749 100644
--- a/integration/microservices/e2e/sum-rmq.spec.ts
+++ b/integration/microservices/e2e/sum-rmq.spec.ts
@@ -77,6 +77,13 @@ describe('RabbitMQ transport', () => {
       .expect(200, '15');
   });
 
+  it(`/POST (multiple-urls)`, () => {
+    return request(server)
+      .post('/multiple-urls')
+      .send([1, 2, 3, 4, 5])
+      .expect(200, '15');
+  }).timeout(10000);
+
   it(`/POST (event notification)`, done => {
     request(server)
       .post('/notify')
diff --git a/integration/microservices/src/mqtt/mqtt.controller.ts b/integration/microservices/src/mqtt/mqtt.controller.ts
index a73a5e0eb..72de41d5c 100644
--- a/integration/microservices/src/mqtt/mqtt.controller.ts
+++ b/integration/microservices/src/mqtt/mqtt.controller.ts
@@ -18,6 +18,8 @@ export class MqttController {
   static IS_NOTIFIED = false;
   static IS_WILDCARD_EVENT_RECEIVED = false;
   static IS_WILDCARD2_EVENT_RECEIVED = false;
+  static IS_SHARED_WILDCARD_EVENT_RECEIVED = false;
+  static IS_SHARED_WILDCARD2_EVENT_RECEIVED = false;
 
   @Client({ transport: Transport.MQTT })
   client: ClientProxy;
@@ -109,6 +111,32 @@ export class MqttController {
     };
   }
 
+  @Post('shared-wildcard-event')
+  async sendSharedWildcardEvent(): Promise<any> {
+    return this.client.emit<number>('shared-wildcard-event/test', true);
+  }
+
+  @Post('shared-wildcard-message')
+  async sendSharedWildcardMessage(
+    @Body() data: number[],
+  ): Promise<Observable<number>> {
+    await this.client.connect();
+    return this.client.send<number>('shared-wildcard-message/test', data);
+  }
+
+  @Post('shared-wildcard-event2')
+  async sendSharedWildcardEvent2(): Promise<any> {
+    return this.client.emit<number>('shared-wildcard-event2/test/test', true);
+  }
+
+  @Post('shared-wildcard-message2')
+  async sendSharedWildcardMessage2(
+    @Body() data: number[],
+  ): Promise<Observable<number>> {
+    await this.client.connect();
+    return this.client.send<number>('shared-wildcard-message2/test/test', data);
+  }
+
   @MessagePattern('wildcard-message/#')
   wildcardMessageHandler(data: number[]): number {
     if ((data as any).response) {
@@ -156,4 +184,27 @@ export class MqttController {
   streaming(data: number[]): Observable<number> {
     return from(data);
   }
+
+  @MessagePattern('$share/test-group/shared-wildcard-message/#')
+  sharedWildcardMessageHandler(data: number[]): number {
+    if ((data as any).response) {
+      return;
+    }
+    return (data || []).reduce((a, b) => a + b);
+  }
+
+  @EventPattern('$share/test-group/shared-wildcard-event/#')
+  sharedWildcardEventHandler(data: boolean) {
+    MqttController.IS_SHARED_WILDCARD_EVENT_RECEIVED = data;
+  }
+
+  @MessagePattern('$share/test-group/shared-wildcard-message2/+/test')
+  sharedWildcardMessageHandler2(data: number[]): number {
+    return (data || []).reduce((a, b) => a + b);
+  }
+
+  @EventPattern('$share/test-group/shared-wildcard-event2/+/test')
+  sharedWildcardEventHandler2(data: boolean) {
+    MqttController.IS_SHARED_WILDCARD2_EVENT_RECEIVED = data;
+  }
 }
diff --git a/integration/microservices/src/rmq/rmq.controller.ts b/integration/microservices/src/rmq/rmq.controller.ts
index 932bb46a9..07f8075e6 100644
--- a/integration/microservices/src/rmq/rmq.controller.ts
+++ b/integration/microservices/src/rmq/rmq.controller.ts
@@ -61,6 +61,21 @@ export class RMQController {
       .reduce(async (a, b) => (await a) && b);
   }
 
+  @Post('multiple-urls')
+  @HttpCode(200)
+  multipleUrls(@Body() data: number[]) {
+    const clientWithMultipleUrls = ClientProxyFactory.create({
+      transport: Transport.RMQ,
+      options: {
+        urls: [`amqp://localhost:5671`, `amqp://localhost:5672`],
+        queue: 'test',
+        queueOptions: { durable: false },
+        socketOptions: { noDelay: true },
+      },
+    });
+    return clientWithMultipleUrls.send<number>({ cmd: 'multiple-urls' }, data);
+  }
+
   @Post('record-builder-duplex')
   @HttpCode(200)
   useRecordBuilderDuplex(@Body() data: Record<string, any>) {
@@ -109,6 +124,11 @@ export class RMQController {
     return from(data);
   }
 
+  @MessagePattern({ cmd: 'multiple-urls' })
+  handleMultipleUrls(data: number[]): number {
+    return (data || []).reduce((a, b) => a + b);
+  }
+
   @Post('notify')
   async sendNotification(): Promise<any> {
     return this.client.emit<number>('notification', true);
diff --git a/integration/module-utils/src/integration.module-definition.ts b/integration/module-utils/src/integration.module-definition.ts
new file mode 100644
index 000000000..89d7a9842
--- /dev/null
+++ b/integration/module-utils/src/integration.module-definition.ts
@@ -0,0 +1,17 @@
+import { ConfigurableModuleBuilder } from '@nestjs/common';
+import { IntegrationModuleOptions } from './interfaces/integration-module-options.interface';
+
+export const { ConfigurableModuleClass, MODULE_OPTIONS_TOKEN } =
+  new ConfigurableModuleBuilder<IntegrationModuleOptions>()
+    .setClassMethodName('forRoot')
+    .setFactoryMethodName('construct')
+    .setExtras(
+      {
+        isGlobal: true,
+      },
+      (definition, extras) => ({
+        ...definition,
+        global: extras.isGlobal,
+      }),
+    )
+    .build();
diff --git a/integration/module-utils/src/integration.module.ts b/integration/module-utils/src/integration.module.ts
new file mode 100644
index 000000000..3b994f4bd
--- /dev/null
+++ b/integration/module-utils/src/integration.module.ts
@@ -0,0 +1,16 @@
+import { Inject, Module } from '@nestjs/common';
+import {
+  ConfigurableModuleClass,
+  MODULE_OPTIONS_TOKEN,
+} from './integration.module-definition';
+import { IntegrationModuleOptions } from './interfaces/integration-module-options.interface';
+
+@Module({})
+export class IntegrationModule extends ConfigurableModuleClass {
+  constructor(
+    @Inject(MODULE_OPTIONS_TOKEN)
+    public readonly options: IntegrationModuleOptions,
+  ) {
+    super();
+  }
+}
diff --git a/integration/module-utils/src/interfaces/integration-module-options.interface.ts b/integration/module-utils/src/interfaces/integration-module-options.interface.ts
new file mode 100644
index 000000000..802e02076
--- /dev/null
+++ b/integration/module-utils/src/interfaces/integration-module-options.interface.ts
@@ -0,0 +1,4 @@
+export interface IntegrationModuleOptions {
+  url: string;
+  secure?: boolean;
+}
diff --git a/integration/module-utils/test/integration-module.spec.ts b/integration/module-utils/test/integration-module.spec.ts
new file mode 100644
index 000000000..ea22a71c5
--- /dev/null
+++ b/integration/module-utils/test/integration-module.spec.ts
@@ -0,0 +1,47 @@
+import { Test } from '@nestjs/testing';
+import { expect } from 'chai';
+import { IntegrationModule } from '../src/integration.module';
+
+describe('Module utils (ConfigurableModuleBuilder)', () => {
+  it('should auto-generate "forRoot" method', async () => {
+    const moduleRef = await Test.createTestingModule({
+      imports: [
+        IntegrationModule.forRoot({
+          isGlobal: true,
+          url: 'test_url',
+          secure: false,
+        }),
+      ],
+    }).compile();
+
+    const integrationModule = moduleRef.get(IntegrationModule);
+
+    expect(integrationModule.options).to.deep.equal({
+      url: 'test_url',
+      secure: false,
+    });
+  });
+
+  it('should auto-generate "forRootAsync" method', async () => {
+    const moduleRef = await Test.createTestingModule({
+      imports: [
+        IntegrationModule.forRootAsync({
+          isGlobal: true,
+          useFactory: () => {
+            return {
+              url: 'test_url',
+              secure: false,
+            };
+          },
+        }),
+      ],
+    }).compile();
+
+    const integrationModule = moduleRef.get(IntegrationModule);
+
+    expect(integrationModule.options).to.deep.equal({
+      url: 'test_url',
+      secure: false,
+    });
+  });
+});
diff --git a/integration/module-utils/tsconfig.json b/integration/module-utils/tsconfig.json
new file mode 100644
index 000000000..c6354c564
--- /dev/null
+++ b/integration/module-utils/tsconfig.json
@@ -0,0 +1,22 @@
+{
+  "compilerOptions": {
+    "module": "commonjs",
+    "declaration": false,
+    "noImplicitAny": false,
+    "removeComments": true,
+    "noLib": false,
+    "emitDecoratorMetadata": true,
+    "experimentalDecorators": true,
+    "target": "es6",
+    "sourceMap": true,
+    "allowJs": true,
+    "outDir": "./dist"
+  },
+  "include": [
+    "src/**/*",
+    "e2e/**/*"
+  ],
+  "exclude": [
+    "node_modules",
+  ]
+}
\ No newline at end of file
diff --git a/integration/mosquitto.conf b/integration/mosquitto.conf
new file mode 100644
index 000000000..440823741
--- /dev/null
+++ b/integration/mosquitto.conf
@@ -0,0 +1,906 @@
+# Config file for mosquitto
+#
+# See mosquitto.conf(5) for more information.
+#
+# Default values are shown, uncomment to change.
+#
+# Use the # character to indicate a comment, but only if it is the
+# very first character on the line.
+
+# =================================================================
+# General configuration
+# =================================================================
+
+# Use per listener security settings.
+#
+# It is recommended this option be set before any other options.
+#
+# If this option is set to true, then all authentication and access control
+# options are controlled on a per listener basis. The following options are
+# affected:
+#
+# acl_file
+# allow_anonymous
+# allow_zero_length_clientid
+# auto_id_prefix
+# password_file
+# plugin
+# plugin_opt_*
+# psk_file
+#
+# Note that if set to true, then a durable client (i.e. with clean session set
+# to false) that has disconnected will use the ACL settings defined for the
+# listener that it was most recently connected to.
+#
+# The default behaviour is for this to be set to false, which maintains the
+# setting behaviour from previous versions of mosquitto.
+#per_listener_settings false
+
+
+# This option controls whether a client is allowed to connect with a zero
+# length client id or not. This option only affects clients using MQTT v3.1.1
+# and later. If set to false, clients connecting with a zero length client id
+# are disconnected. If set to true, clients will be allocated a client id by
+# the broker. This means it is only useful for clients with clean session set
+# to true.
+#allow_zero_length_clientid true
+
+# If allow_zero_length_clientid is true, this option allows you to set a prefix
+# to automatically generated client ids to aid visibility in logs.
+# Defaults to 'auto-'
+#auto_id_prefix auto-
+
+# This option affects the scenario when a client subscribes to a topic that has
+# retained messages. It is possible that the client that published the retained
+# message to the topic had access at the time they published, but that access
+# has been subsequently removed. If check_retain_source is set to true, the
+# default, the source of a retained message will be checked for access rights
+# before it is republished. When set to false, no check will be made and the
+# retained message will always be published. This affects all listeners.
+#check_retain_source true
+
+# QoS 1 and 2 messages will be allowed inflight per client until this limit
+# is exceeded.  Defaults to 0. (No maximum)
+# See also max_inflight_messages
+#max_inflight_bytes 0
+
+# The maximum number of QoS 1 and 2 messages currently inflight per
+# client.
+# This includes messages that are partway through handshakes and
+# those that are being retried. Defaults to 20. Set to 0 for no
+# maximum. Setting to 1 will guarantee in-order delivery of QoS 1
+# and 2 messages.
+#max_inflight_messages 20
+
+# For MQTT v5 clients, it is possible to have the server send a "server
+# keepalive" value that will override the keepalive value set by the client.
+# This is intended to be used as a mechanism to say that the server will
+# disconnect the client earlier than it anticipated, and that the client should
+# use the new keepalive value. The max_keepalive option allows you to specify
+# that clients may only connect with keepalive less than or equal to this
+# value, otherwise they will be sent a server keepalive telling them to use
+# max_keepalive. This only applies to MQTT v5 clients. The default, and maximum
+# value allowable, is 65535.
+#
+# Set to 0 to allow clients to set keepalive = 0, which means no keepalive
+# checks are made and the client will never be disconnected by the broker if no
+# messages are received. You should be very sure this is the behaviour that you
+# want.
+#
+# For MQTT v3.1.1 and v3.1 clients, there is no mechanism to tell the client
+# what keepalive value they should use. If an MQTT v3.1.1 or v3.1 client
+# specifies a keepalive time greater than max_keepalive they will be sent a
+# CONNACK message with the "identifier rejected" reason code, and disconnected.
+#
+#max_keepalive 65535
+
+# For MQTT v5 clients, it is possible to have the server send a "maximum packet
+# size" value that will instruct the client it will not accept MQTT packets
+# with size greater than max_packet_size bytes. This applies to the full MQTT
+# packet, not just the payload. Setting this option to a positive value will
+# set the maximum packet size to that number of bytes. If a client sends a
+# packet which is larger than this value, it will be disconnected. This applies
+# to all clients regardless of the protocol version they are using, but v3.1.1
+# and earlier clients will of course not have received the maximum packet size
+# information. Defaults to no limit. Setting below 20 bytes is forbidden
+# because it is likely to interfere with ordinary client operation, even with
+# very small payloads.
+#max_packet_size 0
+
+# QoS 1 and 2 messages above those currently in-flight will be queued per
+# client until this limit is exceeded.  Defaults to 0. (No maximum)
+# See also max_queued_messages.
+# If both max_queued_messages and max_queued_bytes are specified, packets will
+# be queued until the first limit is reached.
+#max_queued_bytes 0
+
+# Set the maximum QoS supported. Clients publishing at a QoS higher than
+# specified here will be disconnected.
+#max_qos 2
+
+# The maximum number of QoS 1 and 2 messages to hold in a queue per client
+# above those that are currently in-flight.  Defaults to 1000. Set
+# to 0 for no maximum (not recommended).
+# See also queue_qos0_messages.
+# See also max_queued_bytes.
+#max_queued_messages 1000
+#
+# This option sets the maximum number of heap memory bytes that the broker will
+# allocate, and hence sets a hard limit on memory use by the broker.  Memory
+# requests that exceed this value will be denied. The effect will vary
+# depending on what has been denied. If an incoming message is being processed,
+# then the message will be dropped and the publishing client will be
+# disconnected. If an outgoing message is being sent, then the individual
+# message will be dropped and the receiving client will be disconnected.
+# Defaults to no limit.
+#memory_limit 0
+
+# This option sets the maximum publish payload size that the broker will allow.
+# Received messages that exceed this size will not be accepted by the broker.
+# The default value is 0, which means that all valid MQTT messages are
+# accepted. MQTT imposes a maximum payload size of 268435455 bytes.
+#message_size_limit 0
+
+# This option allows persistent clients (those with clean session set to false)
+# to be removed if they do not reconnect within a certain time frame.
+#
+# This is a non-standard option in MQTT V3.1 but allowed in MQTT v3.1.1.
+#
+# Badly designed clients may set clean session to false whilst using a randomly
+# generated client id. This leads to persistent clients that will never
+# reconnect. This option allows these clients to be removed.
+#
+# The expiration period should be an integer followed by one of h d w m y for
+# hour, day, week, month and year respectively. For example
+#
+# persistent_client_expiration 2m
+# persistent_client_expiration 14d
+# persistent_client_expiration 1y
+#
+# The default if not set is to never expire persistent clients.
+#persistent_client_expiration
+
+# Write process id to a file. Default is a blank string which means
+# a pid file shouldn't be written.
+# This should be set to /var/run/mosquitto/mosquitto.pid if mosquitto is
+# being run automatically on boot with an init script and
+# start-stop-daemon or similar.
+#pid_file
+
+# Set to true to queue messages with QoS 0 when a persistent client is
+# disconnected. These messages are included in the limit imposed by
+# max_queued_messages and max_queued_bytes
+# Defaults to false.
+# This is a non-standard option for the MQTT v3.1 spec but is allowed in
+# v3.1.1.
+#queue_qos0_messages false
+
+# Set to false to disable retained message support. If a client publishes a
+# message with the retain bit set, it will be disconnected if this is set to
+# false.
+#retain_available true
+
+# Disable Nagle's algorithm on client sockets. This has the effect of reducing
+# latency of individual messages at the potential cost of increasing the number
+# of packets being sent.
+#set_tcp_nodelay false
+
+# Time in seconds between updates of the $SYS tree.
+# Set to 0 to disable the publishing of the $SYS tree.
+#sys_interval 10
+
+# The MQTT specification requires that the QoS of a message delivered to a
+# subscriber is never upgraded to match the QoS of the subscription. Enabling
+# this option changes this behaviour. If upgrade_outgoing_qos is set true,
+# messages sent to a subscriber will always match the QoS of its subscription.
+# This is a non-standard option explicitly disallowed by the spec.
+#upgrade_outgoing_qos false
+
+# When run as root, drop privileges to this user and its primary
+# group.
+# Set to root to stay as root, but this is not recommended.
+# If set to "mosquitto", or left unset, and the "mosquitto" user does not exist
+# then it will drop privileges to the "nobody" user instead.
+# If run as a non-root user, this setting has no effect.
+# Note that on Windows this has no effect and so mosquitto should be started by
+# the user you wish it to run as.
+#user mosquitto
+
+# =================================================================
+# Listeners
+# =================================================================
+
+# Listen on a port/ip address combination. By using this variable
+# multiple times, mosquitto can listen on more than one port. If
+# this variable is used and neither bind_address nor port given,
+# then the default listener will not be started.
+# The port number to listen on must be given. Optionally, an ip
+# address or host name may be supplied as a second argument. In
+# this case, mosquitto will attempt to bind the listener to that
+# address and so restrict access to the associated network and
+# interface. By default, mosquitto will listen on all interfaces.
+# Note that for a websockets listener it is not possible to bind to a host
+# name.
+#
+# On systems that support Unix Domain Sockets, it is also possible
+# to create a # Unix socket rather than opening a TCP socket. In
+# this case, the port number should be set to 0 and a unix socket
+# path must be provided, e.g.
+# listener 0 /tmp/mosquitto.sock
+#
+# listener port-number [ip address/host name/unix socket path]
+#listener
+
+# By default, a listener will attempt to listen on all supported IP protocol
+# versions. If you do not have an IPv4 or IPv6 interface you may wish to
+# disable support for either of those protocol versions. In particular, note
+# that due to the limitations of the websockets library, it will only ever
+# attempt to open IPv6 sockets if IPv6 support is compiled in, and so will fail
+# if IPv6 is not available.
+#
+# Set to `ipv4` to force the listener to only use IPv4, or set to `ipv6` to
+# force the listener to only use IPv6. If you want support for both IPv4 and
+# IPv6, then do not use the socket_domain option.
+#
+#socket_domain
+
+# Bind the listener to a specific interface. This is similar to
+# the [ip address/host name] part of the listener definition, but is useful
+# when an interface has multiple addresses or the address may change. If used
+# with the [ip address/host name] part of the listener definition, then the
+# bind_interface option will take priority.
+# Not available on Windows.
+#
+# Example: bind_interface eth0
+#bind_interface
+
+# When a listener is using the websockets protocol, it is possible to serve
+# http data as well. Set http_dir to a directory which contains the files you
+# wish to serve. If this option is not specified, then no normal http
+# connections will be possible.
+#http_dir
+
+# The maximum number of client connections to allow. This is
+# a per listener setting.
+# Default is -1, which means unlimited connections.
+# Note that other process limits mean that unlimited connections
+# are not really possible. Typically the default maximum number of
+# connections possible is around 1024.
+#max_connections -1
+
+# The listener can be restricted to operating within a topic hierarchy using
+# the mount_point option. This is achieved be prefixing the mount_point string
+# to all topics for any clients connected to this listener. This prefixing only
+# happens internally to the broker; the client will not see the prefix.
+#mount_point
+
+# Choose the protocol to use when listening.
+# This can be either mqtt or websockets.
+# Certificate based TLS may be used with websockets, except that only the
+# cafile, certfile, keyfile, ciphers, and ciphers_tls13 options are supported.
+#protocol mqtt
+listener 1883
+protocol mqtt
+
+listener 9001
+protocol websockets
+
+# Set use_username_as_clientid to true to replace the clientid that a client
+# connected with with its username. This allows authentication to be tied to
+# the clientid, which means that it is possible to prevent one client
+# disconnecting another by using the same clientid.
+# If a client connects with no username it will be disconnected as not
+# authorised when this option is set to true.
+# Do not use in conjunction with clientid_prefixes.
+# See also use_identity_as_username.
+#use_username_as_clientid
+
+# Change the websockets headers size. This is a global option, it is not
+# possible to set per listener. This option sets the size of the buffer used in
+# the libwebsockets library when reading HTTP headers. If you are passing large
+# header data such as cookies then you may need to increase this value. If left
+# unset, or set to 0, then the default of 1024 bytes will be used.
+#websockets_headers_size
+
+# -----------------------------------------------------------------
+# Certificate based SSL/TLS support
+# -----------------------------------------------------------------
+# The following options can be used to enable certificate based SSL/TLS support
+# for this listener. Note that the recommended port for MQTT over TLS is 8883,
+# but this must be set manually.
+#
+# See also the mosquitto-tls man page and the "Pre-shared-key based SSL/TLS
+# support" section. Only one of certificate or PSK encryption support can be
+# enabled for any listener.
+
+# Both of certfile and keyfile must be defined to enable certificate based
+# TLS encryption.
+
+# Path to the PEM encoded server certificate.
+#certfile
+
+# Path to the PEM encoded keyfile.
+#keyfile
+
+# If you wish to control which encryption ciphers are used, use the ciphers
+# option. The list of available ciphers can be optained using the "openssl
+# ciphers" command and should be provided in the same format as the output of
+# that command. This applies to TLS 1.2 and earlier versions only. Use
+# ciphers_tls1.3 for TLS v1.3.
+#ciphers
+
+# Choose which TLS v1.3 ciphersuites are used for this listener.
+# Defaults to "TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256"
+#ciphers_tls1.3
+
+# If you have require_certificate set to true, you can create a certificate
+# revocation list file to revoke access to particular client certificates. If
+# you have done this, use crlfile to point to the PEM encoded revocation file.
+#crlfile
+
+# To allow the use of ephemeral DH key exchange, which provides forward
+# security, the listener must load DH parameters. This can be specified with
+# the dhparamfile option. The dhparamfile can be generated with the command
+# e.g. "openssl dhparam -out dhparam.pem 2048"
+#dhparamfile
+
+# By default an TLS enabled listener will operate in a similar fashion to a
+# https enabled web server, in that the server has a certificate signed by a CA
+# and the client will verify that it is a trusted certificate. The overall aim
+# is encryption of the network traffic. By setting require_certificate to true,
+# the client must provide a valid certificate in order for the network
+# connection to proceed. This allows access to the broker to be controlled
+# outside of the mechanisms provided by MQTT.
+#require_certificate false
+
+# cafile and capath define methods of accessing the PEM encoded
+# Certificate Authority certificates that will be considered trusted when
+# checking incoming client certificates.
+# cafile defines the path to a file containing the CA certificates.
+# capath defines a directory that will be searched for files
+# containing the CA certificates. For capath to work correctly, the
+# certificate files must have ".crt" as the file ending and you must run
+# "openssl rehash <path to capath>" each time you add/remove a certificate.
+#cafile
+#capath
+
+
+# If require_certificate is true, you may set use_identity_as_username to true
+# to use the CN value from the client certificate as a username. If this is
+# true, the password_file option will not be used for this listener.
+#use_identity_as_username false
+
+# -----------------------------------------------------------------
+# Pre-shared-key based SSL/TLS support
+# -----------------------------------------------------------------
+# The following options can be used to enable PSK based SSL/TLS support for
+# this listener. Note that the recommended port for MQTT over TLS is 8883, but
+# this must be set manually.
+#
+# See also the mosquitto-tls man page and the "Certificate based SSL/TLS
+# support" section. Only one of certificate or PSK encryption support can be
+# enabled for any listener.
+
+# The psk_hint option enables pre-shared-key support for this listener and also
+# acts as an identifier for this listener. The hint is sent to clients and may
+# be used locally to aid authentication. The hint is a free form string that
+# doesn't have much meaning in itself, so feel free to be creative.
+# If this option is provided, see psk_file to define the pre-shared keys to be
+# used or create a security plugin to handle them.
+#psk_hint
+
+# When using PSK, the encryption ciphers used will be chosen from the list of
+# available PSK ciphers. If you want to control which ciphers are available,
+# use the "ciphers" option.  The list of available ciphers can be optained
+# using the "openssl ciphers" command and should be provided in the same format
+# as the output of that command.
+#ciphers
+
+# Set use_identity_as_username to have the psk identity sent by the client used
+# as its username. Authentication will be carried out using the PSK rather than
+# the MQTT username/password and so password_file will not be used for this
+# listener.
+#use_identity_as_username false
+
+
+# =================================================================
+# Persistence
+# =================================================================
+
+# If persistence is enabled, save the in-memory database to disk
+# every autosave_interval seconds. If set to 0, the persistence
+# database will only be written when mosquitto exits. See also
+# autosave_on_changes.
+# Note that writing of the persistence database can be forced by
+# sending mosquitto a SIGUSR1 signal.
+#autosave_interval 1800
+
+# If true, mosquitto will count the number of subscription changes, retained
+# messages received and queued messages and if the total exceeds
+# autosave_interval then the in-memory database will be saved to disk.
+# If false, mosquitto will save the in-memory database to disk by treating
+# autosave_interval as a time in seconds.
+#autosave_on_changes false
+
+# Save persistent message data to disk (true/false).
+# This saves information about all messages, including
+# subscriptions, currently in-flight messages and retained
+# messages.
+# retained_persistence is a synonym for this option.
+#persistence false
+
+# The filename to use for the persistent database, not including
+# the path.
+#persistence_file mosquitto.db
+
+# Location for persistent database.
+# Default is an empty string (current directory).
+# Set to e.g. /var/lib/mosquitto if running as a proper service on Linux or
+# similar.
+#persistence_location
+
+
+# =================================================================
+# Logging
+# =================================================================
+
+# Places to log to. Use multiple log_dest lines for multiple
+# logging destinations.
+# Possible destinations are: stdout stderr syslog topic file dlt
+#
+# stdout and stderr log to the console on the named output.
+#
+# syslog uses the userspace syslog facility which usually ends up
+# in /var/log/messages or similar.
+#
+# topic logs to the broker topic '$SYS/broker/log/<severity>',
+# where severity is one of D, E, W, N, I, M which are debug, error,
+# warning, notice, information and message. Message type severity is used by
+# the subscribe/unsubscribe log_types and publishes log messages to
+# $SYS/broker/log/M/susbcribe or $SYS/broker/log/M/unsubscribe.
+#
+# The file destination requires an additional parameter which is the file to be
+# logged to, e.g. "log_dest file /var/log/mosquitto.log". The file will be
+# closed and reopened when the broker receives a HUP signal. Only a single file
+# destination may be configured.
+#
+# The dlt destination is for the automotive `Diagnostic Log and Trace` tool.
+# This requires that Mosquitto has been compiled with DLT support.
+#
+# Note that if the broker is running as a Windows service it will default to
+# "log_dest none" and neither stdout nor stderr logging is available.
+# Use "log_dest none" if you wish to disable logging.
+#log_dest stderr
+
+# Types of messages to log. Use multiple log_type lines for logging
+# multiple types of messages.
+# Possible types are: debug, error, warning, notice, information,
+# none, subscribe, unsubscribe, websockets, all.
+# Note that debug type messages are for decoding the incoming/outgoing
+# network packets. They are not logged in "topics".
+#log_type error
+#log_type warning
+#log_type notice
+#log_type information
+
+
+# If set to true, client connection and disconnection messages will be included
+# in the log.
+#connection_messages true
+
+# If using syslog logging (not on Windows), messages will be logged to the
+# "daemon" facility by default. Use the log_facility option to choose which of
+# local0 to local7 to log to instead. The option value should be an integer
+# value, e.g. "log_facility 5" to use local5.
+#log_facility
+
+# If set to true, add a timestamp value to each log message.
+#log_timestamp true
+
+# Set the format of the log timestamp. If left unset, this is the number of
+# seconds since the Unix epoch.
+# This is a free text string which will be passed to the strftime function. To
+# get an ISO 8601 datetime, for example:
+# log_timestamp_format %Y-%m-%dT%H:%M:%S
+#log_timestamp_format
+
+# Change the websockets logging level. This is a global option, it is not
+# possible to set per listener. This is an integer that is interpreted by
+# libwebsockets as a bit mask for its lws_log_levels enum. See the
+# libwebsockets documentation for more details. "log_type websockets" must also
+# be enabled.
+#websockets_log_level 0
+
+
+# =================================================================
+# Security
+# =================================================================
+
+# If set, only clients that have a matching prefix on their
+# clientid will be allowed to connect to the broker. By default,
+# all clients may connect.
+# For example, setting "secure-" here would mean a client "secure-
+# client" could connect but another with clientid "mqtt" couldn't.
+#clientid_prefixes
+
+# Boolean value that determines whether clients that connect
+# without providing a username are allowed to connect. If set to
+# false then a password file should be created (see the
+# password_file option) to control authenticated client access.
+#
+# Defaults to false, unless there are no listeners defined in the configuration
+# file, in which case it is set to true, but connections are only allowed from
+# the local machine.
+allow_anonymous true
+
+# -----------------------------------------------------------------
+# Default authentication and topic access control
+# -----------------------------------------------------------------
+
+# Control access to the broker using a password file. This file can be
+# generated using the mosquitto_passwd utility. If TLS support is not compiled
+# into mosquitto (it is recommended that TLS support should be included) then
+# plain text passwords are used, in which case the file should be a text file
+# with lines in the format:
+# username:password
+# The password (and colon) may be omitted if desired, although this
+# offers very little in the way of security.
+#
+# See the TLS client require_certificate and use_identity_as_username options
+# for alternative authentication options. If a plugin is used as well as
+# password_file, the plugin check will be made first.
+#password_file
+
+# Access may also be controlled using a pre-shared-key file. This requires
+# TLS-PSK support and a listener configured to use it. The file should be text
+# lines in the format:
+# identity:key
+# The key should be in hexadecimal format without a leading "0x".
+# If an plugin is used as well, the plugin check will be made first.
+#psk_file
+
+# Control access to topics on the broker using an access control list
+# file. If this parameter is defined then only the topics listed will
+# have access.
+# If the first character of a line of the ACL file is a # it is treated as a
+# comment.
+# Topic access is added with lines of the format:
+#
+# topic [read|write|readwrite|deny] <topic>
+#
+# The access type is controlled using "read", "write", "readwrite" or "deny".
+# This parameter is optional (unless <topic> contains a space character) - if
+# not given then the access is read/write.  <topic> can contain the + or #
+# wildcards as in subscriptions.
+#
+# The "deny" option can used to explicity deny access to a topic that would
+# otherwise be granted by a broader read/write/readwrite statement. Any "deny"
+# topics are handled before topics that grant read/write access.
+#
+# The first set of topics are applied to anonymous clients, assuming
+# allow_anonymous is true. User specific topic ACLs are added after a
+# user line as follows:
+#
+# user <username>
+#
+# The username referred to here is the same as in password_file. It is
+# not the clientid.
+#
+#
+# If is also possible to define ACLs based on pattern substitution within the
+# topic. The patterns available for substition are:
+#
+# %c to match the client id of the client
+# %u to match the username of the client
+#
+# The substitution pattern must be the only text for that level of hierarchy.
+#
+# The form is the same as for the topic keyword, but using pattern as the
+# keyword.
+# Pattern ACLs apply to all users even if the "user" keyword has previously
+# been given.
+#
+# If using bridges with usernames and ACLs, connection messages can be allowed
+# with the following pattern:
+# pattern write $SYS/broker/connection/%c/state
+#
+# pattern [read|write|readwrite] <topic>
+#
+# Example:
+#
+# pattern write sensor/%u/data
+#
+# If an plugin is used as well as acl_file, the plugin check will be
+# made first.
+#acl_file
+
+# -----------------------------------------------------------------
+# External authentication and topic access plugin options
+# -----------------------------------------------------------------
+
+# External authentication and access control can be supported with the
+# plugin option. This is a path to a loadable plugin. See also the
+# plugin_opt_* options described below.
+#
+# The plugin option can be specified multiple times to load multiple
+# plugins. The plugins will be processed in the order that they are specified
+# here. If the plugin option is specified alongside either of
+# password_file or acl_file then the plugin checks will be made first.
+#
+# If the per_listener_settings option is false, the plugin will be apply to all
+# listeners. If per_listener_settings is true, then the plugin will apply to
+# the current listener being defined only.
+#
+# This option is also available as `auth_plugin`, but this use is deprecated
+# and will be removed in the future.
+#
+#plugin
+
+# If the plugin option above is used, define options to pass to the
+# plugin here as described by the plugin instructions. All options named
+# using the format plugin_opt_* will be passed to the plugin, for example:
+#
+# This option is also available as `auth_opt_*`, but this use is deprecated
+# and will be removed in the future.
+#
+# plugin_opt_db_host
+# plugin_opt_db_port
+# plugin_opt_db_username
+# plugin_opt_db_password
+
+
+# =================================================================
+# Bridges
+# =================================================================
+
+# A bridge is a way of connecting multiple MQTT brokers together.
+# Create a new bridge using the "connection" option as described below. Set
+# options for the bridges using the remaining parameters. You must specify the
+# address and at least one topic to subscribe to.
+#
+# Each connection must have a unique name.
+#
+# The address line may have multiple host address and ports specified. See
+# below in the round_robin description for more details on bridge behaviour if
+# multiple addresses are used. Note that if you use an IPv6 address, then you
+# are required to specify a port.
+#
+# The direction that the topic will be shared can be chosen by
+# specifying out, in or both, where the default value is out.
+# The QoS level of the bridged communication can be specified with the next
+# topic option. The default QoS level is 0, to change the QoS the topic
+# direction must also be given.
+#
+# The local and remote prefix options allow a topic to be remapped when it is
+# bridged to/from the remote broker. This provides the ability to place a topic
+# tree in an appropriate location.
+#
+# For more details see the mosquitto.conf man page.
+#
+# Multiple topics can be specified per connection, but be careful
+# not to create any loops.
+#
+# If you are using bridges with cleansession set to false (the default), then
+# you may get unexpected behaviour from incoming topics if you change what
+# topics you are subscribing to. This is because the remote broker keeps the
+# subscription for the old topic. If you have this problem, connect your bridge
+# with cleansession set to true, then reconnect with cleansession set to false
+# as normal.
+#connection <name>
+#address <host>[:<port>] [<host>[:<port>]]
+#topic <topic> [[[out | in | both] qos-level] local-prefix remote-prefix]
+
+# If you need to have the bridge connect over a particular network interface,
+# use bridge_bind_address to tell the bridge which local IP address the socket
+# should bind to, e.g. `bridge_bind_address 192.168.1.10`
+#bridge_bind_address
+
+# If a bridge has topics that have "out" direction, the default behaviour is to
+# send an unsubscribe request to the remote broker on that topic. This means
+# that changing a topic direction from "in" to "out" will not keep receiving
+# incoming messages. Sending these unsubscribe requests is not always
+# desirable, setting bridge_attempt_unsubscribe to false will disable sending
+# the unsubscribe request.
+#bridge_attempt_unsubscribe true
+
+# Set the version of the MQTT protocol to use with for this bridge. Can be one
+# of mqttv50, mqttv311 or mqttv31. Defaults to mqttv311.
+#bridge_protocol_version mqttv311
+
+# Set the clean session variable for this bridge.
+# When set to true, when the bridge disconnects for any reason, all
+# messages and subscriptions will be cleaned up on the remote
+# broker. Note that with cleansession set to true, there may be a
+# significant amount of retained messages sent when the bridge
+# reconnects after losing its connection.
+# When set to false, the subscriptions and messages are kept on the
+# remote broker, and delivered when the bridge reconnects.
+#cleansession false
+
+# Set the amount of time a bridge using the lazy start type must be idle before
+# it will be stopped. Defaults to 60 seconds.
+#idle_timeout 60
+
+# Set the keepalive interval for this bridge connection, in
+# seconds.
+#keepalive_interval 60
+
+# Set the clientid to use on the local broker. If not defined, this defaults to
+# 'local.<clientid>'. If you are bridging a broker to itself, it is important
+# that local_clientid and clientid do not match.
+#local_clientid
+
+# If set to true, publish notification messages to the local and remote brokers
+# giving information about the state of the bridge connection. Retained
+# messages are published to the topic $SYS/broker/connection/<clientid>/state
+# unless the notification_topic option is used.
+# If the message is 1 then the connection is active, or 0 if the connection has
+# failed.
+# This uses the last will and testament feature.
+#notifications true
+
+# Choose the topic on which notification messages for this bridge are
+# published. If not set, messages are published on the topic
+# $SYS/broker/connection/<clientid>/state
+#notification_topic
+
+# Set the client id to use on the remote end of this bridge connection. If not
+# defined, this defaults to 'name.hostname' where name is the connection name
+# and hostname is the hostname of this computer.
+# This replaces the old "clientid" option to avoid confusion. "clientid"
+# remains valid for the time being.
+#remote_clientid
+
+# Set the password to use when connecting to a broker that requires
+# authentication. This option is only used if remote_username is also set.
+# This replaces the old "password" option to avoid confusion. "password"
+# remains valid for the time being.
+#remote_password
+
+# Set the username to use when connecting to a broker that requires
+# authentication.
+# This replaces the old "username" option to avoid confusion. "username"
+# remains valid for the time being.
+#remote_username
+
+# Set the amount of time a bridge using the automatic start type will wait
+# until attempting to reconnect.
+# This option can be configured to use a constant delay time in seconds, or to
+# use a backoff mechanism based on "Decorrelated Jitter", which adds a degree
+# of randomness to when the restart occurs.
+#
+# Set a constant timeout of 20 seconds:
+# restart_timeout 20
+#
+# Set backoff with a base (start value) of 10 seconds and a cap (upper limit) of
+# 60 seconds:
+# restart_timeout 10 30
+#
+# Defaults to jitter with a base of 5 and cap of 30
+#restart_timeout 5 30
+
+# If the bridge has more than one address given in the address/addresses
+# configuration, the round_robin option defines the behaviour of the bridge on
+# a failure of the bridge connection. If round_robin is false, the default
+# value, then the first address is treated as the main bridge connection. If
+# the connection fails, the other secondary addresses will be attempted in
+# turn. Whilst connected to a secondary bridge, the bridge will periodically
+# attempt to reconnect to the main bridge until successful.
+# If round_robin is true, then all addresses are treated as equals. If a
+# connection fails, the next address will be tried and if successful will
+# remain connected until it fails
+#round_robin false
+
+# Set the start type of the bridge. This controls how the bridge starts and
+# can be one of three types: automatic, lazy and once. Note that RSMB provides
+# a fourth start type "manual" which isn't currently supported by mosquitto.
+#
+# "automatic" is the default start type and means that the bridge connection
+# will be started automatically when the broker starts and also restarted
+# after a short delay (30 seconds) if the connection fails.
+#
+# Bridges using the "lazy" start type will be started automatically when the
+# number of queued messages exceeds the number set with the "threshold"
+# parameter. It will be stopped automatically after the time set by the
+# "idle_timeout" parameter. Use this start type if you wish the connection to
+# only be active when it is needed.
+#
+# A bridge using the "once" start type will be started automatically when the
+# broker starts but will not be restarted if the connection fails.
+#start_type automatic
+
+# Set the number of messages that need to be queued for a bridge with lazy
+# start type to be restarted. Defaults to 10 messages.
+# Must be less than max_queued_messages.
+#threshold 10
+
+# If try_private is set to true, the bridge will attempt to indicate to the
+# remote broker that it is a bridge not an ordinary client. If successful, this
+# means that loop detection will be more effective and that retained messages
+# will be propagated correctly. Not all brokers support this feature so it may
+# be necessary to set try_private to false if your bridge does not connect
+# properly.
+#try_private true
+
+# Some MQTT brokers do not allow retained messages. MQTT v5 gives a mechanism
+# for brokers to tell clients that they do not support retained messages, but
+# this is not possible for MQTT v3.1.1 or v3.1. If you need to bridge to a
+# v3.1.1 or v3.1 broker that does not support retained messages, set the
+# bridge_outgoing_retain option to false. This will remove the retain bit on
+# all outgoing messages to that bridge, regardless of any other setting.
+#bridge_outgoing_retain true
+
+# If you wish to restrict the size of messages sent to a remote bridge, use the
+# bridge_max_packet_size option. This sets the maximum number of bytes for
+# the total message, including headers and payload.
+# Note that MQTT v5 brokers may provide their own maximum-packet-size property.
+# In this case, the smaller of the two limits will be used.
+# Set to 0 for "unlimited".
+#bridge_max_packet_size 0
+
+
+# -----------------------------------------------------------------
+# Certificate based SSL/TLS support
+# -----------------------------------------------------------------
+# Either bridge_cafile or bridge_capath must be defined to enable TLS support
+# for this bridge.
+# bridge_cafile defines the path to a file containing the
+# Certificate Authority certificates that have signed the remote broker
+# certificate.
+# bridge_capath defines a directory that will be searched for files containing
+# the CA certificates. For bridge_capath to work correctly, the certificate
+# files must have ".crt" as the file ending and you must run "openssl rehash
+# <path to capath>" each time you add/remove a certificate.
+#bridge_cafile
+#bridge_capath
+
+
+# If the remote broker has more than one protocol available on its port, e.g.
+# MQTT and WebSockets, then use bridge_alpn to configure which protocol is
+# requested. Note that WebSockets support for bridges is not yet available.
+#bridge_alpn
+
+# When using certificate based encryption, bridge_insecure disables
+# verification of the server hostname in the server certificate. This can be
+# useful when testing initial server configurations, but makes it possible for
+# a malicious third party to impersonate your server through DNS spoofing, for
+# example. Use this option in testing only. If you need to resort to using this
+# option in a production environment, your setup is at fault and there is no
+# point using encryption.
+#bridge_insecure false
+
+# Path to the PEM encoded client certificate, if required by the remote broker.
+#bridge_certfile
+
+# Path to the PEM encoded client private key, if required by the remote broker.
+#bridge_keyfile
+
+# -----------------------------------------------------------------
+# PSK based SSL/TLS support
+# -----------------------------------------------------------------
+# Pre-shared-key encryption provides an alternative to certificate based
+# encryption. A bridge can be configured to use PSK with the bridge_identity
+# and bridge_psk options. These are the client PSK identity, and pre-shared-key
+# in hexadecimal format with no "0x". Only one of certificate and PSK based
+# encryption can be used on one
+# bridge at once.
+#bridge_identity
+#bridge_psk
+
+
+# =================================================================
+# External config files
+# =================================================================
+
+# External configuration files may be included by using the
+# include_dir option. This defines a directory that will be searched
+# for config files. All files that end in '.conf' will be loaded as
+# a configuration file. It is best to have this as the last option
+# in the main file. This option will only be processed from the main
+# configuration file. The directory specified must not contain the
+# main configuration file.
+# Files within include_dir will be loaded sorted in case-sensitive
+# alphabetical order, with capital letters ordered first. If this option is
+# given multiple times, all of the files from the first instance will be
+# processed before the next instance. See the man page for examples.
+#include_dir
diff --git a/integration/nest-application/global-prefix/e2e/global-prefix.spec.ts b/integration/nest-application/global-prefix/e2e/global-prefix.spec.ts
index b11becd24..131d2dd03 100644
--- a/integration/nest-application/global-prefix/e2e/global-prefix.spec.ts
+++ b/integration/nest-application/global-prefix/e2e/global-prefix.spec.ts
@@ -108,15 +108,15 @@ describe('Global prefix', () => {
     server = app.getHttpServer();
     await app.init();
 
-    await request(server).get('/hello/foo').expect(200);
+    await request(server)
+      .get('/hello/foo')
+      .expect(200, 'Hello: Data attached in middleware');
 
     await request(server)
       .get('/middleware/foo')
       .expect(200, MIDDLEWARE_PARAM_VALUE);
 
-    await request(server)
-      .get('/api/v1/middleware/foo')
-      .expect(404);
+    await request(server).get('/api/v1/middleware/foo').expect(404);
   });
 
   afterEach(async () => {
diff --git a/integration/nest-application/global-prefix/src/app.controller.ts b/integration/nest-application/global-prefix/src/app.controller.ts
index 8d1472a2f..912c0d76c 100644
--- a/integration/nest-application/global-prefix/src/app.controller.ts
+++ b/integration/nest-application/global-prefix/src/app.controller.ts
@@ -1,10 +1,10 @@
-import { Controller, Get, Post } from '@nestjs/common';
+import { Controller, Get, Post, Req } from '@nestjs/common';
 
 @Controller()
 export class AppController {
   @Get('hello/:name')
-  getHello(): string {
-    return 'hello';
+  getHello(@Req() req): string {
+    return 'Hello: ' + req.extras?.data;
   }
 
   @Get('health')
diff --git a/integration/nest-application/global-prefix/src/app.module.ts b/integration/nest-application/global-prefix/src/app.module.ts
index 2123145a8..85d1e6ac4 100644
--- a/integration/nest-application/global-prefix/src/app.module.ts
+++ b/integration/nest-application/global-prefix/src/app.module.ts
@@ -17,6 +17,11 @@ export class AppModule {
       .apply((req, res, next) => res.end(MIDDLEWARE_PARAM_VALUE))
       .forRoutes({ path: MIDDLEWARE_VALUE + '/*', method: RequestMethod.GET })
       .apply((req, res, next) => res.status(201).end(MIDDLEWARE_PARAM_VALUE))
-      .forRoutes({ path: MIDDLEWARE_VALUE + '/*', method: RequestMethod.POST });
+      .forRoutes({ path: MIDDLEWARE_VALUE + '/*', method: RequestMethod.POST })
+      .apply((req, res, next) => {
+        req.extras = { data: 'Data attached in middleware' };
+        next();
+      })
+      .forRoutes({ path: '*', method: RequestMethod.GET });
   }
 }
diff --git a/integration/send-files/e2e/express.spec.ts b/integration/send-files/e2e/express.spec.ts
index 425ce6695..1657d137c 100644
--- a/integration/send-files/e2e/express.spec.ts
+++ b/integration/send-files/e2e/express.spec.ts
@@ -9,7 +9,8 @@ import { join } from 'path';
 import * as request from 'supertest';
 import { AppModule } from '../src/app.module';
 
-const readmeString = readFileSync(join(process.cwd(), 'Readme.md')).toString();
+const readme = readFileSync(join(process.cwd(), 'Readme.md'));
+const readmeString = readme.toString();
 
 describe('Express FileSend', () => {
   let app: NestExpressApplication;
@@ -53,12 +54,13 @@ describe('Express FileSend', () => {
         expect(res.body.toString()).to.be.eq(readmeString);
       });
   });
-  it('should return a file with correct content type and disposition', async () => {
+  it('should return a file with correct headers', async () => {
     return request(app.getHttpServer())
       .get('/file/with/headers')
       .expect(200)
       .expect('Content-Type', 'text/markdown')
       .expect('Content-Disposition', 'attachment; filename="Readme.md"')
+      .expect('Content-Length', readme.byteLength.toString())
       .expect(res => {
         expect(res.text).to.be.eq(readmeString);
       });
diff --git a/integration/send-files/e2e/fastify.spec.ts b/integration/send-files/e2e/fastify.spec.ts
index 9e7ee5b5e..8b821ba7c 100644
--- a/integration/send-files/e2e/fastify.spec.ts
+++ b/integration/send-files/e2e/fastify.spec.ts
@@ -8,7 +8,8 @@ import { readFileSync } from 'fs';
 import { join } from 'path';
 import { AppModule } from '../src/app.module';
 
-const readmeString = readFileSync(join(process.cwd(), 'Readme.md')).toString();
+const readme = readFileSync(join(process.cwd(), 'Readme.md'));
+const readmeString = readme.toString();
 
 describe('Fastify FileSend', () => {
   let app: NestFastifyApplication;
@@ -67,4 +68,17 @@ describe('Fastify FileSend', () => {
         expect(payload.toString()).to.be.eq(readmeString);
       });
   });
+  it('should return a file with correct headers', async () => {
+    return app
+      .inject({ url: '/file/with/headers', method: 'get' })
+      .then(({ statusCode, headers, payload }) => {
+        expect(statusCode).to.equal(200);
+        expect(headers['content-type']).to.equal('text/markdown');
+        expect(headers['content-disposition']).to.equal(
+          'attachment; filename="Readme.md"',
+        );
+        expect(headers['content-length']).to.equal(readme.byteLength);
+        expect(payload).to.equal(readmeString);
+      });
+  });
 });
diff --git a/integration/send-files/src/app.service.ts b/integration/send-files/src/app.service.ts
index a83e6a4f6..ba5849a75 100644
--- a/integration/send-files/src/app.service.ts
+++ b/integration/send-files/src/app.service.ts
@@ -25,11 +25,13 @@ export class AppService {
   }
 
   getFileWithHeaders(): StreamableFile {
+    const file = readFileSync(join(process.cwd(), 'Readme.md'));
     return new StreamableFile(
       createReadStream(join(process.cwd(), 'Readme.md')),
       {
         type: 'text/markdown',
         disposition: 'attachment; filename="Readme.md"',
+        length: file.byteLength,
       },
     );
   }
diff --git a/integration/versioning/e2e/custom-versioning-fastify.spec.ts b/integration/versioning/e2e/custom-versioning-fastify.spec.ts
new file mode 100644
index 000000000..0deaf4e59
--- /dev/null
+++ b/integration/versioning/e2e/custom-versioning-fastify.spec.ts
@@ -0,0 +1,967 @@
+import { INestApplication, VersioningType } from '@nestjs/common';
+import {
+  FastifyAdapter,
+  NestFastifyApplication,
+} from '@nestjs/platform-fastify';
+import { Test } from '@nestjs/testing';
+import { FastifyRequest } from 'fastify';
+import * as request from 'supertest';
+import { AppModule } from '../src/app.module';
+
+describe('Custom Versioning (fastify)', () => {
+  const extractor = (request: FastifyRequest): string | string[] => {
+    const versions = [request.headers['accept'] ?? '']
+      .flatMap(v => v.split(','))
+      .map(header => header.match(/v(\d+\.?\d*)\+json$/))
+      .filter(match => match && match.length)
+      .map(matchArray => matchArray[1])
+      .sort()
+      .reverse();
+
+    return versions;
+  };
+  let app: INestApplication;
+
+  // ======================================================================== //
+  describe('without global default version', () => {
+    before(async () => {
+      const moduleRef = await Test.createTestingModule({
+        imports: [AppModule],
+      }).compile();
+
+      app = moduleRef.createNestApplication<NestFastifyApplication>(
+        new FastifyAdapter(),
+      );
+      app.enableVersioning({
+        type: VersioningType.CUSTOM,
+        extractor,
+      });
+      await app.init();
+      await app.getHttpAdapter().getInstance().ready();
+    });
+
+    describe('GET /', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Hello World V1!');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Hello World V2!');
+      });
+
+      it('V2, if two versions are requested, select the highest version', () => {
+        return request(app.getHttpServer())
+          .get('/')
+          .set({
+            Accept: 'application/foo.v1+json, application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Hello World V2!');
+      });
+
+      it('V2, if a non-existent version is requested, select the highest supported version', () => {
+        return request(app.getHttpServer())
+          .get('/')
+          .set({
+            Accept:
+              'application/foo.v1+json, application/foo.v2+json, application/foo.v3+json',
+          })
+          .expect(200)
+          .expect('Hello World V2!');
+      });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(404);
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(404);
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer()).get('/').expect(404);
+      });
+    });
+
+    describe('GET /:param', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/param/hello')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Parameter V1!');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/param/hello')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Parameter V2!');
+      });
+
+      it('V2, if two versions are requested, select the highest version', () => {
+        return request(app.getHttpServer())
+          .get('/param/hello')
+          .set({
+            Accept: 'application/foo.v1+json, application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Parameter V2!');
+      });
+
+      it('V2, if a non-existent version is requested, select the highest supported version', () => {
+        return request(app.getHttpServer())
+          .get('/param/hello')
+          .set({
+            Accept:
+              'application/foo.v1+json, application/foo.v2+json, application/foo.v3+json',
+          })
+          .expect(200)
+          .expect('Parameter V2!');
+      });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/param/hello')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(404);
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/param/hello')
+          .set({
+            Accept: '',
+          })
+          .expect(404);
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer()).get('/').expect(404);
+      });
+    });
+
+    describe('GET /multiple', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/multiple')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Multiple Versions 1 or 2');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/multiple')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Multiple Versions 1 or 2');
+      });
+
+      it('V2, if two versions are requested, select the highest version', () => {
+        return request(app.getHttpServer())
+          .get('/multiple')
+          .set({
+            Accept: 'application/foo.v1+json, application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Multiple Versions 1 or 2');
+      });
+
+      it('V2, if a non-existent version is requested, select the highest supported version', () => {
+        return request(app.getHttpServer())
+          .get('/multiple')
+          .set({
+            Accept:
+              'application/foo.v1+json, application/foo.v2+json, application/foo.v3+json',
+          })
+          .expect(200)
+          .expect('Multiple Versions 1 or 2');
+      });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/multiple')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(404);
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/multiple')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(404);
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer()).get('/multiple').expect(404);
+      });
+    });
+
+    describe('GET /neutral', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/neutral')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Neutral');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/neutral')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Neutral');
+      });
+
+      it('V2, if two versions are requested, select the highest version', () => {
+        return request(app.getHttpServer())
+          .get('/neutral')
+          .set({
+            Accept: 'application/foo.v1+json, application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Neutral');
+      });
+
+      it('V2, if a non-existent version is requested, select the highest supported version', () => {
+        return request(app.getHttpServer())
+          .get('/neutral')
+          .set({
+            Accept:
+              'application/foo.v1+json, application/foo.v2+json, application/foo.v3+json',
+          })
+          .expect(200)
+          .expect('Neutral');
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/neutral')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(200)
+          .expect('Neutral');
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer())
+          .get('/neutral')
+          .expect(200)
+          .expect('Neutral');
+      });
+    });
+
+    describe('GET /override', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/override')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Override Version 1');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/override')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Override Version 2');
+      });
+
+      it('V2, if two versions are requested, select the highest version', () => {
+        return request(app.getHttpServer())
+          .get('/override')
+          .set({
+            Accept: 'application/foo.v1+json, application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Override Version 2');
+      });
+
+      it('V2, if a non-existent version is requested, select the highest supported version', () => {
+        return request(app.getHttpServer())
+          .get('/override')
+          .set({
+            Accept:
+              'application/foo.v1+json, application/foo.v2+json, application/foo.v3+json',
+          })
+          .expect(200)
+          .expect('Override Version 2');
+      });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/override')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(404);
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/override')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(404);
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer()).get('/override').expect(404);
+      });
+    });
+
+    describe('GET /override-partial', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Override Partial Version 1');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Override Partial Version 2');
+      });
+
+      it('V2, if two versions are requested, select the highest version', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .set({
+            Accept: 'application/foo.v1+json, application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Override Partial Version 2');
+      });
+
+      it('V2, if a non-existent version is requested, select the highest supported version', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .set({
+            Accept:
+              'application/foo.v1+json, application/foo.v2+json, application/foo.v3+json',
+          })
+          .expect(200)
+          .expect('Override Partial Version 2');
+      });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(404);
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(404);
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .expect(404);
+      });
+    });
+
+    describe('GET /foo/bar', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/foo/bar')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Hello FooBar!');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/foo/bar')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Hello FooBar!');
+      });
+
+      it('V2, if two versions are requested, select the highest version', () => {
+        return request(app.getHttpServer())
+          .get('/foo/bar')
+          .set({
+            Accept: 'application/foo.v1+json, application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Hello FooBar!');
+      });
+
+      it('V2, if a non-existent version is requested, select the highest supported version', () => {
+        return request(app.getHttpServer())
+          .get('/foo/bar')
+          .set({
+            Accept:
+              'application/foo.v1+json, application/foo.v2+json, application/foo.v3+json',
+          })
+          .expect(200)
+          .expect('Hello FooBar!');
+      });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/foo/bar')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(200)
+          .expect('Hello FooBar!');
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/foo/bar')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(200)
+          .expect('Hello FooBar!');
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer())
+          .get('/foo/bar')
+          .expect(200)
+          .expect('Hello FooBar!');
+      });
+    });
+
+    after(async () => {
+      await app.close();
+    });
+  });
+
+  // ======================================================================== //
+  describe('with the global default version: "1"', () => {
+    before(async () => {
+      const moduleRef = await Test.createTestingModule({
+        imports: [AppModule],
+      }).compile();
+
+      app = moduleRef.createNestApplication<NestFastifyApplication>(
+        new FastifyAdapter(),
+      );
+      app.enableVersioning({
+        type: VersioningType.CUSTOM,
+        extractor,
+        defaultVersion: '1',
+      });
+      await app.init();
+      await app.getHttpAdapter().getInstance().ready();
+    });
+
+    describe('GET /', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Hello World V1!');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Hello World V2!');
+      });
+
+      it('V2, if two versions are requested, select the highest version', () => {
+        return request(app.getHttpServer())
+          .get('/')
+          .set({
+            Accept: 'application/foo.v1+json, application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Hello World V2!');
+      });
+
+      it('V2, if a non-existent version is requested, select the highest supported version', () => {
+        return request(app.getHttpServer())
+          .get('/')
+          .set({
+            Accept:
+              'application/foo.v1+json, application/foo.v2+json, application/foo.v3+json',
+          })
+          .expect(200)
+          .expect('Hello World V2!');
+      });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(404);
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(404);
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer()).get('/').expect(404);
+      });
+    });
+
+    describe('GET /:param', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/param/hello')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Parameter V1!');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/param/hello')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Parameter V2!');
+      });
+
+      it('V2, if two versions are requested, select the highest version', () => {
+        return request(app.getHttpServer())
+          .get('/param/hello')
+          .set({
+            Accept: 'application/foo.v1+json, application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Parameter V2!');
+      });
+
+      it('V2, if a non-existent version is requested, select the highest supported version', () => {
+        return request(app.getHttpServer())
+          .get('/param/hello')
+          .set({
+            Accept:
+              'application/foo.v1+json, application/foo.v2+json, application/foo.v3+json',
+          })
+          .expect(200)
+          .expect('Parameter V2!');
+      });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/param/hello')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(404);
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/param/hello')
+          .set({
+            Accept: '',
+          })
+          .expect(404);
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer()).get('/').expect(404);
+      });
+    });
+
+    describe('GET /multiple', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/multiple')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Multiple Versions 1 or 2');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/multiple')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Multiple Versions 1 or 2');
+      });
+
+      it('V2, if two versions are requested, select the highest version', () => {
+        return request(app.getHttpServer())
+          .get('/multiple')
+          .set({
+            Accept: 'application/foo.v1+json, application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Multiple Versions 1 or 2');
+      });
+
+      it('V2, if a non-existent version is requested, select the highest supported version', () => {
+        return request(app.getHttpServer())
+          .get('/multiple')
+          .set({
+            Accept:
+              'application/foo.v1+json, application/foo.v2+json, application/foo.v3+json',
+          })
+          .expect(200)
+          .expect('Multiple Versions 1 or 2');
+      });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/multiple')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(404);
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/multiple')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(404);
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer()).get('/multiple').expect(404);
+      });
+    });
+
+    describe('GET /neutral', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/neutral')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Neutral');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/neutral')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Neutral');
+      });
+
+      it('V2, if two versions are requested, select the highest version', () => {
+        return request(app.getHttpServer())
+          .get('/neutral')
+          .set({
+            Accept: 'application/foo.v1+json, application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Neutral');
+      });
+
+      it('V2, if a non-existent version is requested, select the highest supported version', () => {
+        return request(app.getHttpServer())
+          .get('/neutral')
+          .set({
+            Accept:
+              'application/foo.v1+json, application/foo.v2+json, application/foo.v3+json',
+          })
+          .expect(200)
+          .expect('Neutral');
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/neutral')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(200)
+          .expect('Neutral');
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer())
+          .get('/neutral')
+          .expect(200)
+          .expect('Neutral');
+      });
+    });
+
+    describe('GET /override', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/override')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Override Version 1');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/override')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Override Version 2');
+      });
+
+      it('V2, if two versions are requested, select the highest version', () => {
+        return request(app.getHttpServer())
+          .get('/override')
+          .set({
+            Accept: 'application/foo.v1+json, application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Override Version 2');
+      });
+
+      it('V2, if a non-existent version is requested, select the highest supported version', () => {
+        return request(app.getHttpServer())
+          .get('/override')
+          .set({
+            Accept:
+              'application/foo.v1+json, application/foo.v2+json, application/foo.v3+json',
+          })
+          .expect(200)
+          .expect('Override Version 2');
+      });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/override')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(404);
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/override')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(404);
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer()).get('/override').expect(404);
+      });
+    });
+
+    describe('GET /override-partial', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Override Partial Version 1');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Override Partial Version 2');
+      });
+
+      it('V2, if two versions are requested, select the highest version', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .set({
+            Accept: 'application/foo.v1+json, application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Override Partial Version 2');
+      });
+
+      it('V2, if a non-existent version is requested, select the highest supported version', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .set({
+            Accept:
+              'application/foo.v1+json, application/foo.v2+json, application/foo.v3+json',
+          })
+          .expect(200)
+          .expect('Override Partial Version 2');
+      });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(404);
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(404);
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .expect(404);
+      });
+    });
+
+    describe('GET /foo/bar', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/foo/bar')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Hello FooBar!');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/foo/bar')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(404);
+      });
+
+      it('V2, if a non-existent version is requested, select the highest supported version', () => {
+        return request(app.getHttpServer())
+          .get('/foo/bar')
+          .set({
+            Accept: 'application/foo.v1+json, application/foo.v2+json',
+          })
+          .expect('Hello FooBar!');
+      });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/foo/bar')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(404);
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/foo/bar')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(404);
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer()).get('/foo/bar').expect(404);
+      });
+    });
+
+    after(async () => {
+      await app.close();
+    });
+  });
+});
diff --git a/integration/versioning/e2e/custom-versioning.spec.ts b/integration/versioning/e2e/custom-versioning.spec.ts
new file mode 100644
index 000000000..9cff09d2f
--- /dev/null
+++ b/integration/versioning/e2e/custom-versioning.spec.ts
@@ -0,0 +1,712 @@
+import { INestApplication, VersioningType } from '@nestjs/common';
+import { Test } from '@nestjs/testing';
+import { Request } from 'express';
+import * as request from 'supertest';
+import { AppModule } from '../src/app.module';
+
+describe('Custom Versioning', () => {
+  const extractor = (request: Request): string | string[] => {
+    const versions = request
+      .header('Accept')
+      ?.split(',')
+      .map(header => header.match(/v(\d+\.?\d*)\+json$/))
+      .filter(match => match && match.length)
+      .map(matchArray => matchArray[1])
+      .sort()
+      .reverse();
+
+    return versions;
+  };
+  let app: INestApplication;
+
+  // ======================================================================== //
+  describe('without global default version', () => {
+    before(async () => {
+      const moduleRef = await Test.createTestingModule({
+        imports: [AppModule],
+      }).compile();
+
+      app = moduleRef.createNestApplication();
+      app.enableVersioning({
+        type: VersioningType.CUSTOM,
+        extractor,
+      });
+      await app.init();
+    });
+
+    describe('GET /', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Hello World V1!');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Hello World V2!');
+      });
+
+      // There's a known limitation of the express-adapter, where
+      // it cannot handle selection of the highest matched version properly.
+      //
+      // it('V2, if two versions are requested, select the highest version', () => {
+      //   return request(app.getHttpServer())
+      //     .get('/')
+      //     .set({
+      //       Accept: 'application/foo.v1+json, application/foo.v2+json',
+      //     })
+      //     .expect(200)
+      //     .expect('Hello World V2!');
+      // });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(404);
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(404);
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer()).get('/').expect(404);
+      });
+    });
+
+    describe('GET /:param', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/param/hello')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Parameter V1!');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/param/hello')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Parameter V2!');
+      });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/param/hello')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(404);
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/param/hello')
+          .set({
+            Accept: '',
+          })
+          .expect(404);
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer()).get('/').expect(404);
+      });
+    });
+
+    describe('GET /multiple', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/multiple')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Multiple Versions 1 or 2');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/multiple')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Multiple Versions 1 or 2');
+      });
+
+      it('V2, if an unsupported version is specified, select the lower supported version', () => {
+        return request(app.getHttpServer())
+          .get('/multiple')
+          .set({
+            Accept: 'application/foo.v2+json, application/foo.v3+json',
+          })
+          .expect(200)
+          .expect('Multiple Versions 1 or 2');
+      });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/multiple')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(404);
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/multiple')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(404);
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer()).get('/multiple').expect(404);
+      });
+    });
+
+    describe('GET /neutral', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/neutral')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Neutral');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/neutral')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Neutral');
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/neutral')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(200)
+          .expect('Neutral');
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer())
+          .get('/neutral')
+          .expect(200)
+          .expect('Neutral');
+      });
+    });
+
+    describe('GET /override', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/override')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Override Version 1');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/override')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Override Version 2');
+      });
+
+      // There's a known limitation of the express-adapter, where
+      // it cannot handle selection of the highest matched version properly.
+      //
+      // it('V2, if two versions are requested, select the highest version', () => {
+      //   return request(app.getHttpServer())
+      //     .get('/override')
+      //     .set({
+      //       Accept: 'application/foo.v1+json, application/foo.v2+json',
+      //     })
+      //     .expect(200)
+      //     .expect('Override Version 2');
+      // });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/override')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(404);
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/override')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(404);
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer()).get('/override').expect(404);
+      });
+    });
+
+    describe('GET /override-partial', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Override Partial Version 1');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Override Partial Version 2');
+      });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(404);
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(404);
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .expect(404);
+      });
+    });
+
+    describe('GET /foo/bar', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/foo/bar')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Hello FooBar!');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/foo/bar')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Hello FooBar!');
+      });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/foo/bar')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(200)
+          .expect('Hello FooBar!');
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/foo/bar')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(200)
+          .expect('Hello FooBar!');
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer())
+          .get('/foo/bar')
+          .expect(200)
+          .expect('Hello FooBar!');
+      });
+    });
+
+    after(async () => {
+      await app.close();
+    });
+  });
+
+  // ======================================================================== //
+  describe('with the global default version: "1"', () => {
+    before(async () => {
+      const moduleRef = await Test.createTestingModule({
+        imports: [AppModule],
+      }).compile();
+
+      app = moduleRef.createNestApplication();
+      app.enableVersioning({
+        type: VersioningType.CUSTOM,
+        extractor,
+        defaultVersion: '1',
+      });
+      await app.init();
+    });
+
+    describe('GET /', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Hello World V1!');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Hello World V2!');
+      });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(404);
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(404);
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer()).get('/').expect(404);
+      });
+    });
+
+    describe('GET /:param', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/param/hello')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Parameter V1!');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/param/hello')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Parameter V2!');
+      });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/param/hello')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(404);
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/param/hello')
+          .set({
+            Accept: '',
+          })
+          .expect(404);
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer()).get('/').expect(404);
+      });
+    });
+
+    describe('GET /multiple', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/multiple')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Multiple Versions 1 or 2');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/multiple')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Multiple Versions 1 or 2');
+      });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/multiple')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(404);
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/multiple')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(404);
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer()).get('/multiple').expect(404);
+      });
+    });
+
+    describe('GET /neutral', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/neutral')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Neutral');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/neutral')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Neutral');
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/neutral')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(200)
+          .expect('Neutral');
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer())
+          .get('/neutral')
+          .expect(200)
+          .expect('Neutral');
+      });
+    });
+
+    describe('GET /override', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/override')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Override Version 1');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/override')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Override Version 2');
+      });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/override')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(404);
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/override')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(404);
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer()).get('/override').expect(404);
+      });
+    });
+
+    describe('GET /override-partial', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Override Partial Version 1');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(200)
+          .expect('Override Partial Version 2');
+      });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(404);
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(404);
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer())
+          .get('/override-partial')
+          .expect(404);
+      });
+    });
+
+    describe('GET /foo/bar', () => {
+      it('V1', () => {
+        return request(app.getHttpServer())
+          .get('/foo/bar')
+          .set({
+            Accept: 'application/foo.v1+json',
+          })
+          .expect(200)
+          .expect('Hello FooBar!');
+      });
+
+      it('V2', () => {
+        return request(app.getHttpServer())
+          .get('/foo/bar')
+          .set({
+            Accept: 'application/foo.v2+json',
+          })
+          .expect(404);
+      });
+
+      it('V3', () => {
+        return request(app.getHttpServer())
+          .get('/foo/bar')
+          .set({
+            Accept: 'application/foo.v3+json',
+          })
+          .expect(404);
+      });
+
+      it('No Version', () => {
+        return request(app.getHttpServer())
+          .get('/foo/bar')
+          .set({
+            Accept: 'application/json',
+          })
+          .expect(404);
+      });
+
+      it('No Header', () => {
+        return request(app.getHttpServer()).get('/foo/bar').expect(404);
+      });
+    });
+
+    after(async () => {
+      await app.close();
+    });
+  });
+});
diff --git a/integration/websockets/e2e/ws-gateway.spec.ts b/integration/websockets/e2e/ws-gateway.spec.ts
index c68883ba3..bea1f5c2a 100644
--- a/integration/websockets/e2e/ws-gateway.spec.ts
+++ b/integration/websockets/e2e/ws-gateway.spec.ts
@@ -14,7 +14,7 @@ async function createNestApp(...gateways): Promise<INestApplication> {
   const testingModule = await Test.createTestingModule({
     providers: gateways,
   }).compile();
-  const app = await testingModule.createNestApplication();
+  const app = testingModule.createNestApplication();
   app.useWebSocketAdapter(new WsAdapter(app) as any);
   return app;
 }
@@ -40,6 +40,7 @@ describe('WebSocketGateway (WsAdapter)', () => {
     await new Promise<void>(resolve =>
       ws.on('message', data => {
         expect(JSON.parse(data).data.test).to.be.eql('test');
+        ws.close();
         resolve();
       }),
     );
@@ -63,6 +64,7 @@ describe('WebSocketGateway (WsAdapter)', () => {
     await new Promise<void>(resolve =>
       ws.on('message', data => {
         expect(JSON.parse(data).data.test).to.be.eql('test');
+        ws.close();
         resolve();
       }),
     );
@@ -89,6 +91,7 @@ describe('WebSocketGateway (WsAdapter)', () => {
       await new Promise<void>(resolve =>
         ws.on('message', data => {
           expect(JSON.parse(data).data.test).to.be.eql('test');
+          ws.close();
           resolve();
         }),
       );
@@ -113,6 +116,7 @@ describe('WebSocketGateway (WsAdapter)', () => {
       ws.on('open', () => {
         ws.on('message', data => {
           expect(JSON.parse(data).data.test).to.be.eql('test');
+          ws.close();
           resolve();
         });
         ws.send(
@@ -129,6 +133,7 @@ describe('WebSocketGateway (WsAdapter)', () => {
     await new Promise<void>(resolve => {
       ws2.on('message', data => {
         expect(JSON.parse(data).data.test).to.be.eql('test');
+        ws2.close();
         resolve();
       });
       ws2.send(
@@ -158,6 +163,7 @@ describe('WebSocketGateway (WsAdapter)', () => {
       ws.on('open', () => {
         ws.on('message', data => {
           expect(JSON.parse(data).data.test).to.be.eql('test');
+          ws.close();
           resolve();
         });
         ws.send(
@@ -174,6 +180,7 @@ describe('WebSocketGateway (WsAdapter)', () => {
     await new Promise<void>(resolve => {
       ws2.on('message', data => {
         expect(JSON.parse(data).data.test).to.be.eql('test');
+        ws2.close();
         resolve();
       });
       ws2.send(
@@ -187,5 +194,7 @@ describe('WebSocketGateway (WsAdapter)', () => {
     });
   });
 
-  afterEach(() => app.close());
+  afterEach(async function () {
+    await app.close();
+  });
 });
diff --git a/lerna.json b/lerna.json
index e12b9c5dc..8285b0f66 100644
--- a/lerna.json
+++ b/lerna.json
@@ -3,5 +3,5 @@
   "packages": [
     "packages/*"
   ],
-  "version": "8.3.1"
+  "version": "8.4.5"
 }
diff --git a/package-lock.json b/package-lock.json
index ddc34f406..4f7c42bb1 100644
Binary files a/package-lock.json and b/package-lock.json differ
diff --git a/package.json b/package.json
index 20fb80e7c..859433b2a 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "@nestjs/core",
-  "version": "8.3.1",
+  "version": "8.4.4",
   "description": "Modern, fast, powerful node.js web framework",
   "homepage": "https://nestjs.com",
   "repository": {
@@ -25,8 +25,8 @@
     "coverage": "nyc report --reporter=text-lcov | coveralls",
     "format": "prettier \"**/*.ts\" --ignore-path ./.prettierignore --write && git status",
     "postinstall": "opencollective",
-    "test": "nyc --require ts-node/register mocha packages/**/*.spec.ts --reporter spec --require 'node_modules/reflect-metadata/Reflect.js' --exit",
-    "test:integration": "mocha \"integration/*/{,!(node_modules)/**/}/*.spec.ts\" --reporter spec --require ts-node/register --require 'node_modules/reflect-metadata/Reflect.js' --exit",
+    "test": "nyc mocha packages/**/*.spec.ts --reporter spec",
+    "test:integration": "mocha \"integration/*/{,!(node_modules)/**/}/*.spec.ts\" --reporter spec",
     "test:docker:up": "docker-compose -f integration/docker-compose.yml up -d",
     "test:docker:down": "docker-compose -f integration/docker-compose.yml down",
     "lint": "concurrently 'npm run lint:packages' 'npm run lint:integration' 'npm run lint:spec'",
@@ -34,8 +34,9 @@
     "lint:integration": "eslint 'integration/*/{,!(node_modules)/**/}/*.ts' -c '.eslintrc.spec.js'",
     "lint:packages": "eslint 'packages/**/**.ts' --ignore-pattern 'packages/**/*.spec.ts'",
     "lint:spec": "eslint 'packages/**/**.spec.ts' -c '.eslintrc.spec.js'",
-    "prerelease": "gulp copy-misc && gulp build --dist node_modules/@nestjs && npm run changelog | pbcopy",
+    "prerelease": "gulp copy-misc && gulp build --dist node_modules/@nestjs",
     "publish": "npm run prerelease && npm run build:prod && ./node_modules/.bin/lerna publish --force-publish --access public --exact -m \"chore(@nestjs) publish %s release\"",
+    "prepublishOnly": "npm run changelog | pbcopy",
     "publish:beta": "npm run prerelease && npm run build:prod && ./node_modules/.bin/lerna publish --npm-tag=beta --access public -m \"chore(@nestjs) publish %s release\"",
     "publish:next": "npm run prerelease && npm run build:prod && ./node_modules/.bin/lerna publish --npm-tag=next --access public --skip-git -m \"chore(@nestjs) publish %s release\"",
     "publish:rc": "npm run prerelease && npm run build:prod && ./node_modules/.bin/lerna publish --npm-tag=rc --access public -m \"chore(@nestjs) publish %s release\"",
@@ -49,83 +50,84 @@
   },
   "dependencies": {
     "@nuxtjs/opencollective": "0.3.2",
-    "axios": "0.26.0",
+    "axios": "0.27.2",
     "class-transformer": "0.5.1",
     "class-validator": "0.13.2",
-    "cli-color": "2.0.1",
+    "cli-color": "2.0.2",
     "cors": "2.8.5",
-    "express": "4.17.3",
-    "fast-json-stringify": "3.0.3",
+    "express": "4.18.1",
+    "fast-json-stringify": "3.2.0",
     "fast-safe-stringify": "2.1.1",
     "graphql-subscriptions": "2.0.0",
     "iterare": "1.2.1",
-    "object-hash": "2.2.0",
+    "object-hash": "3.0.0",
     "path-to-regexp": "3.2.0",
     "reflect-metadata": "0.1.13",
-    "rxjs": "7.5.4",
-    "socket.io": "4.4.1",
-    "tslib": "2.3.1",
+    "rxjs": "7.5.5",
+    "socket.io": "4.5.0",
+    "tslib": "2.4.0",
     "uuid": "8.3.2"
   },
   "devDependencies": {
     "@codechecks/client": "0.1.12",
-    "@commitlint/cli": "16.2.1",
-    "@commitlint/config-angular": "16.2.1",
-    "@grpc/grpc-js": "1.5.5",
-    "@grpc/proto-loader": "0.6.9",
-    "@nestjs/apollo": "10.0.3",
-    "@nestjs/graphql": "10.0.3",
-    "@nestjs/mongoose": "9.0.2",
+    "@commitlint/cli": "17.0.0",
+    "@commitlint/config-angular": "17.0.0",
+    "@grpc/grpc-js": "1.6.7",
+    "@grpc/proto-loader": "0.6.12",
+    "@nestjs/apollo": "10.0.11",
+    "@nestjs/graphql": "10.0.8",
+    "@nestjs/mongoose": "9.0.3",
     "@nestjs/typeorm": "8.0.3",
     "@types/amqplib": "0.8.2",
     "@types/bytes": "3.1.1",
-    "@types/cache-manager": "3.4.2",
-    "@types/chai": "4.3.0",
+    "@types/cache-manager": "3.4.3",
+    "@types/chai": "4.3.1",
     "@types/chai-as-promised": "7.1.5",
     "@types/cors": "2.8.12",
     "@types/express": "4.17.13",
     "@types/gulp": "4.0.9",
     "@types/http-errors": "1.8.2",
-    "@types/mocha": "9.1.0",
-    "@types/node": "17.0.18",
+    "@types/mocha": "9.1.1",
+    "@types/node": "17.0.34",
     "@types/redis": "4.0.11",
     "@types/reflect-metadata": "0.1.0",
     "@types/sinon": "10.0.11",
     "@types/socket.io": "3.0.2",
-    "@types/ws": "8.2.2",
+    "@types/supertest": "2.0.12",
+    "@types/ws": "8.5.3",
     "@typescript-eslint/eslint-plugin": "4.33.0",
     "@typescript-eslint/parser": "4.33.0",
-    "amqp-connection-manager": "4.1.1",
-    "amqplib": "0.8.0",
-    "apollo-server-core": "3.6.3",
-    "apollo-server-express": "3.6.3",
+    "amqp-connection-manager": "4.1.3",
+    "amqplib": "0.9.0",
+    "apollo-server-core": "3.7.0",
+    "apollo-server-express": "3.7.0",
     "artillery": "1.7.9",
-    "body-parser": "1.19.2",
+    "body-parser": "1.20.0",
     "bytes": "3.1.2",
-    "cache-manager": "3.6.0",
+    "cache-manager": "3.6.1",
     "cache-manager-redis-store": "2.0.0",
     "chai": "4.3.6",
     "chai-as-promised": "7.1.1",
-    "clang-format": "1.6.0",
+    "clang-format": "1.8.0",
     "commitlint-circle": "1.0.0",
-    "concurrently": "7.0.0",
+    "concurrently": "7.2.0",
     "conventional-changelog": "3.1.25",
-    "core-js": "3.21.1",
+    "core-js": "3.22.5",
     "coveralls": "3.1.1",
     "delete-empty": "3.0.0",
-    "engine.io-client": "6.1.1",
+    "engine.io-client": "6.2.2",
     "eslint": "7.32.0",
-    "eslint-config-prettier": "8.3.0",
-    "eslint-plugin-import": "2.25.4",
-    "eventsource": "1.1.0",
+    "eslint-config-prettier": "8.5.0",
+    "eslint-plugin-import": "2.26.0",
+    "eventsource": "2.0.2",
     "fancy-log": "2.0.0",
-    "fastify": "3.27.1",
-    "fastify-cors": "6.0.2",
-    "fastify-formbody": "5.2.0",
-    "fastify-multipart": "5.3.1",
-    "fastify-static": "4.5.0",
-    "graphql": "15.7.2",
-    "graphql-tools": "7.0.5",
+    "fastify": "3.29.0",
+    "fastify-cors": "6.1.0",
+    "fastify-formbody": "5.3.0",
+    "fastify-multipart": "5.4.0",
+    "fastify-static": "4.7.0",
+    "graphql": "15.8.0",
+    "graphql-tools": "8.2.9",
     "gulp": "4.0.2",
     "gulp-clang-format": "1.0.27",
     "gulp-clean": "0.4.0",
@@ -133,40 +135,40 @@
     "gulp-typescript": "5.0.1",
     "gulp-watch": "5.0.1",
     "http-errors": "2.0.0",
-    "husky": "7.0.4",
+    "husky": "8.0.1",
     "imports-loader": "3.1.1",
     "json-loader": "0.5.7",
-    "kafkajs": "1.16.0",
-    "lerna": "2.11.0",
+    "kafkajs": "2.0.0",
+    "lerna": "3.0.0",
     "lerna-changelog": "2.2.0",
-    "light-my-request": "4.8.0",
-    "lint-staged": "12.3.4",
+    "light-my-request": "4.10.1",
+    "lint-staged": "12.4.1",
     "markdown-table": "2.0.0",
     "merge-graphql-schemas": "1.7.8",
-    "middie": "6.0.0",
-    "mocha": "9.2.0",
-    "mongoose": "6.2.2",
-    "mqtt": "4.3.6",
+    "middie": "6.1.0",
+    "mocha": "9.2.2",
+    "mongoose": "6.3.3",
+    "mqtt": "4.3.7",
     "multer": "1.4.4",
     "mysql2": "2.3.3",
     "nats": "2.6.1",
-    "nodemon": "2.0.15",
+    "nodemon": "2.0.16",
     "nyc": "15.1.0",
-    "point-of-view": "5.1.0",
-    "prettier": "2.5.1",
+    "point-of-view": "5.3.0",
+    "prettier": "2.6.2",
     "redis": "3.1.2",
     "rxjs-compat": "6.6.7",
-    "sinon": "13.0.1",
+    "sinon": "14.0.0",
     "sinon-chai": "3.7.0",
-    "socket.io-client": "4.4.1",
+    "socket.io-client": "4.5.0",
     "subscriptions-transport-ws": "0.11.0",
-    "supertest": "6.2.2",
-    "ts-morph": "13.0.3",
-    "ts-node": "10.5.0",
-    "typeorm": "0.2.43",
-    "typescript": "4.3.5",
+    "supertest": "6.2.3",
+    "ts-morph": "14.0.0",
+    "ts-node": "10.7.0",
+    "typeorm": "0.2.45",
+    "typescript": "4.6.4",
     "wrk": "1.2.1",
-    "ws": "7.5.6"
+    "ws": "8.6.0"
   },
   "engines": {
     "node": ">= 10.13.0"
@@ -223,5 +225,13 @@
     ],
     "sourceMap": true,
     "instrument": true
+  },
+  "mocha": {
+    "require": [
+      "ts-node/register",
+      "node_modules/reflect-metadata/Reflect.js",
+      "hooks/mocha-init-hook.ts"
+    ],
+    "exit": true
   }
 }
diff --git a/packages/common/Readme.md b/packages/common/Readme.md
index 772d0077a..a5e43201d 100644
--- a/packages/common/Readme.md
+++ b/packages/common/Readme.md
@@ -54,7 +54,7 @@ With official support, you can get expert help straight from Nest core team. We
 
 ## Support
 
-Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support by the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).
+Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support from the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).
 
 #### Principal Sponsors
 <table style="text-align:center;"><tr>
@@ -64,17 +64,20 @@ Nest is an MIT-licensed open source project. It can grow thanks to the sponsors
 <a href="https://github.com/Sanofi-IADC" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/sanofi.png" width="180" valign="middle" /></a></td>
 <td>
 <a href="https://nx.dev" target="_blank"><img src="https://nestjs.com/img/nx-logo.png" height="45" valign="middle" /></a></td>
+    <td>
+<a href="https://valor-software.com/" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/valor-software.png" width="170" valign="middle" /></a></td>
 </tr></table>
 
 #### Gold Sponsors
 
 <table style="text-align:center;"><tr><td>
   <a href="https://careers.labster.com/departments/platform" target="_blank"><img src="https://nestjs.com/img/labster-logo.png" width="170" valign="middle" /></a></td><td>
-<a href="https://weld.app/" target="_blank"><img src="https://nestjs.com/img/weld-logo.svg" width="150" valign="middle" /></a></td>
-  <td>
-<a href="https://valor-software.com/" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/valor-software.png" width="170" valign="middle" /></a></td>
+<a href="https://weld.app/" target="_blank"><img src="https://nestjs.com/img/weld-logo.svg" width="140" valign="middle" /></a></td>
 <td>
-<a href="https://intrinsic.ventures/" target="_blank"><img src="https://nestjs.com/img/intrinisic-logo.png" width="210" valign="middle" /></a></td></</tr></table>
+<a href="https://intrinsic.ventures/" target="_blank"><img src="https://nestjs.com/img/intrinisic-logo.png" width="210" valign="middle" /></a></td>
+ <td>
+<a href="https://jetbrains.com/" target="_blank"><img src="https://nestjs.com/img/jetbrains-logo.svg" width="110" valign="middle" /></a></td><td>
+<a href="https://snyk.co/nestjs" target="_blank"><img src="https://nestjs.com/img/snyk-logo-black.png" width="185" valign="middle" /></a></td></</tr></table>
 
 #### Silver Sponsors
 
diff --git a/packages/common/cache/cache.constants.ts b/packages/common/cache/cache.constants.ts
index 0ecf5c94e..799547a7b 100644
--- a/packages/common/cache/cache.constants.ts
+++ b/packages/common/cache/cache.constants.ts
@@ -1,4 +1,3 @@
 export const CACHE_MANAGER = 'CACHE_MANAGER';
-export const CACHE_MODULE_OPTIONS = 'CACHE_MODULE_OPTIONS';
 export const CACHE_KEY_METADATA = 'cache_module:cache_key';
 export const CACHE_TTL_METADATA = 'cache_module:cache_ttl';
diff --git a/packages/common/cache/cache.module-definition.ts b/packages/common/cache/cache.module-definition.ts
new file mode 100644
index 000000000..25d74e986
--- /dev/null
+++ b/packages/common/cache/cache.module-definition.ts
@@ -0,0 +1,12 @@
+import { ConfigurableModuleBuilder } from '../module-utils';
+import {
+  CacheModuleOptions,
+  CacheOptionsFactory,
+} from './interfaces/cache-module.interface';
+
+export const { ConfigurableModuleClass, MODULE_OPTIONS_TOKEN } =
+  new ConfigurableModuleBuilder<CacheModuleOptions>({
+    moduleName: 'Cache',
+  })
+    .setFactoryMethodName('createCacheOptions' as keyof CacheOptionsFactory)
+    .build();
diff --git a/packages/common/cache/cache.module.ts b/packages/common/cache/cache.module.ts
index 4e2c63d48..992f98f03 100644
--- a/packages/common/cache/cache.module.ts
+++ b/packages/common/cache/cache.module.ts
@@ -1,11 +1,11 @@
 import { Module } from '../decorators';
-import { DynamicModule, Provider } from '../interfaces';
-import { CACHE_MANAGER, CACHE_MODULE_OPTIONS } from './cache.constants';
+import { DynamicModule } from '../interfaces';
+import { CACHE_MANAGER } from './cache.constants';
+import { ConfigurableModuleClass } from './cache.module-definition';
 import { createCacheManager } from './cache.providers';
 import {
   CacheModuleAsyncOptions,
   CacheModuleOptions,
-  CacheOptionsFactory,
 } from './interfaces/cache-module.interface';
 
 /**
@@ -19,7 +19,7 @@ import {
   providers: [createCacheManager()],
   exports: [CACHE_MANAGER],
 })
-export class CacheModule {
+export class CacheModule extends ConfigurableModuleClass {
   /**
    * Configure the cache manager statically.
    *
@@ -31,9 +31,8 @@ export class CacheModule {
     options: CacheModuleOptions<StoreConfig> = {} as any,
   ): DynamicModule {
     return {
-      module: CacheModule,
       global: options.isGlobal,
-      providers: [{ provide: CACHE_MODULE_OPTIONS, useValue: options }],
+      ...super.register(options),
     };
   }
 
@@ -48,47 +47,11 @@ export class CacheModule {
   static registerAsync<
     StoreConfig extends Record<any, any> = Record<string, any>,
   >(options: CacheModuleAsyncOptions<StoreConfig>): DynamicModule {
+    const moduleDefinition = super.registerAsync(options);
     return {
-      module: CacheModule,
       global: options.isGlobal,
-      imports: options.imports,
-      providers: [
-        ...this.createAsyncProviders<StoreConfig>(options),
-        ...(options.extraProviders || []),
-      ],
-    };
-  }
-
-  private static createAsyncProviders<StoreConfig extends Record<any, any>>(
-    options: CacheModuleAsyncOptions<StoreConfig>,
-  ): Provider[] {
-    if (options.useExisting || options.useFactory) {
-      return [this.createAsyncOptionsProvider(options)];
-    }
-    return [
-      this.createAsyncOptionsProvider(options),
-      {
-        provide: options.useClass,
-        useClass: options.useClass,
-      },
-    ];
-  }
-
-  private static createAsyncOptionsProvider<
-    StoreConfig extends Record<any, any>,
-  >(options: CacheModuleAsyncOptions<StoreConfig>): Provider {
-    if (options.useFactory) {
-      return {
-        provide: CACHE_MODULE_OPTIONS,
-        useFactory: options.useFactory,
-        inject: options.inject || [],
-      };
-    }
-    return {
-      provide: CACHE_MODULE_OPTIONS,
-      useFactory: async (optionsFactory: CacheOptionsFactory<StoreConfig>) =>
-        optionsFactory.createCacheOptions(),
-      inject: [options.useExisting || options.useClass],
+      ...moduleDefinition,
+      providers: moduleDefinition.providers.concat(options.extraProviders),
     };
   }
 }
diff --git a/packages/common/cache/cache.providers.ts b/packages/common/cache/cache.providers.ts
index 2e6df398d..4aaacf0f5 100644
--- a/packages/common/cache/cache.providers.ts
+++ b/packages/common/cache/cache.providers.ts
@@ -1,6 +1,7 @@
 import { Provider } from '../interfaces';
 import { loadPackage } from '../utils/load-package.util';
-import { CACHE_MANAGER, CACHE_MODULE_OPTIONS } from './cache.constants';
+import { CACHE_MANAGER } from './cache.constants';
+import { MODULE_OPTIONS_TOKEN } from './cache.module-definition';
 import { defaultCacheOptions } from './default-options';
 import { CacheManagerOptions } from './interfaces/cache-manager.interface';
 
@@ -31,6 +32,6 @@ export function createCacheManager(): Provider {
             ...(options || {}),
           });
     },
-    inject: [CACHE_MODULE_OPTIONS],
+    inject: [MODULE_OPTIONS_TOKEN],
   };
 }
diff --git a/packages/common/cache/interfaces/cache-module.interface.ts b/packages/common/cache/interfaces/cache-module.interface.ts
index 5beb769c8..a5fd220cc 100644
--- a/packages/common/cache/interfaces/cache-module.interface.ts
+++ b/packages/common/cache/interfaces/cache-module.interface.ts
@@ -1,4 +1,5 @@
-import { ModuleMetadata, Provider, Type } from '../../interfaces';
+import { Provider, Type } from '../../interfaces';
+import { ConfigurableModuleAsyncOptions } from '../../module-utils';
 import { CacheManagerOptions } from './cache-manager.interface';
 
 export type CacheModuleOptions<
@@ -39,7 +40,10 @@ export interface CacheOptionsFactory<
  */
 export interface CacheModuleAsyncOptions<
   StoreConfig extends Record<any, any> = Record<string, any>,
-> extends Pick<ModuleMetadata, 'imports'> {
+> extends ConfigurableModuleAsyncOptions<
+    CacheModuleOptions<StoreConfig>,
+    keyof CacheOptionsFactory
+  > {
   /**
    * Injection token resolving to an existing provider. The provider must implement
    * the `CacheOptionsFactory` interface.
@@ -63,6 +67,9 @@ export interface CacheModuleAsyncOptions<
    * Dependencies that a Factory may inject.
    */
   inject?: any[];
+  /**
+   * Extra providers to be registered within a scope of this module.
+   */
   extraProviders?: Provider[];
   /**
    * If "true', register `CacheModule` as a global module.
diff --git a/packages/common/decorators/core/catch.decorator.ts b/packages/common/decorators/core/catch.decorator.ts
index fbf7fb698..cd3cdb161 100644
--- a/packages/common/decorators/core/catch.decorator.ts
+++ b/packages/common/decorators/core/catch.decorator.ts
@@ -1,5 +1,5 @@
 import { CATCH_WATERMARK, FILTER_CATCH_EXCEPTIONS } from '../../constants';
-import { Type } from '../../interfaces';
+import { Type, Abstract } from '../../interfaces';
 
 /**
  * Decorator that marks a class as a Nest exception filter. An exception filter
@@ -18,7 +18,9 @@ import { Type } from '../../interfaces';
  *
  * @publicApi
  */
-export function Catch(...exceptions: Type<any>[]): ClassDecorator {
+export function Catch(
+  ...exceptions: Array<Type<any> | Abstract<any>>
+): ClassDecorator {
   return (target: object) => {
     Reflect.defineMetadata(CATCH_WATERMARK, true, target);
     Reflect.defineMetadata(FILTER_CATCH_EXCEPTIONS, exceptions, target);
diff --git a/packages/common/decorators/http/render.decorator.ts b/packages/common/decorators/http/render.decorator.ts
index 6e9f22a1c..92d2f8d20 100644
--- a/packages/common/decorators/http/render.decorator.ts
+++ b/packages/common/decorators/http/render.decorator.ts
@@ -7,7 +7,7 @@ import { RENDER_METADATA } from '../../constants';
  *
  * @param template name of the render engine template file
  *
- * @see [Model-View-Controller](https://docs.nestjs.com/techniques.mvc)
+ * @see [Model-View-Controller](https://docs.nestjs.com/techniques/mvc)
  *
  * @publicApi
  */
diff --git a/packages/common/enums/version-type.enum.ts b/packages/common/enums/version-type.enum.ts
index 981986e87..abe4c6416 100644
--- a/packages/common/enums/version-type.enum.ts
+++ b/packages/common/enums/version-type.enum.ts
@@ -5,4 +5,5 @@ export enum VersioningType {
   URI,
   HEADER,
   MEDIA_TYPE,
+  CUSTOM,
 }
diff --git a/packages/common/exceptions/bad-gateway.exception.ts b/packages/common/exceptions/bad-gateway.exception.ts
index 78667996c..83ae75507 100644
--- a/packages/common/exceptions/bad-gateway.exception.ts
+++ b/packages/common/exceptions/bad-gateway.exception.ts
@@ -4,7 +4,7 @@ import { HttpException } from './http.exception';
 /**
  * Defines an HTTP exception for *Bad Gateway* type errors.
  *
- * @see [Base Exceptions](https://docs.nestjs.com/exception-filters#base-exceptions)
+ * @see [Built-in HTTP exceptions](https://docs.nestjs.com/exception-filters#built-in-http-exceptions)
  *
  * @publicApi
  */
diff --git a/packages/common/exceptions/bad-request.exception.ts b/packages/common/exceptions/bad-request.exception.ts
index b5385d09c..3d93e229b 100644
--- a/packages/common/exceptions/bad-request.exception.ts
+++ b/packages/common/exceptions/bad-request.exception.ts
@@ -4,7 +4,7 @@ import { HttpException } from './http.exception';
 /**
  * Defines an HTTP exception for *Bad Request* type errors.
  *
- * @see [Base Exceptions](https://docs.nestjs.com/exception-filters#base-exceptions)
+ * @see [Built-in HTTP exceptions](https://docs.nestjs.com/exception-filters#built-in-http-exceptions)
  *
  * @publicApi
  */
diff --git a/packages/common/exceptions/conflict.exception.ts b/packages/common/exceptions/conflict.exception.ts
index d67cc30f4..93322515e 100644
--- a/packages/common/exceptions/conflict.exception.ts
+++ b/packages/common/exceptions/conflict.exception.ts
@@ -4,7 +4,7 @@ import { HttpException } from './http.exception';
 /**
  * Defines an HTTP exception for *Conflict* type errors.
  *
- * @see [Base Exceptions](https://docs.nestjs.com/exception-filters#base-exceptions)
+ * @see [Built-in HTTP exceptions](https://docs.nestjs.com/exception-filters#built-in-http-exceptions)
  *
  * @publicApi
  */
diff --git a/packages/common/exceptions/forbidden.exception.ts b/packages/common/exceptions/forbidden.exception.ts
index 7c3ae92fb..2c10e7a2a 100644
--- a/packages/common/exceptions/forbidden.exception.ts
+++ b/packages/common/exceptions/forbidden.exception.ts
@@ -4,7 +4,7 @@ import { HttpException } from './http.exception';
 /**
  * Defines an HTTP exception for *Forbidden* type errors.
  *
- * @see [Base Exceptions](https://docs.nestjs.com/exception-filters#base-exceptions)
+ * @see [Built-in HTTP exceptions](https://docs.nestjs.com/exception-filters#built-in-http-exceptions)
  *
  * @publicApi
  */
diff --git a/packages/common/exceptions/gateway-timeout.exception.ts b/packages/common/exceptions/gateway-timeout.exception.ts
index 2648ddfec..e2d068518 100644
--- a/packages/common/exceptions/gateway-timeout.exception.ts
+++ b/packages/common/exceptions/gateway-timeout.exception.ts
@@ -4,7 +4,7 @@ import { HttpException } from './http.exception';
 /**
  * Defines an HTTP exception for *Gateway Timeout* type errors.
  *
- * @see [Base Exceptions](https://docs.nestjs.com/exception-filters#base-exceptions)
+ * @see [Built-in HTTP exceptions](https://docs.nestjs.com/exception-filters#built-in-http-exceptions)
  *
  * @publicApi
  */
diff --git a/packages/common/exceptions/gone.exception.ts b/packages/common/exceptions/gone.exception.ts
index 48b141dfe..f319fe558 100644
--- a/packages/common/exceptions/gone.exception.ts
+++ b/packages/common/exceptions/gone.exception.ts
@@ -4,7 +4,7 @@ import { HttpException } from './http.exception';
 /**
  * Defines an HTTP exception for *Gone* type errors.
  *
- * @see [Base Exceptions](https://docs.nestjs.com/exception-filters#base-exceptions)
+ * @see [Built-in HTTP exceptions](https://docs.nestjs.com/exception-filters#built-in-http-exceptions)
  *
  * @publicApi
  */
diff --git a/packages/common/exceptions/http-version-not-supported.exception.ts b/packages/common/exceptions/http-version-not-supported.exception.ts
index 41b340291..ded68714b 100644
--- a/packages/common/exceptions/http-version-not-supported.exception.ts
+++ b/packages/common/exceptions/http-version-not-supported.exception.ts
@@ -4,7 +4,7 @@ import { HttpException } from './http.exception';
 /**
  * Defines an HTTP exception for *Http Version Not Supported* type errors.
  *
- * @see [Base Exceptions](https://docs.nestjs.com/exception-filters#base-exceptions)
+ * @see [Built-in HTTP exceptions](https://docs.nestjs.com/exception-filters#built-in-http-exceptions)
  *
  * @publicApi
  */
diff --git a/packages/common/exceptions/http.exception.ts b/packages/common/exceptions/http.exception.ts
index e907834c8..84ec9361b 100644
--- a/packages/common/exceptions/http.exception.ts
+++ b/packages/common/exceptions/http.exception.ts
@@ -4,7 +4,7 @@ import { isObject, isString } from '../utils/shared.utils';
  * Defines the base Nest HTTP exception, which is handled by the default
  * Exceptions Handler.
  *
- * @see [Base Exceptions](https://docs.nestjs.com/exception-filters#base-exceptions)
+ * @see [Built-in HTTP exceptions](https://docs.nestjs.com/exception-filters#built-in-http-exceptions)
  *
  * @publicApi
  */
diff --git a/packages/common/exceptions/im-a-teapot.exception.ts b/packages/common/exceptions/im-a-teapot.exception.ts
index db640cd90..4b345681e 100644
--- a/packages/common/exceptions/im-a-teapot.exception.ts
+++ b/packages/common/exceptions/im-a-teapot.exception.ts
@@ -7,7 +7,7 @@ import { HttpException } from './http.exception';
  * Any attempt to brew coffee with a teapot should result in the error code
  * "418 I'm a teapot". The resulting entity body MAY be short and stout.
  *
- * @see [Base Exceptions](https://docs.nestjs.com/exception-filters#base-exceptions)
+ * @see [Built-in HTTP exceptions](https://docs.nestjs.com/exception-filters#built-in-http-exceptions)
  *
  * @publicApi
  */
diff --git a/packages/common/exceptions/internal-server-error.exception.ts b/packages/common/exceptions/internal-server-error.exception.ts
index 06a04d7d8..673a2e7a2 100644
--- a/packages/common/exceptions/internal-server-error.exception.ts
+++ b/packages/common/exceptions/internal-server-error.exception.ts
@@ -4,7 +4,7 @@ import { HttpException } from './http.exception';
 /**
  * Defines an HTTP exception for *Internal Server Error* type errors.
  *
- * @see [Base Exceptions](https://docs.nestjs.com/exception-filters#base-exceptions)
+ * @see [Built-in HTTP exceptions](https://docs.nestjs.com/exception-filters#built-in-http-exceptions)
  *
  * @publicApi
  */
diff --git a/packages/common/exceptions/method-not-allowed.exception.ts b/packages/common/exceptions/method-not-allowed.exception.ts
index df7666b00..f44ad305b 100644
--- a/packages/common/exceptions/method-not-allowed.exception.ts
+++ b/packages/common/exceptions/method-not-allowed.exception.ts
@@ -4,7 +4,7 @@ import { HttpException } from './http.exception';
 /**
  * Defines an HTTP exception for *Method Not Allowed* type errors.
  *
- * @see [Base Exceptions](https://docs.nestjs.com/exception-filters#base-exceptions)
+ * @see [Built-in HTTP exceptions](https://docs.nestjs.com/exception-filters#built-in-http-exceptions)
  *
  * @publicApi
  */
diff --git a/packages/common/exceptions/misdirected.exception.ts b/packages/common/exceptions/misdirected.exception.ts
index 11ae29bae..5fa2f082c 100644
--- a/packages/common/exceptions/misdirected.exception.ts
+++ b/packages/common/exceptions/misdirected.exception.ts
@@ -4,7 +4,7 @@ import { HttpException } from './http.exception';
 /**
  * Defines an HTTP exception for *Misdirected* type errors.
  *
- * @see [Base Exceptions](https://docs.nestjs.com/exception-filters#base-exceptions)
+ * @see [Built-in HTTP exceptions](https://docs.nestjs.com/exception-filters#built-in-http-exceptions)
  *
  * @publicApi
  */
diff --git a/packages/common/exceptions/not-acceptable.exception.ts b/packages/common/exceptions/not-acceptable.exception.ts
index e836d3447..18e71156c 100644
--- a/packages/common/exceptions/not-acceptable.exception.ts
+++ b/packages/common/exceptions/not-acceptable.exception.ts
@@ -4,7 +4,7 @@ import { HttpException } from './http.exception';
 /**
  * Defines an HTTP exception for *Not Acceptable* type errors.
  *
- * @see [Base Exceptions](https://docs.nestjs.com/exception-filters#base-exceptions)
+ * @see [Built-in HTTP exceptions](https://docs.nestjs.com/exception-filters#built-in-http-exceptions)
  *
  * @publicApi
  */
diff --git a/packages/common/exceptions/not-found.exception.ts b/packages/common/exceptions/not-found.exception.ts
index d8c38ca7f..a8ab1491a 100644
--- a/packages/common/exceptions/not-found.exception.ts
+++ b/packages/common/exceptions/not-found.exception.ts
@@ -4,7 +4,7 @@ import { HttpException } from './http.exception';
 /**
  * Defines an HTTP exception for *Not Found* type errors.
  *
- * @see [Base Exceptions](https://docs.nestjs.com/exception-filters#base-exceptions)
+ * @see [Built-in HTTP exceptions](https://docs.nestjs.com/exception-filters#built-in-http-exceptions)
  *
  * @publicApi
  */
diff --git a/packages/common/exceptions/not-implemented.exception.ts b/packages/common/exceptions/not-implemented.exception.ts
index 4702fe384..0576406fc 100644
--- a/packages/common/exceptions/not-implemented.exception.ts
+++ b/packages/common/exceptions/not-implemented.exception.ts
@@ -4,7 +4,7 @@ import { HttpException } from './http.exception';
 /**
  * Defines an HTTP exception for *Not Implemented* type errors.
  *
- * @see [Base Exceptions](https://docs.nestjs.com/exception-filters#base-exceptions)
+ * @see [Built-in HTTP exceptions](https://docs.nestjs.com/exception-filters#built-in-http-exceptions)
  *
  * @publicApi
  */
diff --git a/packages/common/exceptions/payload-too-large.exception.ts b/packages/common/exceptions/payload-too-large.exception.ts
index 968b94d3f..3f967f834 100644
--- a/packages/common/exceptions/payload-too-large.exception.ts
+++ b/packages/common/exceptions/payload-too-large.exception.ts
@@ -4,7 +4,7 @@ import { HttpException } from './http.exception';
 /**
  * Defines an HTTP exception for *Payload Too Large* type errors.
  *
- * @see [Base Exceptions](https://docs.nestjs.com/exception-filters#base-exceptions)
+ * @see [Built-in HTTP exceptions](https://docs.nestjs.com/exception-filters#built-in-http-exceptions)
  *
  * @publicApi
  */
diff --git a/packages/common/exceptions/precondition-failed.exception.ts b/packages/common/exceptions/precondition-failed.exception.ts
index ca9c3a70d..6e8456396 100644
--- a/packages/common/exceptions/precondition-failed.exception.ts
+++ b/packages/common/exceptions/precondition-failed.exception.ts
@@ -4,7 +4,7 @@ import { HttpException } from './http.exception';
 /**
  * Defines an HTTP exception for *Precondition Failed* type errors.
  *
- * @see [Base Exceptions](https://docs.nestjs.com/exception-filters#base-exceptions)
+ * @see [Built-in HTTP exceptions](https://docs.nestjs.com/exception-filters#built-in-http-exceptions)
  *
  * @publicApi
  */
diff --git a/packages/common/exceptions/request-timeout.exception.ts b/packages/common/exceptions/request-timeout.exception.ts
index 3bcd193ce..8521e290f 100644
--- a/packages/common/exceptions/request-timeout.exception.ts
+++ b/packages/common/exceptions/request-timeout.exception.ts
@@ -4,7 +4,7 @@ import { HttpException } from './http.exception';
 /**
  * Defines an HTTP exception for *Request Timeout* type errors.
  *
- * @see [Base Exceptions](https://docs.nestjs.com/exception-filters#base-exceptions)
+ * @see [Built-in HTTP exceptions](https://docs.nestjs.com/exception-filters#built-in-http-exceptions)
  *
  * @publicApi
  */
diff --git a/packages/common/exceptions/service-unavailable.exception.ts b/packages/common/exceptions/service-unavailable.exception.ts
index f0270b7e6..b7721322f 100644
--- a/packages/common/exceptions/service-unavailable.exception.ts
+++ b/packages/common/exceptions/service-unavailable.exception.ts
@@ -4,7 +4,7 @@ import { HttpException } from './http.exception';
 /**
  * Defines an HTTP exception for *Service Unavailable* type errors.
  *
- * @see [Base Exceptions](https://docs.nestjs.com/exception-filters#base-exceptions)
+ * @see [Built-in HTTP exceptions](https://docs.nestjs.com/exception-filters#built-in-http-exceptions)
  *
  * @publicApi
  */
diff --git a/packages/common/exceptions/unauthorized.exception.ts b/packages/common/exceptions/unauthorized.exception.ts
index 7d9379816..1791316c6 100644
--- a/packages/common/exceptions/unauthorized.exception.ts
+++ b/packages/common/exceptions/unauthorized.exception.ts
@@ -4,7 +4,7 @@ import { HttpException } from './http.exception';
 /**
  * Defines an HTTP exception for *Unauthorized* type errors.
  *
- * @see [Base Exceptions](https://docs.nestjs.com/exception-filters#base-exceptions)
+ * @see [Built-in HTTP exceptions](https://docs.nestjs.com/exception-filters#built-in-http-exceptions)
  *
  * @publicApi
  */
diff --git a/packages/common/exceptions/unprocessable-entity.exception.ts b/packages/common/exceptions/unprocessable-entity.exception.ts
index f76c8d24e..b1cf34b77 100644
--- a/packages/common/exceptions/unprocessable-entity.exception.ts
+++ b/packages/common/exceptions/unprocessable-entity.exception.ts
@@ -4,7 +4,7 @@ import { HttpException } from './http.exception';
 /**
  * Defines an HTTP exception for *Unprocessable Entity* type errors.
  *
- * @see [Base Exceptions](https://docs.nestjs.com/exception-filters#base-exceptions)
+ * @see [Built-in HTTP exceptions](https://docs.nestjs.com/exception-filters#built-in-http-exceptions)
  *
  * @publicApi
  */
diff --git a/packages/common/exceptions/unsupported-media-type.exception.ts b/packages/common/exceptions/unsupported-media-type.exception.ts
index 49e4ab14f..eaeab69a9 100644
--- a/packages/common/exceptions/unsupported-media-type.exception.ts
+++ b/packages/common/exceptions/unsupported-media-type.exception.ts
@@ -4,7 +4,7 @@ import { HttpException } from './http.exception';
 /**
  * Defines an HTTP exception for *Unsupported Media Type* type errors.
  *
- * @see [Base Exceptions](https://docs.nestjs.com/exception-filters#base-exceptions)
+ * @see [Built-in HTTP exceptions](https://docs.nestjs.com/exception-filters#built-in-http-exceptions)
  *
  * @publicApi
  */
diff --git a/packages/common/file-stream/streamable-file.ts b/packages/common/file-stream/streamable-file.ts
index b0b0ddab0..7fe05c1d9 100644
--- a/packages/common/file-stream/streamable-file.ts
+++ b/packages/common/file-stream/streamable-file.ts
@@ -16,6 +16,7 @@ export class StreamableFile {
       this.stream = new Readable();
       this.stream.push(bufferOrReadStream);
       this.stream.push(null);
+      this.options.length ??= bufferOrReadStream.length;
     } else if (bufferOrReadStream.pipe && isFunction(bufferOrReadStream.pipe)) {
       this.stream = bufferOrReadStream;
     }
@@ -26,8 +27,15 @@ export class StreamableFile {
   }
 
   getHeaders() {
-    const { type = 'application/octet-stream', disposition = null } =
-      this.options;
-    return { type, disposition };
+    const {
+      type = 'application/octet-stream',
+      disposition = undefined,
+      length = undefined,
+    } = this.options;
+    return {
+      type,
+      disposition,
+      length,
+    };
   }
 }
diff --git a/packages/common/file-stream/streamable-options.interface.ts b/packages/common/file-stream/streamable-options.interface.ts
index 8b9bd24a7..5d167b6b0 100644
--- a/packages/common/file-stream/streamable-options.interface.ts
+++ b/packages/common/file-stream/streamable-options.interface.ts
@@ -1,4 +1,5 @@
 export interface StreamableFileOptions {
   type?: string;
   disposition?: string;
+  length?: number;
 }
diff --git a/packages/common/http/http.constants.ts b/packages/common/http/http.constants.ts
index 21f6d8499..d69880b18 100644
--- a/packages/common/http/http.constants.ts
+++ b/packages/common/http/http.constants.ts
@@ -1,3 +1 @@
 export const AXIOS_INSTANCE_TOKEN = 'AXIOS_INSTANCE_TOKEN';
-export const HTTP_MODULE_ID = 'HTTP_MODULE_ID';
-export const HTTP_MODULE_OPTIONS = 'HTTP_MODULE_OPTIONS';
diff --git a/packages/common/http/http.module-definition.ts b/packages/common/http/http.module-definition.ts
new file mode 100644
index 000000000..708d8f701
--- /dev/null
+++ b/packages/common/http/http.module-definition.ts
@@ -0,0 +1,23 @@
+import { Provider } from '../interfaces';
+import { ConfigurableModuleBuilder } from '../module-utils';
+import { HttpModuleOptions } from './interfaces';
+
+export const {
+  ConfigurableModuleClass,
+  MODULE_OPTIONS_TOKEN,
+  ASYNC_OPTIONS_TYPE,
+} = new ConfigurableModuleBuilder<HttpModuleOptions>({
+  moduleName: 'Http',
+  alwaysTransient: true,
+})
+  .setFactoryMethodName('createHttpOptions')
+  .setExtras<{ extraProviders?: Provider[] }>(
+    {
+      extraProviders: [],
+    },
+    (definition, extras) => ({
+      ...definition,
+      providers: definition.providers.concat(extras?.extraProviders),
+    }),
+  )
+  .build();
diff --git a/packages/common/http/http.module.ts b/packages/common/http/http.module.ts
index cc0367673..a2e46b464 100644
--- a/packages/common/http/http.module.ts
+++ b/packages/common/http/http.module.ts
@@ -1,18 +1,14 @@
 import Axios from 'axios';
 import { Module } from '../decorators/modules/module.decorator';
-import { DynamicModule, Provider } from '../interfaces';
-import { randomStringGenerator } from '../utils/random-string-generator.util';
+import { DynamicModule } from '../interfaces';
+import { AXIOS_INSTANCE_TOKEN } from './http.constants';
 import {
-  AXIOS_INSTANCE_TOKEN,
-  HTTP_MODULE_ID,
-  HTTP_MODULE_OPTIONS,
-} from './http.constants';
+  ASYNC_OPTIONS_TYPE,
+  ConfigurableModuleClass,
+  MODULE_OPTIONS_TOKEN,
+} from './http.module-definition';
 import { HttpService } from './http.service';
-import {
-  HttpModuleAsyncOptions,
-  HttpModuleOptions,
-  HttpModuleOptionsFactory,
-} from './interfaces';
+import { HttpModuleOptions } from './interfaces';
 
 /**
  * @deprecated "HttpModule" (from the "@nestjs/common" package) is deprecated and will be removed in the next major release. Please, use the "@nestjs/axios" package instead.
@@ -27,73 +23,17 @@ import {
   ],
   exports: [HttpService],
 })
-export class HttpModule {
-  static register(config: HttpModuleOptions): DynamicModule {
-    return {
-      module: HttpModule,
-      providers: [
-        {
-          provide: AXIOS_INSTANCE_TOKEN,
-          useValue: Axios.create(config),
-        },
-        {
-          provide: HTTP_MODULE_ID,
-          useValue: randomStringGenerator(),
-        },
-      ],
-    };
-  }
-
-  static registerAsync(options: HttpModuleAsyncOptions): DynamicModule {
+export class HttpModule extends ConfigurableModuleClass {
+  static registerAsync(options: typeof ASYNC_OPTIONS_TYPE): DynamicModule {
     return {
-      module: HttpModule,
-      imports: options.imports,
+      ...super.registerAsync(options),
       providers: [
-        ...this.createAsyncProviders(options),
         {
           provide: AXIOS_INSTANCE_TOKEN,
           useFactory: (config: HttpModuleOptions) => Axios.create(config),
-          inject: [HTTP_MODULE_OPTIONS],
+          inject: [MODULE_OPTIONS_TOKEN],
         },
-        {
-          provide: HTTP_MODULE_ID,
-          useValue: randomStringGenerator(),
-        },
-        ...(options.extraProviders || []),
       ],
     };
   }
-
-  private static createAsyncProviders(
-    options: HttpModuleAsyncOptions,
-  ): Provider[] {
-    if (options.useExisting || options.useFactory) {
-      return [this.createAsyncOptionsProvider(options)];
-    }
-    return [
-      this.createAsyncOptionsProvider(options),
-      {
-        provide: options.useClass,
-        useClass: options.useClass,
-      },
-    ];
-  }
-
-  private static createAsyncOptionsProvider(
-    options: HttpModuleAsyncOptions,
-  ): Provider {
-    if (options.useFactory) {
-      return {
-        provide: HTTP_MODULE_OPTIONS,
-        useFactory: options.useFactory,
-        inject: options.inject || [],
-      };
-    }
-    return {
-      provide: HTTP_MODULE_OPTIONS,
-      useFactory: async (optionsFactory: HttpModuleOptionsFactory) =>
-        optionsFactory.createHttpOptions(),
-      inject: [options.useExisting || options.useClass],
-    };
-  }
 }
diff --git a/packages/common/http/interfaces/http-module.interface.ts b/packages/common/http/interfaces/http-module.interface.ts
index 794f9385c..02b147d86 100644
--- a/packages/common/http/interfaces/http-module.interface.ts
+++ b/packages/common/http/interfaces/http-module.interface.ts
@@ -1,19 +1,3 @@
 import { AxiosRequestConfig } from 'axios';
-import { ModuleMetadata, Provider, Type } from '../../interfaces';
 
 export type HttpModuleOptions = AxiosRequestConfig;
-
-export interface HttpModuleOptionsFactory {
-  createHttpOptions(): Promise<HttpModuleOptions> | HttpModuleOptions;
-}
-
-export interface HttpModuleAsyncOptions
-  extends Pick<ModuleMetadata, 'imports'> {
-  useExisting?: Type<HttpModuleOptionsFactory>;
-  useClass?: Type<HttpModuleOptionsFactory>;
-  useFactory?: (
-    ...args: any[]
-  ) => Promise<HttpModuleOptions> | HttpModuleOptions;
-  inject?: any[];
-  extraProviders?: Provider[];
-}
diff --git a/packages/common/index.ts b/packages/common/index.ts
index 6a6107762..350464899 100644
--- a/packages/common/index.ts
+++ b/packages/common/index.ts
@@ -1,6 +1,6 @@
 /*
  * Nest @common
- * Copyright(c) 2017 - 2021 Kamil Mysliwiec
+ * Copyright(c) 2017 - 2022 Kamil Mysliwiec
  * https://nestjs.com
  * MIT Licensed
  */
@@ -31,6 +31,7 @@ export {
   INestApplication,
   INestApplicationContext,
   INestMicroservice,
+  InjectionToken,
   IntrospectionResult,
   MessageEvent,
   MiddlewareConsumer,
@@ -44,6 +45,7 @@ export {
   OnApplicationShutdown,
   OnModuleDestroy,
   OnModuleInit,
+  OptionalFactoryDependency,
   Paramtype,
   PipeTransform,
   Provider,
@@ -59,6 +61,7 @@ export {
   WsExceptionFilter,
   WsMessageHandler,
 } from './interfaces';
+export * from './module-utils';
 export * from './pipes';
 export * from './serializer';
 export * from './services';
diff --git a/packages/common/interfaces/middleware/nest-middleware.interface.ts b/packages/common/interfaces/middleware/nest-middleware.interface.ts
index d392d052d..bf3106995 100644
--- a/packages/common/interfaces/middleware/nest-middleware.interface.ts
+++ b/packages/common/interfaces/middleware/nest-middleware.interface.ts
@@ -1,3 +1,3 @@
 export interface NestMiddleware<TRequest = any, TResponse = any> {
-  use(req: TRequest, res: TResponse, next: () => void): any;
+  use(req: TRequest, res: TResponse, next: (error?: Error | any) => void): any;
 }
diff --git a/packages/common/interfaces/modules/index.ts b/packages/common/interfaces/modules/index.ts
index 612adb82b..458f952a3 100644
--- a/packages/common/interfaces/modules/index.ts
+++ b/packages/common/interfaces/modules/index.ts
@@ -1,6 +1,8 @@
 export * from './dynamic-module.interface';
 export * from './forward-reference.interface';
+export * from './injection-token.interface';
 export * from './introspection-result.interface';
 export * from './module-metadata.interface';
 export * from './nest-module.interface';
+export * from './optional-factory-dependency.interface';
 export * from './provider.interface';
diff --git a/packages/common/interfaces/modules/injection-token.interface.ts b/packages/common/interfaces/modules/injection-token.interface.ts
new file mode 100644
index 000000000..01aa7b1a9
--- /dev/null
+++ b/packages/common/interfaces/modules/injection-token.interface.ts
@@ -0,0 +1,9 @@
+import { Abstract } from '../abstract.interface';
+import { Type } from '../type.interface';
+
+export type InjectionToken =
+  | string
+  | symbol
+  | Type<any>
+  | Abstract<any>
+  | Function;
diff --git a/packages/common/interfaces/modules/optional-factory-dependency.interface.ts b/packages/common/interfaces/modules/optional-factory-dependency.interface.ts
new file mode 100644
index 000000000..be2ebb298
--- /dev/null
+++ b/packages/common/interfaces/modules/optional-factory-dependency.interface.ts
@@ -0,0 +1,6 @@
+import { InjectionToken } from './injection-token.interface';
+
+export type OptionalFactoryDependency = {
+  token: InjectionToken;
+  optional: boolean;
+};
diff --git a/packages/common/interfaces/modules/provider.interface.ts b/packages/common/interfaces/modules/provider.interface.ts
index c868b3c97..ba6d86da2 100644
--- a/packages/common/interfaces/modules/provider.interface.ts
+++ b/packages/common/interfaces/modules/provider.interface.ts
@@ -1,6 +1,7 @@
-import { Abstract } from '../abstract.interface';
 import { Scope } from '../scope-options.interface';
 import { Type } from '../type.interface';
+import { InjectionToken } from './injection-token.interface';
+import { OptionalFactoryDependency } from './optional-factory-dependency.interface';
 
 /**
  *
@@ -27,7 +28,7 @@ export type Provider<T = any> =
  * };
  * ```
  *
- * @see [Use class](https://docs.nestjs.com/fundamentals/custom-providers#use-class)
+ * @see [Class providers](https://docs.nestjs.com/fundamentals/custom-providers#class-providers-useclass)
  * @see [Injection scopes](https://docs.nestjs.com/fundamentals/injection-scopes)
  *
  * @publicApi
@@ -36,7 +37,7 @@ export interface ClassProvider<T = any> {
   /**
    * Injection token
    */
-  provide: string | symbol | Type<any> | Abstract<any> | Function;
+  provide: InjectionToken;
   /**
    * Type (class name) of provider (instance to be injected).
    */
@@ -45,6 +46,12 @@ export interface ClassProvider<T = any> {
    * Optional enum defining lifetime of the provider that is injected.
    */
   scope?: Scope;
+  /**
+   * This option is only available on factory providers!
+   *
+   * @see [Use factory](https://docs.nestjs.com/fundamentals/custom-providers#factory-providers-usefactory)
+   */
+  inject?: never;
 }
 
 /**
@@ -58,7 +65,7 @@ export interface ClassProvider<T = any> {
  * };
  * ```
  *
- * @see [Use value](https://docs.nestjs.com/fundamentals/custom-providers#use-value)
+ * @see [Value providers](https://docs.nestjs.com/fundamentals/custom-providers#value-providers-usevalue)
  *
  * @publicApi
  */
@@ -66,11 +73,17 @@ export interface ValueProvider<T = any> {
   /**
    * Injection token
    */
-  provide: string | symbol | Type<any> | Abstract<any> | Function;
+  provide: InjectionToken;
   /**
    * Instance of a provider to be injected.
    */
   useValue: T;
+  /**
+   * This option is only available on factory providers!
+   *
+   * @see [Use factory](https://docs.nestjs.com/fundamentals/custom-providers#factory-providers-usefactory)
+   */
+  inject?: never;
 }
 
 /**
@@ -88,7 +101,7 @@ export interface ValueProvider<T = any> {
  * };
  * ```
  *
- * @see [Use factory](https://docs.nestjs.com/fundamentals/custom-providers#use-factory)
+ * @see [Factory providers](https://docs.nestjs.com/fundamentals/custom-providers#factory-providers-usefactory)
  * @see [Injection scopes](https://docs.nestjs.com/fundamentals/injection-scopes)
  *
  * @publicApi
@@ -97,15 +110,15 @@ export interface FactoryProvider<T = any> {
   /**
    * Injection token
    */
-  provide: string | symbol | Type<any> | Abstract<any> | Function;
+  provide: InjectionToken;
   /**
    * Factory function that returns an instance of the provider to be injected.
    */
-  useFactory: (...args: any[]) => T;
+  useFactory: (...args: any[]) => T | Promise<T>;
   /**
    * Optional list of providers to be injected into the context of the Factory function.
    */
-  inject?: Array<Type<any> | string | symbol | Abstract<any> | Function>;
+  inject?: Array<InjectionToken | OptionalFactoryDependency>;
   /**
    * Optional enum defining lifetime of the provider that is returned by the Factory function.
    */
@@ -123,7 +136,7 @@ export interface FactoryProvider<T = any> {
  * };
  * ```
  *
- * @see [Use existing](https://docs.nestjs.com/fundamentals/custom-providers#use-existing)
+ * @see [Alias providers](https://docs.nestjs.com/fundamentals/custom-providers#alias-providers-useexisting)
  *
  * @publicApi
  */
@@ -131,7 +144,7 @@ export interface ExistingProvider<T = any> {
   /**
    * Injection token
    */
-  provide: string | symbol | Type<any> | Abstract<any> | Function;
+  provide: InjectionToken;
   /**
    * Provider to be aliased by the Injection token.
    */
diff --git a/packages/common/interfaces/version-options.interface.ts b/packages/common/interfaces/version-options.interface.ts
index be03d349d..fcdd786b6 100644
--- a/packages/common/interfaces/version-options.interface.ts
+++ b/packages/common/interfaces/version-options.interface.ts
@@ -58,6 +58,20 @@ export interface MediaTypeVersioningOptions {
   key: string;
 }
 
+export interface CustomVersioningOptions {
+  type: VersioningType.CUSTOM;
+
+  /**
+   * A function that accepts a request object (specific to the underlying platform, ie Express or Fastify)
+   * and returns a single version value or an ordered array of versions, in order from HIGHEST to LOWEST.
+   *
+   * Ex. Returned version array = ['3.1', '3.0', '2.5', '2', '1.9']
+   *
+   * Use type assertion or narrowing to identify the specific request type.
+   */
+  extractor: (request: unknown) => string | string[];
+}
+
 interface VersioningCommonOptions {
   /**
    * The default version to be used as a fallback when you did not provide some
@@ -70,4 +84,9 @@ interface VersioningCommonOptions {
  * @publicApi
  */
 export type VersioningOptions = VersioningCommonOptions &
-  (HeaderVersioningOptions | UriVersioningOptions | MediaTypeVersioningOptions);
+  (
+    | HeaderVersioningOptions
+    | UriVersioningOptions
+    | MediaTypeVersioningOptions
+    | CustomVersioningOptions
+  );
diff --git a/packages/common/module-utils/configurable-module.builder.ts b/packages/common/module-utils/configurable-module.builder.ts
new file mode 100644
index 000000000..0e3f1318f
--- /dev/null
+++ b/packages/common/module-utils/configurable-module.builder.ts
@@ -0,0 +1,330 @@
+import { DynamicModule, Provider } from '../interfaces';
+import { Logger } from '../services/logger.service';
+import { randomStringGenerator } from '../utils/random-string-generator.util';
+import {
+  ASYNC_METHOD_SUFFIX,
+  CONFIGURABLE_MODULE_ID,
+  DEFAULT_FACTORY_CLASS_METHOD_KEY,
+  DEFAULT_METHOD_KEY,
+} from './constants';
+import {
+  ConfigurableModuleAsyncOptions,
+  ConfigurableModuleCls,
+  ConfigurableModuleOptionsFactory,
+} from './interfaces';
+import { ConfigurableModuleHost } from './interfaces/configurable-module-host.interface';
+import { generateOptionsInjectionToken } from './utils/generate-options-injection-token.util';
+
+/**
+ * @publicApi
+ */
+export interface ConfigurableModuleBuilderOptions {
+  /**
+   * Specified what injection token should be used for the module options provider.
+   * By default, an auto-generated UUID will be used.
+   */
+  optionsInjectionToken?: string | symbol;
+  /**
+   * By default, an UUID will be used as a module options provider token.
+   * Explicitly specifying the "moduleName" will instruct the "ConfigurableModuleBuilder"
+   * to use a more descriptive provider token.
+   *
+   * For example, if `moduleName: "Cache"` then auto-generated provider token will be "CACHE_MODULE_OPTIONS".
+   */
+  moduleName?: string;
+  /**
+   * Indicates whether module should always be "transient", meaning,
+   * every time you call the static method to construct a dynamic module,
+   * regardless of what arguments you pass in, a new "unique" module will be created.
+   *
+   * @default false
+   */
+  alwaysTransient?: boolean;
+}
+
+/**
+ * Factory that lets you create configurable modules and
+ * provides a way to reduce the majority of dynamic module boilerplate.
+ *
+ * @publicApi
+ */
+export class ConfigurableModuleBuilder<
+  ModuleOptions,
+  StaticMethodKey extends string = typeof DEFAULT_METHOD_KEY,
+  FactoryClassMethodKey extends string = typeof DEFAULT_FACTORY_CLASS_METHOD_KEY,
+  ExtraModuleDefinitionOptions = {},
+> {
+  protected staticMethodKey: StaticMethodKey;
+  protected factoryClassMethodKey: FactoryClassMethodKey;
+  protected extras: ExtraModuleDefinitionOptions;
+  protected transformModuleDefinition: (
+    definition: DynamicModule,
+    extraOptions: ExtraModuleDefinitionOptions,
+  ) => DynamicModule;
+
+  protected readonly logger = new Logger(ConfigurableModuleBuilder.name);
+
+  constructor(
+    protected readonly options: ConfigurableModuleBuilderOptions = {},
+    parentBuilder?: ConfigurableModuleBuilder<ModuleOptions>,
+  ) {
+    if (parentBuilder) {
+      this.staticMethodKey = parentBuilder.staticMethodKey as StaticMethodKey;
+      this.factoryClassMethodKey =
+        parentBuilder.factoryClassMethodKey as FactoryClassMethodKey;
+      this.transformModuleDefinition = parentBuilder.transformModuleDefinition;
+      this.extras = parentBuilder.extras as ExtraModuleDefinitionOptions;
+    }
+  }
+
+  /**
+   * Registers the "extras" object (a set of extra options that can be used to modify the dynamic module definition).
+   * Values you specify within the "extras" object will be used as default values (that can be overriden by module consumers).
+   *
+   * This method also applies the so-called "module definition transform function" that takes the auto-generated
+   * dynamic module object ("DynamicModule") and the actual consumer "extras" object as input parameters.
+   * The "extras" object consists of values explicitly specified by module consumers and default values.
+   *
+   * @example
+   * ```typescript
+   * .setExtras<{ isGlobal?: boolean }>({ isGlobal: false }, (definition, extras) =>
+   *    ({ ...definition, global: extras.isGlobal })
+   * )
+   * ```
+   */
+  setExtras<ExtraModuleDefinitionOptions>(
+    extras: ExtraModuleDefinitionOptions,
+    transformDefinition: (
+      definition: DynamicModule,
+      extras: ExtraModuleDefinitionOptions,
+    ) => DynamicModule,
+  ) {
+    const builder = new ConfigurableModuleBuilder<
+      ModuleOptions,
+      StaticMethodKey,
+      FactoryClassMethodKey,
+      ExtraModuleDefinitionOptions
+    >(this.options, this as any);
+    builder.extras = extras;
+    builder.transformModuleDefinition = transformDefinition;
+    return builder;
+  }
+
+  /**
+   * Dynamic modules must expose public static methods that let you pass in
+   * configuration parameters (control the module's behavior from the outside).
+   * Some frequently used names that you may have seen in other modules are:
+   * "forRoot", "forFeature", "register", "configure".
+   *
+   * This method "setClassMethodName" lets you specify the name of the
+   * method that will be auto-generated.
+   *
+   * @param key name of the method
+   */
+  setClassMethodName<StaticMethodKey extends string>(key: StaticMethodKey) {
+    const builder = new ConfigurableModuleBuilder<
+      ModuleOptions,
+      StaticMethodKey,
+      FactoryClassMethodKey,
+      ExtraModuleDefinitionOptions
+    >(this.options, this as any);
+    builder.staticMethodKey = key;
+    return builder;
+  }
+
+  /**
+   * Asynchronously configured modules (that rely on other modules, i.e. "ConfigModule")
+   * let you pass the configuration factory class that will be registered and instantiated as a provider.
+   * This provider then will be used to retrieve the module's configuration. To provide the configuration,
+   * the corresponding factory method must be implemented.
+   *
+   * This method ("setFactoryMethodName") lets you control what method name will have to be
+   * implemented by the config factory (default is "create").
+   *
+   * @param key name of the method
+   */
+  setFactoryMethodName<FactoryClassMethodKey extends string>(
+    key: FactoryClassMethodKey,
+  ) {
+    const builder = new ConfigurableModuleBuilder<
+      ModuleOptions,
+      StaticMethodKey,
+      FactoryClassMethodKey,
+      ExtraModuleDefinitionOptions
+    >(this.options, this as any);
+    builder.factoryClassMethodKey = key;
+    return builder;
+  }
+
+  /**
+   * Returns an object consisting of multiple properties that lets you
+   * easily construct dynamic configurable modules. See "ConfigurableModuleHost" interface for more details.
+   */
+  build(): ConfigurableModuleHost<
+    ModuleOptions,
+    StaticMethodKey,
+    FactoryClassMethodKey,
+    ExtraModuleDefinitionOptions
+  > {
+    this.staticMethodKey ??= DEFAULT_METHOD_KEY as StaticMethodKey;
+    this.factoryClassMethodKey ??=
+      DEFAULT_FACTORY_CLASS_METHOD_KEY as FactoryClassMethodKey;
+    this.options.optionsInjectionToken ??= this.options.moduleName
+      ? this.constructInjectionTokenString()
+      : generateOptionsInjectionToken();
+    this.transformModuleDefinition ??= definition => definition;
+
+    return {
+      ConfigurableModuleClass:
+        this.createConfigurableModuleCls<ModuleOptions>(),
+      MODULE_OPTIONS_TOKEN: this.options.optionsInjectionToken,
+      ASYNC_OPTIONS_TYPE: this.createTypeProxy('ASYNC_OPTIONS_TYPE'),
+      OPTIONS_TYPE: this.createTypeProxy('OPTIONS_TYPE'),
+    };
+  }
+
+  private constructInjectionTokenString(): string {
+    const moduleNameInSnakeCase = this.options.moduleName
+      .trim()
+      .split(/(?=[A-Z])/)
+      .join('_')
+      .toUpperCase();
+    return `${moduleNameInSnakeCase}_MODULE_OPTIONS`;
+  }
+
+  private createConfigurableModuleCls<ModuleOptions>(): ConfigurableModuleCls<
+    ModuleOptions,
+    StaticMethodKey,
+    FactoryClassMethodKey
+  > {
+    // eslint-disable-next-line @typescript-eslint/no-this-alias
+    const self = this;
+    const asyncMethodKey = this.staticMethodKey + ASYNC_METHOD_SUFFIX;
+
+    class InternalModuleClass {
+      static [self.staticMethodKey](
+        options: ModuleOptions & ExtraModuleDefinitionOptions,
+      ): DynamicModule {
+        const providers = [
+          {
+            provide: self.options.optionsInjectionToken,
+            useValue: this.omitExtras(options, self.extras),
+          },
+        ];
+        if (self.options.alwaysTransient) {
+          providers.push({
+            provide: CONFIGURABLE_MODULE_ID,
+            useValue: randomStringGenerator(),
+          });
+        }
+        return self.transformModuleDefinition(
+          {
+            module: this,
+            providers,
+          },
+          options,
+        );
+      }
+
+      static [asyncMethodKey](
+        options: ConfigurableModuleAsyncOptions<ModuleOptions> &
+          ExtraModuleDefinitionOptions,
+      ): DynamicModule {
+        const providers = this.createAsyncProviders(options);
+        if (self.options.alwaysTransient) {
+          providers.push({
+            provide: CONFIGURABLE_MODULE_ID,
+            useValue: randomStringGenerator(),
+          });
+        }
+        return self.transformModuleDefinition(
+          {
+            module: this,
+            imports: options.imports || [],
+            providers,
+          },
+          options,
+        );
+      }
+
+      private static omitExtras(
+        input: ModuleOptions & ExtraModuleDefinitionOptions,
+        extras: ExtraModuleDefinitionOptions | undefined,
+      ): ModuleOptions {
+        if (!extras) {
+          return input;
+        }
+        const moduleOptions = {};
+        const extrasKeys = Object.keys(extras);
+
+        Object.keys(input)
+          .filter(key => !extrasKeys.includes(key))
+          .forEach(key => {
+            moduleOptions[key] = input[key];
+          });
+        return moduleOptions as ModuleOptions;
+      }
+
+      private static createAsyncProviders(
+        options: ConfigurableModuleAsyncOptions<ModuleOptions>,
+      ): Provider[] {
+        if (options.useExisting || options.useFactory) {
+          return [this.createAsyncOptionsProvider(options)];
+        }
+        return [
+          this.createAsyncOptionsProvider(options),
+          {
+            provide: options.useClass,
+            useClass: options.useClass,
+          },
+        ];
+      }
+
+      private static createAsyncOptionsProvider(
+        options: ConfigurableModuleAsyncOptions<ModuleOptions>,
+      ): Provider {
+        if (options.useFactory) {
+          return {
+            provide: self.options.optionsInjectionToken,
+            useFactory: options.useFactory,
+            inject: options.inject || [],
+          };
+        }
+        return {
+          provide: self.options.optionsInjectionToken,
+          useFactory: async (
+            optionsFactory: ConfigurableModuleOptionsFactory<
+              ModuleOptions,
+              FactoryClassMethodKey
+            >,
+          ) =>
+            await optionsFactory[
+              self.factoryClassMethodKey as keyof typeof optionsFactory
+            ](),
+          inject: [options.useExisting || options.useClass],
+        };
+      }
+    }
+    return InternalModuleClass as unknown as ConfigurableModuleCls<
+      ModuleOptions,
+      StaticMethodKey,
+      FactoryClassMethodKey
+    >;
+  }
+
+  private createTypeProxy(
+    typeName: 'OPTIONS_TYPE' | 'ASYNC_OPTIONS_TYPE' | 'OptionsFactoryInterface',
+  ) {
+    const proxy = new Proxy(
+      {},
+      {
+        get: () => {
+          throw new Error(
+            `"${typeName}" is not supposed to be used as a value.`,
+          );
+        },
+      },
+    );
+    return proxy as any;
+  }
+}
diff --git a/packages/common/module-utils/constants.ts b/packages/common/module-utils/constants.ts
new file mode 100644
index 000000000..2d97c0c8c
--- /dev/null
+++ b/packages/common/module-utils/constants.ts
@@ -0,0 +1,5 @@
+export const DEFAULT_METHOD_KEY = 'register';
+export const DEFAULT_FACTORY_CLASS_METHOD_KEY = 'create';
+
+export const ASYNC_METHOD_SUFFIX = 'Async';
+export const CONFIGURABLE_MODULE_ID = 'CONFIGURABLE_MODULE_ID';
diff --git a/packages/common/module-utils/index.ts b/packages/common/module-utils/index.ts
new file mode 100644
index 000000000..4393992bd
--- /dev/null
+++ b/packages/common/module-utils/index.ts
@@ -0,0 +1,2 @@
+export * from './configurable-module.builder';
+export * from './interfaces';
diff --git a/packages/common/module-utils/interfaces/configurable-module-async-options.interface.ts b/packages/common/module-utils/interfaces/configurable-module-async-options.interface.ts
new file mode 100644
index 000000000..56f7040e4
--- /dev/null
+++ b/packages/common/module-utils/interfaces/configurable-module-async-options.interface.ts
@@ -0,0 +1,51 @@
+import { FactoryProvider, ModuleMetadata, Type } from '../../interfaces';
+import { DEFAULT_FACTORY_CLASS_METHOD_KEY } from '../constants';
+
+/**
+ * Interface that must be implemented by the module options factory class.
+ * Method key varies depending on the "FactoryClassMethodKey" type argument.
+ *
+ * @publicApi
+ */
+export type ConfigurableModuleOptionsFactory<
+  ModuleOptions,
+  FactoryClassMethodKey extends string,
+> = Record<
+  `${FactoryClassMethodKey}`,
+  () => Promise<ModuleOptions> | ModuleOptions
+>;
+
+/**
+ * Interface that represents the module async options object
+ * Factory method name varies depending on the "FactoryClassMethodKey" type argument.
+ *
+ * @publicApi
+ */
+export interface ConfigurableModuleAsyncOptions<
+  ModuleOptions,
+  FactoryClassMethodKey extends string = typeof DEFAULT_FACTORY_CLASS_METHOD_KEY,
+> extends Pick<ModuleMetadata, 'imports'> {
+  /**
+   * Injection token resolving to an existing provider. The provider must implement
+   * the corresponding interface.
+   */
+  useExisting?: Type<
+    ConfigurableModuleOptionsFactory<ModuleOptions, FactoryClassMethodKey>
+  >;
+  /**
+   * Injection token resolving to a class that will be instantiated as a provider.
+   * The class must implement the corresponding interface.
+   */
+  useClass?: Type<
+    ConfigurableModuleOptionsFactory<ModuleOptions, FactoryClassMethodKey>
+  >;
+  /**
+   * Function returning options (or a Promise resolving to options) to configure the
+   * cache module.
+   */
+  useFactory?: (...args: unknown[]) => Promise<ModuleOptions> | ModuleOptions;
+  /**
+   * Dependencies that a Factory may inject.
+   */
+  inject?: FactoryProvider['inject'];
+}
diff --git a/packages/common/module-utils/interfaces/configurable-module-cls.interface.ts b/packages/common/module-utils/interfaces/configurable-module-cls.interface.ts
new file mode 100644
index 000000000..e01c706be
--- /dev/null
+++ b/packages/common/module-utils/interfaces/configurable-module-cls.interface.ts
@@ -0,0 +1,35 @@
+import { DynamicModule } from '../../interfaces';
+import {
+  DEFAULT_FACTORY_CLASS_METHOD_KEY,
+  DEFAULT_METHOD_KEY,
+} from '../constants';
+import { ConfigurableModuleAsyncOptions } from './configurable-module-async-options.interface';
+
+/**
+ * Class that represents a blueprint/prototype for a configurable Nest module.
+ * This class provides static methods for constructing dynamic modules. Their names
+ * can be controlled through the "MethodKey" type argument.
+ *
+ * @publicApi
+ */
+export type ConfigurableModuleCls<
+  ModuleOptions,
+  MethodKey extends string = typeof DEFAULT_METHOD_KEY,
+  FactoryClassMethodKey extends string = typeof DEFAULT_FACTORY_CLASS_METHOD_KEY,
+  ExtraModuleDefinitionOptions = {},
+> = {
+  new (): any;
+} & Record<
+  `${MethodKey}`,
+  (options: ModuleOptions & ExtraModuleDefinitionOptions) => DynamicModule
+> &
+  Record<
+    `${MethodKey}Async`,
+    (
+      options: ConfigurableModuleAsyncOptions<
+        ModuleOptions,
+        FactoryClassMethodKey
+      > &
+        ExtraModuleDefinitionOptions,
+    ) => DynamicModule
+  >;
diff --git a/packages/common/module-utils/interfaces/configurable-module-host.interface.ts b/packages/common/module-utils/interfaces/configurable-module-host.interface.ts
new file mode 100644
index 000000000..6a652ecce
--- /dev/null
+++ b/packages/common/module-utils/interfaces/configurable-module-host.interface.ts
@@ -0,0 +1,77 @@
+import { ConfigurableModuleAsyncOptions } from './configurable-module-async-options.interface';
+import { ConfigurableModuleCls } from './configurable-module-cls.interface';
+
+/**
+ * Configurable module host. See properties for more details
+ *
+ * @publicApi
+ */
+export interface ConfigurableModuleHost<
+  ModuleOptions = Record<string, unknown>,
+  MethodKey extends string = string,
+  FactoryClassMethodKey extends string = string,
+  ExtraModuleDefinitionOptions = {},
+> {
+  /**
+   * Class that represents a blueprint/prototype for a configurable Nest module.
+   * This class provides static methods for constructing dynamic modules. Their names
+   * can be controlled through the "MethodKey" type argument.
+   *
+   * Your module class should inherit from this class to make the static methods available.
+   *
+   * @example
+   * ```typescript
+   * @Module({})
+   * class IntegrationModule extends ConfigurableModuleCls {
+   *  // ...
+   * }
+   * ```
+   */
+  ConfigurableModuleClass: ConfigurableModuleCls<
+    ModuleOptions,
+    MethodKey,
+    FactoryClassMethodKey,
+    ExtraModuleDefinitionOptions
+  >;
+  /**
+   * Module options provider token. Can be used to inject the "options object" to
+   * providers registered within the host module.
+   */
+  MODULE_OPTIONS_TOKEN: string | symbol;
+  /**
+   * Can be used to auto-infer the compound "async module options" type.
+   * Note: this property is not supposed to be used as a value.
+   *
+   * @example
+   * ```typescript
+   * @Module({})
+   * class IntegrationModule extends ConfigurableModuleCls {
+   *  static module = initializer(IntegrationModule);
+   *
+   * static registerAsync(options: typeof ASYNC_OPTIONS_TYPE): DynamicModule {
+   *  return super.registerAsync(options);
+   * }
+   * ```
+   */
+  ASYNC_OPTIONS_TYPE: ConfigurableModuleAsyncOptions<
+    ModuleOptions,
+    FactoryClassMethodKey
+  > &
+    ExtraModuleDefinitionOptions;
+  /**
+   * Can be used to auto-infer the compound "module options" type (options interface + extra module definition options).
+   * Note: this property is not supposed to be used as a value.
+   *
+   * @example
+   * ```typescript
+   * @Module({})
+   * class IntegrationModule extends ConfigurableModuleCls {
+   *  static module = initializer(IntegrationModule);
+   *
+   * static register(options: typeof OPTIONS_TYPE): DynamicModule {
+   *  return super.register(options);
+   * }
+   * ```
+   */
+  OPTIONS_TYPE: ModuleOptions & ExtraModuleDefinitionOptions;
+}
diff --git a/packages/common/module-utils/interfaces/index.ts b/packages/common/module-utils/interfaces/index.ts
new file mode 100644
index 000000000..35c523076
--- /dev/null
+++ b/packages/common/module-utils/interfaces/index.ts
@@ -0,0 +1,3 @@
+export * from './configurable-module-async-options.interface';
+export * from './configurable-module-cls.interface';
+export * from './configurable-module-host.interface';
diff --git a/packages/common/module-utils/utils/generate-options-injection-token.util.ts b/packages/common/module-utils/utils/generate-options-injection-token.util.ts
new file mode 100644
index 000000000..259a6afa3
--- /dev/null
+++ b/packages/common/module-utils/utils/generate-options-injection-token.util.ts
@@ -0,0 +1,6 @@
+import { randomStringGenerator } from '../../utils/random-string-generator.util';
+
+export function generateOptionsInjectionToken() {
+  const hash = randomStringGenerator();
+  return `CONFIGURABLE_MODULE_OPTIONS[${hash}]`;
+}
diff --git a/packages/common/package.json b/packages/common/package.json
index 58bd7fec9..82bfc8c5b 100644
--- a/packages/common/package.json
+++ b/packages/common/package.json
@@ -1,6 +1,6 @@
 {
   "name": "@nestjs/common",
-  "version": "8.3.1",
+  "version": "8.4.5",
   "description": "Nest - modern, fast, powerful node.js web framework (@common)",
   "author": "Kamil Mysliwiec",
   "homepage": "https://nestjs.com",
@@ -17,9 +17,9 @@
   },
   "license": "MIT",
   "dependencies": {
-    "axios": "0.26.0",
+    "axios": "0.27.2",
     "iterare": "1.2.1",
-    "tslib": "2.3.1",
+    "tslib": "2.4.0",
     "uuid": "8.3.2"
   },
   "peerDependencies": {
diff --git a/packages/common/pipes/default-value.pipe.ts b/packages/common/pipes/default-value.pipe.ts
index 4ce7d9701..65716f497 100644
--- a/packages/common/pipes/default-value.pipe.ts
+++ b/packages/common/pipes/default-value.pipe.ts
@@ -16,7 +16,7 @@ import { isNil, isNumber } from '../utils/shared.utils';
 export class DefaultValuePipe<T = any, R = any>
   implements PipeTransform<T, T | R>
 {
-  constructor(private readonly defaultValue: R) {}
+  constructor(protected readonly defaultValue: R) {}
 
   transform(value?: T, _metadata?: ArgumentMetadata): T | R {
     if (
diff --git a/packages/common/pipes/parse-array.pipe.ts b/packages/common/pipes/parse-array.pipe.ts
index 6ede5cf0b..c9ed1c67d 100644
--- a/packages/common/pipes/parse-array.pipe.ts
+++ b/packages/common/pipes/parse-array.pipe.ts
@@ -36,7 +36,7 @@ export class ParseArrayPipe implements PipeTransform {
   protected readonly validationPipe: ValidationPipe;
   protected exceptionFactory: (error: string) => any;
 
-  constructor(@Optional() private readonly options: ParseArrayOptions = {}) {
+  constructor(@Optional() protected readonly options: ParseArrayOptions = {}) {
     this.validationPipe = new ValidationPipe({
       transform: true,
       validateCustomDecorators: true,
diff --git a/packages/common/pipes/parse-bool.pipe.ts b/packages/common/pipes/parse-bool.pipe.ts
index 5876144d9..a5b6bcb6d 100644
--- a/packages/common/pipes/parse-bool.pipe.ts
+++ b/packages/common/pipes/parse-bool.pipe.ts
@@ -48,14 +48,32 @@ export class ParseBoolPipe
     value: string | boolean,
     metadata: ArgumentMetadata,
   ): Promise<boolean> {
-    if (value === true || value === 'true') {
+    if (this.isTrue(value)) {
       return true;
     }
-    if (value === false || value === 'false') {
+    if (this.isFalse(value)) {
       return false;
     }
     throw this.exceptionFactory(
       'Validation failed (boolean string is expected)',
     );
   }
+
+  /**
+   * @param value currently processed route argument
+   * @returns `true` if `value` is said 'true', ie., if it is equal to the boolean
+   * `true` or the string `"true"`
+   */
+  protected isTrue(value: string | boolean): boolean {
+    return value === true || value === 'true';
+  }
+
+  /**
+   * @param value currently processed route argument
+   * @returns `true` if `value` is said 'false', ie., if it is equal to the boolean
+   * `false` or the string `"false"`
+   */
+  protected isFalse(value: string | boolean): boolean {
+    return value === false || value === 'false';
+  }
 }
diff --git a/packages/common/pipes/parse-float.pipe.ts b/packages/common/pipes/parse-float.pipe.ts
index 086152a9b..1f0fdb021 100644
--- a/packages/common/pipes/parse-float.pipe.ts
+++ b/packages/common/pipes/parse-float.pipe.ts
@@ -39,15 +39,23 @@ export class ParseFloatPipe implements PipeTransform<string> {
    * @param metadata contains metadata about the currently processed route argument
    */
   async transform(value: string, metadata: ArgumentMetadata): Promise<number> {
-    const isNumeric =
-      ['string', 'number'].includes(typeof value) &&
-      !isNaN(parseFloat(value)) &&
-      isFinite(value as any);
-    if (!isNumeric) {
+    if (!this.isNumeric(value)) {
       throw this.exceptionFactory(
         'Validation failed (numeric string is expected)',
       );
     }
     return parseFloat(value);
   }
+
+  /**
+   * @param value currently processed route argument
+   * @returns `true` if `value` is a valid float number
+   */
+  protected isNumeric(value: string): boolean {
+    return (
+      ['string', 'number'].includes(typeof value) &&
+      !isNaN(parseFloat(value)) &&
+      isFinite(value as any)
+    );
+  }
 }
diff --git a/packages/common/pipes/parse-int.pipe.ts b/packages/common/pipes/parse-int.pipe.ts
index 2ba713f85..9d79a2b4c 100644
--- a/packages/common/pipes/parse-int.pipe.ts
+++ b/packages/common/pipes/parse-int.pipe.ts
@@ -44,15 +44,23 @@ export class ParseIntPipe implements PipeTransform<string> {
    * @param metadata contains metadata about the currently processed route argument
    */
   async transform(value: string, metadata: ArgumentMetadata): Promise<number> {
-    const isNumeric =
-      ['string', 'number'].includes(typeof value) &&
-      /^-?\d+$/.test(value) &&
-      isFinite(value as any);
-    if (!isNumeric) {
+    if (!this.isNumeric(value)) {
       throw this.exceptionFactory(
         'Validation failed (numeric string is expected)',
       );
     }
     return parseInt(value, 10);
   }
+
+  /**
+   * @param value currently processed route argument
+   * @returns `true` if `value` is a valid integer number
+   */
+  protected isNumeric(value: string): boolean {
+    return (
+      ['string', 'number'].includes(typeof value) &&
+      /^-?\d+$/.test(value) &&
+      isFinite(value as any)
+    );
+  }
 }
diff --git a/packages/common/pipes/parse-uuid.pipe.ts b/packages/common/pipes/parse-uuid.pipe.ts
index 2679e8f93..81fe2b4c1 100644
--- a/packages/common/pipes/parse-uuid.pipe.ts
+++ b/packages/common/pipes/parse-uuid.pipe.ts
@@ -9,7 +9,7 @@ import {
   ErrorHttpStatusCode,
   HttpErrorByCode,
 } from '../utils/http-error-by-code.util';
-import { isUUID } from '../utils/is-uuid';
+import { isString } from '../utils/shared.utils';
 
 export interface ParseUUIDPipeOptions {
   version?: '3' | '4' | '5';
@@ -19,6 +19,12 @@ export interface ParseUUIDPipeOptions {
 
 @Injectable()
 export class ParseUUIDPipe implements PipeTransform<string> {
+  protected static uuidRegExps = {
+    3: /^[0-9A-F]{8}-[0-9A-F]{4}-3[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i,
+    4: /^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,
+    5: /^[0-9A-F]{8}-[0-9A-F]{4}-5[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,
+    all: /^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i,
+  };
   private readonly version: '3' | '4' | '5';
   protected exceptionFactory: (errors: string) => any;
 
@@ -35,14 +41,23 @@ export class ParseUUIDPipe implements PipeTransform<string> {
       exceptionFactory ||
       (error => new HttpErrorByCode[errorHttpStatusCode](error));
   }
+
   async transform(value: string, metadata: ArgumentMetadata): Promise<string> {
-    if (!isUUID(value, this.version)) {
+    if (!this.isUUID(value, this.version)) {
       throw this.exceptionFactory(
-        `Validation failed (uuid ${
-          this.version ? 'v' + this.version : ''
+        `Validation failed (uuid${
+          this.version ? ` v ${this.version}` : ''
         } is expected)`,
       );
     }
     return value;
   }
+
+  protected isUUID(str: unknown, version = 'all') {
+    if (!isString(str)) {
+      throw this.exceptionFactory('The value passed as UUID is not a string');
+    }
+    const pattern = ParseUUIDPipe.uuidRegExps[version];
+    return pattern?.test(str);
+  }
 }
diff --git a/packages/common/services/console-logger.service.ts b/packages/common/services/console-logger.service.ts
index 5ae5c570c..a1a9ffb6c 100644
--- a/packages/common/services/console-logger.service.ts
+++ b/packages/common/services/console-logger.service.ts
@@ -183,27 +183,58 @@ export class ConsoleLogger implements LoggerService {
     logLevel: LogLevel = 'log',
     writeStreamType?: 'stdout' | 'stderr',
   ) {
-    const color = this.getColorByLogLevel(logLevel);
     messages.forEach(message => {
-      const output = isPlainObject(message)
-        ? `${color('Object:')}\n${JSON.stringify(
-            message,
-            (key, value) =>
-              typeof value === 'bigint' ? value.toString() : value,
-            2,
-          )}\n`
-        : color(message as string);
-
-      const pidMessage = color(`[Nest] ${process.pid}  - `);
+      const pidMessage = this.formatPid(process.pid);
       const contextMessage = context ? yellow(`[${context}] `) : '';
       const timestampDiff = this.updateAndGetTimestampDiff();
-      const formattedLogLevel = color(logLevel.toUpperCase().padStart(7, ' '));
-      const computedMessage = `${pidMessage}${this.getTimestamp()} ${formattedLogLevel} ${contextMessage}${output}${timestampDiff}\n`;
+      const formattedLogLevel = logLevel.toUpperCase().padStart(7, ' ');
+      const formatedMessage = this.formatMessage(
+        logLevel,
+        message,
+        pidMessage,
+        formattedLogLevel,
+        contextMessage,
+        timestampDiff,
+      );
 
-      process[writeStreamType ?? 'stdout'].write(computedMessage);
+      process[writeStreamType ?? 'stdout'].write(formatedMessage);
     });
   }
 
+  protected formatPid(pid: number) {
+    return `[Nest] ${pid}  - `;
+  }
+
+  protected formatMessage(
+    logLevel: LogLevel,
+    message: unknown,
+    pidMessage: string,
+    formattedLogLevel: string,
+    contextMessage: string,
+    timestampDiff: string,
+  ) {
+    const output = this.stringifyMessage(message, logLevel);
+    pidMessage = this.colorize(pidMessage, logLevel);
+    formattedLogLevel = this.colorize(formattedLogLevel, logLevel);
+    return `${pidMessage}${this.getTimestamp()} ${formattedLogLevel} ${contextMessage}${output}${timestampDiff}\n`;
+  }
+
+  protected stringifyMessage(message: unknown, logLevel: LogLevel) {
+    return isPlainObject(message)
+      ? `${this.colorize('Object:', logLevel)}\n${JSON.stringify(
+          message,
+          (key, value) =>
+            typeof value === 'bigint' ? value.toString() : value,
+          2,
+        )}\n`
+      : this.colorize(message as string, logLevel);
+  }
+
+  protected colorize(message: string, logLevel: LogLevel) {
+    const color = this.getColorByLogLevel(logLevel);
+    return color(message);
+  }
+
   protected printStackTrace(stack: string) {
     if (!stack) {
       return;
diff --git a/packages/common/test/file-stream/streamable-file.spec.ts b/packages/common/test/file-stream/streamable-file.spec.ts
index c4cb075b5..7bfd43301 100644
--- a/packages/common/test/file-stream/streamable-file.spec.ts
+++ b/packages/common/test/file-stream/streamable-file.spec.ts
@@ -17,6 +17,32 @@ describe('StreamableFile', () => {
       expect(streamableFile.getStream()).to.equal(stream);
     });
   });
+  describe('when options is empty', () => {
+    it('should return application/octet-stream for type and undefined for others', () => {
+      const stream = new Readable();
+      const streamableFile = new StreamableFile(stream);
+      expect(streamableFile.getHeaders()).to.deep.equal({
+        type: 'application/octet-stream',
+        disposition: undefined,
+        length: undefined,
+      });
+    });
+  });
+  describe('when options is defined', () => {
+    it('should pass provided headers', () => {
+      const stream = new Readable();
+      const streamableFile = new StreamableFile(stream, {
+        type: 'application/pdf',
+        disposition: 'inline',
+        length: 100,
+      });
+      expect(streamableFile.getHeaders()).to.deep.equal({
+        type: 'application/pdf',
+        disposition: 'inline',
+        length: 100,
+      });
+    });
+  });
   describe('otherwise', () => {
     describe('when input is a Buffer instance', () => {
       it('should create a readable stream and push the input buffer', () => {
diff --git a/packages/common/test/module-utils/configurable-module.builder.spec.ts b/packages/common/test/module-utils/configurable-module.builder.spec.ts
new file mode 100644
index 000000000..3d3623271
--- /dev/null
+++ b/packages/common/test/module-utils/configurable-module.builder.spec.ts
@@ -0,0 +1,112 @@
+import { expect } from 'chai';
+import { Provider } from '../../interfaces';
+import { ConfigurableModuleBuilder } from '../../module-utils';
+
+describe('ConfigurableModuleBuilder', () => {
+  describe('setExtras', () => {
+    it('should apply module definition transformer function and return typed builder', () => {
+      const { ConfigurableModuleClass } = new ConfigurableModuleBuilder()
+        .setExtras(
+          { isGlobal: false },
+          (definition, extras: { isGlobal: boolean }) => ({
+            ...definition,
+            global: extras.isGlobal,
+          }),
+        )
+        .build();
+
+      expect(
+        ConfigurableModuleClass.register({
+          // No type error
+          isGlobal: true,
+        }),
+      ).to.deep.include({
+        global: true,
+      });
+    });
+  });
+  describe('setClassMethodName', () => {
+    it('should set static class method name and return typed builder', () => {
+      const { ConfigurableModuleClass } = new ConfigurableModuleBuilder()
+        .setClassMethodName('forRoot')
+        .build();
+
+      expect(ConfigurableModuleClass.forRoot).to.not.be.undefined;
+      expect(ConfigurableModuleClass.forRootAsync).to.not.be.undefined;
+      expect((ConfigurableModuleClass as any).register).to.be.undefined;
+    });
+  });
+  describe('setFactoryMethodName', () => {
+    it('should set configuration factory class method name and return typed builder', () => {
+      const { ConfigurableModuleClass } = new ConfigurableModuleBuilder()
+        .setFactoryMethodName('createOptions')
+        .build();
+
+      expect(
+        ConfigurableModuleClass.registerAsync({
+          useClass: class {
+            // No type error
+            createOptions() {}
+          },
+        }),
+      ).to.not.be.undefined;
+    });
+  });
+  describe('build', () => {
+    it('should return a fully typed "ConfigurableModuleClass"', () => {
+      type ExtraConfig = { isGlobal?: boolean; extraProviders: Provider[] };
+
+      const {
+        ConfigurableModuleClass,
+        OPTIONS_TYPE,
+        ASYNC_OPTIONS_TYPE,
+        MODULE_OPTIONS_TOKEN,
+      } = new ConfigurableModuleBuilder({
+        moduleName: 'RandomTest',
+        alwaysTransient: true,
+      })
+        .setFactoryMethodName('createOptions')
+        .setClassMethodName('forFeature')
+        .setExtras<ExtraConfig>(
+          { isGlobal: false, extraProviders: [] },
+          (definition, extras) => ({
+            ...definition,
+            global: extras.isGlobal,
+            providers: definition.providers?.concat(extras.extraProviders),
+          }),
+        )
+        .build();
+
+      const definition = ConfigurableModuleClass.forFeatureAsync({
+        useFactory: () => {},
+        isGlobal: true,
+        extraProviders: ['test' as any],
+      });
+
+      expect(definition.global).to.equal(true);
+      expect(definition.providers).to.have.length(3);
+      expect(definition.providers).to.deep.contain('test');
+      expect(MODULE_OPTIONS_TOKEN).to.equal('RANDOM_TEST_MODULE_OPTIONS');
+      expect((definition.providers[0] as any).provide).to.equal(
+        'RANDOM_TEST_MODULE_OPTIONS',
+      );
+
+      try {
+        expect(ASYNC_OPTIONS_TYPE.imports).to.equal(undefined);
+      } catch (err) {
+        expect(err).to.be.instanceOf(Error);
+        expect(err.message).to.equal(
+          '"ASYNC_OPTIONS_TYPE" is not supposed to be used as a value.',
+        );
+      }
+      try {
+        expect(OPTIONS_TYPE.isGlobal).to.equal(undefined);
+      } catch (err) {
+        expect(err).to.be.instanceOf(Error);
+        expect(err.message).to.equal(
+          '"OPTIONS_TYPE" is not supposed to be used as a value.',
+        );
+      }
+    });
+  });
+});
diff --git a/packages/common/test/pipes/parse-int.pipe.spec.ts b/packages/common/test/pipes/parse-int.pipe.spec.ts
index 3bb7ab185..d9d78de27 100644
--- a/packages/common/test/pipes/parse-int.pipe.spec.ts
+++ b/packages/common/test/pipes/parse-int.pipe.spec.ts
@@ -1,4 +1,3 @@
-import * as sinon from 'sinon';
 import { expect } from 'chai';
 import { ArgumentMetadata } from '../../interfaces';
 import { ParseIntPipe } from '../../pipes/parse-int.pipe';
diff --git a/packages/common/test/pipes/parse-uuid.pipe.spec.ts b/packages/common/test/pipes/parse-uuid.pipe.spec.ts
index 3f6cb79fb..bcb3a76b3 100644
--- a/packages/common/test/pipes/parse-uuid.pipe.spec.ts
+++ b/packages/common/test/pipes/parse-uuid.pipe.spec.ts
@@ -1,9 +1,18 @@
 import { expect } from 'chai';
+import { HttpStatus } from '../../enums';
+import { HttpException } from '../../exceptions';
 import { ArgumentMetadata } from '../../interfaces';
 import { ParseUUIDPipe } from '../../pipes/parse-uuid.pipe';
 
+class TestException extends HttpException {
+  constructor() {
+    super('This is a TestException', HttpStatus.I_AM_A_TEAPOT);
+  }
+}
+
 describe('ParseUUIDPipe', () => {
   let target: ParseUUIDPipe;
+  const exceptionFactory = (error: any) => new TestException();
 
   describe('transform', () => {
     const v3 = 'e8b5a51d-11c8-3310-a6ab-367563f20686';
@@ -12,53 +21,80 @@ describe('ParseUUIDPipe', () => {
 
     describe('when validation passes', () => {
       it('should return string if value is uuid v3, v4 or v5', async () => {
-        target = new ParseUUIDPipe();
+        target = new ParseUUIDPipe({ exceptionFactory });
         expect(await target.transform(v3, {} as ArgumentMetadata)).to.equal(v3);
         expect(await target.transform(v4, {} as ArgumentMetadata)).to.equal(v4);
         expect(await target.transform(v5, {} as ArgumentMetadata)).to.equal(v5);
       });
 
       it('should return string if value is uuid v3', async () => {
-        target = new ParseUUIDPipe({ version: '3' });
+        target = new ParseUUIDPipe({ version: '3', exceptionFactory });
         expect(await target.transform(v3, {} as ArgumentMetadata)).to.equal(v3);
       });
 
       it('should return string if value is uuid v4', async () => {
-        target = new ParseUUIDPipe({ version: '4' });
+        target = new ParseUUIDPipe({ version: '4', exceptionFactory });
         expect(await target.transform(v4, {} as ArgumentMetadata)).to.equal(v4);
       });
 
       it('should return string if value is uuid v5', async () => {
-        target = new ParseUUIDPipe({ version: '5' });
+        target = new ParseUUIDPipe({ version: '5', exceptionFactory });
         expect(await target.transform(v5, {} as ArgumentMetadata)).to.equal(v5);
       });
     });
 
     describe('when validation fails', () => {
       it('should throw an error', async () => {
-        target = new ParseUUIDPipe();
-        expect(target.transform('123a', {} as ArgumentMetadata)).to.be.rejected;
+        target = new ParseUUIDPipe({ exceptionFactory });
+        await expect(
+          target.transform('123a', {} as ArgumentMetadata),
+        ).to.be.rejectedWith(TestException);
+      });
+
+      it('should throw an error - not a string', async () => {
+        target = new ParseUUIDPipe({ exceptionFactory });
+        await expect(
+          target.transform(undefined, {} as ArgumentMetadata),
+        ).to.be.rejectedWith(TestException);
       });
 
       it('should throw an error - v3', async () => {
-        target = new ParseUUIDPipe({ version: '3' });
-        expect(target.transform('123a', {} as ArgumentMetadata)).to.be.rejected;
-        expect(target.transform(v4, {} as ArgumentMetadata)).to.be.rejected;
-        expect(target.transform(v5, {} as ArgumentMetadata)).to.be.rejected;
+        target = new ParseUUIDPipe({ version: '3', exceptionFactory });
+        await expect(
+          target.transform('123a', {} as ArgumentMetadata),
+        ).to.be.rejectedWith(TestException);
+        await expect(
+          target.transform(v4, {} as ArgumentMetadata),
+        ).to.be.rejectedWith(TestException);
+        await expect(
+          target.transform(v5, {} as ArgumentMetadata),
+        ).to.be.rejectedWith(TestException);
       });
 
       it('should throw an error - v4', async () => {
-        target = new ParseUUIDPipe({ version: '4' });
-        expect(target.transform('123a', {} as ArgumentMetadata)).to.be.rejected;
-        expect(target.transform(v3, {} as ArgumentMetadata)).to.be.rejected;
-        expect(target.transform(v5, {} as ArgumentMetadata)).to.be.rejected;
+        target = new ParseUUIDPipe({ version: '4', exceptionFactory });
+        await expect(
+          target.transform('123a', {} as ArgumentMetadata),
+        ).to.be.rejectedWith(TestException);
+        await expect(
+          target.transform(v3, {} as ArgumentMetadata),
+        ).to.be.rejectedWith(TestException);
+        await expect(
+          target.transform(v5, {} as ArgumentMetadata),
+        ).to.be.rejectedWith(TestException);
       });
 
       it('should throw an error - v5 ', async () => {
-        target = new ParseUUIDPipe({ version: '5' });
-        expect(target.transform('123a', {} as ArgumentMetadata)).to.be.rejected;
-        expect(target.transform(v3, {} as ArgumentMetadata)).to.be.rejected;
-        expect(target.transform(v4, {} as ArgumentMetadata)).to.be.rejected;
+        target = new ParseUUIDPipe({ version: '5', exceptionFactory });
+        await expect(
+          target.transform('123a', {} as ArgumentMetadata),
+        ).to.be.rejectedWith(TestException);
+        await expect(
+          target.transform(v3, {} as ArgumentMetadata),
+        ).to.be.rejectedWith(TestException);
+        await expect(
+          target.transform(v4, {} as ArgumentMetadata),
+        ).to.be.rejectedWith(TestException);
       });
     });
   });
diff --git a/packages/common/test/services/logger.service.spec.ts b/packages/common/test/services/logger.service.spec.ts
index 5caa83a65..1a954c1be 100644
--- a/packages/common/test/services/logger.service.spec.ts
+++ b/packages/common/test/services/logger.service.spec.ts
@@ -1,7 +1,7 @@
 import { expect } from 'chai';
 import 'reflect-metadata';
 import * as sinon from 'sinon';
-import { ConsoleLogger, Logger, LoggerService } from '../../services';
+import { ConsoleLogger, Logger, LoggerService, LogLevel } from '../../services';
 
 describe('Logger', () => {
   describe('[static methods]', () => {
@@ -520,4 +520,61 @@ describe('Logger', () => {
       });
     });
   });
+  describe('ConsoleLogger', () => {
+    let processStdoutWriteSpy: sinon.SinonSpy;
+
+    beforeEach(() => {
+      processStdoutWriteSpy = sinon.spy(process.stdout, 'write');
+    });
+    afterEach(() => {
+      processStdoutWriteSpy.restore();
+    });
+
+    it('should support custom formatter', () => {
+      class CustomConsoleLogger extends ConsoleLogger {
+        protected formatMessage(
+          logLevel: LogLevel,
+          message: unknown,
+          pidMessage: string,
+          formattedLogLevel: string,
+          contextMessage: string,
+          timestampDiff: string,
+        ) {
+          return `Prefix: ${message}`;
+        }
+      }
+
+      const consoleLogger = new CustomConsoleLogger();
+      consoleLogger.debug('test');
+
+      expect(processStdoutWriteSpy.firstCall.firstArg).to.equal(`Prefix: test`);
+    });
+
+    it('should support custom formatter and colorizer', () => {
+      class CustomConsoleLogger extends ConsoleLogger {
+        protected formatMessage(
+          logLevel: LogLevel,
+          message: unknown,
+          pidMessage: string,
+          formattedLogLevel: string,
+          contextMessage: string,
+          timestampDiff: string,
+        ) {
+          const strMessage = this.stringifyMessage(message, logLevel);
+          return `Prefix: ${strMessage}`;
+        }
+
+        protected colorize(message: string, logLevel: LogLevel): string {
+          return `~~~${message}~~~`;
+        }
+      }
+
+      const consoleLogger = new CustomConsoleLogger();
+      consoleLogger.debug('test');
+
+      expect(processStdoutWriteSpy.firstCall.firstArg).to.equal(
+        `Prefix: ~~~test~~~`,
+      );
+    });
+  });
 });
diff --git a/packages/common/utils/is-uuid.ts b/packages/common/utils/is-uuid.ts
deleted file mode 100644
index 0e9572f4d..000000000
--- a/packages/common/utils/is-uuid.ts
+++ /dev/null
@@ -1,17 +0,0 @@
-import { BadRequestException } from '../exceptions';
-import { isString } from './shared.utils';
-
-const uuid = {
-  3: /^[0-9A-F]{8}-[0-9A-F]{4}-3[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i,
-  4: /^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,
-  5: /^[0-9A-F]{8}-[0-9A-F]{4}-5[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,
-  all: /^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i,
-};
-
-export function isUUID(str: any, version = 'all') {
-  if (!isString(str)) {
-    throw new BadRequestException('The value passed as UUID is not a string');
-  }
-  const pattern = uuid[version];
-  return pattern && pattern.test(str);
-}
diff --git a/packages/core/Readme.md b/packages/core/Readme.md
index 772d0077a..a5e43201d 100644
--- a/packages/core/Readme.md
+++ b/packages/core/Readme.md
@@ -54,7 +54,7 @@ With official support, you can get expert help straight from Nest core team. We
 
 ## Support
 
-Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support by the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).
+Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support from the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).
 
 #### Principal Sponsors
 <table style="text-align:center;"><tr>
@@ -64,17 +64,20 @@ Nest is an MIT-licensed open source project. It can grow thanks to the sponsors
 <a href="https://github.com/Sanofi-IADC" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/sanofi.png" width="180" valign="middle" /></a></td>
 <td>
 <a href="https://nx.dev" target="_blank"><img src="https://nestjs.com/img/nx-logo.png" height="45" valign="middle" /></a></td>
+    <td>
+<a href="https://valor-software.com/" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/valor-software.png" width="170" valign="middle" /></a></td>
 </tr></table>
 
 #### Gold Sponsors
 
 <table style="text-align:center;"><tr><td>
   <a href="https://careers.labster.com/departments/platform" target="_blank"><img src="https://nestjs.com/img/labster-logo.png" width="170" valign="middle" /></a></td><td>
-<a href="https://weld.app/" target="_blank"><img src="https://nestjs.com/img/weld-logo.svg" width="150" valign="middle" /></a></td>
-  <td>
-<a href="https://valor-software.com/" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/valor-software.png" width="170" valign="middle" /></a></td>
+<a href="https://weld.app/" target="_blank"><img src="https://nestjs.com/img/weld-logo.svg" width="140" valign="middle" /></a></td>
 <td>
-<a href="https://intrinsic.ventures/" target="_blank"><img src="https://nestjs.com/img/intrinisic-logo.png" width="210" valign="middle" /></a></td></</tr></table>
+<a href="https://intrinsic.ventures/" target="_blank"><img src="https://nestjs.com/img/intrinisic-logo.png" width="210" valign="middle" /></a></td>
+ <td>
+<a href="https://jetbrains.com/" target="_blank"><img src="https://nestjs.com/img/jetbrains-logo.svg" width="110" valign="middle" /></a></td><td>
+<a href="https://snyk.co/nestjs" target="_blank"><img src="https://nestjs.com/img/snyk-logo-black.png" width="185" valign="middle" /></a></td></</tr></table>
 
 #### Silver Sponsors
 
diff --git a/packages/core/index.ts b/packages/core/index.ts
index 2915304ab..ebc30ca4c 100644
--- a/packages/core/index.ts
+++ b/packages/core/index.ts
@@ -1,6 +1,6 @@
 /*
  * Nest @core
- * Copyright(c) 2017 - 2021 Kamil Mysliwiec
+ * Copyright(c) 2017 - 2022 Kamil Mysliwiec
  * https://nestjs.com
  * MIT Licensed
  */
diff --git a/packages/core/injector/container.ts b/packages/core/injector/container.ts
index b50957d38..138524a5c 100644
--- a/packages/core/injector/container.ts
+++ b/packages/core/injector/container.ts
@@ -154,13 +154,13 @@ export class NestContainer {
     provider: Provider,
     token: string,
   ): string | symbol | Function {
+    const moduleRef = this.modules.get(token);
     if (!provider) {
-      throw new CircularDependencyException();
+      throw new CircularDependencyException(moduleRef?.metatype.name);
     }
-    if (!this.modules.has(token)) {
+    if (!moduleRef) {
       throw new UnknownModuleException();
     }
-    const moduleRef = this.modules.get(token);
     return moduleRef.addProvider(provider);
   }
 
diff --git a/packages/core/injector/injector.ts b/packages/core/injector/injector.ts
index 67996afb3..d4e8c232d 100644
--- a/packages/core/injector/injector.ts
+++ b/packages/core/injector/injector.ts
@@ -1,4 +1,9 @@
-import { Logger, LoggerService } from '@nestjs/common';
+import {
+  InjectionToken,
+  Logger,
+  LoggerService,
+  OptionalFactoryDependency,
+} from '@nestjs/common';
 import {
   OPTIONAL_DEPS_METADATA,
   OPTIONAL_PROPERTY_DEPS_METADATA,
@@ -15,6 +20,7 @@ import {
   isNil,
   isObject,
   isString,
+  isSymbol,
   isUndefined,
 } from '@nestjs/common/utils/shared.utils';
 import { iterate } from 'iterare';
@@ -34,13 +40,13 @@ import { InstanceToken, Module } from './module';
 /**
  * The type of an injectable dependency
  */
-export type InjectorDependency = Type<any> | Function | string | symbol;
+export type InjectorDependency = InjectionToken;
 
 /**
  * The property-based dependency
  */
 export interface PropertyDependency {
-  key: string;
+  key: symbol | string;
   name: InjectorDependency;
   isOptional?: boolean;
   instance?: any;
@@ -119,7 +125,7 @@ export class Injector {
       const properties = await this.resolveProperties(
         wrapper,
         moduleRef,
-        inject,
+        inject as InjectionToken[],
         contextId,
         wrapper,
         inquirer,
@@ -137,7 +143,7 @@ export class Injector {
     await this.resolveConstructorParams<T>(
       wrapper,
       moduleRef,
-      inject,
+      inject as InjectionToken[],
       callback,
       contextId,
       wrapper,
@@ -246,12 +252,11 @@ export class Injector {
       );
       return callback(deps);
     }
-    const dependencies = isNil(inject)
-      ? this.reflectConstructorParams(wrapper.metatype as Type<any>)
-      : inject;
-    const optionalDependenciesIds = isNil(inject)
-      ? this.reflectOptionalParams(wrapper.metatype as Type<any>)
-      : [];
+
+    const isFactoryProvider = !isNil(inject);
+    const [dependencies, optionalDependenciesIds] = isFactoryProvider
+      ? this.getFactoryProviderDependencies(wrapper)
+      : this.getClassDependencies(wrapper);
 
     let isResolved = true;
     const resolveParam = async (param: unknown, index: number) => {
@@ -292,6 +297,47 @@ export class Injector {
     isResolved && (await callback(instances));
   }
 
+  public getClassDependencies<T>(
+    wrapper: InstanceWrapper<T>,
+  ): [InjectorDependency[], number[]] {
+    const ctorRef = wrapper.metatype as Type<any>;
+    return [
+      this.reflectConstructorParams(ctorRef),
+      this.reflectOptionalParams(ctorRef),
+    ];
+  }
+
+  public getFactoryProviderDependencies<T>(
+    wrapper: InstanceWrapper<T>,
+  ): [InjectorDependency[], number[]] {
+    const optionalDependenciesIds = [];
+    const isOptionalFactoryDep = (
+      item: InjectionToken | OptionalFactoryDependency,
+    ): item is OptionalFactoryDependency =>
+      !isUndefined((item as OptionalFactoryDependency).token) &&
+      !isUndefined((item as OptionalFactoryDependency).optional);
+
+    const mapFactoryProviderInjectArray = (
+      item: InjectionToken | OptionalFactoryDependency,
+      index: number,
+    ): InjectionToken => {
+      if (typeof item !== 'object') {
+        return item;
+      }
+      if (isOptionalFactoryDep(item)) {
+        if (item.optional) {
+          optionalDependenciesIds.push(index);
+        }
+        return item?.token;
+      }
+      return item;
+    };
+    return [
+      wrapper.inject?.map?.(mapFactoryProviderInjectArray),
+      optionalDependenciesIds,
+    ];
+  }
+
   public reflectConstructorParams<T>(type: Type<T>): any[] {
     const paramtypes = Reflect.getMetadata(PARAMTYPES_METADATA, type) || [];
     const selfParams = this.reflectSelfParams<T>(type);
@@ -315,7 +361,7 @@ export class Injector {
     moduleRef: Module,
     contextId = STATIC_CONTEXT,
     inquirer?: InstanceWrapper,
-    keyOrIndex?: string | number,
+    keyOrIndex?: symbol | string | number,
   ) {
     if (isUndefined(param)) {
       this.logger.log(
@@ -357,7 +403,7 @@ export class Injector {
     wrapper: InstanceWrapper<T>,
     contextId = STATIC_CONTEXT,
     inquirer?: InstanceWrapper,
-    keyOrIndex?: string | number,
+    keyOrIndex?: symbol | string | number,
   ): Promise<InstanceWrapper> {
     this.printResolvingDependenciesLog(token, inquirer);
     this.printLookingForProviderLog(token, moduleRef);
@@ -392,7 +438,12 @@ export class Injector {
       inquirerId,
     );
     if (!instanceHost.isResolved && !instanceWrapper.forwardRef) {
-      await this.loadProvider(instanceWrapper, moduleRef, contextId, inquirer);
+      await this.loadProvider(
+        instanceWrapper,
+        instanceWrapper.host ?? moduleRef,
+        contextId,
+        inquirer,
+      );
     } else if (
       !instanceHost.isResolved &&
       instanceWrapper.forwardRef &&
@@ -428,10 +479,11 @@ export class Injector {
     wrapper: InstanceWrapper<T>,
     contextId = STATIC_CONTEXT,
     inquirer?: InstanceWrapper,
-    keyOrIndex?: string | number,
+    keyOrIndex?: symbol | string | number,
   ): Promise<InstanceWrapper<T>> {
+    const token = wrapper.token || wrapper.name;
     const { name } = dependencyContext;
-    if (wrapper && wrapper.name === name) {
+    if (wrapper && token === name) {
       throw new UnknownDependenciesException(
         wrapper.name,
         dependencyContext,
@@ -460,7 +512,7 @@ export class Injector {
     wrapper: InstanceWrapper<T>,
     contextId = STATIC_CONTEXT,
     inquirer?: InstanceWrapper,
-    keyOrIndex?: string | number,
+    keyOrIndex?: symbol | string | number,
   ) {
     const instanceWrapper = await this.lookupComponentInImports(
       moduleRef,
@@ -488,7 +540,7 @@ export class Injector {
     moduleRegistry: any[] = [],
     contextId = STATIC_CONTEXT,
     inquirer?: InstanceWrapper,
-    keyOrIndex?: string | number,
+    keyOrIndex?: symbol | string | number,
     isTraversing?: boolean,
   ): Promise<any> {
     let instanceWrapperRef: InstanceWrapper = null;
@@ -779,13 +831,15 @@ export class Injector {
   }
 
   protected addDependencyMetadata(
-    keyOrIndex: number | string,
+    keyOrIndex: symbol | string | number,
     hostWrapper: InstanceWrapper,
     instanceWrapper: InstanceWrapper,
   ) {
-    isString(keyOrIndex)
-      ? hostWrapper.addPropertiesMetadata(keyOrIndex, instanceWrapper)
-      : hostWrapper.addCtorMetadata(keyOrIndex, instanceWrapper);
+    if (isSymbol(keyOrIndex) || isString(keyOrIndex)) {
+      hostWrapper.addPropertiesMetadata(keyOrIndex, instanceWrapper);
+    } else {
+      hostWrapper.addCtorMetadata(keyOrIndex, instanceWrapper);
+    }
   }
 
   private getTokenName(token: InstanceToken): string {
diff --git a/packages/core/injector/instance-wrapper.ts b/packages/core/injector/instance-wrapper.ts
index 9d9d29579..239e89dea 100644
--- a/packages/core/injector/instance-wrapper.ts
+++ b/packages/core/injector/instance-wrapper.ts
@@ -24,7 +24,7 @@ export interface InstancePerContext<T> {
   donePromise?: Promise<void>;
 }
 export interface PropertyMetadata {
-  key: string;
+  key: symbol | string;
   wrapper: InstanceWrapper;
 }
 
@@ -43,7 +43,7 @@ export class InstanceWrapper<T = any> {
 
   public scope?: Scope = Scope.DEFAULT;
   public metatype: Type<T> | Function;
-  public inject?: (string | symbol | Function | Type<any>)[];
+  public inject?: FactoryProvider['inject'];
   public forwardRef?: boolean;
 
   private readonly values = new WeakMap<ContextId, InstancePerContext<T>>();
@@ -146,7 +146,7 @@ export class InstanceWrapper<T = any> {
     return this[INSTANCE_METADATA_SYMBOL].dependencies;
   }
 
-  public addPropertiesMetadata(key: string, wrapper: InstanceWrapper) {
+  public addPropertiesMetadata(key: symbol | string, wrapper: InstanceWrapper) {
     if (!this[INSTANCE_METADATA_SYMBOL].properties) {
       this[INSTANCE_METADATA_SYMBOL].properties = [];
     }
diff --git a/packages/core/injector/module.ts b/packages/core/injector/module.ts
index ed3102a01..461fd0899 100644
--- a/packages/core/injector/module.ts
+++ b/packages/core/injector/module.ts
@@ -1,11 +1,11 @@
 import {
-  Abstract,
   ClassProvider,
   Controller,
   DynamicModule,
   ExistingProvider,
   FactoryProvider,
   Injectable,
+  InjectionToken,
   NestModule,
   Provider,
   ValueProvider,
@@ -31,12 +31,11 @@ import { NestContainer } from './container';
 import { InstanceWrapper } from './instance-wrapper';
 import { ModuleRef } from './module-ref';
 
-export type InstanceToken =
-  | string
-  | symbol
-  | Type<any>
-  | Abstract<any>
-  | Function;
+/**
+ * @note
+ * Left for backward compatibility
+ */
+export type InstanceToken = InjectionToken;
 
 export class Module {
   private readonly _id: string;
diff --git a/packages/core/middleware/middleware-module.ts b/packages/core/middleware/middleware-module.ts
index 748887811..ecb98e1b5 100644
--- a/packages/core/middleware/middleware-module.ts
+++ b/packages/core/middleware/middleware-module.ts
@@ -9,7 +9,6 @@ import {
   addLeadingSlash,
   isUndefined,
 } from '@nestjs/common/utils/shared.utils';
-import { isRouteExcluded, isRequestMethodAll } from '../router/utils';
 import { ApplicationConfig } from '../application-config';
 import { InvalidMiddlewareException } from '../errors/exceptions/invalid-middleware.exception';
 import { RuntimeException } from '../errors/exceptions/runtime.exception';
@@ -23,6 +22,7 @@ import { InstanceToken, Module } from '../injector/module';
 import { REQUEST_CONTEXT_ID } from '../router/request/request-constants';
 import { RouterExceptionFilters } from '../router/router-exception-filters';
 import { RouterProxy } from '../router/router-proxy';
+import { isRequestMethodAll, isRouteExcluded } from '../router/utils';
 import { MiddlewareBuilder } from './builder';
 import { MiddlewareContainer } from './container';
 import { MiddlewareResolver } from './resolver';
@@ -274,8 +274,9 @@ export class MiddlewareModule {
     const prefix = this.config.getGlobalPrefix();
     const excludedRoutes = this.config.getGlobalPrefixOptions().exclude;
     if (
-      Array.isArray(excludedRoutes) &&
-      isRouteExcluded(excludedRoutes, path, method)
+      (Array.isArray(excludedRoutes) &&
+        isRouteExcluded(excludedRoutes, path, method)) ||
+      ['*', '/*', '(.*)', '/(.*)'].includes(path)
     ) {
       path = addLeadingSlash(path);
     } else {
diff --git a/packages/core/nest-application-context.ts b/packages/core/nest-application-context.ts
index a61b9b8b0..c6e3799a1 100644
--- a/packages/core/nest-application-context.ts
+++ b/packages/core/nest-application-context.ts
@@ -324,6 +324,7 @@ export class NestApplicationContext implements INestApplicationContext {
       wrapperRef.host,
       collection,
       contextId,
+      wrapperRef,
     );
     if (!instance) {
       throw new UnknownElementException();
diff --git a/packages/core/package.json b/packages/core/package.json
index 0daf73db9..498884211 100644
--- a/packages/core/package.json
+++ b/packages/core/package.json
@@ -1,6 +1,6 @@
 {
   "name": "@nestjs/core",
-  "version": "8.3.1",
+  "version": "8.4.5",
   "description": "Nest - modern, fast, powerful node.js web framework (@core)",
   "author": "Kamil Mysliwiec",
   "license": "MIT",
@@ -30,13 +30,13 @@
     "@nuxtjs/opencollective": "0.3.2",
     "fast-safe-stringify": "2.1.1",
     "iterare": "1.2.1",
-    "object-hash": "2.2.0",
+    "object-hash": "3.0.0",
     "path-to-regexp": "3.2.0",
-    "tslib": "2.3.1",
+    "tslib": "2.4.0",
     "uuid": "8.3.2"
   },
   "devDependencies": {
-    "@nestjs/common": "8.3.1"
+    "@nestjs/common": "8.4.5"
   },
   "peerDependencies": {
     "@nestjs/common": "^8.0.0",
diff --git a/packages/core/router/router-explorer.ts b/packages/core/router/router-explorer.ts
index 153bf29b4..ab0517dc5 100644
--- a/packages/core/router/router-explorer.ts
+++ b/packages/core/router/router-explorer.ts
@@ -338,8 +338,7 @@ export class RouterExplorer {
       return router.applyVersionFilter(handler, version, versioningOptions);
     }
     /**
-     * This can be removed in the next major release.
-     * Left for backward-compatibility.
+     * TODO(v9): This was left for backward-compatibility and can be removed.
      */
     return <TRequest extends Record<string, any> = any, TResponse = any>(
       req: TRequest,
@@ -353,6 +352,47 @@ export class RouterExplorer {
       if (versioningOptions.type === VersioningType.URI) {
         return handler(req, res, next);
       }
+
+      // Custom Extractor Versioning Handler
+      if (versioningOptions.type === VersioningType.CUSTOM) {
+        const extractedVersion = versioningOptions.extractor(req) as
+          | string
+          | string[]
+          | Array<string | symbol>;
+
+        if (Array.isArray(version)) {
+          if (
+            Array.isArray(extractedVersion) &&
+            version.filter(
+              extractedVersion.includes as (
+                value: string | symbol,
+                index: number,
+                array: Array<string | symbol>,
+              ) => boolean,
+            ).length
+          ) {
+            return handler(req, res, next);
+          } else if (
+            isString(extractedVersion) &&
+            version.includes(extractedVersion)
+          ) {
+            return handler(req, res, next);
+          }
+        } else {
+          if (
+            Array.isArray(extractedVersion) &&
+            extractedVersion.includes(version)
+          ) {
+            return handler(req, res, next);
+          } else if (
+            isString(extractedVersion) &&
+            version === extractedVersion
+          ) {
+            return handler(req, res, next);
+          }
+        }
+      }
+
       // Media Type (Accept Header) Versioning Handler
       if (versioningOptions.type === VersioningType.MEDIA_TYPE) {
         const MEDIA_TYPE_HEADER = 'Accept';
@@ -362,9 +402,16 @@ export class RouterExplorer {
 
         const acceptHeaderVersionParameter = acceptHeaderValue
           ? acceptHeaderValue.split(';')[1]
-          : '';
+          : undefined;
 
-        if (acceptHeaderVersionParameter) {
+        // No version was supplied
+        if (isUndefined(acceptHeaderVersionParameter)) {
+          if (Array.isArray(version)) {
+            if (version.includes(VERSION_NEUTRAL)) {
+              return handler(req, res, next);
+            }
+          }
+        } else {
           const headerVersion = acceptHeaderVersionParameter.split(
             versioningOptions.key,
           )[1];
@@ -386,7 +433,14 @@ export class RouterExplorer {
           req.headers?.[versioningOptions.header] ||
           req.headers?.[versioningOptions.header.toLowerCase()];
 
-        if (customHeaderVersionParameter) {
+        // No version was supplied
+        if (isUndefined(customHeaderVersionParameter)) {
+          if (Array.isArray(version)) {
+            if (version.includes(VERSION_NEUTRAL)) {
+              return handler(req, res, next);
+            }
+          }
+        } else {
           if (Array.isArray(version)) {
             if (version.includes(customHeaderVersionParameter)) {
               return handler(req, res, next);
diff --git a/packages/core/router/router-response-controller.ts b/packages/core/router/router-response-controller.ts
index 008eea5a8..4128e7fca 100644
--- a/packages/core/router/router-response-controller.ts
+++ b/packages/core/router/router-response-controller.ts
@@ -5,9 +5,9 @@ import {
   RequestMethod,
   MessageEvent,
 } from '@nestjs/common';
-import { isFunction, isObject } from '@nestjs/common/utils/shared.utils';
+import { isObject } from '@nestjs/common/utils/shared.utils';
 import { IncomingMessage } from 'http';
-import { EMPTY, lastValueFrom, Observable } from 'rxjs';
+import { EMPTY, lastValueFrom, Observable, isObservable } from 'rxjs';
 import { catchError, debounce, map } from 'rxjs/operators';
 import {
   AdditionalHeaders,
@@ -64,7 +64,7 @@ export class RouterResponseController {
   }
 
   public async transformToResult(resultOrDeferred: any) {
-    if (resultOrDeferred && isFunction(resultOrDeferred.subscribe)) {
+    if (isObservable(resultOrDeferred)) {
       return lastValueFrom(resultOrDeferred);
     }
     return resultOrDeferred;
@@ -152,8 +152,8 @@ export class RouterResponseController {
     });
   }
 
-  private assertObservable(result: any) {
-    if (!isFunction(result.subscribe)) {
+  private assertObservable(value: any) {
+    if (!isObservable(value)) {
       throw new ReferenceError(
         'You must return an Observable stream to use Server-Sent Events (SSE).',
       );
diff --git a/packages/core/scanner.ts b/packages/core/scanner.ts
index c318dba07..63d02a6c2 100644
--- a/packages/core/scanner.ts
+++ b/packages/core/scanner.ts
@@ -1,18 +1,17 @@
 import {
-  Abstract,
   DynamicModule,
   flatten,
   ForwardReference,
-  Provider,
   Logger,
+  Provider,
 } from '@nestjs/common';
 import {
+  CATCH_WATERMARK,
+  CONTROLLER_WATERMARK,
   EXCEPTION_FILTERS_METADATA,
   GUARDS_METADATA,
-  INTERCEPTORS_METADATA,
   INJECTABLE_WATERMARK,
-  CONTROLLER_WATERMARK,
-  CATCH_WATERMARK,
+  INTERCEPTORS_METADATA,
   MODULE_METADATA,
   PIPES_METADATA,
   ROUTE_ARGS_METADATA,
@@ -23,6 +22,7 @@ import {
   ExceptionFilter,
   ExistingProvider,
   FactoryProvider,
+  InjectionToken,
   NestInterceptor,
   PipeTransform,
   Scope,
@@ -41,8 +41,8 @@ import { iterate } from 'iterare';
 import { ApplicationConfig } from './application-config';
 import { APP_FILTER, APP_GUARD, APP_INTERCEPTOR, APP_PIPE } from './constants';
 import { CircularDependencyException } from './errors/exceptions/circular-dependency.exception';
-import { InvalidModuleException } from './errors/exceptions/invalid-module.exception';
 import { InvalidClassModuleException } from './errors/exceptions/invalid-class-module.exception';
+import { InvalidModuleException } from './errors/exceptions/invalid-module.exception';
 import { UndefinedModuleException } from './errors/exceptions/undefined-module.exception';
 import { getClassScope } from './helpers/get-class-scope';
 import { NestContainer } from './injector/container';
@@ -54,7 +54,7 @@ import { MetadataScanner } from './metadata-scanner';
 interface ApplicationProviderWrapper {
   moduleKey: string;
   providerKey: string;
-  type: string | symbol | Type<any> | Abstract<any> | Function;
+  type: InjectionToken;
   scope?: Scope;
 }
 
diff --git a/packages/core/test/injector/injector.spec.ts b/packages/core/test/injector/injector.spec.ts
index 8c7d54c2e..3a1068afc 100644
--- a/packages/core/test/injector/injector.spec.ts
+++ b/packages/core/test/injector/injector.spec.ts
@@ -1,3 +1,4 @@
+import { Optional } from '@nestjs/common';
 import * as chai from 'chai';
 import { expect } from 'chai';
 import * as chaiAsPromised from 'chai-as-promised';
@@ -803,4 +804,105 @@ describe('Injector', () => {
       expect(loadPropertiesMetadataSpy.called).to.be.true;
     });
   });
+
+  describe('getClassDependencies', () => {
+    it('should return an array that consists of deps and optional dep ids', async () => {
+      class FixtureDep1 {}
+      class FixtureDep2 {}
+
+      @Injectable()
+      class FixtureClass {
+        constructor(
+          private dep1: FixtureDep1,
+          @Optional() private dep2: FixtureDep2,
+        ) {}
+      }
+
+      const wrapper = new InstanceWrapper({ metatype: FixtureClass });
+      const [dependencies, optionalDependenciesIds] =
+        injector.getClassDependencies(wrapper);
+
+      expect(dependencies).to.deep.eq([FixtureDep1, FixtureDep2]);
+      expect(optionalDependenciesIds).to.deep.eq([1]);
+    });
+  });
+
+  describe('getFactoryProviderDependencies', () => {
+    it('should return an array that consists of deps and optional dep ids', async () => {
+      class FixtureDep1 {}
+      class FixtureDep2 {}
+
+      const wrapper = new InstanceWrapper({
+        inject: [
+          FixtureDep1,
+          { token: FixtureDep2, optional: true },
+          { token: FixtureDep2, optional: false },
+          {} as any,
+        ],
+      });
+      const [dependencies, optionalDependenciesIds] =
+        injector.getFactoryProviderDependencies(wrapper);
+
+      expect(dependencies).to.deep.eq([
+        FixtureDep1,
+        FixtureDep2,
+        FixtureDep2,
+        {},
+      ]);
+      expect(optionalDependenciesIds).to.deep.eq([1]);
+    });
+  });
+
+  describe('addDependencyMetadata', () => {
+    interface IInjector extends Omit<Injector, 'addDependencyMetadata'> {
+      addDependencyMetadata: (
+        keyOrIndex: symbol | string | number,
+        hostWrapper: InstanceWrapper,
+        instanceWrapper: InstanceWrapper,
+      ) => void;
+    }
+
+    let exposedInjector: IInjector;
+    let hostWrapper: InstanceWrapper;
+    let instanceWrapper: InstanceWrapper;
+
+    beforeEach(() => {
+      exposedInjector = injector as unknown as IInjector;
+      hostWrapper = new InstanceWrapper();
+      instanceWrapper = new InstanceWrapper();
+    });
+
+    it('should add dependency metadata to PropertiesMetadata when key is symbol', async () => {
+      const addPropertiesMetadataSpy = sinon.spy(
+        hostWrapper,
+        'addPropertiesMetadata',
+      );
+
+      const key = Symbol.for('symbol');
+      exposedInjector.addDependencyMetadata(key, hostWrapper, instanceWrapper);
+
+      expect(addPropertiesMetadataSpy.called).to.be.true;
+    });
+
+    it('should add dependency metadata to PropertiesMetadata when key is string', async () => {
+      const addPropertiesMetadataSpy = sinon.spy(
+        hostWrapper,
+        'addPropertiesMetadata',
+      );
+
+      const key = 'string';
+      exposedInjector.addDependencyMetadata(key, hostWrapper, instanceWrapper);
+
+      expect(addPropertiesMetadataSpy.called).to.be.true;
+    });
+
+    it('should add dependency metadata to CtorMetadata when key is number', async () => {
+      const addCtorMetadataSpy = sinon.spy(hostWrapper, 'addCtorMetadata');
+
+      const key = 0;
+      exposedInjector.addDependencyMetadata(key, hostWrapper, instanceWrapper);
+
+      expect(addCtorMetadataSpy.called).to.be.true;
+    });
+  });
 });
diff --git a/packages/core/test/nest-application-context.spec.ts b/packages/core/test/nest-application-context.spec.ts
new file mode 100644
index 000000000..10f9659c8
--- /dev/null
+++ b/packages/core/test/nest-application-context.spec.ts
@@ -0,0 +1,263 @@
+import { expect } from 'chai';
+import { InjectionToken, Logger, Scope } from '@nestjs/common';
+import { ContextIdFactory } from '../helpers/context-id-factory';
+import { InstanceLoader } from '../injector/instance-loader';
+import { NestContainer } from '../injector/container';
+import { NestApplicationContext } from '../nest-application-context';
+
+describe('NestApplicationContext', () => {
+  class A {}
+
+  async function testHelper(
+    injectionKey: InjectionToken,
+    scope: Scope,
+  ): Promise<NestApplicationContext> {
+    const nestContainer = new NestContainer();
+    const instanceLoader = new InstanceLoader(nestContainer);
+    const module = await nestContainer.addModule(class T {}, []);
+
+    nestContainer.addProvider(
+      {
+        provide: injectionKey,
+        useClass: A,
+        scope,
+      },
+      module.token,
+    );
+
+    nestContainer.addInjectable(
+      {
+        provide: injectionKey,
+        useClass: A,
+        scope,
+      },
+      module.token,
+    );
+
+    const modules = nestContainer.getModules();
+    await instanceLoader.createInstancesOfDependencies(modules);
+
+    const applicationContext = new NestApplicationContext(nestContainer, []);
+    return applicationContext;
+  }
+
+  describe('get', () => {
+    describe('when scope = DEFAULT', () => {
+      it('should get value with function injection key', async () => {
+        const key = A;
+        const applicationContext = await testHelper(key, Scope.DEFAULT);
+
+        const a1: A = await applicationContext.get(key);
+        const a2: A = await applicationContext.get(key);
+
+        expect(a1).instanceOf(A);
+        expect(a2).instanceOf(A);
+        expect(a1).equal(a2);
+      });
+
+      it('should get value with string injection key', async () => {
+        const key = 'KEY_A';
+        const applicationContext = await testHelper(key, Scope.DEFAULT);
+
+        const a1: A = await applicationContext.get(key);
+        const a2: A = await applicationContext.get(key);
+
+        expect(a1).instanceOf(A);
+        expect(a2).instanceOf(A);
+        expect(a1).equal(a2);
+      });
+
+      it('should get value with symbol injection key', async () => {
+        const key = Symbol('KEY_A');
+        const applicationContext = await testHelper(key, Scope.DEFAULT);
+
+        const a1: A = await applicationContext.get(key);
+        const a2: A = await applicationContext.get(key);
+
+        expect(a1).instanceOf(A);
+        expect(a2).instanceOf(A);
+        expect(a1).equal(a2);
+      });
+    });
+
+    describe('when scope = REQUEST', () => {
+      it('should throw error when use function injection key', async () => {
+        const key = A;
+        const applicationContext = await testHelper(key, Scope.REQUEST);
+
+        expect(() => applicationContext.get(key)).to.be.throw;
+      });
+
+      it('should throw error when use string injection key', async () => {
+        const key = 'KEY_A';
+        const applicationContext = await testHelper(key, Scope.REQUEST);
+
+        expect(() => applicationContext.get(key)).to.be.throw;
+      });
+
+      it('should throw error when use symbol injection key', async () => {
+        const key = Symbol('KEY_A');
+        const applicationContext = await testHelper(key, Scope.REQUEST);
+
+        expect(() => applicationContext.get(key)).to.be.throw;
+      });
+    });
+
+    describe('when scope = TRANSIENT', () => {
+      it('should throw error when use function injection key', async () => {
+        const key = A;
+        const applicationContext = await testHelper(key, Scope.TRANSIENT);
+
+        expect(() => applicationContext.get(key)).to.be.throw;
+      });
+
+      it('should throw error when use string injection key', async () => {
+        const key = 'KEY_A';
+        const applicationContext = await testHelper(key, Scope.TRANSIENT);
+
+        expect(() => applicationContext.get(key)).to.be.throw;
+      });
+
+      it('should throw error when use symbol injection key', async () => {
+        const key = Symbol('KEY_A');
+        const applicationContext = await testHelper(key, Scope.TRANSIENT);
+
+        expect(() => applicationContext.get(key)).to.be.throw;
+      });
+    });
+  });
+
+  describe('resolve', () => {
+    describe('when scope = DEFAULT', () => {
+      it('should resolve value with function injection key', async () => {
+        const key = A;
+        const applicationContext = await testHelper(key, Scope.DEFAULT);
+
+        const a1: A = await applicationContext.resolve(key);
+        const a2: A = await applicationContext.resolve(key);
+
+        expect(a1).instanceOf(A);
+        expect(a2).instanceOf(A);
+        expect(a1).equal(a2);
+      });
+
+      it('should resolve value with string injection key', async () => {
+        const key = 'KEY_A';
+        const applicationContext = await testHelper(key, Scope.DEFAULT);
+
+        const a1: A = await applicationContext.resolve(key);
+        const a2: A = await applicationContext.resolve(key);
+
+        expect(a1).instanceOf(A);
+        expect(a2).instanceOf(A);
+        expect(a1).equal(a2);
+      });
+
+      it('should resolve value with symbol injection key', async () => {
+        const key = Symbol('KEY_A');
+        const applicationContext = await testHelper(key, Scope.DEFAULT);
+
+        const a1: A = await applicationContext.resolve(key);
+        const a2: A = await applicationContext.resolve(key);
+
+        expect(a1).instanceOf(A);
+        expect(a2).instanceOf(A);
+        expect(a1).equal(a2);
+      });
+    });
+
+    describe('when scope = REQUEST', () => {
+      it('should resolve value with function injection key', async () => {
+        const key = A;
+        const applicationContext = await testHelper(key, Scope.REQUEST);
+
+        const contextId = ContextIdFactory.create();
+        const a1: A = await applicationContext.resolve(key);
+        const a2: A = await applicationContext.resolve(key, contextId);
+        const a3: A = await applicationContext.resolve(key, contextId);
+
+        expect(a1).instanceOf(A);
+        expect(a2).instanceOf(A);
+        expect(a1).not.equal(a2);
+        expect(a2).equal(a3);
+      });
+
+      it('should resolve value with string injection key', async () => {
+        const key = 'KEY_A';
+        const applicationContext = await testHelper(key, Scope.REQUEST);
+
+        const contextId = ContextIdFactory.create();
+        const a1: A = await applicationContext.resolve(key);
+        const a2: A = await applicationContext.resolve(key, contextId);
+        const a3: A = await applicationContext.resolve(key, contextId);
+
+        expect(a1).instanceOf(A);
+        expect(a2).instanceOf(A);
+        expect(a1).not.equal(a2);
+        expect(a2).equal(a3);
+      });
+
+      it('should resolve value with symbol injection key', async () => {
+        const key = Symbol('KEY_A');
+        const applicationContext = await testHelper(key, Scope.REQUEST);
+
+        const contextId = ContextIdFactory.create();
+        const a1: A = await applicationContext.resolve(key);
+        const a2: A = await applicationContext.resolve(key, contextId);
+        const a3: A = await applicationContext.resolve(key, contextId);
+
+        expect(a1).instanceOf(A);
+        expect(a2).instanceOf(A);
+        expect(a1).not.equal(a2);
+        expect(a2).equal(a3);
+      });
+    });
+
+    describe('when scope = TRANSIENT', () => {
+      it('should resolve value with function injection key', async () => {
+        const key = A;
+        const applicationContext = await testHelper(key, Scope.TRANSIENT);
+
+        const contextId = ContextIdFactory.create();
+        const a1: A = await applicationContext.resolve(key);
+        const a2: A = await applicationContext.resolve(key, contextId);
+        const a3: A = await applicationContext.resolve(key, contextId);
+
+        expect(a1).instanceOf(A);
+        expect(a2).instanceOf(A);
+        expect(a1).not.equal(a2);
+        expect(a2).equal(a3);
+      });
+
+      it('should resolve value with string injection key', async () => {
+        const key = 'KEY_A';
+        const applicationContext = await testHelper(key, Scope.TRANSIENT);
+
+        const contextId = ContextIdFactory.create();
+        const a1: A = await applicationContext.resolve(key);
+        const a2: A = await applicationContext.resolve(key, contextId);
+        const a3: A = await applicationContext.resolve(key, contextId);
+
+        expect(a1).instanceOf(A);
+        expect(a2).instanceOf(A);
+        expect(a1).not.equal(a2);
+        expect(a2).equal(a3);
+      });
+
+      it('should resolve value with symbol injection key', async () => {
+        const key = Symbol('KEY_A');
+        const applicationContext = await testHelper(key, Scope.TRANSIENT);
+
+        const contextId = ContextIdFactory.create();
+        const a1: A = await applicationContext.resolve(key);
+        const a2: A = await applicationContext.resolve(key, contextId);
+        const a3: A = await applicationContext.resolve(key, contextId);
+
+        expect(a1).instanceOf(A);
+        expect(a2).instanceOf(A);
+        expect(a1).not.equal(a2);
+        expect(a2).equal(a3);
+      });
+    });
+  });
+});
diff --git a/packages/core/test/router/router-explorer.spec.ts b/packages/core/test/router/router-explorer.spec.ts
index f8da6c375..5f5343210 100644
--- a/packages/core/test/router/router-explorer.spec.ts
+++ b/packages/core/test/router/router-explorer.spec.ts
@@ -365,38 +365,38 @@ describe('RouterExplorer', () => {
   });
 
   describe('applyVersionFilter', () => {
-    describe('when the version is VERSION_NEUTRAL', () => {
-      it('should return the handler', () => {
-        const version = VERSION_NEUTRAL as VersionValue;
-        const versioningOptions: VersioningOptions = {
-          type: VersioningType.URI,
-        };
-        const handler = sinon.stub();
+    describe('when the versioning type is URI', () => {
+      describe('and the version is VERSION_NEUTRAL', () => {
+        it('should return the handler', () => {
+          const version: VersionValue = VERSION_NEUTRAL;
+          const versioningOptions: RoutePathMetadata['versioningOptions'] = {
+            type: VersioningType.URI,
+          };
+          const handler = sinon.stub();
 
-        const routePathMetadata: RoutePathMetadata = {
-          methodVersion: version,
-          versioningOptions,
-        };
-        const versionFilter = (routerBuilder as any).applyVersionFilter(
-          null,
-          routePathMetadata,
-          handler,
-        );
+          const routePathMetadata: RoutePathMetadata = {
+            methodVersion: version,
+            versioningOptions,
+          };
+          const versionFilter = (routerBuilder as any).applyVersionFilter(
+            null,
+            routePathMetadata,
+            handler,
+          );
 
-        const req = {};
-        const res = {};
-        const next = sinon.stub();
+          const req = {};
+          const res = {};
+          const next = sinon.stub();
 
-        versionFilter(req, res, next);
+          versionFilter(req, res, next);
 
-        expect(handler.calledWith(req, res, next)).to.be.true;
+          expect(handler.calledWith(req, res, next)).to.be.true;
+        });
       });
-    });
 
-    describe('when the versioning type is URI', () => {
       it('should return the handler', () => {
         const version = '1';
-        const versioningOptions: VersioningOptions = {
+        const versioningOptions: RoutePathMetadata['versioningOptions'] = {
           type: VersioningType.URI,
         };
         const handler = sinon.stub();
@@ -423,7 +423,7 @@ describe('RouterExplorer', () => {
     describe('when the versioning type is MEDIA_TYPE', () => {
       it('should return next if there is no Media Type header', () => {
         const version = '1';
-        const versioningOptions: VersioningOptions = {
+        const versioningOptions: RoutePathMetadata['versioningOptions'] = {
           type: VersioningType.MEDIA_TYPE,
           key: 'v=',
         };
@@ -450,7 +450,7 @@ describe('RouterExplorer', () => {
 
       it('should return next if there is no version in the Media Type header', () => {
         const version = '1';
-        const versioningOptions: VersioningOptions = {
+        const versioningOptions: RoutePathMetadata['versioningOptions'] = {
           type: VersioningType.MEDIA_TYPE,
           key: 'v=',
         };
@@ -476,9 +476,64 @@ describe('RouterExplorer', () => {
       });
 
       describe('when the handler version is an array', () => {
+        describe('and the version has VERSION_NEUTRAL', () => {
+          it('should return the handler if there is no version in the Media Type header', () => {
+            const version: VersionValue = [VERSION_NEUTRAL];
+            const versioningOptions: RoutePathMetadata['versioningOptions'] = {
+              type: VersioningType.MEDIA_TYPE,
+              key: 'v=',
+            };
+            const handler = sinon.stub();
+
+            const routePathMetadata: RoutePathMetadata = {
+              methodVersion: version,
+              versioningOptions,
+            };
+            const versionFilter = (routerBuilder as any).applyVersionFilter(
+              null,
+              routePathMetadata,
+              handler,
+            );
+
+            const req = {};
+            const res = {};
+            const next = sinon.stub();
+
+            versionFilter(req, res, next);
+
+            expect(handler.calledWith(req, res, next)).to.be.true;
+          });
+          it('should return next if the version in the Media Type header does not match the handler version', () => {
+            const version: VersionValue = ['1', '2', VERSION_NEUTRAL];
+            const versioningOptions: RoutePathMetadata['versioningOptions'] = {
+              type: VersioningType.MEDIA_TYPE,
+              key: 'v=',
+            };
+            const handler = sinon.stub();
+
+            const routePathMetadata: RoutePathMetadata = {
+              methodVersion: version,
+              versioningOptions,
+            };
+            const versionFilter = (routerBuilder as any).applyVersionFilter(
+              null,
+              routePathMetadata,
+              handler,
+            );
+
+            const req = { headers: { accept: 'application/json;v=3' } };
+            const res = {};
+            const next = sinon.stub();
+
+            versionFilter(req, res, next);
+
+            expect(next.called).to.be.true;
+          });
+        });
+
         it('should return next if the version in the Media Type header does not match the handler version', () => {
           const version = ['1', '2'];
-          const versioningOptions: VersioningOptions = {
+          const versioningOptions: RoutePathMetadata['versioningOptions'] = {
             type: VersioningType.MEDIA_TYPE,
             key: 'v=',
           };
@@ -505,7 +560,7 @@ describe('RouterExplorer', () => {
 
         it('should return the handler if the version in the Media Type header matches the handler version', () => {
           const version = ['1', '2'];
-          const versioningOptions: VersioningOptions = {
+          const versioningOptions: RoutePathMetadata['versioningOptions'] = {
             type: VersioningType.MEDIA_TYPE,
             key: 'v=',
           };
@@ -534,7 +589,7 @@ describe('RouterExplorer', () => {
       describe('when the handler version is a string', () => {
         it('should return next if the version in the Media Type header does not match the handler version', () => {
           const version = '1';
-          const versioningOptions: VersioningOptions = {
+          const versioningOptions: RoutePathMetadata['versioningOptions'] = {
             type: VersioningType.MEDIA_TYPE,
             key: 'v=',
           };
@@ -561,7 +616,7 @@ describe('RouterExplorer', () => {
 
         it('should return the handler if the version in the Media Type header matches the handler version', () => {
           const version = '1';
-          const versioningOptions: VersioningOptions = {
+          const versioningOptions: RoutePathMetadata['versioningOptions'] = {
             type: VersioningType.MEDIA_TYPE,
             key: 'v=',
           };
@@ -588,10 +643,186 @@ describe('RouterExplorer', () => {
       });
     });
 
+    describe('when the versioning type is CUSTOM', () => {
+      const extractor = (request: { headers: { accept?: string } }) => {
+        const match = request.headers.accept?.match(/v(\d+\.?\d*)\+json$/);
+        if (match) {
+          return match[1];
+        }
+        return null;
+      };
+
+      it('should return next if there is no pertinent request object', () => {
+        const version = '1';
+        const versioningOptions: VersioningOptions = {
+          type: VersioningType.CUSTOM,
+          extractor,
+        };
+        const handler = sinon.stub();
+
+        const routePathMetadata: RoutePathMetadata = {
+          methodVersion: version,
+          versioningOptions,
+        };
+        const versionFilter = (routerBuilder as any).applyVersionFilter(
+          null,
+          routePathMetadata,
+          handler,
+        );
+
+        const req = { headers: {} };
+        const res = {};
+        const next = sinon.stub();
+
+        versionFilter(req, res, next);
+
+        expect(next.called).to.be.true;
+      });
+
+      it('should return next if there is no version in the request object value', () => {
+        const version = '1';
+        const versioningOptions: VersioningOptions = {
+          type: VersioningType.CUSTOM,
+          extractor,
+        };
+        const handler = sinon.stub();
+
+        const routePathMetadata: RoutePathMetadata = {
+          methodVersion: version,
+          versioningOptions,
+        };
+        const versionFilter = (routerBuilder as any).applyVersionFilter(
+          null,
+          routePathMetadata,
+          handler,
+        );
+
+        const req = { headers: { accept: 'application/json;' } };
+        const res = {};
+        const next = sinon.stub();
+
+        versionFilter(req, res, next);
+
+        expect(next.called).to.be.true;
+      });
+
+      describe('when the handler version is an array', () => {
+        it('should return next if the version in the request object value does not match the handler version', () => {
+          const version = ['1', '2'];
+          const versioningOptions: VersioningOptions = {
+            type: VersioningType.CUSTOM,
+            extractor,
+          };
+          const handler = sinon.stub();
+
+          const routePathMetadata: RoutePathMetadata = {
+            methodVersion: version,
+            versioningOptions,
+          };
+          const versionFilter = (routerBuilder as any).applyVersionFilter(
+            null,
+            routePathMetadata,
+            handler,
+          );
+
+          const req = { headers: { accept: 'application/foo.v3+json' } };
+          const res = {};
+          const next = sinon.stub();
+
+          versionFilter(req, res, next);
+
+          expect(next.called).to.be.true;
+        });
+
+        it('should return the handler if the version in the request object value matches the handler version', () => {
+          const version = ['1', '2'];
+          const versioningOptions: VersioningOptions = {
+            type: VersioningType.CUSTOM,
+            extractor,
+          };
+          const handler = sinon.stub();
+
+          const routePathMetadata: RoutePathMetadata = {
+            methodVersion: version,
+            versioningOptions,
+          };
+          const versionFilter = (routerBuilder as any).applyVersionFilter(
+            null,
+            routePathMetadata,
+            handler,
+          );
+
+          const req = { headers: { accept: 'application/foo.v2+json' } };
+          const res = {};
+          const next = sinon.stub();
+
+          versionFilter(req, res, next);
+
+          expect(handler.calledWith(req, res, next)).to.be.true;
+        });
+      });
+
+      describe('when the handler version is a string', () => {
+        it('should return next if the version in the request object value does not match the handler version', () => {
+          const version = '1';
+          const versioningOptions: VersioningOptions = {
+            type: VersioningType.CUSTOM,
+            extractor,
+          };
+          const handler = sinon.stub();
+
+          const routePathMetadata: RoutePathMetadata = {
+            methodVersion: version,
+            versioningOptions,
+          };
+          const versionFilter = (routerBuilder as any).applyVersionFilter(
+            null,
+            routePathMetadata,
+            handler,
+          );
+
+          const req = { headers: { accept: 'application/foo.v2+json' } };
+          const res = {};
+          const next = sinon.stub();
+
+          versionFilter(req, res, next);
+
+          expect(next.called).to.be.true;
+        });
+
+        it('should return the handler if the version in the request object value matches the handler version', () => {
+          const version = '1';
+          const versioningOptions: VersioningOptions = {
+            type: VersioningType.CUSTOM,
+            extractor,
+          };
+          const handler = sinon.stub();
+
+          const routePathMetadata: RoutePathMetadata = {
+            methodVersion: version,
+            versioningOptions,
+          };
+          const versionFilter = (routerBuilder as any).applyVersionFilter(
+            null,
+            routePathMetadata,
+            handler,
+          );
+
+          const req = { headers: { accept: 'application/foo.v1+json' } };
+          const res = {};
+          const next = sinon.stub();
+
+          versionFilter(req, res, next);
+
+          expect(handler.calledWith(req, res, next)).to.be.true;
+        });
+      });
+    });
+
     describe('when the versioning type is HEADER', () => {
       it('should return next if there is no Custom Header', () => {
         const version = '1';
-        const versioningOptions: VersioningOptions = {
+        const versioningOptions: RoutePathMetadata['versioningOptions'] = {
           type: VersioningType.HEADER,
           header: 'X-API-Version',
         };
@@ -618,7 +849,7 @@ describe('RouterExplorer', () => {
 
       it('should return next if there is no version in the Custom Header', () => {
         const version = '1';
-        const versioningOptions: VersioningOptions = {
+        const versioningOptions: RoutePathMetadata['versioningOptions'] = {
           type: VersioningType.HEADER,
           header: 'X-API-Version',
         };
@@ -644,9 +875,64 @@ describe('RouterExplorer', () => {
       });
 
       describe('when the handler version is an array', () => {
+        describe('and the version has VERSION_NEUTRAL', () => {
+          it('should return the handler if there is no version in the Custom Header', () => {
+            const version: VersionValue = [VERSION_NEUTRAL];
+            const versioningOptions: RoutePathMetadata['versioningOptions'] = {
+              type: VersioningType.HEADER,
+              header: 'X-API-Version',
+            };
+            const handler = sinon.stub();
+
+            const routePathMetadata: RoutePathMetadata = {
+              methodVersion: version,
+              versioningOptions,
+            };
+            const versionFilter = (routerBuilder as any).applyVersionFilter(
+              null,
+              routePathMetadata,
+              handler,
+            );
+
+            const req = {};
+            const res = {};
+            const next = sinon.stub();
+
+            versionFilter(req, res, next);
+
+            expect(handler.calledWith(req, res, next)).to.be.true;
+          });
+          it('should return next if the version in the Custom Header does not match the handler version', () => {
+            const version: VersionValue = ['1', '2', VERSION_NEUTRAL];
+            const versioningOptions: RoutePathMetadata['versioningOptions'] = {
+              type: VersioningType.HEADER,
+              header: 'X-API-Version',
+            };
+            const handler = sinon.stub();
+
+            const routePathMetadata: RoutePathMetadata = {
+              methodVersion: version,
+              versioningOptions,
+            };
+            const versionFilter = (routerBuilder as any).applyVersionFilter(
+              null,
+              routePathMetadata,
+              handler,
+            );
+
+            const req = { headers: { 'X-API-Version': '3' } };
+            const res = {};
+            const next = sinon.stub();
+
+            versionFilter(req, res, next);
+
+            expect(next.called).to.be.true;
+          });
+        });
+
         it('should return next if the version in the Custom Header does not match the handler version', () => {
           const version = ['1', '2'];
-          const versioningOptions: VersioningOptions = {
+          const versioningOptions: RoutePathMetadata['versioningOptions'] = {
             type: VersioningType.HEADER,
             header: 'X-API-Version',
           };
@@ -673,7 +959,7 @@ describe('RouterExplorer', () => {
 
         it('should return the handler if the version in the Custom Header matches the handler version', () => {
           const version = ['1', '2'];
-          const versioningOptions: VersioningOptions = {
+          const versioningOptions: RoutePathMetadata['versioningOptions'] = {
             type: VersioningType.HEADER,
             header: 'X-API-Version',
           };
@@ -702,7 +988,7 @@ describe('RouterExplorer', () => {
       describe('when the handler version is a string', () => {
         it('should return next if the version in the Custom Header does not match the handler version', () => {
           const version = '1';
-          const versioningOptions: VersioningOptions = {
+          const versioningOptions: RoutePathMetadata['versioningOptions'] = {
             type: VersioningType.HEADER,
             header: 'X-API-Version',
           };
@@ -729,7 +1015,7 @@ describe('RouterExplorer', () => {
 
         it('should return the handler if the version in the Custom Header matches the handler version', () => {
           const version = '1';
-          const versioningOptions: VersioningOptions = {
+          const versioningOptions: RoutePathMetadata['versioningOptions'] = {
             type: VersioningType.HEADER,
             header: 'X-API-Version',
           };
diff --git a/packages/core/test/router/router-response-controller.spec.ts b/packages/core/test/router/router-response-controller.spec.ts
index ebe155639..fbc3d3490 100644
--- a/packages/core/test/router/router-response-controller.spec.ts
+++ b/packages/core/test/router/router-response-controller.spec.ts
@@ -71,13 +71,13 @@ describe('RouterResponseController', () => {
   describe('transformToResult', () => {
     describe('when resultOrDeferred', () => {
       describe('is Promise', () => {
-        it('should return Promise', async () => {
+        it('should return Promise that resolves to the value resolved by the input Promise', async () => {
           const value = 100;
           expect(
             await routerResponseController.transformToResult(
               Promise.resolve(value),
             ),
-          ).to.be.eq(100);
+          ).to.be.eq(value);
         });
       });
 
@@ -88,16 +88,25 @@ describe('RouterResponseController', () => {
             await routerResponseController.transformToResult(
               of(1, 2, 3, lastValue),
             ),
-          ).to.be.eq(100);
+          ).to.be.eq(lastValue);
         });
       });
 
-      describe('is value', () => {
-        it('should return Promise', async () => {
+      describe('is an object that has the method `subscribe`', () => {
+        it('should return a Promise that resolves to the input value', async () => {
+          const value = { subscribe() {} };
+          expect(
+            await routerResponseController.transformToResult(value),
+          ).to.equal(value);
+        });
+      });
+
+      describe('is an ordinary value', () => {
+        it('should return a Promise that resolves to the input value', async () => {
           const value = 100;
           expect(
             await routerResponseController.transformToResult(value),
-          ).to.be.eq(100);
+          ).to.be.eq(value);
         });
       });
     });
diff --git a/packages/microservices/Readme.md b/packages/microservices/Readme.md
index 772d0077a..a5e43201d 100644
--- a/packages/microservices/Readme.md
+++ b/packages/microservices/Readme.md
@@ -54,7 +54,7 @@ With official support, you can get expert help straight from Nest core team. We
 
 ## Support
 
-Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support by the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).
+Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support from the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).
 
 #### Principal Sponsors
 <table style="text-align:center;"><tr>
@@ -64,17 +64,20 @@ Nest is an MIT-licensed open source project. It can grow thanks to the sponsors
 <a href="https://github.com/Sanofi-IADC" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/sanofi.png" width="180" valign="middle" /></a></td>
 <td>
 <a href="https://nx.dev" target="_blank"><img src="https://nestjs.com/img/nx-logo.png" height="45" valign="middle" /></a></td>
+    <td>
+<a href="https://valor-software.com/" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/valor-software.png" width="170" valign="middle" /></a></td>
 </tr></table>
 
 #### Gold Sponsors
 
 <table style="text-align:center;"><tr><td>
   <a href="https://careers.labster.com/departments/platform" target="_blank"><img src="https://nestjs.com/img/labster-logo.png" width="170" valign="middle" /></a></td><td>
-<a href="https://weld.app/" target="_blank"><img src="https://nestjs.com/img/weld-logo.svg" width="150" valign="middle" /></a></td>
-  <td>
-<a href="https://valor-software.com/" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/valor-software.png" width="170" valign="middle" /></a></td>
+<a href="https://weld.app/" target="_blank"><img src="https://nestjs.com/img/weld-logo.svg" width="140" valign="middle" /></a></td>
 <td>
-<a href="https://intrinsic.ventures/" target="_blank"><img src="https://nestjs.com/img/intrinisic-logo.png" width="210" valign="middle" /></a></td></</tr></table>
+<a href="https://intrinsic.ventures/" target="_blank"><img src="https://nestjs.com/img/intrinisic-logo.png" width="210" valign="middle" /></a></td>
+ <td>
+<a href="https://jetbrains.com/" target="_blank"><img src="https://nestjs.com/img/jetbrains-logo.svg" width="110" valign="middle" /></a></td><td>
+<a href="https://snyk.co/nestjs" target="_blank"><img src="https://nestjs.com/img/snyk-logo-black.png" width="185" valign="middle" /></a></td></</tr></table>
 
 #### Silver Sponsors
 
diff --git a/packages/microservices/client/client-kafka.ts b/packages/microservices/client/client-kafka.ts
index 99c85e53f..2715d5ed7 100644
--- a/packages/microservices/client/client-kafka.ts
+++ b/packages/microservices/client/client-kafka.ts
@@ -19,6 +19,7 @@ import {
   KafkaConfig,
   KafkaMessage,
   Producer,
+  TopicPartitionOffsetAndMetadata,
 } from '../external/kafka.interface';
 import {
   KafkaLogger,
@@ -191,7 +192,9 @@ export class ClientKafka extends ClientProxy {
 
   protected async dispatchEvent(packet: OutgoingEvent): Promise<any> {
     const pattern = this.normalizePattern(packet.pattern);
-    const outgoingEvent = await this.serializer.serialize(packet.data);
+    const outgoingEvent = await this.serializer.serialize(packet.data, {
+      pattern,
+    });
     const message = Object.assign(
       {
         topic: pattern,
@@ -231,7 +234,7 @@ export class ClientKafka extends ClientProxy {
       const replyTopic = this.getResponsePatternName(pattern);
       const replyPartition = this.getReplyTopicPartition(replyTopic);
 
-      Promise.resolve(this.serializer.serialize(packet.data))
+      Promise.resolve(this.serializer.serialize(packet.data, { pattern }))
         .then((serializedPacket: KafkaRequest) => {
           serializedPacket.headers[KafkaHeaders.CORRELATION_ID] = packet.id;
           serializedPacket.headers[KafkaHeaders.REPLY_TOPIC] = replyTopic;
@@ -284,4 +287,14 @@ export class ClientKafka extends ClientProxy {
     this.deserializer =
       (options && options.deserializer) || new KafkaResponseDeserializer();
   }
+
+  public commitOffsets(
+    topicPartitions: TopicPartitionOffsetAndMetadata[],
+  ): Promise<void> {
+    if (this.consumer) {
+      return this.consumer.commitOffsets(topicPartitions);
+    } else {
+      throw new Error('No consumer initialized');
+    }
+  }
 }
diff --git a/packages/microservices/client/client-mqtt.ts b/packages/microservices/client/client-mqtt.ts
index 8797b56f8..44cf246b1 100644
--- a/packages/microservices/client/client-mqtt.ts
+++ b/packages/microservices/client/client-mqtt.ts
@@ -174,11 +174,14 @@ export class ClientMqtt extends ClientProxy {
     const serializedPacket: ReadPacket & Partial<MqttRecord> =
       this.serializer.serialize(packet);
 
+    const options = serializedPacket.options;
+    delete serializedPacket.options;
+
     return new Promise<void>((resolve, reject) =>
       this.mqttClient.publish(
         pattern,
         JSON.stringify(serializedPacket),
-        this.mergePacketOptions(serializedPacket.options),
+        this.mergePacketOptions(options),
         (err: any) => (err ? reject(err) : resolve()),
       ),
     );
diff --git a/packages/microservices/client/client-rmq.ts b/packages/microservices/client/client-rmq.ts
index 945b7d6d1..a8b1e64fd 100644
--- a/packages/microservices/client/client-rmq.ts
+++ b/packages/microservices/client/client-rmq.ts
@@ -3,7 +3,7 @@ import { loadPackage } from '@nestjs/common/utils/load-package.util';
 import { randomStringGenerator } from '@nestjs/common/utils/random-string-generator.util';
 import { EventEmitter } from 'events';
 import { EmptyError, fromEvent, lastValueFrom, merge, Observable } from 'rxjs';
-import { first, map, share, switchMap } from 'rxjs/operators';
+import { first, map, retryWhen, scan, share, switchMap } from 'rxjs/operators';
 import {
   CONNECT_FAILED_EVENT,
   DISCONNECTED_RMQ_MESSAGE,
@@ -118,7 +118,20 @@ export class ClientRMQ extends ClientProxy {
         }),
       );
     const disconnect$ = eventToError(DISCONNECT_EVENT);
-    const connectFailed$ = eventToError(CONNECT_FAILED_EVENT);
+
+    const urls = this.getOptionsProp(this.options, 'urls', []);
+    const connectFailed$ = eventToError(CONNECT_FAILED_EVENT).pipe(
+      retryWhen(e =>
+        e.pipe(
+          scan((errorCount, error: any) => {
+            if (urls.indexOf(error.url) >= urls.length - 1) {
+              throw error;
+            }
+            return errorCount + 1;
+          }, 0),
+        ),
+      ),
+    );
     return merge(source$, disconnect$, connectFailed$).pipe(first());
   }
 
@@ -222,14 +235,17 @@ export class ClientRMQ extends ClientProxy {
     const serializedPacket: ReadPacket & Partial<RmqRecord> =
       this.serializer.serialize(packet);
 
+    const options = serializedPacket.options;
+    delete serializedPacket.options;
+
     return new Promise<void>((resolve, reject) =>
       this.channel.sendToQueue(
         this.queue,
         Buffer.from(JSON.stringify(serializedPacket)),
         {
           persistent: this.persistent,
-          ...serializedPacket.options,
-          headers: this.mergeHeaders(serializedPacket.options?.headers),
+          ...options,
+          headers: this.mergeHeaders(options?.headers),
         },
         (err: unknown) => (err ? reject(err) : resolve()),
       ),
diff --git a/packages/microservices/client/client-tcp.ts b/packages/microservices/client/client-tcp.ts
index f16c6407c..840452c8f 100644
--- a/packages/microservices/client/client-tcp.ts
+++ b/packages/microservices/client/client-tcp.ts
@@ -1,4 +1,4 @@
-import { Logger } from '@nestjs/common';
+import { Logger, Type } from '@nestjs/common';
 import * as net from 'net';
 import { EmptyError, lastValueFrom } from 'rxjs';
 import { share, tap } from 'rxjs/operators';
@@ -10,7 +10,7 @@ import {
   TCP_DEFAULT_HOST,
   TCP_DEFAULT_PORT,
 } from '../constants';
-import { JsonSocket } from '../helpers/json-socket';
+import { JsonSocket, TcpSocket } from '../helpers';
 import { PacketId, ReadPacket, WritePacket } from '../interfaces';
 import { TcpClientOptions } from '../interfaces/client-metadata.interface';
 import { ClientProxy } from './client-proxy';
@@ -20,20 +20,23 @@ export class ClientTCP extends ClientProxy {
   private readonly logger = new Logger(ClientTCP.name);
   private readonly port: number;
   private readonly host: string;
+  private readonly socketClass: Type<TcpSocket>;
   private isConnected = false;
-  private socket: JsonSocket;
+  private socket: TcpSocket;
 
   constructor(options: TcpClientOptions['options']) {
     super();
     this.port = this.getOptionsProp(options, 'port') || TCP_DEFAULT_PORT;
     this.host = this.getOptionsProp(options, 'host') || TCP_DEFAULT_HOST;
+    this.socketClass =
+      this.getOptionsProp(options, 'socketClass') || JsonSocket;
 
     this.initializeSerializer(options);
     this.initializeDeserializer(options);
   }
 
   public connect(): Promise<any> {
-    if (this.isConnected && this.connection) {
+    if (this.connection) {
       return this.connection;
     }
     this.socket = this.createSocket();
@@ -80,8 +83,8 @@ export class ClientTCP extends ClientProxy {
     });
   }
 
-  public createSocket(): JsonSocket {
-    return new JsonSocket(new net.Socket());
+  public createSocket(): TcpSocket {
+    return new this.socketClass(new net.Socket());
   }
 
   public close() {
@@ -89,7 +92,7 @@ export class ClientTCP extends ClientProxy {
     this.handleClose();
   }
 
-  public bindEvents(socket: JsonSocket) {
+  public bindEvents(socket: TcpSocket) {
     socket.on(
       ERROR_EVENT,
       (err: any) => err.code !== ECONNREFUSED && this.handleError(err),
@@ -104,6 +107,7 @@ export class ClientTCP extends ClientProxy {
   public handleClose() {
     this.isConnected = false;
     this.socket = null;
+    this.connection = undefined;
   }
 
   protected publish(
diff --git a/packages/microservices/ctx-host/tcp.context.ts b/packages/microservices/ctx-host/tcp.context.ts
index a858ea442..1f1c6a28d 100644
--- a/packages/microservices/ctx-host/tcp.context.ts
+++ b/packages/microservices/ctx-host/tcp.context.ts
@@ -1,7 +1,7 @@
-import { JsonSocket } from '../helpers/json-socket';
+import { TcpSocket } from '../helpers';
 import { BaseRpcContext } from './base-rpc.context';
 
-type TcpContextArgs = [JsonSocket, string];
+type TcpContextArgs = [TcpSocket, string];
 
 export class TcpContext extends BaseRpcContext<TcpContextArgs> {
   constructor(args: TcpContextArgs) {
diff --git a/packages/microservices/decorators/event-pattern.decorator.ts b/packages/microservices/decorators/event-pattern.decorator.ts
index 57bf07a41..34708b007 100644
--- a/packages/microservices/decorators/event-pattern.decorator.ts
+++ b/packages/microservices/decorators/event-pattern.decorator.ts
@@ -1,4 +1,9 @@
-import { isObject, isNumber, isNil } from '@nestjs/common/utils/shared.utils';
+import {
+  isObject,
+  isNumber,
+  isNil,
+  isSymbol,
+} from '@nestjs/common/utils/shared.utils';
 import {
   PATTERN_HANDLER_METADATA,
   PATTERN_METADATA,
@@ -13,26 +18,29 @@ import { Transport } from '../enums';
  */
 export const EventPattern: {
   <T = string>(metadata?: T): MethodDecorator;
-  <T = string>(metadata?: T, transport?: Transport): MethodDecorator;
+  <T = string>(metadata?: T, transport?: Transport | symbol): MethodDecorator;
   <T = string>(metadata?: T, extras?: Record<string, any>): MethodDecorator;
   <T = string>(
     metadata?: T,
-    transport?: Transport,
+    transport?: Transport | symbol,
     extras?: Record<string, any>,
   ): MethodDecorator;
 } = <T = string>(
   metadata?: T,
-  transportOrExtras?: Transport | Record<string, any>,
+  transportOrExtras?: Transport | symbol | Record<string, any>,
   maybeExtras?: Record<string, any>,
 ): MethodDecorator => {
-  let transport: Transport;
+  let transport: Transport | symbol;
   let extras: Record<string, any>;
-  if (isNumber(transportOrExtras) && isNil(maybeExtras)) {
+  if (
+    (isNumber(transportOrExtras) || isSymbol(transportOrExtras)) &&
+    isNil(maybeExtras)
+  ) {
     transport = transportOrExtras;
   } else if (isObject(transportOrExtras) && isNil(maybeExtras)) {
     extras = transportOrExtras;
   } else {
-    transport = transportOrExtras as Transport;
+    transport = transportOrExtras as Transport | symbol;
     extras = maybeExtras;
   }
   return (
@@ -40,11 +48,7 @@ export const EventPattern: {
     key: string | symbol,
     descriptor: PropertyDescriptor,
   ) => {
-    Reflect.defineMetadata(
-      PATTERN_METADATA,
-      [].concat(metadata),
-      descriptor.value,
-    );
+    Reflect.defineMetadata(PATTERN_METADATA, metadata, descriptor.value);
     Reflect.defineMetadata(
       PATTERN_HANDLER_METADATA,
       PatternHandler.EVENT,
diff --git a/packages/microservices/decorators/message-pattern.decorator.ts b/packages/microservices/decorators/message-pattern.decorator.ts
index 553fe3363..3e17d8569 100644
--- a/packages/microservices/decorators/message-pattern.decorator.ts
+++ b/packages/microservices/decorators/message-pattern.decorator.ts
@@ -1,4 +1,9 @@
-import { isObject, isNumber, isNil } from '@nestjs/common/utils/shared.utils';
+import {
+  isObject,
+  isNumber,
+  isNil,
+  isSymbol,
+} from '@nestjs/common/utils/shared.utils';
 /* eslint-disable @typescript-eslint/no-use-before-define */
 import {
   PATTERN_HANDLER_METADATA,
@@ -23,7 +28,7 @@ export const MessagePattern: {
   <T = PatternMetadata | string>(metadata?: T): MethodDecorator;
   <T = PatternMetadata | string>(
     metadata?: T,
-    transport?: Transport,
+    transport?: Transport | symbol,
   ): MethodDecorator;
   <T = PatternMetadata | string>(
     metadata?: T,
@@ -31,22 +36,25 @@ export const MessagePattern: {
   ): MethodDecorator;
   <T = PatternMetadata | string>(
     metadata?: T,
-    transport?: Transport,
+    transport?: Transport | symbol,
     extras?: Record<string, any>,
   ): MethodDecorator;
 } = <T = PatternMetadata | string>(
   metadata?: T,
-  transportOrExtras?: Transport | Record<string, any>,
+  transportOrExtras?: Transport | symbol | Record<string, any>,
   maybeExtras?: Record<string, any>,
 ): MethodDecorator => {
-  let transport: Transport;
+  let transport: Transport | symbol;
   let extras: Record<string, any>;
-  if (isNumber(transportOrExtras) && isNil(maybeExtras)) {
+  if (
+    (isNumber(transportOrExtras) || isSymbol(transportOrExtras)) &&
+    isNil(maybeExtras)
+  ) {
     transport = transportOrExtras;
   } else if (isObject(transportOrExtras) && isNil(maybeExtras)) {
     extras = transportOrExtras;
   } else {
-    transport = transportOrExtras as Transport;
+    transport = transportOrExtras as Transport | symbol;
     extras = maybeExtras;
   }
   return (
@@ -54,11 +62,7 @@ export const MessagePattern: {
     key: string | symbol,
     descriptor: PropertyDescriptor,
   ) => {
-    Reflect.defineMetadata(
-      PATTERN_METADATA,
-      [].concat(metadata),
-      descriptor.value,
-    );
+    Reflect.defineMetadata(PATTERN_METADATA, metadata, descriptor.value);
     Reflect.defineMetadata(
       PATTERN_HANDLER_METADATA,
       PatternHandler.MESSAGE,
diff --git a/packages/microservices/helpers/index.ts b/packages/microservices/helpers/index.ts
index a02fe778e..ff6118b51 100644
--- a/packages/microservices/helpers/index.ts
+++ b/packages/microservices/helpers/index.ts
@@ -2,3 +2,4 @@ export * from './json-socket';
 export * from './kafka-logger';
 export * from './kafka-parser';
 export * from './kafka-reply-partition-assigner';
+export * from './tcp-socket';
diff --git a/packages/microservices/helpers/json-socket.ts b/packages/microservices/helpers/json-socket.ts
index 0320e0dbc..5d017f9b5 100644
--- a/packages/microservices/helpers/json-socket.ts
+++ b/packages/microservices/helpers/json-socket.ts
@@ -1,83 +1,29 @@
-import { Socket } from 'net';
+import { Buffer } from 'buffer';
 import { StringDecoder } from 'string_decoder';
-import {
-  CLOSE_EVENT,
-  CONNECT_EVENT,
-  DATA_EVENT,
-  ERROR_EVENT,
-  MESSAGE_EVENT,
-} from '../constants';
 import { CorruptedPacketLengthException } from '../errors/corrupted-packet-length.exception';
-import { InvalidJSONFormatException } from '../errors/invalid-json-format.exception';
-import { NetSocketClosedException } from '../errors/net-socket-closed.exception';
+import { TcpSocket } from './tcp-socket';
 
-export class JsonSocket {
+export class JsonSocket extends TcpSocket {
   private contentLength: number | null = null;
-  private isClosed = false;
   private buffer = '';
 
   private readonly stringDecoder = new StringDecoder();
-  private readonly delimeter = '#';
+  private readonly delimiter = '#';
 
-  public get netSocket() {
-    return this.socket;
-  }
-
-  constructor(public readonly socket: Socket) {
-    this.socket.on(DATA_EVENT, this.onData.bind(this));
-    this.socket.on(CONNECT_EVENT, () => (this.isClosed = false));
-    this.socket.on(CLOSE_EVENT, () => (this.isClosed = true));
-    this.socket.on(ERROR_EVENT, () => (this.isClosed = true));
-  }
-
-  public connect(port: number, host: string) {
-    this.socket.connect(port, host);
-    return this;
-  }
-
-  public on(event: string, callback: (err?: any) => void) {
-    this.socket.on(event, callback);
-    return this;
-  }
-
-  public once(event: string, callback: (err?: any) => void) {
-    this.socket.once(event, callback);
-    return this;
-  }
-
-  public end() {
-    this.socket.end();
-    return this;
-  }
-
-  public sendMessage(message: any, callback?: (err?: any) => void) {
-    if (this.isClosed) {
-      callback && callback(new NetSocketClosedException());
-      return;
-    }
+  protected handleSend(message: any, callback?: (err?: any) => void) {
     this.socket.write(this.formatMessageData(message), 'utf-8', callback);
   }
 
-  private onData(dataRaw: Buffer | string) {
+  protected handleData(dataRaw: Buffer | string) {
     const data = Buffer.isBuffer(dataRaw)
       ? this.stringDecoder.write(dataRaw)
       : dataRaw;
-
-    try {
-      this.handleData(data);
-    } catch (e) {
-      this.socket.emit(ERROR_EVENT, e.message);
-      this.socket.end();
-    }
-  }
-
-  private handleData(data: string) {
     this.buffer += data;
 
     if (this.contentLength == null) {
-      const i = this.buffer.indexOf(this.delimeter);
+      const i = this.buffer.indexOf(this.delimiter);
       /**
-       * Check if the buffer has the delimeter (#),
+       * Check if the buffer has the delimiter (#),
        * if not, the end of the buffer string might be in the middle of a content length string
        */
       if (i !== -1) {
@@ -95,36 +41,27 @@ export class JsonSocket {
 
     if (this.contentLength !== null) {
       const length = this.buffer.length;
-
       if (length === this.contentLength) {
         this.handleMessage(this.buffer);
       } else if (length > this.contentLength) {
         const message = this.buffer.substring(0, this.contentLength);
         const rest = this.buffer.substring(this.contentLength);
         this.handleMessage(message);
-        this.onData(rest);
+        this.handleData(rest);
       }
     }
   }
 
-  private handleMessage(data: string) {
+  private handleMessage(message: any) {
     this.contentLength = null;
     this.buffer = '';
-
-    let message: Record<string, unknown>;
-    try {
-      message = JSON.parse(data);
-    } catch (e) {
-      throw new InvalidJSONFormatException(e, data);
-    }
-    message = message || {};
-    this.socket.emit(MESSAGE_EVENT, message);
+    this.emitMessage(message);
   }
 
   private formatMessageData(message: any) {
     const messageData = JSON.stringify(message);
     const length = messageData.length;
-    const data = length + this.delimeter + messageData;
+    const data = length + this.delimiter + messageData;
     return data;
   }
 }
diff --git a/packages/microservices/helpers/tcp-socket.ts b/packages/microservices/helpers/tcp-socket.ts
new file mode 100644
index 000000000..cca8fe94d
--- /dev/null
+++ b/packages/microservices/helpers/tcp-socket.ts
@@ -0,0 +1,78 @@
+import { Buffer } from 'buffer';
+import { Socket } from 'net';
+import {
+  CLOSE_EVENT,
+  CONNECT_EVENT,
+  DATA_EVENT,
+  ERROR_EVENT,
+  MESSAGE_EVENT,
+} from '../constants';
+import { NetSocketClosedException } from '../errors/net-socket-closed.exception';
+import { InvalidJSONFormatException } from '../errors/invalid-json-format.exception';
+
+export abstract class TcpSocket {
+  private isClosed = false;
+
+  public get netSocket() {
+    return this.socket;
+  }
+
+  constructor(public readonly socket: Socket) {
+    this.socket.on(DATA_EVENT, this.onData.bind(this));
+    this.socket.on(CONNECT_EVENT, () => (this.isClosed = false));
+    this.socket.on(CLOSE_EVENT, () => (this.isClosed = true));
+    this.socket.on(ERROR_EVENT, () => (this.isClosed = true));
+  }
+
+  public connect(port: number, host: string) {
+    this.socket.connect(port, host);
+    return this;
+  }
+
+  public on(event: string, callback: (err?: any) => void) {
+    this.socket.on(event, callback);
+    return this;
+  }
+
+  public once(event: string, callback: (err?: any) => void) {
+    this.socket.once(event, callback);
+    return this;
+  }
+
+  public end() {
+    this.socket.end();
+    return this;
+  }
+
+  public sendMessage(message: any, callback?: (err?: any) => void) {
+    if (this.isClosed) {
+      callback && callback(new NetSocketClosedException());
+      return;
+    }
+    this.handleSend(message, callback);
+  }
+
+  protected abstract handleSend(message: any, callback?: (err?: any) => void);
+
+  private onData(data: Buffer) {
+    try {
+      this.handleData(data);
+    } catch (e) {
+      this.socket.emit(ERROR_EVENT, e.message);
+      this.socket.end();
+    }
+  }
+
+  protected abstract handleData(data: Buffer | string);
+
+  protected emitMessage(data: string) {
+    let message: Record<string, unknown>;
+    try {
+      message = JSON.parse(data);
+    } catch (e) {
+      throw new InvalidJSONFormatException(e, data);
+    }
+    message = message || {};
+    this.socket.emit(MESSAGE_EVENT, message);
+  }
+}
diff --git a/packages/microservices/index.ts b/packages/microservices/index.ts
index 81f4992ef..886c0be72 100644
--- a/packages/microservices/index.ts
+++ b/packages/microservices/index.ts
@@ -1,6 +1,6 @@
 /*
  * Nest @microservices
- * Copyright(c) 2017 - 2021 Kamil Mysliwiec
+ * Copyright(c) 2017 - 2022 Kamil Mysliwiec
  * https://nestjs.com
  * MIT Licensed
  */
diff --git a/packages/microservices/interfaces/client-metadata.interface.ts b/packages/microservices/interfaces/client-metadata.interface.ts
index 4962eecc1..ace44c265 100644
--- a/packages/microservices/interfaces/client-metadata.interface.ts
+++ b/packages/microservices/interfaces/client-metadata.interface.ts
@@ -1,5 +1,6 @@
 import { Type } from '@nestjs/common';
 import { ClientProxy } from '../client';
+import { TcpSocket } from '../helpers';
 import { Transport } from '../enums/transport.enum';
 import { Deserializer } from './deserializer.interface';
 import {
@@ -33,5 +34,6 @@ export interface TcpClientOptions {
     port?: number;
     serializer?: Serializer;
     deserializer?: Deserializer;
+    socketClass?: Type<TcpSocket>;
   };
 }
diff --git a/packages/microservices/interfaces/custom-transport-strategy.interface.ts b/packages/microservices/interfaces/custom-transport-strategy.interface.ts
index b5d5b2760..358d77b97 100644
--- a/packages/microservices/interfaces/custom-transport-strategy.interface.ts
+++ b/packages/microservices/interfaces/custom-transport-strategy.interface.ts
@@ -1,7 +1,7 @@
 import { Transport } from '../enums';
 
 export interface CustomTransportStrategy {
-  readonly transportId?: Transport;
+  readonly transportId?: Transport | symbol;
   listen(callback: (...optionalParams: unknown[]) => any): any;
   close(): any;
 }
diff --git a/packages/microservices/interfaces/microservice-configuration.interface.ts b/packages/microservices/interfaces/microservice-configuration.interface.ts
index 9942b8b55..9fd257e69 100644
--- a/packages/microservices/interfaces/microservice-configuration.interface.ts
+++ b/packages/microservices/interfaces/microservice-configuration.interface.ts
@@ -1,3 +1,5 @@
+import { Type } from '@nestjs/common';
+import { TcpSocket } from '../helpers';
 import { Transport } from '../enums/transport.enum';
 import { ChannelOptions } from '../external/grpc-options.interface';
 import {
@@ -80,6 +82,7 @@ export interface TcpOptions {
     retryDelay?: number;
     serializer?: Serializer;
     deserializer?: Deserializer;
+    socketClass?: Type<TcpSocket>;
   };
 }
 
diff --git a/packages/microservices/interfaces/serializer.interface.ts b/packages/microservices/interfaces/serializer.interface.ts
index 6674cd6b1..f8d0c8c25 100644
--- a/packages/microservices/interfaces/serializer.interface.ts
+++ b/packages/microservices/interfaces/serializer.interface.ts
@@ -5,7 +5,7 @@ import {
 } from './packet.interface';
 
 export interface Serializer<TInput = any, TOutput = any> {
-  serialize(value: TInput): TOutput;
+  serialize(value: TInput, options?: Record<string, any>): TOutput;
 }
 
 export type ProducerSerializer = Serializer<
diff --git a/packages/microservices/listener-metadata-explorer.ts b/packages/microservices/listener-metadata-explorer.ts
index 66ddffaf0..83e8f04c2 100644
--- a/packages/microservices/listener-metadata-explorer.ts
+++ b/packages/microservices/listener-metadata-explorer.ts
@@ -20,7 +20,7 @@ export interface ClientProperties {
 }
 
 export interface EventOrMessageListenerDefinition {
-  patterns: PatternMetadata[];
+  pattern: PatternMetadata;
   methodKey: string;
   isEventHandler: boolean;
   targetCallback: (...args: any[]) => any;
@@ -58,13 +58,13 @@ export class ListenerMetadataExplorer {
     if (isUndefined(handlerType)) {
       return;
     }
-    const patterns = Reflect.getMetadata(PATTERN_METADATA, targetCallback);
+    const pattern = Reflect.getMetadata(PATTERN_METADATA, targetCallback);
     const transport = Reflect.getMetadata(TRANSPORT_METADATA, targetCallback);
     const extras = Reflect.getMetadata(PATTERN_EXTRAS_METADATA, targetCallback);
     return {
       methodKey,
       targetCallback,
-      patterns,
+      pattern,
       transport,
       extras,
       isEventHandler: handlerType === PatternHandler.EVENT,
diff --git a/packages/microservices/listeners-controller.ts b/packages/microservices/listeners-controller.ts
index abc77d597..7687ccf46 100644
--- a/packages/microservices/listeners-controller.ts
+++ b/packages/microservices/listeners-controller.ts
@@ -71,20 +71,8 @@ export class ListenersController {
           isUndefined(server.transportId) ||
           transport === server.transportId,
       )
-      .reduce((acc, handler) => {
-        handler.patterns.forEach(pattern =>
-          acc.push({ ...handler, patterns: [pattern] }),
-        );
-        return acc;
-      }, [])
       .forEach(
-        ({
-          patterns: [pattern],
-          targetCallback,
-          methodKey,
-          extras,
-          isEventHandler,
-        }) => {
+        ({ pattern, targetCallback, methodKey, extras, isEventHandler }) => {
           if (isStatic) {
             const proxy = this.contextCreator.create(
               instance as object,
diff --git a/packages/microservices/package.json b/packages/microservices/package.json
index 4ade69ee8..b6c8cf0fb 100644
--- a/packages/microservices/package.json
+++ b/packages/microservices/package.json
@@ -1,6 +1,6 @@
 {
   "name": "@nestjs/microservices",
-  "version": "8.3.1",
+  "version": "8.4.5",
   "description": "Nest - modern, fast, powerful node.js web framework (@microservices)",
   "author": "Kamil Mysliwiec",
   "license": "MIT",
@@ -19,11 +19,11 @@
   "dependencies": {
     "iterare": "1.2.1",
     "json-socket": "0.3.0",
-    "tslib": "2.3.1"
+    "tslib": "2.4.0"
   },
   "devDependencies": {
-    "@nestjs/common": "8.3.1",
-    "@nestjs/core": "8.3.1"
+    "@nestjs/common": "8.4.5",
+    "@nestjs/core": "8.4.5"
   },
   "peerDependencies": {
     "@grpc/grpc-js": "*",
diff --git a/packages/microservices/server/server-kafka.ts b/packages/microservices/server/server-kafka.ts
index e7fcd8786..829d30d91 100644
--- a/packages/microservices/server/server-kafka.ts
+++ b/packages/microservices/server/server-kafka.ts
@@ -163,9 +163,10 @@ export class ServerKafka extends Server implements CustomTransportStrategy {
       payload.partition,
       payload.topic,
     ]);
+    const handler = this.getHandlerByPattern(packet.pattern);
     // if the correlation id or reply topic is not set
     // then this is an event (events could still have correlation id)
-    if (!correlationId || !replyTopic) {
+    if (handler?.isEventHandler || !correlationId || !replyTopic) {
       return this.handleEvent(packet.pattern, packet, kafkaContext);
     }
 
@@ -174,7 +175,7 @@ export class ServerKafka extends Server implements CustomTransportStrategy {
       replyPartition,
       correlationId,
     );
-    const handler = this.getHandlerByPattern(packet.pattern);
+
     if (!handler) {
       return publish({
         id: correlationId,
diff --git a/packages/microservices/server/server-mqtt.ts b/packages/microservices/server/server-mqtt.ts
index 6ba956b68..46a647a7a 100644
--- a/packages/microservices/server/server-mqtt.ts
+++ b/packages/microservices/server/server-mqtt.ts
@@ -1,5 +1,4 @@
 import { isUndefined } from '@nestjs/common/utils/shared.utils';
-import { Observable } from 'rxjs';
 import {
   CONNECT_EVENT,
   ERROR_EVENT,
@@ -196,13 +195,20 @@ export class ServerMqtt extends Server implements CustomTransportStrategy {
       ) {
         continue;
       }
-      if (this.matchMqttPattern(key, route)) {
+      const keyWithoutSharedPrefix = this.removeHandlerKeySharedPrefix(key);
+      if (this.matchMqttPattern(keyWithoutSharedPrefix, route)) {
         return value;
       }
     }
     return null;
   }
 
+  public removeHandlerKeySharedPrefix(handlerKey: string) {
+    return handlerKey && handlerKey.startsWith('$share')
+      ? handlerKey.split('/').slice(2).join('/')
+      : handlerKey;
+  }
+
   public getRequestPattern(pattern: string): string {
     return pattern;
   }
diff --git a/packages/microservices/server/server-tcp.ts b/packages/microservices/server/server-tcp.ts
index 6ef786aba..7a14e60ba 100644
--- a/packages/microservices/server/server-tcp.ts
+++ b/packages/microservices/server/server-tcp.ts
@@ -1,3 +1,4 @@
+import { Type } from '@nestjs/common';
 import { isString, isUndefined } from '@nestjs/common/utils/shared.utils';
 import * as net from 'net';
 import { Server as NetSocket, Socket } from 'net';
@@ -13,7 +14,7 @@ import {
 } from '../constants';
 import { TcpContext } from '../ctx-host/tcp.context';
 import { Transport } from '../enums';
-import { JsonSocket } from '../helpers/json-socket';
+import { JsonSocket, TcpSocket } from '../helpers';
 import {
   CustomTransportStrategy,
   IncomingRequest,
@@ -29,6 +30,7 @@ export class ServerTCP extends Server implements CustomTransportStrategy {
 
   private readonly port: number;
   private readonly host: string;
+  private readonly socketClass: Type<TcpSocket>;
   private server: NetSocket;
   private isExplicitlyTerminated = false;
   private retryAttemptsCount = 0;
@@ -37,6 +39,8 @@ export class ServerTCP extends Server implements CustomTransportStrategy {
     super();
     this.port = this.getOptionsProp(options, 'port') || TCP_DEFAULT_PORT;
     this.host = this.getOptionsProp(options, 'host') || TCP_DEFAULT_HOST;
+    this.socketClass =
+      this.getOptionsProp(options, 'socketClass') || JsonSocket;
 
     this.init();
     this.initializeSerializer(options);
@@ -68,7 +72,7 @@ export class ServerTCP extends Server implements CustomTransportStrategy {
     readSocket.on(ERROR_EVENT, this.handleError.bind(this));
   }
 
-  public async handleMessage(socket: JsonSocket, rawMessage: unknown) {
+  public async handleMessage(socket: TcpSocket, rawMessage: unknown) {
     const packet = await this.deserializer.deserialize(rawMessage);
     const pattern = !isString(packet.pattern)
       ? JSON.stringify(packet.pattern)
@@ -124,7 +128,7 @@ export class ServerTCP extends Server implements CustomTransportStrategy {
     this.server.on(CLOSE_EVENT, this.handleClose.bind(this));
   }
 
-  private getSocketInstance(socket: Socket): JsonSocket {
-    return new JsonSocket(socket);
+  private getSocketInstance(socket: Socket): TcpSocket {
+    return new this.socketClass(socket);
   }
 }
diff --git a/packages/microservices/test/decorators/event-pattern.decorator.spec.ts b/packages/microservices/test/decorators/event-pattern.decorator.spec.ts
index dbfb07696..edd238d0a 100644
--- a/packages/microservices/test/decorators/event-pattern.decorator.spec.ts
+++ b/packages/microservices/test/decorators/event-pattern.decorator.spec.ts
@@ -9,24 +9,14 @@ import { EventPattern } from '../../decorators/event-pattern.decorator';
 
 describe('@EventPattern', () => {
   const pattern = { role: 'test' };
-  const patternSecond = { role: 'test2' };
-  const patternThird = { role: 'test3' };
   const extras = { param: 'value' };
   class TestComponent {
     @EventPattern(pattern, undefined, extras)
     public static test() {}
-
-    @EventPattern(patternSecond, undefined, extras)
-    @EventPattern(patternThird, undefined, extras)
-    public static testOnlyThird() {}
-
-    @EventPattern([patternSecond, patternThird], undefined, extras)
-    public static testBoth() {}
   }
   it(`should enhance method with ${PATTERN_METADATA} metadata`, () => {
     const metadata = Reflect.getMetadata(PATTERN_METADATA, TestComponent.test);
-    expect(metadata.length).to.equal(1);
-    expect(metadata[0]).to.be.eql(pattern);
+    expect(metadata).to.be.eql(pattern);
   });
   it(`should enhance method with ${PATTERN_EXTRAS_METADATA} metadata`, () => {
     const metadata = Reflect.getMetadata(
@@ -35,23 +25,6 @@ describe('@EventPattern', () => {
     );
     expect(metadata).to.be.deep.equal(extras);
   });
-  it(`should enhance method with last ${PATTERN_METADATA} metadata`, () => {
-    const metadata = Reflect.getMetadata(
-      PATTERN_METADATA,
-      TestComponent.testOnlyThird,
-    );
-    expect(metadata.length).to.equal(1);
-    expect(metadata[0]).to.be.eql(patternSecond);
-  });
-  it(`should enhance method with both ${PATTERN_METADATA} metadata`, () => {
-    const metadata = Reflect.getMetadata(
-      PATTERN_METADATA,
-      TestComponent.testBoth,
-    );
-    expect(metadata.length).to.equal(2);
-    expect(metadata[0]).to.be.eql(patternSecond);
-    expect(metadata[1]).to.be.eql(patternThird);
-  });
 
   describe('decorator overloads', () => {
     class TestComponent1 {
@@ -72,7 +45,7 @@ describe('@EventPattern', () => {
     }
 
     it(`should enhance method with ${PATTERN_METADATA} metadata`, () => {
-      const [metadataArg] = Reflect.getMetadata(
+      const metadataArg = Reflect.getMetadata(
         PATTERN_METADATA,
         TestComponent1.test,
       );
@@ -90,7 +63,7 @@ describe('@EventPattern', () => {
     });
 
     it(`should enhance method with ${PATTERN_METADATA}, ${TRANSPORT_METADATA} metadata`, () => {
-      const [metadataArg] = Reflect.getMetadata(
+      const metadataArg = Reflect.getMetadata(
         PATTERN_METADATA,
         TestComponent2.test,
       );
@@ -108,7 +81,7 @@ describe('@EventPattern', () => {
     });
 
     it(`should enhance method with ${PATTERN_METADATA}, ${PATTERN_EXTRAS_METADATA} metadata`, () => {
-      const [metadataArg] = Reflect.getMetadata(
+      const metadataArg = Reflect.getMetadata(
         PATTERN_METADATA,
         TestComponent3.test,
       );
@@ -127,7 +100,7 @@ describe('@EventPattern', () => {
 
     it(`should enhance method with ${PATTERN_METADATA}, ${TRANSPORT_METADATA} and \
 ${PATTERN_EXTRAS_METADATA} metadata`, () => {
-      const [metadataArg] = Reflect.getMetadata(
+      const metadataArg = Reflect.getMetadata(
         PATTERN_METADATA,
         TestComponent4.test,
       );
diff --git a/packages/microservices/test/decorators/message-pattern.decorator.spec.ts b/packages/microservices/test/decorators/message-pattern.decorator.spec.ts
index d8b62d2f5..5edabc211 100644
--- a/packages/microservices/test/decorators/message-pattern.decorator.spec.ts
+++ b/packages/microservices/test/decorators/message-pattern.decorator.spec.ts
@@ -21,10 +21,7 @@ describe('@MessagePattern', () => {
     public static test() {}
   }
   it(`should enhance method with ${PATTERN_METADATA} metadata`, () => {
-    const [metadata] = Reflect.getMetadata(
-      PATTERN_METADATA,
-      TestComponent.test,
-    );
+    const metadata = Reflect.getMetadata(PATTERN_METADATA, TestComponent.test);
     expect(metadata).to.be.eql(pattern);
   });
   it(`should enhance method with ${PATTERN_EXTRAS_METADATA} metadata`, () => {
@@ -54,7 +51,7 @@ describe('@MessagePattern', () => {
     }
 
     it(`should enhance method with ${PATTERN_METADATA} metadata`, () => {
-      const [metadataArg] = Reflect.getMetadata(
+      const metadataArg = Reflect.getMetadata(
         PATTERN_METADATA,
         TestComponent1.test,
       );
@@ -72,7 +69,7 @@ describe('@MessagePattern', () => {
     });
 
     it(`should enhance method with ${PATTERN_METADATA}, ${TRANSPORT_METADATA} metadata`, () => {
-      const [metadataArg] = Reflect.getMetadata(
+      const metadataArg = Reflect.getMetadata(
         PATTERN_METADATA,
         TestComponent2.test,
       );
@@ -90,7 +87,7 @@ describe('@MessagePattern', () => {
     });
 
     it(`should enhance method with ${PATTERN_METADATA}, ${PATTERN_EXTRAS_METADATA} metadata`, () => {
-      const [metadataArg] = Reflect.getMetadata(
+      const metadataArg = Reflect.getMetadata(
         PATTERN_METADATA,
         TestComponent3.test,
       );
@@ -109,7 +106,7 @@ describe('@MessagePattern', () => {
 
     it(`should enhance method with ${PATTERN_METADATA}, ${TRANSPORT_METADATA} and \
 ${PATTERN_EXTRAS_METADATA} metadata`, () => {
-      const [metadataArg] = Reflect.getMetadata(
+      const metadataArg = Reflect.getMetadata(
         PATTERN_METADATA,
         TestComponent4.test,
       );
@@ -142,7 +139,7 @@ describe('@GrpcMethod', () => {
 
   it('should derive method and service name', () => {
     const svc = new TestService();
-    const [metadata] = Reflect.getMetadata(PATTERN_METADATA, svc.test);
+    const metadata = Reflect.getMetadata(PATTERN_METADATA, svc.test);
     expect(metadata).to.be.eql({
       service: TestService.name,
       rpc: 'Test',
@@ -152,7 +149,7 @@ describe('@GrpcMethod', () => {
 
   it('should derive method', () => {
     const svc = new TestService();
-    const [metadata] = Reflect.getMetadata(PATTERN_METADATA, svc.test2);
+    const metadata = Reflect.getMetadata(PATTERN_METADATA, svc.test2);
     expect(metadata).to.be.eql({
       service: 'TestService2',
       rpc: 'Test2',
@@ -162,7 +159,7 @@ describe('@GrpcMethod', () => {
 
   it('should override both method and service', () => {
     const svc = new TestService();
-    const [metadata] = Reflect.getMetadata(PATTERN_METADATA, svc.test3);
+    const metadata = Reflect.getMetadata(PATTERN_METADATA, svc.test3);
     expect(metadata).to.be.eql({
       service: 'TestService2',
       rpc: 'Test2',
@@ -185,7 +182,7 @@ describe('@GrpcStreamMethod', () => {
 
   it('should derive method and service name', () => {
     const svc = new TestService();
-    const [metadata] = Reflect.getMetadata(PATTERN_METADATA, svc.test);
+    const metadata = Reflect.getMetadata(PATTERN_METADATA, svc.test);
     expect(metadata).to.be.eql({
       service: TestService.name,
       rpc: 'Test',
@@ -195,7 +192,7 @@ describe('@GrpcStreamMethod', () => {
 
   it('should derive method', () => {
     const svc = new TestService();
-    const [metadata] = Reflect.getMetadata(PATTERN_METADATA, svc.test2);
+    const metadata = Reflect.getMetadata(PATTERN_METADATA, svc.test2);
     expect(metadata).to.be.eql({
       service: 'TestService2',
       rpc: 'Test2',
@@ -205,7 +202,7 @@ describe('@GrpcStreamMethod', () => {
 
   it('should override both method and service', () => {
     const svc = new TestService();
-    const [metadata] = Reflect.getMetadata(PATTERN_METADATA, svc.test3);
+    const metadata = Reflect.getMetadata(PATTERN_METADATA, svc.test3);
     expect(metadata).to.be.eql({
       service: 'TestService2',
       rpc: 'Test2',
@@ -228,7 +225,7 @@ describe('@GrpcStreamCall', () => {
 
   it('should derive method and service name', () => {
     const svc = new TestService();
-    const [metadata] = Reflect.getMetadata(PATTERN_METADATA, svc.test);
+    const metadata = Reflect.getMetadata(PATTERN_METADATA, svc.test);
     expect(metadata).to.be.eql({
       service: TestService.name,
       rpc: 'Test',
@@ -238,7 +235,7 @@ describe('@GrpcStreamCall', () => {
 
   it('should derive method', () => {
     const svc = new TestService();
-    const [metadata] = Reflect.getMetadata(PATTERN_METADATA, svc.test2);
+    const metadata = Reflect.getMetadata(PATTERN_METADATA, svc.test2);
     expect(metadata).to.be.eql({
       service: 'TestService2',
       rpc: 'Test2',
@@ -248,7 +245,7 @@ describe('@GrpcStreamCall', () => {
 
   it('should override both method and service', () => {
     const svc = new TestService();
-    const [metadata] = Reflect.getMetadata(PATTERN_METADATA, svc.test3);
+    const metadata = Reflect.getMetadata(PATTERN_METADATA, svc.test3);
     expect(metadata).to.be.eql({
       service: 'TestService2',
       rpc: 'Test2',
diff --git a/packages/microservices/test/listeners-controller.spec.ts b/packages/microservices/test/listeners-controller.spec.ts
index a3184b647..b23b13c16 100644
--- a/packages/microservices/test/listeners-controller.spec.ts
+++ b/packages/microservices/test/listeners-controller.spec.ts
@@ -21,8 +21,11 @@ describe('ListenersController', () => {
     metadataExplorer: ListenerMetadataExplorer,
     server: any,
     serverTCP: any,
+    serverCustom: any,
+    customTransport: Symbol,
     addSpy: sinon.SinonSpy,
     addSpyTCP: sinon.SinonSpy,
+    addSpyCustom: sinon.SinonSpy,
     proxySpy: sinon.SinonSpy,
     container: NestContainer,
     injector: Injector,
@@ -61,12 +64,18 @@ describe('ListenersController', () => {
       addHandler: addSpyTCP,
       transportId: Transport.TCP,
     };
+    addSpyCustom = sinon.spy();
+    customTransport = Symbol();
+    serverCustom = {
+      addHandler: addSpyCustom,
+      transportId: customTransport,
+    };
   });
 
   describe('registerPatternHandlers', () => {
     const handlers = [
-      { patterns: ['test'], targetCallback: 'tt' },
-      { patterns: ['test2'], targetCallback: '2', isEventHandler: true },
+      { pattern: 'test', targetCallback: 'tt' },
+      { pattern: 'test2', targetCallback: '2', isEventHandler: true },
     ];
 
     beforeEach(() => {
@@ -80,7 +89,7 @@ describe('ListenersController', () => {
     it(`should call "addHandler" method of server for each pattern handler with same transport`, () => {
       const serverHandlers = [
         {
-          patterns: [{ cmd: 'test' }],
+          pattern: { cmd: 'test' },
           targetCallback: 'tt',
           transport: Transport.TCP,
         },
@@ -92,12 +101,8 @@ describe('ListenersController', () => {
     });
     it(`should call "addHandler" method of server without transportID for each pattern handler with any transport value`, () => {
       const serverHandlers = [
-        { patterns: [{ cmd: 'test' }], targetCallback: 'tt' },
-        {
-          patterns: ['test2'],
-          targetCallback: '2',
-          transport: Transport.KAFKA,
-        },
+        { pattern: { cmd: 'test' }, targetCallback: 'tt' },
+        { pattern: 'test2', targetCallback: '2', transport: Transport.KAFKA },
       ];
       explorer.expects('explore').returns(serverHandlers);
       instance.registerPatternHandlers(new InstanceWrapper(), server, '');
@@ -105,14 +110,10 @@ describe('ListenersController', () => {
     });
     it(`should call "addHandler" method of server with transportID for each pattern handler with self transport and without transport`, () => {
       const serverHandlers = [
-        { patterns: ['test'], targetCallback: 'tt' },
-        {
-          patterns: ['test2'],
-          targetCallback: '2',
-          transport: Transport.KAFKA,
-        },
+        { pattern: 'test', targetCallback: 'tt' },
+        { pattern: 'test2', targetCallback: '2', transport: Transport.KAFKA },
         {
-          patterns: [{ cmd: 'test3' }],
+          pattern: { cmd: 'test3' },
           targetCallback: '3',
           transport: Transport.TCP,
         },
@@ -126,13 +127,23 @@ describe('ListenersController', () => {
       instance.registerPatternHandlers(new InstanceWrapper(), serverTCP, '');
       expect(addSpyTCP.calledTwice).to.be.true;
     });
-    it(`should call "addHandler" method of server with extras data`, () => {
+    it(`should call "addHandler" method of server with custom transportID for pattern handler with the same custom token`, () => {
       const serverHandlers = [
         {
-          patterns: ['test'],
+          pattern: { cmd: 'test' },
           targetCallback: 'tt',
-          extras: { param: 'value' },
+          transport: customTransport,
         },
+        { pattern: 'test2', targetCallback: '2', transport: Transport.KAFKA },
+      ];
+
+      explorer.expects('explore').returns(serverHandlers);
+      instance.registerPatternHandlers(new InstanceWrapper(), serverCustom, '');
+      expect(addSpyCustom.calledOnce).to.be.true;
+    });
+    it(`should call "addHandler" method of server with extras data`, () => {
+      const serverHandlers = [
+        { pattern: 'test', targetCallback: 'tt', extras: { param: 'value' } },
       ];
       explorer.expects('explore').returns(serverHandlers);
       instance.registerPatternHandlers(new InstanceWrapper(), serverTCP, '');
@@ -182,7 +193,7 @@ describe('ListenersController', () => {
       const module = {
         controllers: new Map(),
       } as any;
-      const patterns = [{}];
+      const pattern = {};
       const wrapper = new InstanceWrapper({ instance: { [methodKey]: {} } });
 
       it('should pass all arguments to the proxy chain', async () => {
@@ -191,7 +202,7 @@ describe('ListenersController', () => {
           .callsFake(() => Promise.resolve({}));
         const handler = instance.createRequestScopedHandler(
           wrapper,
-          patterns,
+          pattern,
           module,
           moduleKey,
           methodKey,
@@ -210,7 +221,7 @@ describe('ListenersController', () => {
       const module = {
         controllers: new Map(),
       } as any;
-      const patterns = [{}];
+      const pattern = {};
       const wrapper = new InstanceWrapper({ instance: { [methodKey]: {} } });
 
       it('should delegete error to exception filters', async () => {
@@ -219,7 +230,7 @@ describe('ListenersController', () => {
         });
         const handler = instance.createRequestScopedHandler(
           wrapper,
-          patterns,
+          pattern,
           module,
           moduleKey,
           methodKey,
diff --git a/packages/microservices/test/listeners-metadata-explorer.spec.ts b/packages/microservices/test/listeners-metadata-explorer.spec.ts
index 2bb04a763..985365f9a 100644
--- a/packages/microservices/test/listeners-metadata-explorer.spec.ts
+++ b/packages/microservices/test/listeners-metadata-explorer.spec.ts
@@ -2,20 +2,15 @@ import { expect } from 'chai';
 import * as sinon from 'sinon';
 import { MetadataScanner } from '../../core/metadata-scanner';
 import { Client } from '../decorators/client.decorator';
-import { EventPattern } from '../decorators/event-pattern.decorator';
 import { MessagePattern } from '../decorators/message-pattern.decorator';
 import { Transport } from '../enums/transport.enum';
 import { ListenerMetadataExplorer } from '../listener-metadata-explorer';
 
 describe('ListenerMetadataExplorer', () => {
-  const msgPattern = { pattern: 'testMsg' };
-  const firstMultipleMsgPattern = { pattern: 'testMultipleMsg1' };
-  const secondMultipleMsgPattern = { pattern: 'testMultipleMsg2' };
+  const pattern = { pattern: 'test' };
+  const secPattern = { role: '2', cmd: 'm' };
   const clientMetadata = {};
   const clientSecMetadata = { transport: Transport.REDIS };
-  const evtPattern = { role: 'testEvt' };
-  const firstMultipleEvtPattern = { role: 'testMultipleEvt1' };
-  const secondMultipleEvtPattern = { role: 'testMultipleEvt2' };
 
   class Test {
     @Client(clientMetadata as any)
@@ -30,17 +25,11 @@ describe('ListenerMetadataExplorer', () => {
 
     constructor() {}
 
-    @MessagePattern(msgPattern)
-    public testMessage() {}
+    @MessagePattern(pattern)
+    public test() {}
 
-    @MessagePattern([firstMultipleMsgPattern, secondMultipleMsgPattern])
-    public testMultipleMessage() {}
-
-    @EventPattern(evtPattern)
-    public testEvent() {}
-
-    @EventPattern([firstMultipleEvtPattern, secondMultipleEvtPattern])
-    public testMultipleEvent() {}
+    @MessagePattern(secPattern)
+    public testSec() {}
 
     public noPattern() {}
   }
@@ -77,77 +66,20 @@ describe('ListenerMetadataExplorer', () => {
       );
       expect(metadata).to.eq(undefined);
     });
-
-    describe('@MessagePattern', () => {
-      it(`should return pattern properties when "handlerType" metadata is not undefined`, () => {
-        const metadata = instance.exploreMethodMetadata(
-          Object.getPrototypeOf(test),
-          'testMessage',
-        );
-        expect(metadata).to.have.keys([
-          'isEventHandler',
-          'methodKey',
-          'targetCallback',
-          'patterns',
-          'transport',
-          'extras',
-        ]);
-        expect(metadata.patterns.length).to.eql(1);
-        expect(metadata.patterns[0]).to.eql(msgPattern);
-      });
-      it(`should return multiple patterns when more than one is declared`, () => {
-        const metadata = instance.exploreMethodMetadata(
-          Object.getPrototypeOf(test),
-          'testMultipleMessage',
-        );
-        expect(metadata).to.have.keys([
-          'isEventHandler',
-          'methodKey',
-          'targetCallback',
-          'patterns',
-          'transport',
-          'extras',
-        ]);
-        expect(metadata.patterns.length).to.eql(2);
-        expect(metadata.patterns[0]).to.eql(firstMultipleMsgPattern);
-        expect(metadata.patterns[1]).to.eql(secondMultipleMsgPattern);
-      });
-    });
-
-    describe('@EventPattern', () => {
-      it(`should return pattern properties when "handlerType" metadata is not undefined`, () => {
-        const metadata = instance.exploreMethodMetadata(
-          Object.getPrototypeOf(test),
-          'testEvent',
-        );
-        expect(metadata).to.have.keys([
-          'isEventHandler',
-          'methodKey',
-          'targetCallback',
-          'patterns',
-          'transport',
-          'extras',
-        ]);
-        expect(metadata.patterns.length).to.eql(1);
-        expect(metadata.patterns[0]).to.eql(evtPattern);
-      });
-      it(`should return multiple patterns when more than one is declared`, () => {
-        const metadata = instance.exploreMethodMetadata(
-          Object.getPrototypeOf(test),
-          'testMultipleEvent',
-        );
-        expect(metadata).to.have.keys([
-          'isEventHandler',
-          'methodKey',
-          'targetCallback',
-          'patterns',
-          'transport',
-          'extras',
-        ]);
-        expect(metadata.patterns.length).to.eql(2);
-        expect(metadata.patterns[0]).to.eql(firstMultipleEvtPattern);
-        expect(metadata.patterns[1]).to.eql(secondMultipleEvtPattern);
-      });
+    it(`should return pattern properties when "handlerType" metadata is not undefined`, () => {
+      const metadata = instance.exploreMethodMetadata(
+        Object.getPrototypeOf(test),
+        'test',
+      );
+      expect(metadata).to.have.keys([
+        'isEventHandler',
+        'methodKey',
+        'targetCallback',
+        'pattern',
+        'transport',
+        'extras',
+      ]);
+      expect(metadata.pattern).to.eql(pattern);
     });
   });
   describe('scanForClientHooks', () => {
diff --git a/packages/microservices/test/server/server-kafka.spec.ts b/packages/microservices/test/server/server-kafka.spec.ts
index d40ecf5f6..f4ab1eab0 100644
--- a/packages/microservices/test/server/server-kafka.spec.ts
+++ b/packages/microservices/test/server/server-kafka.spec.ts
@@ -283,12 +283,34 @@ describe('ServerKafka', () => {
       expect(handleEventSpy.called).to.be.true;
     });
 
-    it('should call "handleEvent" if correlation identifier is present by the reply topic is not present', async () => {
+    it('should call "handleEvent" if correlation identifier is present but the reply topic is not present', async () => {
       const handleEventSpy = sinon.spy(server, 'handleEvent');
       await server.handleMessage(eventWithCorrelationIdPayload);
       expect(handleEventSpy.called).to.be.true;
     });
 
+    it('should call "handleEvent" if correlation identifier and reply topic are present but the handler is of type eventHandler', async () => {
+      const handler = sinon.spy();
+      (handler as any).isEventHandler = true;
+      (server as any).messageHandlers = objectToMap({
+        [topic]: handler,
+      });
+      const handleEventSpy = sinon.spy(server, 'handleEvent');
+      await server.handleMessage(payload);
+      expect(handleEventSpy.called).to.be.true;
+    });
+
+    it('should NOT call "handleEvent" if correlation identifier and reply topic are present but the handler is not of type eventHandler', async () => {
+      const handler = sinon.spy();
+      (handler as any).isEventHandler = false;
+      (server as any).messageHandlers = objectToMap({
+        [topic]: handler,
+      });
+      const handleEventSpy = sinon.spy(server, 'handleEvent');
+      await server.handleMessage(payload);
+      expect(handleEventSpy.called).to.be.false;
+    });
+
     it(`should publish NO_MESSAGE_HANDLER if pattern not exists in messageHandlers object`, async () => {
       await server.handleMessage(payload);
       expect(
diff --git a/packages/platform-express/Readme.md b/packages/platform-express/Readme.md
index 772d0077a..a5e43201d 100644
--- a/packages/platform-express/Readme.md
+++ b/packages/platform-express/Readme.md
@@ -54,7 +54,7 @@ With official support, you can get expert help straight from Nest core team. We
 
 ## Support
 
-Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support by the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).
+Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support from the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).
 
 #### Principal Sponsors
 <table style="text-align:center;"><tr>
@@ -64,17 +64,20 @@ Nest is an MIT-licensed open source project. It can grow thanks to the sponsors
 <a href="https://github.com/Sanofi-IADC" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/sanofi.png" width="180" valign="middle" /></a></td>
 <td>
 <a href="https://nx.dev" target="_blank"><img src="https://nestjs.com/img/nx-logo.png" height="45" valign="middle" /></a></td>
+    <td>
+<a href="https://valor-software.com/" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/valor-software.png" width="170" valign="middle" /></a></td>
 </tr></table>
 
 #### Gold Sponsors
 
 <table style="text-align:center;"><tr><td>
   <a href="https://careers.labster.com/departments/platform" target="_blank"><img src="https://nestjs.com/img/labster-logo.png" width="170" valign="middle" /></a></td><td>
-<a href="https://weld.app/" target="_blank"><img src="https://nestjs.com/img/weld-logo.svg" width="150" valign="middle" /></a></td>
-  <td>
-<a href="https://valor-software.com/" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/valor-software.png" width="170" valign="middle" /></a></td>
+<a href="https://weld.app/" target="_blank"><img src="https://nestjs.com/img/weld-logo.svg" width="140" valign="middle" /></a></td>
 <td>
-<a href="https://intrinsic.ventures/" target="_blank"><img src="https://nestjs.com/img/intrinisic-logo.png" width="210" valign="middle" /></a></td></</tr></table>
+<a href="https://intrinsic.ventures/" target="_blank"><img src="https://nestjs.com/img/intrinisic-logo.png" width="210" valign="middle" /></a></td>
+ <td>
+<a href="https://jetbrains.com/" target="_blank"><img src="https://nestjs.com/img/jetbrains-logo.svg" width="110" valign="middle" /></a></td><td>
+<a href="https://snyk.co/nestjs" target="_blank"><img src="https://nestjs.com/img/snyk-logo-black.png" width="185" valign="middle" /></a></td></</tr></table>
 
 #### Silver Sponsors
 
diff --git a/packages/platform-express/adapters/express-adapter.ts b/packages/platform-express/adapters/express-adapter.ts
index afe1b782e..b8dcf9340 100644
--- a/packages/platform-express/adapters/express-adapter.ts
+++ b/packages/platform-express/adapters/express-adapter.ts
@@ -19,6 +19,7 @@ import {
   isNil,
   isObject,
   isString,
+  isUndefined,
 } from '@nestjs/common/utils/shared.utils';
 import { AbstractHttpAdapter } from '@nestjs/core/adapters/http-adapter';
 import { RouterMethodFactory } from '@nestjs/core/helpers/router-method-factory';
@@ -48,12 +49,24 @@ export class ExpressAdapter extends AbstractHttpAdapter {
     }
     if (body instanceof StreamableFile) {
       const streamHeaders = body.getHeaders();
-      if (response.getHeader('Content-Type') === undefined) {
+      if (
+        response.getHeader('Content-Type') === undefined &&
+        streamHeaders.type !== undefined
+      ) {
         response.setHeader('Content-Type', streamHeaders.type);
       }
-      if (response.getHeader('Content-Disposition') === undefined) {
+      if (
+        response.getHeader('Content-Disposition') === undefined &&
+        streamHeaders.disposition !== undefined
+      ) {
         response.setHeader('Content-Disposition', streamHeaders.disposition);
       }
+      if (
+        response.getHeader('Content-Length') === undefined &&
+        streamHeaders.length !== undefined
+      ) {
+        response.setHeader('Content-Length', streamHeaders.length);
+      }
       return body.getStream().pipe(response);
     }
     return isObject(body) ? response.json(body) : response.send(String(body));
@@ -199,6 +212,42 @@ export class ExpressAdapter extends AbstractHttpAdapter {
       if (versioningOptions.type === VersioningType.URI) {
         return handler(req, res, next);
       }
+
+      // Custom Extractor Versioning Handler
+      if (versioningOptions.type === VersioningType.CUSTOM) {
+        const extractedVersion = versioningOptions.extractor(req);
+
+        if (Array.isArray(version)) {
+          if (
+            Array.isArray(extractedVersion) &&
+            version.filter(v => extractedVersion.includes(v as string)).length
+          ) {
+            return handler(req, res, next);
+          } else if (
+            isString(extractedVersion) &&
+            version.includes(extractedVersion)
+          ) {
+            return handler(req, res, next);
+          }
+        } else if (isString(version)) {
+          // Known bug here - if there are multiple versions supported across separate
+          // handlers/controllers, we can't select the highest matching handler.
+          // Since this code is evaluated per-handler, then we can't see if the highest
+          // specified version exists in a different handler.
+          if (
+            Array.isArray(extractedVersion) &&
+            extractedVersion.includes(version)
+          ) {
+            return handler(req, res, next);
+          } else if (
+            isString(extractedVersion) &&
+            version === extractedVersion
+          ) {
+            return handler(req, res, next);
+          }
+        }
+      }
+
       // Media Type (Accept Header) Versioning Handler
       if (versioningOptions.type === VersioningType.MEDIA_TYPE) {
         const MEDIA_TYPE_HEADER = 'Accept';
@@ -208,9 +257,16 @@ export class ExpressAdapter extends AbstractHttpAdapter {
 
         const acceptHeaderVersionParameter = acceptHeaderValue
           ? acceptHeaderValue.split(';')[1]
-          : '';
+          : undefined;
 
-        if (acceptHeaderVersionParameter) {
+        // No version was supplied
+        if (isUndefined(acceptHeaderVersionParameter)) {
+          if (Array.isArray(version)) {
+            if (version.includes(VERSION_NEUTRAL)) {
+              return handler(req, res, next);
+            }
+          }
+        } else {
           const headerVersion = acceptHeaderVersionParameter.split(
             versioningOptions.key,
           )[1];
@@ -232,7 +288,14 @@ export class ExpressAdapter extends AbstractHttpAdapter {
           req.headers?.[versioningOptions.header] ||
           req.headers?.[versioningOptions.header.toLowerCase()];
 
-        if (customHeaderVersionParameter) {
+        // No version was supplied
+        if (isUndefined(customHeaderVersionParameter)) {
+          if (Array.isArray(version)) {
+            if (version.includes(VERSION_NEUTRAL)) {
+              return handler(req, res, next);
+            }
+          }
+        } else {
           if (Array.isArray(version)) {
             if (version.includes(customHeaderVersionParameter)) {
               return handler(req, res, next);
diff --git a/packages/platform-express/index.ts b/packages/platform-express/index.ts
index df03ac629..0ed4c2d76 100644
--- a/packages/platform-express/index.ts
+++ b/packages/platform-express/index.ts
@@ -1,6 +1,6 @@
 /*
  * Nest @platform-express
- * Copyright(c) 2017 - 2021 Kamil Mysliwiec
+ * Copyright(c) 2017 - 2022 Kamil Mysliwiec
  * https://nestjs.com
  * MIT Licensed
  */
diff --git a/packages/platform-express/package.json b/packages/platform-express/package.json
index baa5a1b81..e97c6d882 100644
--- a/packages/platform-express/package.json
+++ b/packages/platform-express/package.json
@@ -1,6 +1,6 @@
 {
   "name": "@nestjs/platform-express",
-  "version": "8.3.1",
+  "version": "8.4.5",
   "description": "Nest - modern, fast, powerful node.js web framework (@platform-express)",
   "author": "Kamil Mysliwiec",
   "license": "MIT",
@@ -17,15 +17,15 @@
     "access": "public"
   },
   "dependencies": {
-    "body-parser": "1.19.2",
+    "body-parser": "1.20.0",
     "cors": "2.8.5",
-    "express": "4.17.3",
+    "express": "4.18.1",
     "multer": "1.4.4",
-    "tslib": "2.3.1"
+    "tslib": "2.4.0"
   },
   "devDependencies": {
-    "@nestjs/common": "8.3.1",
-    "@nestjs/core": "8.3.1"
+    "@nestjs/common": "8.4.5",
+    "@nestjs/core": "8.4.5"
   },
   "peerDependencies": {
     "@nestjs/common": "^8.0.0",
diff --git a/packages/platform-fastify/Readme.md b/packages/platform-fastify/Readme.md
index 772d0077a..a5e43201d 100644
--- a/packages/platform-fastify/Readme.md
+++ b/packages/platform-fastify/Readme.md
@@ -54,7 +54,7 @@ With official support, you can get expert help straight from Nest core team. We
 
 ## Support
 
-Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support by the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).
+Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support from the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).
 
 #### Principal Sponsors
 <table style="text-align:center;"><tr>
@@ -64,17 +64,20 @@ Nest is an MIT-licensed open source project. It can grow thanks to the sponsors
 <a href="https://github.com/Sanofi-IADC" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/sanofi.png" width="180" valign="middle" /></a></td>
 <td>
 <a href="https://nx.dev" target="_blank"><img src="https://nestjs.com/img/nx-logo.png" height="45" valign="middle" /></a></td>
+    <td>
+<a href="https://valor-software.com/" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/valor-software.png" width="170" valign="middle" /></a></td>
 </tr></table>
 
 #### Gold Sponsors
 
 <table style="text-align:center;"><tr><td>
   <a href="https://careers.labster.com/departments/platform" target="_blank"><img src="https://nestjs.com/img/labster-logo.png" width="170" valign="middle" /></a></td><td>
-<a href="https://weld.app/" target="_blank"><img src="https://nestjs.com/img/weld-logo.svg" width="150" valign="middle" /></a></td>
-  <td>
-<a href="https://valor-software.com/" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/valor-software.png" width="170" valign="middle" /></a></td>
+<a href="https://weld.app/" target="_blank"><img src="https://nestjs.com/img/weld-logo.svg" width="140" valign="middle" /></a></td>
 <td>
-<a href="https://intrinsic.ventures/" target="_blank"><img src="https://nestjs.com/img/intrinisic-logo.png" width="210" valign="middle" /></a></td></</tr></table>
+<a href="https://intrinsic.ventures/" target="_blank"><img src="https://nestjs.com/img/intrinisic-logo.png" width="210" valign="middle" /></a></td>
+ <td>
+<a href="https://jetbrains.com/" target="_blank"><img src="https://nestjs.com/img/jetbrains-logo.svg" width="110" valign="middle" /></a></td><td>
+<a href="https://snyk.co/nestjs" target="_blank"><img src="https://nestjs.com/img/snyk-logo-black.png" width="185" valign="middle" /></a></td></</tr></table>
 
 #### Silver Sponsors
 
diff --git a/packages/platform-fastify/adapters/fastify-adapter.ts b/packages/platform-fastify/adapters/fastify-adapter.ts
index b2867926d..ebf64274e 100644
--- a/packages/platform-fastify/adapters/fastify-adapter.ts
+++ b/packages/platform-fastify/adapters/fastify-adapter.ts
@@ -115,23 +115,27 @@ export class FastifyAdapter<
       }
     },
     storage() {
-      const versions = new Map();
+      const versions = new Map<string, unknown>();
       return {
         get(version: string | Array<string>) {
+          if (Array.isArray(version)) {
+            return versions.get(version.find(v => versions.has(v))) || null;
+          }
           return versions.get(version) || null;
         },
-        set(
-          versionOrVersions: string | Array<string>,
-          store: Map<string, any>,
-        ) {
-          const storeVersionConstraint = version =>
+        set(versionOrVersions: string | Array<string>, store: unknown) {
+          const storeVersionConstraint = (version: string) =>
             versions.set(version, store);
           if (Array.isArray(versionOrVersions))
             versionOrVersions.forEach(storeVersionConstraint);
           else storeVersionConstraint(versionOrVersions);
         },
         del(version: string | Array<string>) {
-          versions.delete(version);
+          if (Array.isArray(version)) {
+            version.forEach(v => versions.delete(v));
+          } else {
+            versions.delete(version);
+          }
         },
         empty() {
           versions.clear();
@@ -150,12 +154,9 @@ export class FastifyAdapter<
           ? acceptHeaderValue.split(';')[1]
           : '';
 
-        if (acceptHeaderVersionParameter) {
-          const headerVersion = acceptHeaderVersionParameter.split(
-            this.versioningOptions.key,
-          )[1];
-          return headerVersion;
-        }
+        return isUndefined(acceptHeaderVersionParameter)
+          ? VERSION_NEUTRAL // No version was supplied
+          : acceptHeaderVersionParameter.split(this.versioningOptions.key)[1];
       }
       // Header Versioning Handler
       else if (this.versioningOptions.type === VersioningType.HEADER) {
@@ -163,9 +164,13 @@ export class FastifyAdapter<
           req.headers?.[this.versioningOptions.header] ||
           req.headers?.[this.versioningOptions.header.toLowerCase()];
 
-        if (customHeaderVersionParameter) {
-          return customHeaderVersionParameter;
-        }
+        return isUndefined(customHeaderVersionParameter)
+          ? VERSION_NEUTRAL // No version was supplied
+          : customHeaderVersionParameter;
+      }
+      // Custom Versioning Handler
+      else if (this.versioningOptions.type === VersioningType.CUSTOM) {
+        return this.versioningOptions.extractor(req);
       }
       return undefined;
     },
@@ -282,12 +287,24 @@ export class FastifyAdapter<
     }
     if (body instanceof StreamableFile) {
       const streamHeaders = body.getHeaders();
-      if (fastifyReply.getHeader('Content-Type') === undefined) {
+      if (
+        fastifyReply.getHeader('Content-Type') === undefined &&
+        streamHeaders.type !== undefined
+      ) {
         fastifyReply.header('Content-Type', streamHeaders.type);
       }
-      if (fastifyReply.getHeader('Content-Disposition') === undefined) {
+      if (
+        fastifyReply.getHeader('Content-Disposition') === undefined &&
+        streamHeaders.disposition !== undefined
+      ) {
         fastifyReply.header('Content-Disposition', streamHeaders.disposition);
       }
+      if (
+        fastifyReply.getHeader('Content-Length') === undefined &&
+        streamHeaders.length !== undefined
+      ) {
+        fastifyReply.header('Content-Length', streamHeaders.length);
+      }
       body = body.getStream();
     }
     return fastifyReply.send(body);
diff --git a/packages/platform-fastify/index.ts b/packages/platform-fastify/index.ts
index 6ee0f8cf9..2918a05af 100644
--- a/packages/platform-fastify/index.ts
+++ b/packages/platform-fastify/index.ts
@@ -1,6 +1,6 @@
 /*
- * Nest @platform-express
- * Copyright(c) 2017 - 2021 Kamil Mysliwiec
+ * Nest @platform-fastify
+ * Copyright(c) 2017 - 2022 Kamil Mysliwiec
  * https://nestjs.com
  * MIT Licensed
  */
diff --git a/packages/platform-fastify/package.json b/packages/platform-fastify/package.json
index 4cf5d529e..d284ad585 100644
--- a/packages/platform-fastify/package.json
+++ b/packages/platform-fastify/package.json
@@ -1,6 +1,6 @@
 {
   "name": "@nestjs/platform-fastify",
-  "version": "8.3.1",
+  "version": "8.4.5",
   "description": "Nest - modern, fast, powerful node.js web framework (@platform-fastify)",
   "author": "Kamil Mysliwiec",
   "license": "MIT",
@@ -17,13 +17,13 @@
     "access": "public"
   },
   "dependencies": {
-    "fastify": "3.27.1",
-    "fastify-cors": "6.0.2",
-    "fastify-formbody": "5.2.0",
-    "light-my-request": "4.8.0",
-    "middie": "6.0.0",
+    "fastify": "3.29.0",
+    "fastify-cors": "6.1.0",
+    "fastify-formbody": "5.3.0",
+    "light-my-request": "4.10.1",
+    "middie": "6.1.0",
     "path-to-regexp": "3.2.0",
-    "tslib": "2.3.1"
+    "tslib": "2.4.0"
   },
   "peerDependencies": {
     "@nestjs/common": "^8.0.0",
diff --git a/packages/platform-socket.io/Readme.md b/packages/platform-socket.io/Readme.md
index 772d0077a..a5e43201d 100644
--- a/packages/platform-socket.io/Readme.md
+++ b/packages/platform-socket.io/Readme.md
@@ -54,7 +54,7 @@ With official support, you can get expert help straight from Nest core team. We
 
 ## Support
 
-Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support by the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).
+Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support from the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).
 
 #### Principal Sponsors
 <table style="text-align:center;"><tr>
@@ -64,17 +64,20 @@ Nest is an MIT-licensed open source project. It can grow thanks to the sponsors
 <a href="https://github.com/Sanofi-IADC" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/sanofi.png" width="180" valign="middle" /></a></td>
 <td>
 <a href="https://nx.dev" target="_blank"><img src="https://nestjs.com/img/nx-logo.png" height="45" valign="middle" /></a></td>
+    <td>
+<a href="https://valor-software.com/" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/valor-software.png" width="170" valign="middle" /></a></td>
 </tr></table>
 
 #### Gold Sponsors
 
 <table style="text-align:center;"><tr><td>
   <a href="https://careers.labster.com/departments/platform" target="_blank"><img src="https://nestjs.com/img/labster-logo.png" width="170" valign="middle" /></a></td><td>
-<a href="https://weld.app/" target="_blank"><img src="https://nestjs.com/img/weld-logo.svg" width="150" valign="middle" /></a></td>
-  <td>
-<a href="https://valor-software.com/" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/valor-software.png" width="170" valign="middle" /></a></td>
+<a href="https://weld.app/" target="_blank"><img src="https://nestjs.com/img/weld-logo.svg" width="140" valign="middle" /></a></td>
 <td>
-<a href="https://intrinsic.ventures/" target="_blank"><img src="https://nestjs.com/img/intrinisic-logo.png" width="210" valign="middle" /></a></td></</tr></table>
+<a href="https://intrinsic.ventures/" target="_blank"><img src="https://nestjs.com/img/intrinisic-logo.png" width="210" valign="middle" /></a></td>
+ <td>
+<a href="https://jetbrains.com/" target="_blank"><img src="https://nestjs.com/img/jetbrains-logo.svg" width="110" valign="middle" /></a></td><td>
+<a href="https://snyk.co/nestjs" target="_blank"><img src="https://nestjs.com/img/snyk-logo-black.png" width="185" valign="middle" /></a></td></</tr></table>
 
 #### Silver Sponsors
 
diff --git a/packages/platform-socket.io/index.ts b/packages/platform-socket.io/index.ts
index 175a4e0d6..2805fc831 100644
--- a/packages/platform-socket.io/index.ts
+++ b/packages/platform-socket.io/index.ts
@@ -1,6 +1,6 @@
 /*
  * Nest @platform-socket.io
- * Copyright(c) 2017 - 2021 Kamil Mysliwiec
+ * Copyright(c) 2017 - 2022 Kamil Mysliwiec
  * https://nestjs.com
  * MIT Licensed
  */
diff --git a/packages/platform-socket.io/package.json b/packages/platform-socket.io/package.json
index 2973386e5..2d9ac8a0a 100644
--- a/packages/platform-socket.io/package.json
+++ b/packages/platform-socket.io/package.json
@@ -1,6 +1,6 @@
 {
   "name": "@nestjs/platform-socket.io",
-  "version": "8.3.1",
+  "version": "8.4.5",
   "description": "Nest - modern, fast, powerful node.js web framework (@platform-socket.io)",
   "author": "Kamil Mysliwiec",
   "license": "MIT",
@@ -17,8 +17,8 @@
     "access": "public"
   },
   "dependencies": {
-    "socket.io": "4.4.1",
-    "tslib": "2.3.1"
+    "socket.io": "4.5.0",
+    "tslib": "2.4.0"
   },
   "peerDependencies": {
     "@nestjs/common": "^8.0.0",
diff --git a/packages/platform-ws/Readme.md b/packages/platform-ws/Readme.md
index 772d0077a..a5e43201d 100644
--- a/packages/platform-ws/Readme.md
+++ b/packages/platform-ws/Readme.md
@@ -54,7 +54,7 @@ With official support, you can get expert help straight from Nest core team. We
 
 ## Support
 
-Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support by the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).
+Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support from the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).
 
 #### Principal Sponsors
 <table style="text-align:center;"><tr>
@@ -64,17 +64,20 @@ Nest is an MIT-licensed open source project. It can grow thanks to the sponsors
 <a href="https://github.com/Sanofi-IADC" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/sanofi.png" width="180" valign="middle" /></a></td>
 <td>
 <a href="https://nx.dev" target="_blank"><img src="https://nestjs.com/img/nx-logo.png" height="45" valign="middle" /></a></td>
+    <td>
+<a href="https://valor-software.com/" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/valor-software.png" width="170" valign="middle" /></a></td>
 </tr></table>
 
 #### Gold Sponsors
 
 <table style="text-align:center;"><tr><td>
   <a href="https://careers.labster.com/departments/platform" target="_blank"><img src="https://nestjs.com/img/labster-logo.png" width="170" valign="middle" /></a></td><td>
-<a href="https://weld.app/" target="_blank"><img src="https://nestjs.com/img/weld-logo.svg" width="150" valign="middle" /></a></td>
-  <td>
-<a href="https://valor-software.com/" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/valor-software.png" width="170" valign="middle" /></a></td>
+<a href="https://weld.app/" target="_blank"><img src="https://nestjs.com/img/weld-logo.svg" width="140" valign="middle" /></a></td>
 <td>
-<a href="https://intrinsic.ventures/" target="_blank"><img src="https://nestjs.com/img/intrinisic-logo.png" width="210" valign="middle" /></a></td></</tr></table>
+<a href="https://intrinsic.ventures/" target="_blank"><img src="https://nestjs.com/img/intrinisic-logo.png" width="210" valign="middle" /></a></td>
+ <td>
+<a href="https://jetbrains.com/" target="_blank"><img src="https://nestjs.com/img/jetbrains-logo.svg" width="110" valign="middle" /></a></td><td>
+<a href="https://snyk.co/nestjs" target="_blank"><img src="https://nestjs.com/img/snyk-logo-black.png" width="185" valign="middle" /></a></td></</tr></table>
 
 #### Silver Sponsors
 
diff --git a/packages/platform-ws/index.ts b/packages/platform-ws/index.ts
index e1b9386e4..0fb20dd10 100644
--- a/packages/platform-ws/index.ts
+++ b/packages/platform-ws/index.ts
@@ -1,6 +1,6 @@
 /*
  * Nest @platform-ws
- * Copyright(c) 2017 - 2021 Kamil Mysliwiec
+ * Copyright(c) 2017 - 2022 Kamil Mysliwiec
  * https://nestjs.com
  * MIT Licensed
  */
diff --git a/packages/platform-ws/package.json b/packages/platform-ws/package.json
index 46df4f973..16b8e0932 100644
--- a/packages/platform-ws/package.json
+++ b/packages/platform-ws/package.json
@@ -1,6 +1,6 @@
 {
   "name": "@nestjs/platform-ws",
-  "version": "8.3.1",
+  "version": "8.4.5",
   "description": "Nest - modern, fast, powerful node.js web framework (@platform-ws)",
   "author": "Kamil Mysliwiec",
   "license": "MIT",
@@ -17,8 +17,8 @@
     "access": "public"
   },
   "dependencies": {
-    "tslib": "2.3.1",
-    "ws": "7.5.6"
+    "tslib": "2.4.0",
+    "ws": "8.6.0"
   },
   "peerDependencies": {
     "@nestjs/common": "^8.0.0",
diff --git a/packages/testing/Readme.md b/packages/testing/Readme.md
index 772d0077a..a5e43201d 100644
--- a/packages/testing/Readme.md
+++ b/packages/testing/Readme.md
@@ -54,7 +54,7 @@ With official support, you can get expert help straight from Nest core team. We
 
 ## Support
 
-Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support by the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).
+Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support from the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).
 
 #### Principal Sponsors
 <table style="text-align:center;"><tr>
@@ -64,17 +64,20 @@ Nest is an MIT-licensed open source project. It can grow thanks to the sponsors
 <a href="https://github.com/Sanofi-IADC" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/sanofi.png" width="180" valign="middle" /></a></td>
 <td>
 <a href="https://nx.dev" target="_blank"><img src="https://nestjs.com/img/nx-logo.png" height="45" valign="middle" /></a></td>
+    <td>
+<a href="https://valor-software.com/" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/valor-software.png" width="170" valign="middle" /></a></td>
 </tr></table>
 
 #### Gold Sponsors
 
 <table style="text-align:center;"><tr><td>
   <a href="https://careers.labster.com/departments/platform" target="_blank"><img src="https://nestjs.com/img/labster-logo.png" width="170" valign="middle" /></a></td><td>
-<a href="https://weld.app/" target="_blank"><img src="https://nestjs.com/img/weld-logo.svg" width="150" valign="middle" /></a></td>
-  <td>
-<a href="https://valor-software.com/" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/valor-software.png" width="170" valign="middle" /></a></td>
+<a href="https://weld.app/" target="_blank"><img src="https://nestjs.com/img/weld-logo.svg" width="140" valign="middle" /></a></td>
 <td>
-<a href="https://intrinsic.ventures/" target="_blank"><img src="https://nestjs.com/img/intrinisic-logo.png" width="210" valign="middle" /></a></td></</tr></table>
+<a href="https://intrinsic.ventures/" target="_blank"><img src="https://nestjs.com/img/intrinisic-logo.png" width="210" valign="middle" /></a></td>
+ <td>
+<a href="https://jetbrains.com/" target="_blank"><img src="https://nestjs.com/img/jetbrains-logo.svg" width="110" valign="middle" /></a></td><td>
+<a href="https://snyk.co/nestjs" target="_blank"><img src="https://nestjs.com/img/snyk-logo-black.png" width="185" valign="middle" /></a></td></</tr></table>
 
 #### Silver Sponsors
 
diff --git a/packages/testing/index.ts b/packages/testing/index.ts
index c68ed76f1..0a4a47f73 100644
--- a/packages/testing/index.ts
+++ b/packages/testing/index.ts
@@ -1,6 +1,6 @@
 /*
  * Nest @testing
- * Copyright(c) 2017 - 2021 Kamil Mysliwiec
+ * Copyright(c) 2017 - 2022 Kamil Mysliwiec
  * https://nestjs.com
  * MIT Licensed
  */
diff --git a/packages/testing/package.json b/packages/testing/package.json
index 93341567d..8f6bbdd0a 100644
--- a/packages/testing/package.json
+++ b/packages/testing/package.json
@@ -1,6 +1,6 @@
 {
   "name": "@nestjs/testing",
-  "version": "8.3.1",
+  "version": "8.4.5",
   "description": "Nest - modern, fast, powerful node.js web framework (@testing)",
   "author": "Kamil Mysliwiec",
   "license": "MIT",
@@ -18,7 +18,7 @@
   },
   "dependencies": {
     "optional": "0.1.4",
-    "tslib": "2.3.1"
+    "tslib": "2.4.0"
   },
   "peerDependencies": {
     "@nestjs/common": "^8.0.0",
diff --git a/packages/tsconfig.base.json b/packages/tsconfig.base.json
index ff837eb4f..d8d4c2be0 100644
--- a/packages/tsconfig.base.json
+++ b/packages/tsconfig.base.json
@@ -11,6 +11,7 @@
     "noLib": false,
     "emitDecoratorMetadata": true,
     "experimentalDecorators": true,
+    "useUnknownInCatchVariables": false,
     "target": "es2017",
     "sourceMap": false,
     "allowJs": false,
diff --git a/packages/websockets/Readme.md b/packages/websockets/Readme.md
index 772d0077a..a5e43201d 100644
--- a/packages/websockets/Readme.md
+++ b/packages/websockets/Readme.md
@@ -54,7 +54,7 @@ With official support, you can get expert help straight from Nest core team. We
 
 ## Support
 
-Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support by the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).
+Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support from the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).
 
 #### Principal Sponsors
 <table style="text-align:center;"><tr>
@@ -64,17 +64,20 @@ Nest is an MIT-licensed open source project. It can grow thanks to the sponsors
 <a href="https://github.com/Sanofi-IADC" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/sanofi.png" width="180" valign="middle" /></a></td>
 <td>
 <a href="https://nx.dev" target="_blank"><img src="https://nestjs.com/img/nx-logo.png" height="45" valign="middle" /></a></td>
+    <td>
+<a href="https://valor-software.com/" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/valor-software.png" width="170" valign="middle" /></a></td>
 </tr></table>
 
 #### Gold Sponsors
 
 <table style="text-align:center;"><tr><td>
   <a href="https://careers.labster.com/departments/platform" target="_blank"><img src="https://nestjs.com/img/labster-logo.png" width="170" valign="middle" /></a></td><td>
-<a href="https://weld.app/" target="_blank"><img src="https://nestjs.com/img/weld-logo.svg" width="150" valign="middle" /></a></td>
-  <td>
-<a href="https://valor-software.com/" target="_blank"><img src="https://docs.nestjs.com/assets/sponsors/valor-software.png" width="170" valign="middle" /></a></td>
+<a href="https://weld.app/" target="_blank"><img src="https://nestjs.com/img/weld-logo.svg" width="140" valign="middle" /></a></td>
 <td>
-<a href="https://intrinsic.ventures/" target="_blank"><img src="https://nestjs.com/img/intrinisic-logo.png" width="210" valign="middle" /></a></td></</tr></table>
+<a href="https://intrinsic.ventures/" target="_blank"><img src="https://nestjs.com/img/intrinisic-logo.png" width="210" valign="middle" /></a></td>
+ <td>
+<a href="https://jetbrains.com/" target="_blank"><img src="https://nestjs.com/img/jetbrains-logo.svg" width="110" valign="middle" /></a></td><td>
+<a href="https://snyk.co/nestjs" target="_blank"><img src="https://nestjs.com/img/snyk-logo-black.png" width="185" valign="middle" /></a></td></</tr></table>
 
 #### Silver Sponsors
 
diff --git a/packages/websockets/index.ts b/packages/websockets/index.ts
index 76db23065..e8baa6f07 100644
--- a/packages/websockets/index.ts
+++ b/packages/websockets/index.ts
@@ -1,6 +1,6 @@
 /*
  * Nest @websockets
- * Copyright(c) 2017 - 2021 Kamil Mysliwiec
+ * Copyright(c) 2017 - 2022 Kamil Mysliwiec
  * https://nestjs.com
  * MIT Licensed
  */
diff --git a/packages/websockets/interfaces/gateway-metadata.interface.ts b/packages/websockets/interfaces/gateway-metadata.interface.ts
index 1666b321f..e5ac2e7bc 100644
--- a/packages/websockets/interfaces/gateway-metadata.interface.ts
+++ b/packages/websockets/interfaces/gateway-metadata.interface.ts
@@ -31,22 +31,22 @@ export interface GatewayMetadata {
   parser?: any;
   /**
    * How many ms before a client without namespace is closed
-   * @default 45000
+   * @default 45_000
    */
   connectTimeout?: number;
   /**
    * How many ms without a pong packet to consider the connection closed
-   * @default 5000
+   * @default 20_000
    */
   pingTimeout?: number;
   /**
    * How many ms before sending a new ping packet
-   * @default 25000
+   * @default 25_000
    */
   pingInterval?: number;
   /**
    * How many ms before an uncompleted transport upgrade is cancelled
-   * @default 10000
+   * @default 10_000
    */
   upgradeTimeout?: number;
   /**
@@ -116,7 +116,7 @@ export interface GatewayMetadata {
   destroyUpgrade?: boolean;
   /**
    * Milliseconds after which unhandled requests are ended
-   * @default 1000
+   * @default 1_000
    */
   destroyUpgradeTimeout?: number;
 }
diff --git a/packages/websockets/package.json b/packages/websockets/package.json
index e632daf56..2766f8408 100644
--- a/packages/websockets/package.json
+++ b/packages/websockets/package.json
@@ -1,6 +1,6 @@
 {
   "name": "@nestjs/websockets",
-  "version": "8.3.1",
+  "version": "8.4.5",
   "description": "Nest - modern, fast, powerful node.js web framework (@websockets)",
   "author": "Kamil Mysliwiec",
   "license": "MIT",
@@ -13,12 +13,12 @@
   },
   "dependencies": {
     "iterare": "1.2.1",
-    "object-hash": "2.2.0",
-    "tslib": "2.3.1"
+    "object-hash": "3.0.0",
+    "tslib": "2.4.0"
   },
   "devDependencies": {
-    "@nestjs/common": "8.3.1",
-    "@nestjs/core": "8.3.1"
+    "@nestjs/common": "8.4.5",
+    "@nestjs/core": "8.4.5"
   },
   "peerDependencies": {
     "@nestjs/common": "^8.0.0",
diff --git a/packages/websockets/test/web-sockets-controller.spec.ts b/packages/websockets/test/web-sockets-controller.spec.ts
index 68503abb0..659afff09 100644
--- a/packages/websockets/test/web-sockets-controller.spec.ts
+++ b/packages/websockets/test/web-sockets-controller.spec.ts
@@ -345,7 +345,7 @@ describe('WebSocketsController', () => {
                 Promise.resolve(Promise.resolve(value)),
               ),
             ),
-          ).to.be.eq(100);
+          ).to.be.eq(value);
         });
       });
 
@@ -356,18 +356,29 @@ describe('WebSocketsController', () => {
             await lastValueFrom(
               await instance.pickResult(Promise.resolve(of(value))),
             ),
-          ).to.be.eq(100);
+          ).to.be.eq(value);
         });
       });
 
-      describe('is a value', () => {
+      describe('is an object that has the method `subscribe`', () => {
+        it('should return Promise<Observable>', async () => {
+          const value = { subscribe() {} };
+          expect(
+            await lastValueFrom(
+              await instance.pickResult(Promise.resolve(value)),
+            ),
+          ).to.equal(value);
+        });
+      });
+
+      describe('is an ordinary value', () => {
         it('should return Promise<Observable>', async () => {
           const value = 100;
           expect(
             await lastValueFrom(
               await instance.pickResult(Promise.resolve(value)),
             ),
-          ).to.be.eq(100);
+          ).to.be.eq(value);
         });
       });
     });
diff --git a/packages/websockets/web-sockets-controller.ts b/packages/websockets/web-sockets-controller.ts
index 75e790c82..d01811e17 100644
--- a/packages/websockets/web-sockets-controller.ts
+++ b/packages/websockets/web-sockets-controller.ts
@@ -1,9 +1,14 @@
 import { Type } from '@nestjs/common/interfaces/type.interface';
 import { Logger } from '@nestjs/common/services/logger.service';
-import { isFunction } from '@nestjs/common/utils/shared.utils';
 import { ApplicationConfig } from '@nestjs/core/application-config';
 import { MetadataScanner } from '@nestjs/core/metadata-scanner';
-import { from as fromPromise, Observable, of, Subject } from 'rxjs';
+import {
+  from as fromPromise,
+  Observable,
+  isObservable,
+  of,
+  Subject,
+} from 'rxjs';
 import { distinctUntilChanged, mergeAll } from 'rxjs/operators';
 import { GATEWAY_OPTIONS, PORT_METADATA } from './constants';
 import { WsContextCreator } from './context/ws-context-creator';
@@ -158,7 +163,7 @@ export class WebSocketsController {
     deferredResult: Promise<any>,
   ): Promise<Observable<any>> {
     const result = await deferredResult;
-    if (result && isFunction(result.subscribe)) {
+    if (isObservable(result)) {
       return result;
     }
     if (result instanceof Promise) {
diff --git a/sample/01-cats-app/package-lock.json b/sample/01-cats-app/package-lock.json
index 8705e94da..1f3bf12b1 100644
Binary files a/sample/01-cats-app/package-lock.json and b/sample/01-cats-app/package-lock.json differ
diff --git a/sample/01-cats-app/package.json b/sample/01-cats-app/package.json
index f2770ffcf..0f3562953 100644
--- a/sample/01-cats-app/package.json
+++ b/sample/01-cats-app/package.json
@@ -30,17 +30,17 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.7",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/jest": "27.4.0",
-    "@types/node": "16.11.25",
+    "@types/jest": "27.4.1",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "jest": "27.5.1",
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "@typescript-eslint/eslint-plugin": "4.33.0",
diff --git a/sample/02-gateways/package-lock.json b/sample/02-gateways/package-lock.json
index 4f47da2a5..450745806 100644
Binary files a/sample/02-gateways/package-lock.json and b/sample/02-gateways/package-lock.json differ
diff --git a/sample/02-gateways/package.json b/sample/02-gateways/package.json
index c2d05bff2..910a63c62 100644
--- a/sample/02-gateways/package.json
+++ b/sample/02-gateways/package.json
@@ -29,14 +29,15 @@
     "class-validator": "0.13.2",
     "reflect-metadata": "0.1.13",
     "rimraf": "3.0.2",
-    "rxjs": "7.4.0"
+    "rxjs": "7.4.0",
+    "socket.io": "4.4.1"
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.7",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/node": "16.11.25",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "@types/ws": "8.2.2",
     "@typescript-eslint/eslint-plugin": "4.33.0",
@@ -49,7 +50,7 @@
     "redis": "4.0.3",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "typescript": "4.3.5"
diff --git a/sample/03-microservices/package-lock.json b/sample/03-microservices/package-lock.json
index 3035a96bd..2081cae2d 100644
Binary files a/sample/03-microservices/package-lock.json and b/sample/03-microservices/package-lock.json differ
diff --git a/sample/03-microservices/package.json b/sample/03-microservices/package.json
index 07f152775..9b2e8701c 100644
--- a/sample/03-microservices/package.json
+++ b/sample/03-microservices/package.json
@@ -31,17 +31,17 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.7",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/amqplib": "0.8.2",
     "@types/express": "4.17.13",
-    "@types/node": "16.11.25",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "jest": "27.5.1",
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "@typescript-eslint/eslint-plugin": "4.33.0",
diff --git a/sample/04-grpc/package-lock.json b/sample/04-grpc/package-lock.json
index e63c29876..3ba2e178e 100644
Binary files a/sample/04-grpc/package-lock.json and b/sample/04-grpc/package-lock.json differ
diff --git a/sample/04-grpc/package.json b/sample/04-grpc/package.json
index af500e08a..698f661d3 100644
--- a/sample/04-grpc/package.json
+++ b/sample/04-grpc/package.json
@@ -32,10 +32,10 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/node": "16.11.25",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "@typescript-eslint/eslint-plugin": "4.33.0",
     "@typescript-eslint/parser": "4.33.0",
@@ -46,7 +46,7 @@
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "typescript": "4.3.5"
diff --git a/sample/05-sql-typeorm/.gitignore b/sample/05-sql-typeorm/.gitignore
index b5e5f9755..44c92371f 100644
--- a/sample/05-sql-typeorm/.gitignore
+++ b/sample/05-sql-typeorm/.gitignore
@@ -13,7 +13,6 @@ npm-debug.log
 /quick-start
 
 # tests
-/test
 /coverage
 /.nyc_output
 
diff --git a/sample/05-sql-typeorm/docker-compose.yml b/sample/05-sql-typeorm/docker-compose.yml
index eee25f209..a8b6aadb8 100644
--- a/sample/05-sql-typeorm/docker-compose.yml
+++ b/sample/05-sql-typeorm/docker-compose.yml
@@ -9,3 +9,11 @@ services:
       MYSQL_DATABASE: test
     ports:
       - "3306:3306"
+  db-test:
+    image: mysql:8
+    restart: always
+    environment:
+      MYSQL_ROOT_PASSWORD: root
+      MYSQL_DATABASE: test
+    ports:
+      - "3307:3306"
\ No newline at end of file
diff --git a/sample/05-sql-typeorm/package-lock.json b/sample/05-sql-typeorm/package-lock.json
index ccf4d93fc..43f3787dc 100644
Binary files a/sample/05-sql-typeorm/package-lock.json and b/sample/05-sql-typeorm/package-lock.json differ
diff --git a/sample/05-sql-typeorm/package.json b/sample/05-sql-typeorm/package.json
index 32957494c..422b5c423 100644
--- a/sample/05-sql-typeorm/package.json
+++ b/sample/05-sql-typeorm/package.json
@@ -31,11 +31,11 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.7",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/jest": "27.4.0",
-    "@types/node": "16.11.25",
+    "@types/jest": "27.4.1",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "@typescript-eslint/eslint-plugin": "4.33.0",
     "@typescript-eslint/parser": "4.33.0",
@@ -46,7 +46,7 @@
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "typescript": "4.3.5"
diff --git a/sample/05-sql-typeorm/test/jest-e2e.json b/sample/05-sql-typeorm/test/jest-e2e.json
new file mode 100644
index 000000000..e9d912f3e
--- /dev/null
+++ b/sample/05-sql-typeorm/test/jest-e2e.json
@@ -0,0 +1,9 @@
+{
+  "moduleFileExtensions": ["js", "json", "ts"],
+  "rootDir": ".",
+  "testEnvironment": "node",
+  "testRegex": ".e2e-spec.ts$",
+  "transform": {
+    "^.+\\.(t|j)s$": "ts-jest"
+  }
+}
diff --git a/sample/05-sql-typeorm/test/users/users.e2e-spec.ts b/sample/05-sql-typeorm/test/users/users.e2e-spec.ts
new file mode 100644
index 000000000..1f1db731f
--- /dev/null
+++ b/sample/05-sql-typeorm/test/users/users.e2e-spec.ts
@@ -0,0 +1,74 @@
+import { Test, TestingModule } from '@nestjs/testing';
+import { INestApplication } from '@nestjs/common';
+import * as request from 'supertest';
+import { UsersModule } from '../../src/users/users.module';
+import { TypeOrmModule } from '@nestjs/typeorm';
+import { CreateUserDto } from '../../src/users/dto/create-user.dto';
+
+describe('Users - /users (e2e)', () => {
+  const users = {
+    id: 1,
+    firstName: 'FirstName #1',
+    lastName: 'LastName #1',
+    isActive: true,
+  };
+
+  let app: INestApplication;
+
+  beforeAll(async () => {
+    const moduleFixture: TestingModule = await Test.createTestingModule({
+      imports: [
+        TypeOrmModule.forRoot({
+          type: 'mysql',
+          host: 'localhost',
+          port: 3307,
+          username: 'root',
+          password: 'root',
+          database: 'test',
+          autoLoadEntities: true,
+          synchronize: true,
+        }),
+        UsersModule,
+      ],
+    }).compile();
+
+    app = moduleFixture.createNestApplication();
+    await app.init();
+  });
+
+  it('Create [POST /users]', () => {
+    return request(app.getHttpServer())
+      .post('/users')
+      .send(users as CreateUserDto)
+      .expect(201)
+      .then(({ body }) => {
+        expect(body).toEqual(users);
+      });
+  });
+
+  it('Get all users [GET /users]', () => {
+    return request(app.getHttpServer())
+      .get('/users')
+      .expect(200)
+      .then(({ body }) => {
+        expect(body).toBeDefined();
+      });
+  });
+
+  it('Get one user [GET /users/:id]', () => {
+    return request(app.getHttpServer())
+      .get('/users/2')
+      .expect(200)
+      .then(({ body }) => {
+        expect(body).toBeDefined();
+      });
+  });
+
+  it('Delete one user [DELETE /users/:id]', () => {
+    return request(app.getHttpServer()).delete('/users/1').expect(200);
+  });
+
+  afterAll(async () => {
+    await app.close();
+  });
+});
diff --git a/sample/06-mongoose/package-lock.json b/sample/06-mongoose/package-lock.json
index c0e51bd01..ab94878b6 100644
Binary files a/sample/06-mongoose/package-lock.json and b/sample/06-mongoose/package-lock.json differ
diff --git a/sample/06-mongoose/package.json b/sample/06-mongoose/package.json
index c41564ef4..3996e3a4d 100644
--- a/sample/06-mongoose/package.json
+++ b/sample/06-mongoose/package.json
@@ -30,11 +30,11 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.7",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/jest": "27.4.0",
-    "@types/node": "16.11.25",
+    "@types/jest": "27.4.1",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "@typescript-eslint/eslint-plugin": "4.33.0",
     "@typescript-eslint/parser": "4.33.0",
@@ -45,7 +45,7 @@
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "typescript": "4.3.5"
diff --git a/sample/07-sequelize/package-lock.json b/sample/07-sequelize/package-lock.json
index 0c535509a..8d7637d7f 100644
Binary files a/sample/07-sequelize/package-lock.json and b/sample/07-sequelize/package-lock.json differ
diff --git a/sample/07-sequelize/package.json b/sample/07-sequelize/package.json
index 53c334868..afd851bfc 100644
--- a/sample/07-sequelize/package.json
+++ b/sample/07-sequelize/package.json
@@ -33,11 +33,11 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/jest": "27.4.0",
-    "@types/node": "16.11.25",
+    "@types/jest": "27.4.1",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "@typescript-eslint/eslint-plugin": "4.33.0",
     "@typescript-eslint/parser": "4.33.0",
@@ -48,7 +48,7 @@
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "typescript": "4.3.5"
diff --git a/sample/08-webpack/package-lock.json b/sample/08-webpack/package-lock.json
index 1fa83e251..79e816fd7 100644
Binary files a/sample/08-webpack/package-lock.json and b/sample/08-webpack/package-lock.json differ
diff --git a/sample/08-webpack/package.json b/sample/08-webpack/package.json
index 0b3cadcf9..bd3082723 100644
--- a/sample/08-webpack/package.json
+++ b/sample/08-webpack/package.json
@@ -20,18 +20,18 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.7",
-    "@nestjs/schematics": "8.0.6",
-    "@types/node": "16.11.25",
+    "@nestjs/schematics": "8.0.8",
+    "@types/node": "16.11.26",
     "@typescript-eslint/eslint-plugin": "4.33.0",
     "@typescript-eslint/parser": "4.33.0",
     "eslint": "7.32.0",
     "eslint-config-prettier": "8.3.0",
     "eslint-plugin-import": "2.25.4",
     "start-server-webpack-plugin": "2.2.5",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "webpack": "5.64.4",
-    "webpack-cli": "4.9.1",
+    "webpack-cli": "4.9.2",
     "webpack-node-externals": "3.0.0"
   }
 }
diff --git a/sample/09-babel-example/package-lock.json b/sample/09-babel-example/package-lock.json
index 6ce71f9af..a1e6c9a1f 100644
Binary files a/sample/09-babel-example/package-lock.json and b/sample/09-babel-example/package-lock.json differ
diff --git a/sample/09-babel-example/package.json b/sample/09-babel-example/package.json
index f5d270b7e..27e52a508 100644
--- a/sample/09-babel-example/package.json
+++ b/sample/09-babel-example/package.json
@@ -22,14 +22,14 @@
     "rxjs": "7.4.0"
   },
   "devDependencies": {
-    "@babel/cli": "7.17.3",
-    "@babel/core": "7.17.5",
+    "@babel/cli": "7.17.6",
+    "@babel/core": "7.17.8",
     "@babel/node": "7.16.8",
-    "@babel/plugin-proposal-decorators": "7.17.2",
+    "@babel/plugin-proposal-decorators": "7.17.8",
     "@babel/plugin-transform-runtime": "7.17.0",
     "@babel/preset-env": "7.16.11",
-    "@babel/register": "7.17.0",
-    "@babel/runtime": "7.17.2",
+    "@babel/register": "7.17.7",
+    "@babel/runtime": "7.17.8",
     "@nestjs/testing": "8.2.3",
     "jest": "27.5.1",
     "nodemon": "2.0.15",
diff --git a/sample/10-fastify/package-lock.json b/sample/10-fastify/package-lock.json
index a4977c843..bdc20017f 100644
Binary files a/sample/10-fastify/package-lock.json and b/sample/10-fastify/package-lock.json differ
diff --git a/sample/10-fastify/package.json b/sample/10-fastify/package.json
index 74f2965e8..ae7816b8a 100644
--- a/sample/10-fastify/package.json
+++ b/sample/10-fastify/package.json
@@ -30,10 +30,10 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.7",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/node": "16.11.25",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "@typescript-eslint/eslint-plugin": "4.33.0",
     "@typescript-eslint/parser": "4.33.0",
@@ -44,7 +44,7 @@
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "typescript": "4.3.5"
diff --git a/sample/11-swagger/package-lock.json b/sample/11-swagger/package-lock.json
index 285149409..556540eaa 100644
Binary files a/sample/11-swagger/package-lock.json and b/sample/11-swagger/package-lock.json differ
diff --git a/sample/11-swagger/package.json b/sample/11-swagger/package.json
index 7a461eec2..0889b7ad0 100644
--- a/sample/11-swagger/package.json
+++ b/sample/11-swagger/package.json
@@ -28,20 +28,20 @@
     "reflect-metadata": "0.1.13",
     "rimraf": "3.0.2",
     "rxjs": "7.4.0",
-    "swagger-ui-express": "4.1.6"
+    "swagger-ui-express": "4.2.0"
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/node": "16.11.25",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "jest": "27.5.1",
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "@typescript-eslint/eslint-plugin": "4.33.0",
diff --git a/sample/12-graphql-schema-first/package-lock.json b/sample/12-graphql-schema-first/package-lock.json
index 1fc38624c..790dda25c 100644
Binary files a/sample/12-graphql-schema-first/package-lock.json and b/sample/12-graphql-schema-first/package-lock.json differ
diff --git a/sample/12-graphql-schema-first/package.json b/sample/12-graphql-schema-first/package.json
index 3f60d710b..44e83e3d6 100644
--- a/sample/12-graphql-schema-first/package.json
+++ b/sample/12-graphql-schema-first/package.json
@@ -19,7 +19,7 @@
     "test:e2e": "echo 'No e2e tests implemented yet.'"
   },
   "dependencies": {
-    "@graphql-tools/utils": "8.6.1",
+    "@graphql-tools/utils": "8.6.3",
     "@nestjs/apollo": "10.0.0",
     "@nestjs/common": "8.2.3",
     "@nestjs/core": "8.2.3",
@@ -37,10 +37,10 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/node": "16.11.25",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "@typescript-eslint/eslint-plugin": "4.33.0",
     "@typescript-eslint/parser": "4.33.0",
@@ -51,7 +51,7 @@
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-morph": "12.2.0",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
diff --git a/sample/13-mongo-typeorm/package-lock.json b/sample/13-mongo-typeorm/package-lock.json
index c80437ec5..50260a27e 100644
Binary files a/sample/13-mongo-typeorm/package-lock.json and b/sample/13-mongo-typeorm/package-lock.json differ
diff --git a/sample/13-mongo-typeorm/package.json b/sample/13-mongo-typeorm/package.json
index b8364ff13..37c15a7ac 100644
--- a/sample/13-mongo-typeorm/package.json
+++ b/sample/13-mongo-typeorm/package.json
@@ -31,11 +31,11 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.7",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/jest": "27.4.0",
-    "@types/node": "16.11.25",
+    "@types/jest": "27.4.1",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "@typescript-eslint/eslint-plugin": "4.33.0",
     "@typescript-eslint/parser": "4.33.0",
@@ -46,7 +46,7 @@
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "typescript": "4.3.5"
diff --git a/sample/13-mongo-typeorm/src/photo/photo.service.ts b/sample/13-mongo-typeorm/src/photo/photo.service.ts
index 31c751b35..0bca3ddee 100644
--- a/sample/13-mongo-typeorm/src/photo/photo.service.ts
+++ b/sample/13-mongo-typeorm/src/photo/photo.service.ts
@@ -1,13 +1,13 @@
 import { Injectable } from '@nestjs/common';
 import { InjectRepository } from '@nestjs/typeorm';
-import { Repository } from 'typeorm';
+import { MongoRepository } from 'typeorm';
 import { Photo } from './photo.entity';
 
 @Injectable()
 export class PhotoService {
   constructor(
     @InjectRepository(Photo)
-    private readonly photoRepository: Repository<Photo>,
+    private readonly photoRepository: MongoRepository<Photo>,
   ) {}
 
   async findAll(): Promise<Photo[]> {
diff --git a/sample/14-mongoose-base/package-lock.json b/sample/14-mongoose-base/package-lock.json
index 8b2dd8c24..722193cb0 100644
Binary files a/sample/14-mongoose-base/package-lock.json and b/sample/14-mongoose-base/package-lock.json differ
diff --git a/sample/14-mongoose-base/package.json b/sample/14-mongoose-base/package.json
index ecb7ef231..aa2d93b68 100644
--- a/sample/14-mongoose-base/package.json
+++ b/sample/14-mongoose-base/package.json
@@ -29,11 +29,11 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/jest": "27.4.0",
-    "@types/node": "16.11.25",
+    "@types/jest": "27.4.1",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "@typescript-eslint/eslint-plugin": "4.33.0",
     "@typescript-eslint/parser": "4.33.0",
@@ -44,7 +44,7 @@
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "typescript": "4.3.5"
diff --git a/sample/15-mvc/package-lock.json b/sample/15-mvc/package-lock.json
index a1ab804bf..702eed649 100644
Binary files a/sample/15-mvc/package-lock.json and b/sample/15-mvc/package-lock.json differ
diff --git a/sample/15-mvc/package.json b/sample/15-mvc/package.json
index 01e32cd94..826740233 100644
--- a/sample/15-mvc/package.json
+++ b/sample/15-mvc/package.json
@@ -30,16 +30,16 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/node": "16.11.25",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "jest": "27.5.1",
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "@typescript-eslint/eslint-plugin": "4.33.0",
diff --git a/sample/16-gateways-ws/package-lock.json b/sample/16-gateways-ws/package-lock.json
index ec58f2770..644c9c453 100644
Binary files a/sample/16-gateways-ws/package-lock.json and b/sample/16-gateways-ws/package-lock.json differ
diff --git a/sample/16-gateways-ws/package.json b/sample/16-gateways-ws/package.json
index ed7dedc0c..a5d024427 100644
--- a/sample/16-gateways-ws/package.json
+++ b/sample/16-gateways-ws/package.json
@@ -34,16 +34,16 @@
   "devDependencies": {
     "@types/ws": "7.4.7",
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/node": "16.11.25",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "jest": "27.5.1",
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "@typescript-eslint/eslint-plugin": "4.33.0",
diff --git a/sample/17-mvc-fastify/package-lock.json b/sample/17-mvc-fastify/package-lock.json
index 38cfece2b..7193960fe 100644
Binary files a/sample/17-mvc-fastify/package-lock.json and b/sample/17-mvc-fastify/package-lock.json differ
diff --git a/sample/17-mvc-fastify/package.json b/sample/17-mvc-fastify/package.json
index 740d998a3..e2c4eb63f 100644
--- a/sample/17-mvc-fastify/package.json
+++ b/sample/17-mvc-fastify/package.json
@@ -31,10 +31,10 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.7",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/node": "16.11.25",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "@typescript-eslint/eslint-plugin": "4.33.0",
     "@typescript-eslint/parser": "4.33.0",
@@ -45,7 +45,7 @@
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "typescript": "4.3.5"
diff --git a/sample/18-context/package-lock.json b/sample/18-context/package-lock.json
index 39d8df37a..907d5026c 100644
Binary files a/sample/18-context/package-lock.json and b/sample/18-context/package-lock.json differ
diff --git a/sample/18-context/package.json b/sample/18-context/package.json
index b90c4ddfa..af397b8f3 100644
--- a/sample/18-context/package.json
+++ b/sample/18-context/package.json
@@ -27,14 +27,14 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
-    "@types/node": "16.11.25",
+    "@nestjs/schematics": "8.0.8",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "jest": "27.5.1",
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "@typescript-eslint/eslint-plugin": "4.33.0",
diff --git a/sample/19-auth-jwt/package-lock.json b/sample/19-auth-jwt/package-lock.json
index 8668754ac..bbde2473e 100644
Binary files a/sample/19-auth-jwt/package-lock.json and b/sample/19-auth-jwt/package-lock.json differ
diff --git a/sample/19-auth-jwt/package.json b/sample/19-auth-jwt/package.json
index 6a48e2f61..b1fd1c297 100644
--- a/sample/19-auth-jwt/package.json
+++ b/sample/19-auth-jwt/package.json
@@ -34,17 +34,17 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/jest": "27.4.0",
-    "@types/node": "16.11.25",
+    "@types/jest": "27.4.1",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "jest": "27.5.1",
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "@typescript-eslint/eslint-plugin": "4.33.0",
diff --git a/sample/20-cache/package-lock.json b/sample/20-cache/package-lock.json
index 2a9943c86..c4f66a4a0 100644
Binary files a/sample/20-cache/package-lock.json and b/sample/20-cache/package-lock.json differ
diff --git a/sample/20-cache/package.json b/sample/20-cache/package.json
index f0e3a974e..0429ef329 100644
--- a/sample/20-cache/package.json
+++ b/sample/20-cache/package.json
@@ -30,16 +30,16 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/node": "16.11.25",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "jest": "27.5.1",
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "@typescript-eslint/eslint-plugin": "4.33.0",
diff --git a/sample/21-serializer/package-lock.json b/sample/21-serializer/package-lock.json
index b3d2ef0be..e38ad4229 100644
Binary files a/sample/21-serializer/package-lock.json and b/sample/21-serializer/package-lock.json differ
diff --git a/sample/21-serializer/package.json b/sample/21-serializer/package.json
index 1d4445b39..25bbfbfd5 100644
--- a/sample/21-serializer/package.json
+++ b/sample/21-serializer/package.json
@@ -29,16 +29,16 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/node": "16.11.25",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "jest": "27.5.1",
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "@typescript-eslint/eslint-plugin": "4.33.0",
diff --git a/sample/22-graphql-prisma/package-lock.json b/sample/22-graphql-prisma/package-lock.json
index e68a4ce04..c613518e9 100644
Binary files a/sample/22-graphql-prisma/package-lock.json and b/sample/22-graphql-prisma/package-lock.json differ
diff --git a/sample/22-graphql-prisma/package.json b/sample/22-graphql-prisma/package.json
index 851c1b828..4f1f230d5 100644
--- a/sample/22-graphql-prisma/package.json
+++ b/sample/22-graphql-prisma/package.json
@@ -34,16 +34,16 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/node": "16.11.25",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "jest": "27.5.1",
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "@typescript-eslint/eslint-plugin": "4.33.0",
diff --git a/sample/23-graphql-code-first/package-lock.json b/sample/23-graphql-code-first/package-lock.json
index 2e89e7c4d..a988bfdd9 100644
Binary files a/sample/23-graphql-code-first/package-lock.json and b/sample/23-graphql-code-first/package-lock.json differ
diff --git a/sample/23-graphql-code-first/package.json b/sample/23-graphql-code-first/package.json
index 7a81d07fe..9656a8d21 100644
--- a/sample/23-graphql-code-first/package.json
+++ b/sample/23-graphql-code-first/package.json
@@ -36,16 +36,16 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/node": "16.11.25",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "jest": "27.5.1",
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "@typescript-eslint/eslint-plugin": "4.33.0",
diff --git a/sample/23-graphql-code-first/schema.gql b/sample/23-graphql-code-first/schema.gql
index e11c56434..4df716415 100644
--- a/sample/23-graphql-code-first/schema.gql
+++ b/sample/23-graphql-code-first/schema.gql
@@ -2,13 +2,15 @@
 # THIS FILE WAS AUTOMATICALLY GENERATED (DO NOT MODIFY)
 # ------------------------------------------------------
 
+directive @upper on FIELD_DEFINITION
+
 """recipe """
 type Recipe {
   id: ID!
-  title: String!
   description: String
   creationDate: Date!
   ingredients: [String!]!
+  title: String!
 }
 
 """Date custom scalar type"""
diff --git a/sample/23-graphql-code-first/src/app.module.ts b/sample/23-graphql-code-first/src/app.module.ts
index 481e79ced..2b32aa272 100644
--- a/sample/23-graphql-code-first/src/app.module.ts
+++ b/sample/23-graphql-code-first/src/app.module.ts
@@ -1,6 +1,7 @@
 import { ApolloDriver, ApolloDriverConfig } from '@nestjs/apollo';
 import { Module } from '@nestjs/common';
 import { GraphQLModule } from '@nestjs/graphql';
+import { DirectiveLocation, GraphQLDirective } from 'graphql';
 import { upperDirectiveTransformer } from './common/directives/upper-case.directive';
 import { RecipesModule } from './recipes/recipes.module';
 
@@ -12,6 +13,14 @@ import { RecipesModule } from './recipes/recipes.module';
       autoSchemaFile: 'schema.gql',
       transformSchema: schema => upperDirectiveTransformer(schema, 'upper'),
       installSubscriptionHandlers: true,
+      buildSchemaOptions: {
+        directives: [
+          new GraphQLDirective({
+            name: 'upper',
+            locations: [DirectiveLocation.FIELD_DEFINITION],
+          }),
+        ],
+      },
     }),
   ],
 })
diff --git a/sample/23-graphql-code-first/src/recipes/models/recipe.model.ts b/sample/23-graphql-code-first/src/recipes/models/recipe.model.ts
index 2193b2310..ef0a772bc 100644
--- a/sample/23-graphql-code-first/src/recipes/models/recipe.model.ts
+++ b/sample/23-graphql-code-first/src/recipes/models/recipe.model.ts
@@ -1,11 +1,11 @@
-import { Field, ID, ObjectType } from '@nestjs/graphql';
+import { Directive, Field, ID, ObjectType } from '@nestjs/graphql';
 
 @ObjectType({ description: 'recipe ' })
 export class Recipe {
   @Field(type => ID)
   id: string;
 
-  @Field()
+  @Directive('@upper')
   title: string;
 
   @Field({ nullable: true })
diff --git a/sample/24-serve-static/package-lock.json b/sample/24-serve-static/package-lock.json
index 1851c5c10..79bbbed4e 100644
Binary files a/sample/24-serve-static/package-lock.json and b/sample/24-serve-static/package-lock.json differ
diff --git a/sample/24-serve-static/package.json b/sample/24-serve-static/package.json
index 58e8a3717..b91fa8539 100644
--- a/sample/24-serve-static/package.json
+++ b/sample/24-serve-static/package.json
@@ -31,16 +31,16 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/node": "16.11.25",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "jest": "27.5.1",
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "@typescript-eslint/eslint-plugin": "4.33.0",
diff --git a/sample/25-dynamic-modules/package-lock.json b/sample/25-dynamic-modules/package-lock.json
index 8f3d69d38..3eaeea0b9 100644
Binary files a/sample/25-dynamic-modules/package-lock.json and b/sample/25-dynamic-modules/package-lock.json differ
diff --git a/sample/25-dynamic-modules/package.json b/sample/25-dynamic-modules/package.json
index 7c63a61fe..0ac6b93e7 100644
--- a/sample/25-dynamic-modules/package.json
+++ b/sample/25-dynamic-modules/package.json
@@ -30,17 +30,17 @@
   "devDependencies": {
     "@types/dotenv": "8.2.0",
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/jest": "27.4.0",
-    "@types/node": "16.11.25",
+    "@types/jest": "27.4.1",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "jest": "27.5.1",
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "@typescript-eslint/eslint-plugin": "4.33.0",
diff --git a/sample/26-queues/package-lock.json b/sample/26-queues/package-lock.json
index b05c25d3a..74ffc81f2 100644
Binary files a/sample/26-queues/package-lock.json and b/sample/26-queues/package-lock.json differ
diff --git a/sample/26-queues/package.json b/sample/26-queues/package.json
index 7c53f9d3a..ba61b32f1 100644
--- a/sample/26-queues/package.json
+++ b/sample/26-queues/package.json
@@ -31,19 +31,19 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/bull": "3.15.8",
     "@types/dotenv": "8.2.0",
     "@types/express": "4.17.13",
-    "@types/jest": "27.4.0",
-    "@types/node": "16.11.25",
+    "@types/jest": "27.4.1",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "jest": "27.5.1",
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "@typescript-eslint/eslint-plugin": "4.33.0",
diff --git a/sample/27-scheduling/package-lock.json b/sample/27-scheduling/package-lock.json
index 4bb349413..86d3f8746 100644
Binary files a/sample/27-scheduling/package-lock.json and b/sample/27-scheduling/package-lock.json differ
diff --git a/sample/27-scheduling/package.json b/sample/27-scheduling/package.json
index fefa24d69..4bc054eab 100644
--- a/sample/27-scheduling/package.json
+++ b/sample/27-scheduling/package.json
@@ -30,19 +30,19 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/bull": "3.15.8",
     "@types/dotenv": "8.2.0",
     "@types/express": "4.17.13",
-    "@types/jest": "27.4.0",
-    "@types/node": "16.11.25",
+    "@types/jest": "27.4.1",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "jest": "27.5.1",
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "@typescript-eslint/eslint-plugin": "4.33.0",
diff --git a/sample/28-sse/package-lock.json b/sample/28-sse/package-lock.json
index bc25d693a..dfe3c6c91 100644
Binary files a/sample/28-sse/package-lock.json and b/sample/28-sse/package-lock.json differ
diff --git a/sample/28-sse/package.json b/sample/28-sse/package.json
index 18c7a5ed0..3ab54338c 100644
--- a/sample/28-sse/package.json
+++ b/sample/28-sse/package.json
@@ -28,18 +28,18 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/dotenv": "8.2.0",
     "@types/express": "4.17.13",
-    "@types/jest": "27.4.0",
-    "@types/node": "16.11.25",
+    "@types/jest": "27.4.1",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "jest": "27.5.1",
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "@typescript-eslint/eslint-plugin": "4.33.0",
diff --git a/sample/29-file-upload/package-lock.json b/sample/29-file-upload/package-lock.json
index a0202e3c3..2f075e23a 100644
Binary files a/sample/29-file-upload/package-lock.json and b/sample/29-file-upload/package-lock.json differ
diff --git a/sample/29-file-upload/package.json b/sample/29-file-upload/package.json
index c1b9c96b9..df8e1d605 100644
--- a/sample/29-file-upload/package.json
+++ b/sample/29-file-upload/package.json
@@ -30,18 +30,18 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/jest": "27.4.0",
+    "@types/jest": "27.4.1",
     "@types/multer": "1.4.7",
-    "@types/node": "16.11.25",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "jest": "27.5.1",
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "@typescript-eslint/eslint-plugin": "4.33.0",
diff --git a/sample/30-event-emitter/package-lock.json b/sample/30-event-emitter/package-lock.json
index a58baae71..e93ae381c 100644
Binary files a/sample/30-event-emitter/package-lock.json and b/sample/30-event-emitter/package-lock.json differ
diff --git a/sample/30-event-emitter/package.json b/sample/30-event-emitter/package.json
index 1b70ef84e..548e648b9 100644
--- a/sample/30-event-emitter/package.json
+++ b/sample/30-event-emitter/package.json
@@ -29,11 +29,11 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/jest": "27.4.0",
-    "@types/node": "16.11.25",
+    "@types/jest": "27.4.1",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "@typescript-eslint/eslint-plugin": "4.33.0",
     "@typescript-eslint/parser": "4.33.0",
@@ -44,7 +44,7 @@
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "typescript": "4.3.5"
diff --git a/sample/30-event-emitter/test/app.e2e-spec.ts b/sample/30-event-emitter/test/app.e2e-spec.ts
index 50cda6233..1fac95f6b 100644
--- a/sample/30-event-emitter/test/app.e2e-spec.ts
+++ b/sample/30-event-emitter/test/app.e2e-spec.ts
@@ -21,4 +21,6 @@ describe('AppController (e2e)', () => {
       .expect(200)
       .expect('Hello World!');
   });
+  
+  afterEach(() => app.close());
 });
diff --git a/sample/31-graphql-federation-code-first/gateway/package-lock.json b/sample/31-graphql-federation-code-first/gateway/package-lock.json
index ceefa2725..04cb1eb31 100644
Binary files a/sample/31-graphql-federation-code-first/gateway/package-lock.json and b/sample/31-graphql-federation-code-first/gateway/package-lock.json differ
diff --git a/sample/31-graphql-federation-code-first/gateway/package.json b/sample/31-graphql-federation-code-first/gateway/package.json
index b86c4ff0b..da6d62a0e 100644
--- a/sample/31-graphql-federation-code-first/gateway/package.json
+++ b/sample/31-graphql-federation-code-first/gateway/package.json
@@ -29,7 +29,7 @@
     "@nestjs/platform-express": "8.2.3",
     "apollo-server-express": "3.6.2",
     "graphql": "15.7.2",
-    "graphql-tools": "7.0.5",
+    "graphql-tools": "8.0.0",
     "reflect-metadata": "0.1.13",
     "rimraf": "3.0.2",
     "rxjs": "7.4.0",
@@ -37,11 +37,11 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/jest": "27.4.0",
-    "@types/node": "16.11.25",
+    "@types/jest": "27.4.1",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "@typescript-eslint/eslint-plugin": "4.33.0",
     "@typescript-eslint/parser": "4.33.0",
@@ -52,7 +52,7 @@
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "typescript": "4.3.5"
diff --git a/sample/31-graphql-federation-code-first/posts-application/package-lock.json b/sample/31-graphql-federation-code-first/posts-application/package-lock.json
index fb1b4a90d..025537d4d 100644
Binary files a/sample/31-graphql-federation-code-first/posts-application/package-lock.json and b/sample/31-graphql-federation-code-first/posts-application/package-lock.json differ
diff --git a/sample/31-graphql-federation-code-first/posts-application/package.json b/sample/31-graphql-federation-code-first/posts-application/package.json
index c58fcc112..5ef3c4f38 100644
--- a/sample/31-graphql-federation-code-first/posts-application/package.json
+++ b/sample/31-graphql-federation-code-first/posts-application/package.json
@@ -31,7 +31,7 @@
     "@nestjs/platform-express": "8.2.3",
     "apollo-server-express": "3.6.2",
     "graphql": "15.7.2",
-    "graphql-tools": "7.0.5",
+    "graphql-tools": "8.0.0",
     "reflect-metadata": "0.1.13",
     "rimraf": "3.0.2",
     "rxjs": "7.4.0",
@@ -39,11 +39,11 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/jest": "27.4.0",
-    "@types/node": "16.11.25",
+    "@types/jest": "27.4.1",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "@typescript-eslint/eslint-plugin": "4.33.0",
     "@typescript-eslint/parser": "4.33.0",
@@ -54,7 +54,7 @@
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "typescript": "4.3.5"
diff --git a/sample/31-graphql-federation-code-first/users-application/package-lock.json b/sample/31-graphql-federation-code-first/users-application/package-lock.json
index 1b6a4b869..41c680a0e 100644
Binary files a/sample/31-graphql-federation-code-first/users-application/package-lock.json and b/sample/31-graphql-federation-code-first/users-application/package-lock.json differ
diff --git a/sample/31-graphql-federation-code-first/users-application/package.json b/sample/31-graphql-federation-code-first/users-application/package.json
index ffbde5458..ede2439a5 100644
--- a/sample/31-graphql-federation-code-first/users-application/package.json
+++ b/sample/31-graphql-federation-code-first/users-application/package.json
@@ -30,7 +30,7 @@
     "@nestjs/platform-express": "8.2.3",
     "apollo-server-express": "3.6.2",
     "graphql": "15.7.2",
-    "graphql-tools": "7.0.5",
+    "graphql-tools": "8.0.0",
     "reflect-metadata": "0.1.13",
     "rimraf": "3.0.2",
     "rxjs": "7.4.0",
@@ -38,11 +38,11 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/jest": "27.4.0",
-    "@types/node": "16.11.25",
+    "@types/jest": "27.4.1",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "@typescript-eslint/eslint-plugin": "4.33.0",
     "@typescript-eslint/parser": "4.33.0",
@@ -53,7 +53,7 @@
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "typescript": "4.3.5"
diff --git a/sample/32-graphql-federation-schema-first/gateway/package-lock.json b/sample/32-graphql-federation-schema-first/gateway/package-lock.json
index fa9edb335..cb349e3d8 100644
Binary files a/sample/32-graphql-federation-schema-first/gateway/package-lock.json and b/sample/32-graphql-federation-schema-first/gateway/package-lock.json differ
diff --git a/sample/32-graphql-federation-schema-first/gateway/package.json b/sample/32-graphql-federation-schema-first/gateway/package.json
index e7308f2b1..c24fea6c6 100644
--- a/sample/32-graphql-federation-schema-first/gateway/package.json
+++ b/sample/32-graphql-federation-schema-first/gateway/package.json
@@ -29,7 +29,7 @@
     "@nestjs/platform-express": "8.2.3",
     "apollo-server-express": "3.6.2",
     "graphql": "15.7.2",
-    "graphql-tools": "7.0.5",
+    "graphql-tools": "8.0.0",
     "reflect-metadata": "0.1.13",
     "rimraf": "3.0.2",
     "rxjs": "7.4.0",
@@ -37,11 +37,11 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/jest": "27.4.0",
-    "@types/node": "16.11.25",
+    "@types/jest": "27.4.1",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "@typescript-eslint/eslint-plugin": "4.33.0",
     "@typescript-eslint/parser": "4.33.0",
@@ -52,7 +52,7 @@
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "typescript": "4.3.5"
diff --git a/sample/32-graphql-federation-schema-first/posts-application/package-lock.json b/sample/32-graphql-federation-schema-first/posts-application/package-lock.json
index 94b735f7b..b07ac6e28 100644
Binary files a/sample/32-graphql-federation-schema-first/posts-application/package-lock.json and b/sample/32-graphql-federation-schema-first/posts-application/package-lock.json differ
diff --git a/sample/32-graphql-federation-schema-first/posts-application/package.json b/sample/32-graphql-federation-schema-first/posts-application/package.json
index c8778d69a..445e1d1ec 100644
--- a/sample/32-graphql-federation-schema-first/posts-application/package.json
+++ b/sample/32-graphql-federation-schema-first/posts-application/package.json
@@ -31,7 +31,7 @@
     "@nestjs/platform-express": "8.2.3",
     "apollo-server-express": "3.6.2",
     "graphql": "15.7.2",
-    "graphql-tools": "7.0.5",
+    "graphql-tools": "8.0.0",
     "reflect-metadata": "0.1.13",
     "rimraf": "3.0.2",
     "rxjs": "7.4.0",
@@ -39,11 +39,11 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/jest": "27.4.0",
-    "@types/node": "16.11.25",
+    "@types/jest": "27.4.1",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "@typescript-eslint/eslint-plugin": "4.33.0",
     "@typescript-eslint/parser": "4.33.0",
@@ -54,7 +54,7 @@
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "typescript": "4.3.5"
diff --git a/sample/32-graphql-federation-schema-first/users-application/package-lock.json b/sample/32-graphql-federation-schema-first/users-application/package-lock.json
index d06551674..ac482ea88 100644
Binary files a/sample/32-graphql-federation-schema-first/users-application/package-lock.json and b/sample/32-graphql-federation-schema-first/users-application/package-lock.json differ
diff --git a/sample/32-graphql-federation-schema-first/users-application/package.json b/sample/32-graphql-federation-schema-first/users-application/package.json
index 7a4bb7bb4..c5358a6a3 100644
--- a/sample/32-graphql-federation-schema-first/users-application/package.json
+++ b/sample/32-graphql-federation-schema-first/users-application/package.json
@@ -30,7 +30,7 @@
     "@nestjs/platform-express": "8.2.3",
     "apollo-server-express": "3.6.2",
     "graphql": "15.7.2",
-    "graphql-tools": "7.0.5",
+    "graphql-tools": "8.0.0",
     "reflect-metadata": "0.1.13",
     "rimraf": "3.0.2",
     "rxjs": "7.4.0",
@@ -38,11 +38,11 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/jest": "27.4.0",
-    "@types/node": "16.11.25",
+    "@types/jest": "27.4.1",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
     "@typescript-eslint/eslint-plugin": "4.33.0",
     "@typescript-eslint/parser": "4.33.0",
@@ -53,7 +53,7 @@
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "typescript": "4.3.5"
diff --git a/sample/33-graphql-mercurius/package-lock.json b/sample/33-graphql-mercurius/package-lock.json
index 482a902a6..7a9866999 100644
Binary files a/sample/33-graphql-mercurius/package-lock.json and b/sample/33-graphql-mercurius/package-lock.json differ
diff --git a/sample/33-graphql-mercurius/package.json b/sample/33-graphql-mercurius/package.json
index cf235c078..5ce073daf 100644
--- a/sample/33-graphql-mercurius/package.json
+++ b/sample/33-graphql-mercurius/package.json
@@ -33,16 +33,16 @@
   },
   "devDependencies": {
     "@nestjs/cli": "8.1.5",
-    "@nestjs/schematics": "8.0.6",
+    "@nestjs/schematics": "8.0.8",
     "@nestjs/testing": "8.2.3",
     "@types/express": "4.17.13",
-    "@types/node": "16.11.25",
+    "@types/node": "16.11.26",
     "@types/supertest": "2.0.11",
-    "jest": "27.3.1",
+    "jest": "27.5.1",
     "prettier": "2.5.1",
     "supertest": "6.1.6",
     "ts-jest": "27.0.7",
-    "ts-loader": "9.2.6",
+    "ts-loader": "9.2.8",
     "ts-node": "10.4.0",
     "tsconfig-paths": "3.11.0",
     "@typescript-eslint/eslint-plugin": "4.33.0",
diff --git a/tsconfig.json b/tsconfig.json
index 036b1a814..5712f3c0c 100644
--- a/tsconfig.json
+++ b/tsconfig.json
@@ -8,6 +8,7 @@
     "noLib": false,
     "emitDecoratorMetadata": true,
     "experimentalDecorators": true,
+    "useUnknownInCatchVariables": false,
     "target": "es6",
     "sourceMap": true,
     "allowJs": true,
