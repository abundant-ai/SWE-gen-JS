diff --git a/.travis.yml b/.travis.yml
index 263d976..46897f4 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -15,8 +15,12 @@ script:
   - npm run test-cov
 
 env:
+  - NODE=8 TYPESCRIPT=typescript@1.6
+  - NODE=8 TYPESCRIPT=typescript@1.7
+  - NODE=8 TYPESCRIPT=typescript@1.8
   - NODE=8 TYPESCRIPT=typescript@2.0
-  - NODE=6 TYPESCRIPT=typescript@latest
+  - NODE=8 TYPESCRIPT=typescript@2.1
+  - NODE=4 TYPESCRIPT=typescript@latest
   - NODE=8 TYPESCRIPT=typescript@latest
   - NODE=8 TYPESCRIPT=typescript@next
 
diff --git a/README.md b/README.md
index 6099d21..b11a961 100644
--- a/README.md
+++ b/README.md
@@ -4,8 +4,9 @@
 [![NPM downloads][downloads-image]][downloads-url]
 [![Build status][travis-image]][travis-url]
 [![Test coverage][coveralls-image]][coveralls-url]
+[![Greenkeeper badge](https://badges.greenkeeper.io/TypeStrong/ts-node.svg)](https://greenkeeper.io/)
 
-> TypeScript execution environment and REPL for node. **Works with `typescript@>=2.0`**.
+> TypeScript execution environment and REPL for node. **Works with `typescript@>=1.5`**.
 
 ## Installation
 
@@ -21,7 +22,7 @@ npm install -g typescript
 * Execute TypeScript files with node
 * Interactive REPL
 * Execute (and print) TypeScript through the CLI
-* Source map support
+* Uses source maps
 * Loads compiler options and `.d.ts` files from `tsconfig.json`
 
 ## Usage
@@ -47,9 +48,7 @@ echo "console.log('Hello, world!')" | ts-node
 
 ### Programmatic
 
-You can require `ts-node` and register the loader for future requires by using `require('ts-node').register({ /* options */ })`. You can also use the shortcuts `node -r ts-node/register` or `node -r ts-node/register/type-check` depending on your preferences.
-
-**Note:** If you need to use advanced node.js CLI arguments, use `node -r ts-node/register` instead of the `ts-node` CLI.
+You can require `ts-node` and register the loader for future requires by using `require('ts-node').register({ /* options */ })`. You can also use the shortcut files `node -r ts-node/register` or `node -r ts-node/register/type-check` depending on your preferences.
 
 ### Mocha
 
@@ -68,57 +67,42 @@ ts-node node_modules/tape/bin/tape [...args]
 ### Gulp
 
 ```sh
-# Create a `gulpfile.ts` and run `gulp`.
+# Just create a `gulpfile.ts` and run `gulp`.
 gulp
 ```
 
 ## How It Works
 
-**TypeScript Node** works by registering the TypeScript compiler for the `.ts`, `.tsx` and, with `allowJs` enabled, `.js` extensions. When node.js has a file extension registered (the `require.extensions` object), it will use the extension internally for module resolution. When an extension is unknown to node.js, it will handle the file as `.js` (JavaScript).
+**TypeScript Node** works by registering the TypeScript compiler for the `.ts`, `.tsx` and - when `allowJs` is enabled - `.js` extensions. When node.js has a file extension registered (the `require.extensions` object), it will use the extension internally with module resolution. By default, when an extension is unknown to node.js, it will fallback to handling the file as `.js` (JavaScript).
 
-**P.S.** This means if you don't register an extension, it is compiled as JavaScript. When `ts-node` is used with `allowJs`, JavaScript files are transpiled using the TypeScript compiler.
+**P.S.** This means that if you don't register an extension, it'll be compiled as JavaScript. When `ts-node` is used with `allowJs`, JavaScript files are transpiled using the TypeScript compiler.
 
 ## Loading `tsconfig.json`
 
-**Typescript Node** uses `tsconfig.json` automatically, use `--skip-project` to skip loading `tsconfig.json`.
+**Typescript Node** uses `tsconfig.json` automatically, use `--no-project` to skip loading `tsconfig.json`.
 
 **NOTE**: You can use `ts-node` together with [tsconfig-paths](https://www.npmjs.com/package/tsconfig-paths) to load modules according to the `paths` section in `tsconfig.json`.
 
 ## Configuration Options
 
-You can set options by passing them before the script path, via programmatic usage or via environment variables.
+You can set options by passing them in before the script.
+
+**Note:** These are in addition to the [node.js CLI arguments](https://nodejs.org/api/cli.html).
 
 ```sh
-ts-node --compiler ntypescript --project src/tsconfig.json hello-world.ts
+ts-node --compiler ntypescript --project src --ignoreWarnings 2304 hello-world.ts
 ```
 
-### CLI Options
-
-Support `--print`, `--eval` and `--require` from [node.js CLI options](https://nodejs.org/api/cli.html).
-
-* `--help` Prints help text
-* `--version` Prints version information
-
-### CLI and Programmatic Options
-
-_Environment variable denoted in parentheses._
-
-* `--typeCheck` Enable type checking for TypeScript (`TS_NODE_TYPE_CHECK`)
-* `--cacheDirectory` Configure the output file cache directory (`TS_NODE_CACHE_DIRECTORY`)
-* `-I, --ignore [pattern]` Override the path patterns to skip compilation (`TS_NODE_IGNORE`)
-* `-P, --project [path]` Path to TypeScript JSON project file (`TS_NODE_PROJECT`)
-* `-C, --compiler [name]` Specify a custom TypeScript compiler (`TS_NODE_COMPILER`)
-* `-D, --ignoreDiagnostics [code]` Ignore TypeScript warnings by diagnostic code (`TS_NODE_IGNORE_DIAGNOSTICS`)
-* `-O, --compilerOptions [opts]` JSON object to merge with compiler options (`TS_NODE_COMPILER_OPTIONS`)
-* `--no-cache` Disable the local TypeScript Node cache (`TS_NODE_CACHE`)
-* `--skip-project` Skip project config resolution and loading (`TS_NODE_SKIP_IGNORE`)
-* `--skip-ignore` Skip ignore checks (`TS_NODE_SKIP_PROJECT`)
-
-### Programmatic Only Options
+* **--project, -P** Path to load TypeScript configuration from (JSON file, a directory containing `tsconfig.json`, or `--no-project`/`false` to disable) (also `process.env.TS_NODE_PROJECT`)
+* **--compiler, -C** Use a custom, require-able TypeScript compiler compatible with `typescript@>=1.5.0-alpha` (also `process.env.TS_NODE_COMPILER`)
+* **--ignore** Specify an array of regular expression strings for `ts-node` to skip compiling as TypeScript (defaults to `/node_modules/`, `--no-ignore`/`false` to disable) (also `process.env.TS_NODE_IGNORE`)
+* **--ignoreWarnings, -I** Set an array of TypeScript diagnostic codes to ignore (also `process.env.TS_NODE_IGNORE_WARNINGS`)
+* **--compilerOptions, -O** Set compiler options using JSON (E.g. `--compilerOptions '{"target":"es6"}'`) (also `process.env.TS_NODE_COMPILER_OPTIONS`)
+* **--type-check** Use TypeScript with type checking (also `process.env.TS_NODE_TYPE_CHECK`)
+* **--no-cache** Skip hitting the compiled JavaScript cache (also `process.env.TS_NODE_CACHE`)
+* **--cache-directory** Configure the TypeScript cache directory (also `process.env.TS_NODE_CACHE_DIRECTORY`)
 
-* `transformers` An array of transformers to pass to TypeScript
-* `readFile` Custom TypeScript-compatible file reading function
-* `fileExists` Custom TypeScript-compatible file existence function
+Additionally, the `transformers` option may be provided when programmatically registering `ts-node` to specify custom TypeScript transformers.
 
 ## License
 
diff --git a/package-lock.json b/package-lock.json
deleted file mode 100644
index 5747fee..0000000
--- a/package-lock.json
+++ /dev/null
@@ -1,1236 +0,0 @@
-{
-  "name": "ts-node",
-  "version": "4.1.0",
-  "lockfileVersion": 1,
-  "requires": true,
-  "dependencies": {
-    "@types/arrify": {
-      "version": "1.0.2",
-      "resolved": "https://registry.npmjs.org/@types/arrify/-/arrify-1.0.2.tgz",
-      "integrity": "sha512-gB1Oqypj/WbMjnWyCcvQdynRyfusKtqzUpt+EN/OtgFcjikC7ZV4qzS3SLbO1Ai2B0iVSgWvwR9A49lZGfivYg==",
-      "dev": true
-    },
-    "@types/chai": {
-      "version": "4.0.10",
-      "resolved": "https://registry.npmjs.org/@types/chai/-/chai-4.0.10.tgz",
-      "integrity": "sha512-Ejh1AXTY8lm+x91X/yar3G2z4x9RyKwdTVdyyu7Xj3dNB35fMNCnEWqTO9FgS3zjzlRNqk1MruYhgb8yhRN9rA==",
-      "dev": true
-    },
-    "@types/diff": {
-      "version": "3.2.2",
-      "resolved": "https://registry.npmjs.org/@types/diff/-/diff-3.2.2.tgz",
-      "integrity": "sha512-q3zfJvaTroV5BjAAR+peTHEGAAhGrPX0z2EzCzpt2mwFA+qzUn2nigJLqSekXRtdULKmT8am7zjvTMZSapIgHw==",
-      "dev": true
-    },
-    "@types/minimist": {
-      "version": "1.2.0",
-      "resolved": "https://registry.npmjs.org/@types/minimist/-/minimist-1.2.0.tgz",
-      "integrity": "sha1-aaI6OtKcrwCX8G7aWbNh7i8GOfY=",
-      "dev": true
-    },
-    "@types/mkdirp": {
-      "version": "0.5.2",
-      "resolved": "https://registry.npmjs.org/@types/mkdirp/-/mkdirp-0.5.2.tgz",
-      "integrity": "sha512-U5icWpv7YnZYGsN4/cmh3WD2onMY0aJIiTE6+51TwJCttdHvtCYmkBNOobHlXwrJRL0nkH9jH4kD+1FAdMN4Tg==",
-      "dev": true,
-      "requires": {
-        "@types/node": "9.4.6"
-      }
-    },
-    "@types/mocha": {
-      "version": "2.2.44",
-      "resolved": "https://registry.npmjs.org/@types/mocha/-/mocha-2.2.44.tgz",
-      "integrity": "sha512-k2tWTQU8G4+iSMvqKi0Q9IIsWAp/n8xzdZS4Q4YVIltApoMA00wFBFdlJnmoaK1/z7B0Cy0yPe6GgXteSmdUNw==",
-      "dev": true
-    },
-    "@types/node": {
-      "version": "9.4.6",
-      "resolved": "https://registry.npmjs.org/@types/node/-/node-9.4.6.tgz",
-      "integrity": "sha512-CTUtLb6WqCCgp6P59QintjHWqzf4VL1uPA27bipLAPxFqrtK1gEYllePzTICGqQ8rYsCbpnsNypXjjDzGAAjEQ==",
-      "dev": true
-    },
-    "@types/proxyquire": {
-      "version": "1.3.28",
-      "resolved": "https://registry.npmjs.org/@types/proxyquire/-/proxyquire-1.3.28.tgz",
-      "integrity": "sha512-SQaNzWQ2YZSr7FqAyPPiA3FYpux2Lqh3HWMZQk47x3xbMCqgC/w0dY3dw9rGqlweDDkrySQBcaScXWeR+Yb11Q==",
-      "dev": true
-    },
-    "@types/react": {
-      "version": "16.0.31",
-      "resolved": "https://registry.npmjs.org/@types/react/-/react-16.0.31.tgz",
-      "integrity": "sha512-ft7OuDGUo39e+9LGwUewf2RyEaNBOjWbHUmD5bzjNuSuDabccE/1IuO7iR0dkzLjVUKxTMq69E+FmKfbgBcfbQ==",
-      "dev": true
-    },
-    "@types/semver": {
-      "version": "5.4.0",
-      "resolved": "https://registry.npmjs.org/@types/semver/-/semver-5.4.0.tgz",
-      "integrity": "sha512-PBHCvO98hNec9A491vBbh0ZNDOVxccwKL1u2pm6fs9oDgm7SEnw0lEHqHfjsYryDxnE3zaf7LvERWEXjOp1hig==",
-      "dev": true
-    },
-    "@types/source-map-support": {
-      "version": "0.4.0",
-      "resolved": "https://registry.npmjs.org/@types/source-map-support/-/source-map-support-0.4.0.tgz",
-      "integrity": "sha512-9oVAi1Jlr274pbMGPEe0S3IPImV9knVNafa6E4MookD/fjOZAE6EmLkFX5ZjtZ9OXNPi2FCIZzUSMvwAUUKeSg==",
-      "dev": true,
-      "requires": {
-        "@types/node": "9.4.6"
-      }
-    },
-    "@types/yn": {
-      "version": "github:types/npm-yn#ca75f6c82940fae6a06fb41d2d37a6aa9b4ea8e9",
-      "dev": true
-    },
-    "abbrev": {
-      "version": "1.0.9",
-      "resolved": "https://registry.npmjs.org/abbrev/-/abbrev-1.0.9.tgz",
-      "integrity": "sha1-kbR5JYinc4wl813W9jdSovh3YTU=",
-      "dev": true
-    },
-    "align-text": {
-      "version": "0.1.4",
-      "resolved": "https://registry.npmjs.org/align-text/-/align-text-0.1.4.tgz",
-      "integrity": "sha1-DNkKVhCT810KmSVsIrcGlDP60Rc=",
-      "dev": true,
-      "requires": {
-        "kind-of": "3.2.2",
-        "longest": "1.0.1",
-        "repeat-string": "1.6.1"
-      }
-    },
-    "amdefine": {
-      "version": "1.0.1",
-      "resolved": "https://registry.npmjs.org/amdefine/-/amdefine-1.0.1.tgz",
-      "integrity": "sha1-SlKCrBZHKek2Gbz9OtFR+BfOkfU=",
-      "dev": true
-    },
-    "ansi-regex": {
-      "version": "2.1.1",
-      "resolved": "https://registry.npmjs.org/ansi-regex/-/ansi-regex-2.1.1.tgz",
-      "integrity": "sha1-w7M6te42DYbg5ijwRorn7yfWVN8=",
-      "dev": true
-    },
-    "ansi-styles": {
-      "version": "3.2.0",
-      "resolved": "https://registry.npmjs.org/ansi-styles/-/ansi-styles-3.2.0.tgz",
-      "integrity": "sha512-NnSOmMEYtVR2JVMIGTzynRkkaxtiq1xnFBcdQD/DnNCYPoEPsVJhM98BDyaoNOQIi7p4okdi3E27eN7GQbsUug==",
-      "requires": {
-        "color-convert": "1.9.1"
-      }
-    },
-    "argparse": {
-      "version": "1.0.9",
-      "resolved": "https://registry.npmjs.org/argparse/-/argparse-1.0.9.tgz",
-      "integrity": "sha1-c9g7wmP4bpf4zE9rrhsOkKfSLIY=",
-      "dev": true,
-      "requires": {
-        "sprintf-js": "1.0.3"
-      }
-    },
-    "arrify": {
-      "version": "1.0.1",
-      "resolved": "https://registry.npmjs.org/arrify/-/arrify-1.0.1.tgz",
-      "integrity": "sha1-iYUI2iIm84DfkEcoRWhJwVAaSw0="
-    },
-    "asap": {
-      "version": "2.0.6",
-      "resolved": "https://registry.npmjs.org/asap/-/asap-2.0.6.tgz",
-      "integrity": "sha1-5QNHYR1+aQlDIIu9r+vLwvuGbUY=",
-      "dev": true
-    },
-    "assertion-error": {
-      "version": "1.0.2",
-      "resolved": "https://registry.npmjs.org/assertion-error/-/assertion-error-1.0.2.tgz",
-      "integrity": "sha1-E8pRXYYgbaC6xm6DTdOX2HWBCUw=",
-      "dev": true
-    },
-    "async": {
-      "version": "1.5.2",
-      "resolved": "https://registry.npmjs.org/async/-/async-1.5.2.tgz",
-      "integrity": "sha1-7GphrlZIDAw8skHJVhjiCJL5Zyo=",
-      "dev": true
-    },
-    "babel-code-frame": {
-      "version": "6.26.0",
-      "resolved": "https://registry.npmjs.org/babel-code-frame/-/babel-code-frame-6.26.0.tgz",
-      "integrity": "sha1-Y/1D99weO7fONZR9uP42mj9Yx0s=",
-      "dev": true,
-      "requires": {
-        "chalk": "1.1.3",
-        "esutils": "2.0.2",
-        "js-tokens": "3.0.2"
-      },
-      "dependencies": {
-        "ansi-styles": {
-          "version": "2.2.1",
-          "resolved": "https://registry.npmjs.org/ansi-styles/-/ansi-styles-2.2.1.tgz",
-          "integrity": "sha1-tDLdM1i2NM914eRmQ2gkBTPB3b4=",
-          "dev": true
-        },
-        "chalk": {
-          "version": "1.1.3",
-          "resolved": "https://registry.npmjs.org/chalk/-/chalk-1.1.3.tgz",
-          "integrity": "sha1-qBFcVeSnAv5NFQq9OHKCKn4J/Jg=",
-          "dev": true,
-          "requires": {
-            "ansi-styles": "2.2.1",
-            "escape-string-regexp": "1.0.5",
-            "has-ansi": "2.0.0",
-            "strip-ansi": "3.0.1",
-            "supports-color": "2.0.0"
-          }
-        },
-        "supports-color": {
-          "version": "2.0.0",
-          "resolved": "https://registry.npmjs.org/supports-color/-/supports-color-2.0.0.tgz",
-          "integrity": "sha1-U10EXOa2Nj+kARcIRimZXp3zJMc=",
-          "dev": true
-        }
-      }
-    },
-    "balanced-match": {
-      "version": "1.0.0",
-      "resolved": "https://registry.npmjs.org/balanced-match/-/balanced-match-1.0.0.tgz",
-      "integrity": "sha1-ibTRmasr7kneFk6gK4nORi1xt2c=",
-      "dev": true
-    },
-    "brace-expansion": {
-      "version": "1.1.8",
-      "resolved": "https://registry.npmjs.org/brace-expansion/-/brace-expansion-1.1.8.tgz",
-      "integrity": "sha1-wHshHHyVLsH479Uad+8NHTmQopI=",
-      "dev": true,
-      "requires": {
-        "balanced-match": "1.0.0",
-        "concat-map": "0.0.1"
-      }
-    },
-    "browser-stdout": {
-      "version": "1.3.0",
-      "resolved": "https://registry.npmjs.org/browser-stdout/-/browser-stdout-1.3.0.tgz",
-      "integrity": "sha1-81HTKWnTL6XXpVZxVCY9korjvR8=",
-      "dev": true
-    },
-    "builtin-modules": {
-      "version": "1.1.1",
-      "resolved": "https://registry.npmjs.org/builtin-modules/-/builtin-modules-1.1.1.tgz",
-      "integrity": "sha1-Jw8HbFpywC9bZaR9+Uxf46J4iS8=",
-      "dev": true
-    },
-    "camelcase": {
-      "version": "1.2.1",
-      "resolved": "https://registry.npmjs.org/camelcase/-/camelcase-1.2.1.tgz",
-      "integrity": "sha1-m7UwTS4LVmmLLHWLCKPqqdqlijk=",
-      "dev": true,
-      "optional": true
-    },
-    "center-align": {
-      "version": "0.1.3",
-      "resolved": "https://registry.npmjs.org/center-align/-/center-align-0.1.3.tgz",
-      "integrity": "sha1-qg0yYptu6XIgBBHL1EYckHvCt60=",
-      "dev": true,
-      "optional": true,
-      "requires": {
-        "align-text": "0.1.4",
-        "lazy-cache": "1.0.4"
-      }
-    },
-    "chai": {
-      "version": "4.1.2",
-      "resolved": "https://registry.npmjs.org/chai/-/chai-4.1.2.tgz",
-      "integrity": "sha1-D2RYS6ZC8PKs4oBiefTwbKI61zw=",
-      "dev": true,
-      "requires": {
-        "assertion-error": "1.0.2",
-        "check-error": "1.0.2",
-        "deep-eql": "3.0.1",
-        "get-func-name": "2.0.0",
-        "pathval": "1.1.0",
-        "type-detect": "4.0.5"
-      }
-    },
-    "chalk": {
-      "version": "2.3.0",
-      "resolved": "https://registry.npmjs.org/chalk/-/chalk-2.3.0.tgz",
-      "integrity": "sha512-Az5zJR2CBujap2rqXGaJKaPHyJ0IrUimvYNX+ncCy8PJP4ltOGTrHUIo097ZaL2zMeKYpiCdqDvS6zdrTFok3Q==",
-      "requires": {
-        "ansi-styles": "3.2.0",
-        "escape-string-regexp": "1.0.5",
-        "supports-color": "4.5.0"
-      }
-    },
-    "check-error": {
-      "version": "1.0.2",
-      "resolved": "https://registry.npmjs.org/check-error/-/check-error-1.0.2.tgz",
-      "integrity": "sha1-V00xLt2Iu13YkS6Sht1sCu1KrII=",
-      "dev": true
-    },
-    "cliui": {
-      "version": "2.1.0",
-      "resolved": "https://registry.npmjs.org/cliui/-/cliui-2.1.0.tgz",
-      "integrity": "sha1-S0dXYP+AJkx2LDoXGQMukcf+oNE=",
-      "dev": true,
-      "optional": true,
-      "requires": {
-        "center-align": "0.1.3",
-        "right-align": "0.1.3",
-        "wordwrap": "0.0.2"
-      },
-      "dependencies": {
-        "wordwrap": {
-          "version": "0.0.2",
-          "resolved": "https://registry.npmjs.org/wordwrap/-/wordwrap-0.0.2.tgz",
-          "integrity": "sha1-t5Zpu0LstAn4PVg8rVLKF+qhZD8=",
-          "dev": true,
-          "optional": true
-        }
-      }
-    },
-    "color-convert": {
-      "version": "1.9.1",
-      "resolved": "https://registry.npmjs.org/color-convert/-/color-convert-1.9.1.tgz",
-      "integrity": "sha512-mjGanIiwQJskCC18rPR6OmrZ6fm2Lc7PeGFYwCmy5J34wC6F1PzdGL6xeMfmgicfYcNLGuVFA3WzXtIDCQSZxQ==",
-      "requires": {
-        "color-name": "1.1.3"
-      }
-    },
-    "color-name": {
-      "version": "1.1.3",
-      "resolved": "https://registry.npmjs.org/color-name/-/color-name-1.1.3.tgz",
-      "integrity": "sha1-p9BVi9icQveV3UIyj3QIMcpTvCU="
-    },
-    "commander": {
-      "version": "2.11.0",
-      "resolved": "https://registry.npmjs.org/commander/-/commander-2.11.0.tgz",
-      "integrity": "sha512-b0553uYA5YAEGgyYIGYROzKQ7X5RAqedkfjiZxwi0kL1g3bOaBNNZfYkzt/CL0umgD5wc9Jec2FbB98CjkMRvQ==",
-      "dev": true
-    },
-    "concat-map": {
-      "version": "0.0.1",
-      "resolved": "https://registry.npmjs.org/concat-map/-/concat-map-0.0.1.tgz",
-      "integrity": "sha1-2Klr13/Wjfd5OnMDajug1UBdR3s=",
-      "dev": true
-    },
-    "core-js": {
-      "version": "1.2.7",
-      "resolved": "https://registry.npmjs.org/core-js/-/core-js-1.2.7.tgz",
-      "integrity": "sha1-ZSKUwUZR2yj6k70tX/KYOk8IxjY=",
-      "dev": true
-    },
-    "debug": {
-      "version": "3.1.0",
-      "resolved": "https://registry.npmjs.org/debug/-/debug-3.1.0.tgz",
-      "integrity": "sha512-OX8XqP7/1a9cqkxYw2yXss15f26NKWBpDXQd0/uK/KPqdQhxbPa994hnzjcE2VqQpDslf55723cKPUOGSmMY3g==",
-      "dev": true,
-      "requires": {
-        "ms": "2.0.0"
-      }
-    },
-    "decamelize": {
-      "version": "1.2.0",
-      "resolved": "https://registry.npmjs.org/decamelize/-/decamelize-1.2.0.tgz",
-      "integrity": "sha1-9lNNFRSCabIDUue+4m9QH5oZEpA=",
-      "dev": true,
-      "optional": true
-    },
-    "deep-eql": {
-      "version": "3.0.1",
-      "resolved": "https://registry.npmjs.org/deep-eql/-/deep-eql-3.0.1.tgz",
-      "integrity": "sha512-+QeIQyN5ZuO+3Uk5DYh6/1eKO0m0YmJFGNmFHGACpf1ClL1nmlV/p4gNgbl2pJGxgXb4faqo6UE+M5ACEMyVcw==",
-      "dev": true,
-      "requires": {
-        "type-detect": "4.0.5"
-      }
-    },
-    "deep-is": {
-      "version": "0.1.3",
-      "resolved": "https://registry.npmjs.org/deep-is/-/deep-is-0.1.3.tgz",
-      "integrity": "sha1-s2nW+128E+7PUk+RsHD+7cNXzzQ=",
-      "dev": true
-    },
-    "diff": {
-      "version": "3.4.0",
-      "resolved": "https://registry.npmjs.org/diff/-/diff-3.4.0.tgz",
-      "integrity": "sha512-QpVuMTEoJMF7cKzi6bvWhRulU1fZqZnvyVQgNhPaxxuTYwyjn/j1v9falseQ/uXWwPnO56RBfwtg4h/EQXmucA=="
-    },
-    "doctrine": {
-      "version": "0.7.2",
-      "resolved": "https://registry.npmjs.org/doctrine/-/doctrine-0.7.2.tgz",
-      "integrity": "sha1-fLhgNZujvpDgQLJrcpzkv6ZUxSM=",
-      "dev": true,
-      "requires": {
-        "esutils": "1.1.6",
-        "isarray": "0.0.1"
-      },
-      "dependencies": {
-        "esutils": {
-          "version": "1.1.6",
-          "resolved": "https://registry.npmjs.org/esutils/-/esutils-1.1.6.tgz",
-          "integrity": "sha1-wBzKqa5LiXxtDD4hCuUvPHqEQ3U=",
-          "dev": true
-        }
-      }
-    },
-    "encoding": {
-      "version": "0.1.12",
-      "resolved": "https://registry.npmjs.org/encoding/-/encoding-0.1.12.tgz",
-      "integrity": "sha1-U4tm8+5izRq1HsMjgp0flIDHS+s=",
-      "dev": true,
-      "requires": {
-        "iconv-lite": "0.4.19"
-      }
-    },
-    "escape-string-regexp": {
-      "version": "1.0.5",
-      "resolved": "https://registry.npmjs.org/escape-string-regexp/-/escape-string-regexp-1.0.5.tgz",
-      "integrity": "sha1-G2HAViGQqN/2rjuyzwIAyhMLhtQ="
-    },
-    "escodegen": {
-      "version": "1.8.1",
-      "resolved": "https://registry.npmjs.org/escodegen/-/escodegen-1.8.1.tgz",
-      "integrity": "sha1-WltTr0aTEQvrsIZ6o0MN07cKEBg=",
-      "dev": true,
-      "requires": {
-        "esprima": "2.7.3",
-        "estraverse": "1.9.3",
-        "esutils": "2.0.2",
-        "optionator": "0.8.2",
-        "source-map": "0.2.0"
-      },
-      "dependencies": {
-        "source-map": {
-          "version": "0.2.0",
-          "resolved": "https://registry.npmjs.org/source-map/-/source-map-0.2.0.tgz",
-          "integrity": "sha1-2rc/vPwrqBm03gO9b26qSBZLP50=",
-          "dev": true,
-          "optional": true,
-          "requires": {
-            "amdefine": "1.0.1"
-          }
-        }
-      }
-    },
-    "esprima": {
-      "version": "2.7.3",
-      "resolved": "https://registry.npmjs.org/esprima/-/esprima-2.7.3.tgz",
-      "integrity": "sha1-luO3DVd59q1JzQMmc9HDEnZ7pYE=",
-      "dev": true
-    },
-    "estraverse": {
-      "version": "1.9.3",
-      "resolved": "https://registry.npmjs.org/estraverse/-/estraverse-1.9.3.tgz",
-      "integrity": "sha1-r2fy3JIlgkFZUJJgkaQAXSnJu0Q=",
-      "dev": true
-    },
-    "esutils": {
-      "version": "2.0.2",
-      "resolved": "https://registry.npmjs.org/esutils/-/esutils-2.0.2.tgz",
-      "integrity": "sha1-Cr9PHKpbyx96nYrMbepPqqBLrJs=",
-      "dev": true
-    },
-    "fast-levenshtein": {
-      "version": "2.0.6",
-      "resolved": "https://registry.npmjs.org/fast-levenshtein/-/fast-levenshtein-2.0.6.tgz",
-      "integrity": "sha1-PYpcZog6FqMMqGQ+hR8Zuqd5eRc=",
-      "dev": true
-    },
-    "fbjs": {
-      "version": "0.8.16",
-      "resolved": "https://registry.npmjs.org/fbjs/-/fbjs-0.8.16.tgz",
-      "integrity": "sha1-XmdDL1UNxBtXK/VYR7ispk5TN9s=",
-      "dev": true,
-      "requires": {
-        "core-js": "1.2.7",
-        "isomorphic-fetch": "2.2.1",
-        "loose-envify": "1.3.1",
-        "object-assign": "4.1.1",
-        "promise": "7.3.1",
-        "setimmediate": "1.0.5",
-        "ua-parser-js": "0.7.17"
-      }
-    },
-    "fill-keys": {
-      "version": "1.0.2",
-      "resolved": "https://registry.npmjs.org/fill-keys/-/fill-keys-1.0.2.tgz",
-      "integrity": "sha1-mo+jb06K1jTjv2tPPIiCVRRS6yA=",
-      "dev": true,
-      "requires": {
-        "is-object": "1.0.1",
-        "merge-descriptors": "1.0.1"
-      }
-    },
-    "fs.realpath": {
-      "version": "1.0.0",
-      "resolved": "https://registry.npmjs.org/fs.realpath/-/fs.realpath-1.0.0.tgz",
-      "integrity": "sha1-FQStJSMVjKpA20onh8sBQRmU6k8=",
-      "dev": true
-    },
-    "get-func-name": {
-      "version": "2.0.0",
-      "resolved": "https://registry.npmjs.org/get-func-name/-/get-func-name-2.0.0.tgz",
-      "integrity": "sha1-6td0q+5y4gQJQzoGY2YCPdaIekE=",
-      "dev": true
-    },
-    "glob": {
-      "version": "5.0.15",
-      "resolved": "https://registry.npmjs.org/glob/-/glob-5.0.15.tgz",
-      "integrity": "sha1-G8k2ueAvSmA/zCIuz3Yz0wuLk7E=",
-      "dev": true,
-      "requires": {
-        "inflight": "1.0.6",
-        "inherits": "2.0.3",
-        "minimatch": "3.0.4",
-        "once": "1.4.0",
-        "path-is-absolute": "1.0.1"
-      }
-    },
-    "growl": {
-      "version": "1.10.3",
-      "resolved": "https://registry.npmjs.org/growl/-/growl-1.10.3.tgz",
-      "integrity": "sha512-hKlsbA5Vu3xsh1Cg3J7jSmX/WaW6A5oBeqzM88oNbCRQFz+zUaXm6yxS4RVytp1scBoJzSYl4YAEOQIt6O8V1Q==",
-      "dev": true
-    },
-    "handlebars": {
-      "version": "4.0.11",
-      "resolved": "https://registry.npmjs.org/handlebars/-/handlebars-4.0.11.tgz",
-      "integrity": "sha1-Ywo13+ApS8KB7a5v/F0yn8eYLcw=",
-      "dev": true,
-      "requires": {
-        "async": "1.5.2",
-        "optimist": "0.6.1",
-        "source-map": "0.4.4",
-        "uglify-js": "2.8.29"
-      },
-      "dependencies": {
-        "source-map": {
-          "version": "0.4.4",
-          "resolved": "https://registry.npmjs.org/source-map/-/source-map-0.4.4.tgz",
-          "integrity": "sha1-66T12pwNyZneaAMti092FzZSA2s=",
-          "dev": true,
-          "requires": {
-            "amdefine": "1.0.1"
-          }
-        }
-      }
-    },
-    "has-ansi": {
-      "version": "2.0.0",
-      "resolved": "https://registry.npmjs.org/has-ansi/-/has-ansi-2.0.0.tgz",
-      "integrity": "sha1-NPUEnOHs3ysGSa8+8k5F7TVBbZE=",
-      "dev": true,
-      "requires": {
-        "ansi-regex": "2.1.1"
-      }
-    },
-    "has-flag": {
-      "version": "2.0.0",
-      "resolved": "https://registry.npmjs.org/has-flag/-/has-flag-2.0.0.tgz",
-      "integrity": "sha1-6CB68cx7MNRGzHC3NLXovhj4jVE="
-    },
-    "he": {
-      "version": "1.1.1",
-      "resolved": "https://registry.npmjs.org/he/-/he-1.1.1.tgz",
-      "integrity": "sha1-k0EP0hsAlzUVH4howvJx80J+I/0=",
-      "dev": true
-    },
-    "iconv-lite": {
-      "version": "0.4.19",
-      "resolved": "https://registry.npmjs.org/iconv-lite/-/iconv-lite-0.4.19.tgz",
-      "integrity": "sha512-oTZqweIP51xaGPI4uPa56/Pri/480R+mo7SeU+YETByQNhDG55ycFyNLIgta9vXhILrxXDmF7ZGhqZIcuN0gJQ==",
-      "dev": true
-    },
-    "inflight": {
-      "version": "1.0.6",
-      "resolved": "https://registry.npmjs.org/inflight/-/inflight-1.0.6.tgz",
-      "integrity": "sha1-Sb1jMdfQLQwJvJEKEHW6gWW1bfk=",
-      "dev": true,
-      "requires": {
-        "once": "1.4.0",
-        "wrappy": "1.0.2"
-      }
-    },
-    "inherits": {
-      "version": "2.0.3",
-      "resolved": "https://registry.npmjs.org/inherits/-/inherits-2.0.3.tgz",
-      "integrity": "sha1-Yzwsg+PaQqUC9SRmAiSA9CCCYd4=",
-      "dev": true
-    },
-    "is-buffer": {
-      "version": "1.1.6",
-      "resolved": "https://registry.npmjs.org/is-buffer/-/is-buffer-1.1.6.tgz",
-      "integrity": "sha512-NcdALwpXkTm5Zvvbk7owOUSvVvBKDgKP5/ewfXEznmQFfs4ZRmanOeKBTjRVjka3QFoN6XJ+9F3USqfHqTaU5w==",
-      "dev": true
-    },
-    "is-object": {
-      "version": "1.0.1",
-      "resolved": "https://registry.npmjs.org/is-object/-/is-object-1.0.1.tgz",
-      "integrity": "sha1-iVJojF7C/9awPsyF52ngKQMINHA=",
-      "dev": true
-    },
-    "is-stream": {
-      "version": "1.1.0",
-      "resolved": "https://registry.npmjs.org/is-stream/-/is-stream-1.1.0.tgz",
-      "integrity": "sha1-EtSj3U5o4Lec6428hBc66A2RykQ=",
-      "dev": true
-    },
-    "isarray": {
-      "version": "0.0.1",
-      "resolved": "https://registry.npmjs.org/isarray/-/isarray-0.0.1.tgz",
-      "integrity": "sha1-ihis/Kmo9Bd+Cav8YDiTmwXR7t8=",
-      "dev": true
-    },
-    "isexe": {
-      "version": "2.0.0",
-      "resolved": "https://registry.npmjs.org/isexe/-/isexe-2.0.0.tgz",
-      "integrity": "sha1-6PvzdNxVb/iUehDcsFctYz8s+hA=",
-      "dev": true
-    },
-    "isomorphic-fetch": {
-      "version": "2.2.1",
-      "resolved": "https://registry.npmjs.org/isomorphic-fetch/-/isomorphic-fetch-2.2.1.tgz",
-      "integrity": "sha1-YRrhrPFPXoH3KVB0coGf6XM1WKk=",
-      "dev": true,
-      "requires": {
-        "node-fetch": "1.7.3",
-        "whatwg-fetch": "2.0.3"
-      }
-    },
-    "istanbul": {
-      "version": "0.4.5",
-      "resolved": "https://registry.npmjs.org/istanbul/-/istanbul-0.4.5.tgz",
-      "integrity": "sha1-ZcfXPUxNqE1POsMQuRj7C4Azczs=",
-      "dev": true,
-      "requires": {
-        "abbrev": "1.0.9",
-        "async": "1.5.2",
-        "escodegen": "1.8.1",
-        "esprima": "2.7.3",
-        "glob": "5.0.15",
-        "handlebars": "4.0.11",
-        "js-yaml": "3.10.0",
-        "mkdirp": "0.5.1",
-        "nopt": "3.0.6",
-        "once": "1.4.0",
-        "resolve": "1.1.7",
-        "supports-color": "3.2.3",
-        "which": "1.3.0",
-        "wordwrap": "1.0.0"
-      },
-      "dependencies": {
-        "has-flag": {
-          "version": "1.0.0",
-          "resolved": "https://registry.npmjs.org/has-flag/-/has-flag-1.0.0.tgz",
-          "integrity": "sha1-nZ55MWXOAXoA8AQYxD+UKnsdEfo=",
-          "dev": true
-        },
-        "supports-color": {
-          "version": "3.2.3",
-          "resolved": "https://registry.npmjs.org/supports-color/-/supports-color-3.2.3.tgz",
-          "integrity": "sha1-ZawFBLOVQXHYpklGsq48u4pfVPY=",
-          "dev": true,
-          "requires": {
-            "has-flag": "1.0.0"
-          }
-        }
-      }
-    },
-    "js-tokens": {
-      "version": "3.0.2",
-      "resolved": "https://registry.npmjs.org/js-tokens/-/js-tokens-3.0.2.tgz",
-      "integrity": "sha1-mGbfOVECEw449/mWvOtlRDIJwls=",
-      "dev": true
-    },
-    "js-yaml": {
-      "version": "3.10.0",
-      "resolved": "https://registry.npmjs.org/js-yaml/-/js-yaml-3.10.0.tgz",
-      "integrity": "sha512-O2v52ffjLa9VeM43J4XocZE//WT9N0IiwDa3KSHH7Tu8CtH+1qM8SIZvnsTh6v+4yFy5KUY3BHUVwjpfAWsjIA==",
-      "dev": true,
-      "requires": {
-        "argparse": "1.0.9",
-        "esprima": "4.0.0"
-      },
-      "dependencies": {
-        "esprima": {
-          "version": "4.0.0",
-          "resolved": "https://registry.npmjs.org/esprima/-/esprima-4.0.0.tgz",
-          "integrity": "sha512-oftTcaMu/EGrEIu904mWteKIv8vMuOgGYo7EhVJJN00R/EED9DCua/xxHRdYnKtcECzVg7xOWhflvJMnqcFZjw==",
-          "dev": true
-        }
-      }
-    },
-    "kind-of": {
-      "version": "3.2.2",
-      "resolved": "https://registry.npmjs.org/kind-of/-/kind-of-3.2.2.tgz",
-      "integrity": "sha1-MeohpzS6ubuw8yRm2JOupR5KPGQ=",
-      "dev": true,
-      "requires": {
-        "is-buffer": "1.1.6"
-      }
-    },
-    "lazy-cache": {
-      "version": "1.0.4",
-      "resolved": "https://registry.npmjs.org/lazy-cache/-/lazy-cache-1.0.4.tgz",
-      "integrity": "sha1-odePw6UEdMuAhF07O24dpJpEbo4=",
-      "dev": true,
-      "optional": true
-    },
-    "levn": {
-      "version": "0.3.0",
-      "resolved": "https://registry.npmjs.org/levn/-/levn-0.3.0.tgz",
-      "integrity": "sha1-OwmSTt+fCDwEkP3UwLxEIeBHZO4=",
-      "dev": true,
-      "requires": {
-        "prelude-ls": "1.1.2",
-        "type-check": "0.3.2"
-      }
-    },
-    "longest": {
-      "version": "1.0.1",
-      "resolved": "https://registry.npmjs.org/longest/-/longest-1.0.1.tgz",
-      "integrity": "sha1-MKCy2jj3N3DoKUoNIuZiXtd9AJc=",
-      "dev": true
-    },
-    "loose-envify": {
-      "version": "1.3.1",
-      "resolved": "https://registry.npmjs.org/loose-envify/-/loose-envify-1.3.1.tgz",
-      "integrity": "sha1-0aitM/qc4OcT1l/dCsi3SNR4yEg=",
-      "dev": true,
-      "requires": {
-        "js-tokens": "3.0.2"
-      }
-    },
-    "make-error": {
-      "version": "1.3.0",
-      "resolved": "https://registry.npmjs.org/make-error/-/make-error-1.3.0.tgz",
-      "integrity": "sha1-Uq06M5zPEM5itAQLcI/nByRLi5Y="
-    },
-    "merge-descriptors": {
-      "version": "1.0.1",
-      "resolved": "https://registry.npmjs.org/merge-descriptors/-/merge-descriptors-1.0.1.tgz",
-      "integrity": "sha1-sAqqVW3YtEVoFQ7J0blT8/kMu2E=",
-      "dev": true
-    },
-    "minimatch": {
-      "version": "3.0.4",
-      "resolved": "https://registry.npmjs.org/minimatch/-/minimatch-3.0.4.tgz",
-      "integrity": "sha512-yJHVQEhyqPLUTgt9B83PXu6W3rx4MvvHvSUvToogpwoGDOUQ+yDrR0HRot+yOCdCO7u4hX3pWft6kWBBcqh0UA==",
-      "dev": true,
-      "requires": {
-        "brace-expansion": "1.1.8"
-      }
-    },
-    "minimist": {
-      "version": "1.2.0",
-      "resolved": "https://registry.npmjs.org/minimist/-/minimist-1.2.0.tgz",
-      "integrity": "sha1-o1AIsg9BOD7sH7kU9M1d95omQoQ="
-    },
-    "mkdirp": {
-      "version": "0.5.1",
-      "resolved": "https://registry.npmjs.org/mkdirp/-/mkdirp-0.5.1.tgz",
-      "integrity": "sha1-MAV0OOrGz3+MR2fzhkjWaX11yQM=",
-      "requires": {
-        "minimist": "0.0.8"
-      },
-      "dependencies": {
-        "minimist": {
-          "version": "0.0.8",
-          "resolved": "https://registry.npmjs.org/minimist/-/minimist-0.0.8.tgz",
-          "integrity": "sha1-hX/Kv8M5fSYluCKCYuhqp6ARsF0="
-        }
-      }
-    },
-    "mocha": {
-      "version": "5.0.1",
-      "resolved": "https://registry.npmjs.org/mocha/-/mocha-5.0.1.tgz",
-      "integrity": "sha512-SpwyojlnE/WRBNGtvJSNfllfm5PqEDFxcWluSIgLeSBJtXG4DmoX2NNAeEA7rP5kK+79VgtVq8nG6HskaL1ykg==",
-      "dev": true,
-      "requires": {
-        "browser-stdout": "1.3.0",
-        "commander": "2.11.0",
-        "debug": "3.1.0",
-        "diff": "3.3.1",
-        "escape-string-regexp": "1.0.5",
-        "glob": "7.1.2",
-        "growl": "1.10.3",
-        "he": "1.1.1",
-        "mkdirp": "0.5.1",
-        "supports-color": "4.4.0"
-      },
-      "dependencies": {
-        "diff": {
-          "version": "3.3.1",
-          "resolved": "https://registry.npmjs.org/diff/-/diff-3.3.1.tgz",
-          "integrity": "sha512-MKPHZDMB0o6yHyDryUOScqZibp914ksXwAMYMTHj6KO8UeKsRYNJD3oNCKjTqZon+V488P7N/HzXF8t7ZR95ww==",
-          "dev": true
-        },
-        "glob": {
-          "version": "7.1.2",
-          "resolved": "https://registry.npmjs.org/glob/-/glob-7.1.2.tgz",
-          "integrity": "sha512-MJTUg1kjuLeQCJ+ccE4Vpa6kKVXkPYJ2mOCQyUuKLcLQsdrMCpBPUi8qVE6+YuaJkozeA9NusTAw3hLr8Xe5EQ==",
-          "dev": true,
-          "requires": {
-            "fs.realpath": "1.0.0",
-            "inflight": "1.0.6",
-            "inherits": "2.0.3",
-            "minimatch": "3.0.4",
-            "once": "1.4.0",
-            "path-is-absolute": "1.0.1"
-          }
-        },
-        "supports-color": {
-          "version": "4.4.0",
-          "resolved": "https://registry.npmjs.org/supports-color/-/supports-color-4.4.0.tgz",
-          "integrity": "sha512-rKC3+DyXWgK0ZLKwmRsrkyHVZAjNkfzeehuFWdGGcqGDTZFH73+RH6S/RDAAxl9GusSjZSUWYLmT9N5pzXFOXQ==",
-          "dev": true,
-          "requires": {
-            "has-flag": "2.0.0"
-          }
-        }
-      }
-    },
-    "module-not-found-error": {
-      "version": "1.0.1",
-      "resolved": "https://registry.npmjs.org/module-not-found-error/-/module-not-found-error-1.0.1.tgz",
-      "integrity": "sha1-z4tP9PKWQGdNbN0CsOO8UjwrvcA=",
-      "dev": true
-    },
-    "ms": {
-      "version": "2.0.0",
-      "resolved": "https://registry.npmjs.org/ms/-/ms-2.0.0.tgz",
-      "integrity": "sha1-VgiurfwAvmwpAd9fmGF4jeDVl8g=",
-      "dev": true
-    },
-    "node-fetch": {
-      "version": "1.7.3",
-      "resolved": "https://registry.npmjs.org/node-fetch/-/node-fetch-1.7.3.tgz",
-      "integrity": "sha512-NhZ4CsKx7cYm2vSrBAr2PvFOe6sWDf0UYLRqA6svUYg7+/TSfVAu49jYC4BvQ4Sms9SZgdqGBgroqfDhJdTyKQ==",
-      "dev": true,
-      "requires": {
-        "encoding": "0.1.12",
-        "is-stream": "1.1.0"
-      }
-    },
-    "nopt": {
-      "version": "3.0.6",
-      "resolved": "https://registry.npmjs.org/nopt/-/nopt-3.0.6.tgz",
-      "integrity": "sha1-xkZdvwirzU2zWTF/eaxopkayj/k=",
-      "dev": true,
-      "requires": {
-        "abbrev": "1.0.9"
-      }
-    },
-    "ntypescript": {
-      "version": "1.201706190042.1",
-      "resolved": "https://registry.npmjs.org/ntypescript/-/ntypescript-1.201706190042.1.tgz",
-      "integrity": "sha1-hmrpzDZoixQWBhVu0LzDXN9TYnE=",
-      "dev": true
-    },
-    "object-assign": {
-      "version": "4.1.1",
-      "resolved": "https://registry.npmjs.org/object-assign/-/object-assign-4.1.1.tgz",
-      "integrity": "sha1-IQmtx5ZYh8/AXLvUQsrIv7s2CGM=",
-      "dev": true
-    },
-    "once": {
-      "version": "1.4.0",
-      "resolved": "https://registry.npmjs.org/once/-/once-1.4.0.tgz",
-      "integrity": "sha1-WDsap3WWHUsROsF9nFC6753Xa9E=",
-      "dev": true,
-      "requires": {
-        "wrappy": "1.0.2"
-      }
-    },
-    "optimist": {
-      "version": "0.6.1",
-      "resolved": "https://registry.npmjs.org/optimist/-/optimist-0.6.1.tgz",
-      "integrity": "sha1-2j6nRob6IaGaERwybpDrFaAZZoY=",
-      "dev": true,
-      "requires": {
-        "minimist": "0.0.10",
-        "wordwrap": "0.0.3"
-      },
-      "dependencies": {
-        "minimist": {
-          "version": "0.0.10",
-          "resolved": "https://registry.npmjs.org/minimist/-/minimist-0.0.10.tgz",
-          "integrity": "sha1-3j+YVD2/lggr5IrRoMfNqDYwHc8=",
-          "dev": true
-        },
-        "wordwrap": {
-          "version": "0.0.3",
-          "resolved": "https://registry.npmjs.org/wordwrap/-/wordwrap-0.0.3.tgz",
-          "integrity": "sha1-o9XabNXAvAAI03I0u68b7WMFkQc=",
-          "dev": true
-        }
-      }
-    },
-    "optionator": {
-      "version": "0.8.2",
-      "resolved": "https://registry.npmjs.org/optionator/-/optionator-0.8.2.tgz",
-      "integrity": "sha1-NkxeQJ0/TWMB1sC0wFu6UBgK62Q=",
-      "dev": true,
-      "requires": {
-        "deep-is": "0.1.3",
-        "fast-levenshtein": "2.0.6",
-        "levn": "0.3.0",
-        "prelude-ls": "1.1.2",
-        "type-check": "0.3.2",
-        "wordwrap": "1.0.0"
-      }
-    },
-    "path-is-absolute": {
-      "version": "1.0.1",
-      "resolved": "https://registry.npmjs.org/path-is-absolute/-/path-is-absolute-1.0.1.tgz",
-      "integrity": "sha1-F0uSaHNVNP+8es5r9TpanhtcX18=",
-      "dev": true
-    },
-    "path-parse": {
-      "version": "1.0.5",
-      "resolved": "https://registry.npmjs.org/path-parse/-/path-parse-1.0.5.tgz",
-      "integrity": "sha1-PBrfhx6pzWyUMbbqK9dKD/BVxME=",
-      "dev": true
-    },
-    "pathval": {
-      "version": "1.1.0",
-      "resolved": "https://registry.npmjs.org/pathval/-/pathval-1.1.0.tgz",
-      "integrity": "sha1-uULm1L3mUwBe9rcTYd74cn0GReA=",
-      "dev": true
-    },
-    "prelude-ls": {
-      "version": "1.1.2",
-      "resolved": "https://registry.npmjs.org/prelude-ls/-/prelude-ls-1.1.2.tgz",
-      "integrity": "sha1-IZMqVJ9eUv/ZqCf1cOBL5iqX2lQ=",
-      "dev": true
-    },
-    "promise": {
-      "version": "7.3.1",
-      "resolved": "https://registry.npmjs.org/promise/-/promise-7.3.1.tgz",
-      "integrity": "sha512-nolQXZ/4L+bP/UGlkfaIujX9BKxGwmQ9OT4mOt5yvy8iK1h3wqTEJCijzGANTCCl9nWjY41juyAn2K3Q1hLLTg==",
-      "dev": true,
-      "requires": {
-        "asap": "2.0.6"
-      }
-    },
-    "prop-types": {
-      "version": "15.6.0",
-      "resolved": "https://registry.npmjs.org/prop-types/-/prop-types-15.6.0.tgz",
-      "integrity": "sha1-zq8IMCL8RrSjX2nhPvda7Q1jmFY=",
-      "dev": true,
-      "requires": {
-        "fbjs": "0.8.16",
-        "loose-envify": "1.3.1",
-        "object-assign": "4.1.1"
-      }
-    },
-    "proxyquire": {
-      "version": "1.8.0",
-      "resolved": "https://registry.npmjs.org/proxyquire/-/proxyquire-1.8.0.tgz",
-      "integrity": "sha1-AtUUpb7ZhvBMuyCTrxZ0FTX3ntw=",
-      "dev": true,
-      "requires": {
-        "fill-keys": "1.0.2",
-        "module-not-found-error": "1.0.1",
-        "resolve": "1.1.7"
-      }
-    },
-    "react": {
-      "version": "16.2.0",
-      "resolved": "https://registry.npmjs.org/react/-/react-16.2.0.tgz",
-      "integrity": "sha512-ZmIomM7EE1DvPEnSFAHZn9Vs9zJl5A9H7el0EGTE6ZbW9FKe/14IYAlPbC8iH25YarEQxZL+E8VW7Mi7kfQrDQ==",
-      "dev": true,
-      "requires": {
-        "fbjs": "0.8.16",
-        "loose-envify": "1.3.1",
-        "object-assign": "4.1.1",
-        "prop-types": "15.6.0"
-      }
-    },
-    "repeat-string": {
-      "version": "1.6.1",
-      "resolved": "https://registry.npmjs.org/repeat-string/-/repeat-string-1.6.1.tgz",
-      "integrity": "sha1-jcrkcOHIirwtYA//Sndihtp15jc=",
-      "dev": true
-    },
-    "resolve": {
-      "version": "1.1.7",
-      "resolved": "https://registry.npmjs.org/resolve/-/resolve-1.1.7.tgz",
-      "integrity": "sha1-IDEU2CrSxe2ejgQRs5ModeiJ6Xs=",
-      "dev": true
-    },
-    "right-align": {
-      "version": "0.1.3",
-      "resolved": "https://registry.npmjs.org/right-align/-/right-align-0.1.3.tgz",
-      "integrity": "sha1-YTObci/mo1FWiSENJOFMlhSGE+8=",
-      "dev": true,
-      "optional": true,
-      "requires": {
-        "align-text": "0.1.4"
-      }
-    },
-    "rimraf": {
-      "version": "2.6.2",
-      "resolved": "https://registry.npmjs.org/rimraf/-/rimraf-2.6.2.tgz",
-      "integrity": "sha512-lreewLK/BlghmxtfH36YYVg1i8IAce4TI7oao75I1g245+6BctqTVQiBP3YUJ9C6DQOXJmkYR9X9fCLtCOJc5w==",
-      "dev": true,
-      "requires": {
-        "glob": "7.1.2"
-      },
-      "dependencies": {
-        "glob": {
-          "version": "7.1.2",
-          "resolved": "https://registry.npmjs.org/glob/-/glob-7.1.2.tgz",
-          "integrity": "sha512-MJTUg1kjuLeQCJ+ccE4Vpa6kKVXkPYJ2mOCQyUuKLcLQsdrMCpBPUi8qVE6+YuaJkozeA9NusTAw3hLr8Xe5EQ==",
-          "dev": true,
-          "requires": {
-            "fs.realpath": "1.0.0",
-            "inflight": "1.0.6",
-            "inherits": "2.0.3",
-            "minimatch": "3.0.4",
-            "once": "1.4.0",
-            "path-is-absolute": "1.0.1"
-          }
-        }
-      }
-    },
-    "semver": {
-      "version": "5.4.1",
-      "resolved": "https://registry.npmjs.org/semver/-/semver-5.4.1.tgz",
-      "integrity": "sha512-WfG/X9+oATh81XtllIo/I8gOiY9EXRdv1cQdyykeXK17YcUW3EXUAi2To4pcH6nZtJPr7ZOpM5OMyWJZm+8Rsg==",
-      "dev": true
-    },
-    "setimmediate": {
-      "version": "1.0.5",
-      "resolved": "https://registry.npmjs.org/setimmediate/-/setimmediate-1.0.5.tgz",
-      "integrity": "sha1-KQy7Iy4waULX1+qbg3Mqt4VvgoU=",
-      "dev": true
-    },
-    "source-map": {
-      "version": "0.6.1",
-      "resolved": "https://registry.npmjs.org/source-map/-/source-map-0.6.1.tgz",
-      "integrity": "sha512-UjgapumWlbMhkBgzT7Ykc5YXUT46F0iKu8SGXq0bcwP5dz/h0Plj6enJqjz1Zbq2l5WaqYnrVbwWOWMyF3F47g=="
-    },
-    "source-map-support": {
-      "version": "0.5.3",
-      "resolved": "https://registry.npmjs.org/source-map-support/-/source-map-support-0.5.3.tgz",
-      "integrity": "sha512-eKkTgWYeBOQqFGXRfKabMFdnWepo51vWqEdoeikaEPFiJC7MCU5j2h4+6Q8npkZTeLGbSyecZvRxiSoWl3rh+w==",
-      "requires": {
-        "source-map": "0.6.1"
-      }
-    },
-    "sprintf-js": {
-      "version": "1.0.3",
-      "resolved": "https://registry.npmjs.org/sprintf-js/-/sprintf-js-1.0.3.tgz",
-      "integrity": "sha1-BOaSb2YolTVPPdAVIDYzuFcpfiw=",
-      "dev": true
-    },
-    "strip-ansi": {
-      "version": "3.0.1",
-      "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-3.0.1.tgz",
-      "integrity": "sha1-ajhfuIU9lS1f8F0Oiq+UJ43GPc8=",
-      "dev": true,
-      "requires": {
-        "ansi-regex": "2.1.1"
-      }
-    },
-    "supports-color": {
-      "version": "4.5.0",
-      "resolved": "https://registry.npmjs.org/supports-color/-/supports-color-4.5.0.tgz",
-      "integrity": "sha1-vnoN5ITexcXN34s9WRJQRJEvY1s=",
-      "requires": {
-        "has-flag": "2.0.0"
-      }
-    },
-    "tslib": {
-      "version": "1.8.1",
-      "resolved": "https://registry.npmjs.org/tslib/-/tslib-1.8.1.tgz",
-      "integrity": "sha1-aUavLR1lGnsYY7Ux1uWvpBqkTqw=",
-      "dev": true
-    },
-    "tslint": {
-      "version": "5.8.0",
-      "resolved": "https://registry.npmjs.org/tslint/-/tslint-5.8.0.tgz",
-      "integrity": "sha1-H0mtWy53x2w69N3K5VKuTjYS6xM=",
-      "dev": true,
-      "requires": {
-        "babel-code-frame": "6.26.0",
-        "builtin-modules": "1.1.1",
-        "chalk": "2.3.0",
-        "commander": "2.11.0",
-        "diff": "3.4.0",
-        "glob": "7.1.2",
-        "minimatch": "3.0.4",
-        "resolve": "1.5.0",
-        "semver": "5.4.1",
-        "tslib": "1.8.1",
-        "tsutils": "2.14.0"
-      },
-      "dependencies": {
-        "glob": {
-          "version": "7.1.2",
-          "resolved": "https://registry.npmjs.org/glob/-/glob-7.1.2.tgz",
-          "integrity": "sha512-MJTUg1kjuLeQCJ+ccE4Vpa6kKVXkPYJ2mOCQyUuKLcLQsdrMCpBPUi8qVE6+YuaJkozeA9NusTAw3hLr8Xe5EQ==",
-          "dev": true,
-          "requires": {
-            "fs.realpath": "1.0.0",
-            "inflight": "1.0.6",
-            "inherits": "2.0.3",
-            "minimatch": "3.0.4",
-            "once": "1.4.0",
-            "path-is-absolute": "1.0.1"
-          }
-        },
-        "resolve": {
-          "version": "1.5.0",
-          "resolved": "https://registry.npmjs.org/resolve/-/resolve-1.5.0.tgz",
-          "integrity": "sha512-hgoSGrc3pjzAPHNBg+KnFcK2HwlHTs/YrAGUr6qgTVUZmXv1UEXXl0bZNBKMA9fud6lRYFdPGz0xXxycPzmmiw==",
-          "dev": true,
-          "requires": {
-            "path-parse": "1.0.5"
-          }
-        }
-      }
-    },
-    "tslint-config-standard": {
-      "version": "7.0.0",
-      "resolved": "https://registry.npmjs.org/tslint-config-standard/-/tslint-config-standard-7.0.0.tgz",
-      "integrity": "sha512-QCrLt8WwiRgZpRSgRsk6cExy8/Vipa/5fHespm4Q1ly90EB6Lni04Ub8dkEW10bV3fPN3SkxEwj41ZOe/knCZA==",
-      "dev": true,
-      "requires": {
-        "tslint-eslint-rules": "4.1.1"
-      }
-    },
-    "tslint-eslint-rules": {
-      "version": "4.1.1",
-      "resolved": "https://registry.npmjs.org/tslint-eslint-rules/-/tslint-eslint-rules-4.1.1.tgz",
-      "integrity": "sha1-fDDniC8mvCdr/5HSOEl1xp2viLo=",
-      "dev": true,
-      "requires": {
-        "doctrine": "0.7.2",
-        "tslib": "1.8.1",
-        "tsutils": "1.9.1"
-      },
-      "dependencies": {
-        "tsutils": {
-          "version": "1.9.1",
-          "resolved": "https://registry.npmjs.org/tsutils/-/tsutils-1.9.1.tgz",
-          "integrity": "sha1-ufmrROVa+WgYMdXyjQrur1x1DLA=",
-          "dev": true
-        }
-      }
-    },
-    "tsutils": {
-      "version": "2.14.0",
-      "resolved": "https://registry.npmjs.org/tsutils/-/tsutils-2.14.0.tgz",
-      "integrity": "sha512-f6axSMV0RoUufiKiRQgmRlN1c+Ag+mDaZjcd6bHdvplT/zyhuMCGqw3pJS8s3+0x4EVkdoQajs9PchdDZlguvw==",
-      "dev": true,
-      "requires": {
-        "tslib": "1.8.1"
-      }
-    },
-    "type-check": {
-      "version": "0.3.2",
-      "resolved": "https://registry.npmjs.org/type-check/-/type-check-0.3.2.tgz",
-      "integrity": "sha1-WITKtRLPHTVeP7eE8wgEsrUg23I=",
-      "dev": true,
-      "requires": {
-        "prelude-ls": "1.1.2"
-      }
-    },
-    "type-detect": {
-      "version": "4.0.5",
-      "resolved": "https://registry.npmjs.org/type-detect/-/type-detect-4.0.5.tgz",
-      "integrity": "sha512-N9IvkQslUGYGC24RkJk1ba99foK6TkwC2FHAEBlQFBP0RxQZS8ZpJuAZcwiY/w9ZJHFQb1aOXBI60OdxhTrwEQ==",
-      "dev": true
-    },
-    "typescript": {
-      "version": "2.7.2",
-      "resolved": "https://registry.npmjs.org/typescript/-/typescript-2.7.2.tgz",
-      "integrity": "sha512-p5TCYZDAO0m4G344hD+wx/LATebLWZNkkh2asWUFqSsD2OrDNhbAHuSjobrmsUmdzjJjEeZVU9g1h3O6vpstnw==",
-      "dev": true
-    },
-    "ua-parser-js": {
-      "version": "0.7.17",
-      "resolved": "https://registry.npmjs.org/ua-parser-js/-/ua-parser-js-0.7.17.tgz",
-      "integrity": "sha512-uRdSdu1oA1rncCQL7sCj8vSyZkgtL7faaw9Tc9rZ3mGgraQ7+Pdx7w5mnOSF3gw9ZNG6oc+KXfkon3bKuROm0g==",
-      "dev": true
-    },
-    "uglify-js": {
-      "version": "2.8.29",
-      "resolved": "https://registry.npmjs.org/uglify-js/-/uglify-js-2.8.29.tgz",
-      "integrity": "sha1-KcVzMUgFe7Th913zW3qcty5qWd0=",
-      "dev": true,
-      "optional": true,
-      "requires": {
-        "source-map": "0.5.7",
-        "uglify-to-browserify": "1.0.2",
-        "yargs": "3.10.0"
-      },
-      "dependencies": {
-        "source-map": {
-          "version": "0.5.7",
-          "resolved": "https://registry.npmjs.org/source-map/-/source-map-0.5.7.tgz",
-          "integrity": "sha1-igOdLRAh0i0eoUyA2OpGi6LvP8w=",
-          "dev": true,
-          "optional": true
-        }
-      }
-    },
-    "uglify-to-browserify": {
-      "version": "1.0.2",
-      "resolved": "https://registry.npmjs.org/uglify-to-browserify/-/uglify-to-browserify-1.0.2.tgz",
-      "integrity": "sha1-bgkk1r2mta/jSeOabWMoUKD4grc=",
-      "dev": true,
-      "optional": true
-    },
-    "whatwg-fetch": {
-      "version": "2.0.3",
-      "resolved": "https://registry.npmjs.org/whatwg-fetch/-/whatwg-fetch-2.0.3.tgz",
-      "integrity": "sha1-nITsLc9oGH/wC8ZOEnS0QhduHIQ=",
-      "dev": true
-    },
-    "which": {
-      "version": "1.3.0",
-      "resolved": "https://registry.npmjs.org/which/-/which-1.3.0.tgz",
-      "integrity": "sha512-xcJpopdamTuY5duC/KnTTNBraPK54YwpenP4lzxU8H91GudWpFv38u0CKjclE1Wi2EH2EDz5LRcHcKbCIzqGyg==",
-      "dev": true,
-      "requires": {
-        "isexe": "2.0.0"
-      }
-    },
-    "window-size": {
-      "version": "0.1.0",
-      "resolved": "https://registry.npmjs.org/window-size/-/window-size-0.1.0.tgz",
-      "integrity": "sha1-VDjNLqk7IC76Ohn+iIeu58lPnJ0=",
-      "dev": true,
-      "optional": true
-    },
-    "wordwrap": {
-      "version": "1.0.0",
-      "resolved": "https://registry.npmjs.org/wordwrap/-/wordwrap-1.0.0.tgz",
-      "integrity": "sha1-J1hIEIkUVqQXHI0CJkQa3pDLyus=",
-      "dev": true
-    },
-    "wrappy": {
-      "version": "1.0.2",
-      "resolved": "https://registry.npmjs.org/wrappy/-/wrappy-1.0.2.tgz",
-      "integrity": "sha1-tSQ9jz7BqjXxNkYFvA0QNuMKtp8=",
-      "dev": true
-    },
-    "yargs": {
-      "version": "3.10.0",
-      "resolved": "https://registry.npmjs.org/yargs/-/yargs-3.10.0.tgz",
-      "integrity": "sha1-9+572FfdfB0tOMDnTvvWgdFDH9E=",
-      "dev": true,
-      "optional": true,
-      "requires": {
-        "camelcase": "1.2.1",
-        "cliui": "2.1.0",
-        "decamelize": "1.2.0",
-        "window-size": "0.1.0"
-      }
-    },
-    "yn": {
-      "version": "2.0.0",
-      "resolved": "https://registry.npmjs.org/yn/-/yn-2.0.0.tgz",
-      "integrity": "sha1-5a2ryKz0CPY4X8dklWhMiOavaJo="
-    }
-  }
-}
diff --git a/package.json b/package.json
index a12f8d1..c00af1b 100644
--- a/package.json
+++ b/package.json
@@ -5,7 +5,8 @@
   "main": "dist/index.js",
   "types": "dist/index.d.ts",
   "bin": {
-    "ts-node": "dist/bin.js"
+    "ts-node": "dist/bin.js",
+    "_ts-node": "dist/_bin.js"
   },
   "files": [
     "dist/",
@@ -13,7 +14,7 @@
     "LICENSE"
   ],
   "scripts": {
-    "lint": "tslint \"src/**/*.ts\" --project tsconfig.json",
+    "lint": "tslint \"src/**/*.ts\" --project tsconfig.json --type-check",
     "clean": "rimraf dist",
     "tsc": "tsc",
     "build": "npm run clean && npm run tsc",
@@ -49,20 +50,21 @@
   "homepage": "https://github.com/TypeStrong/ts-node",
   "devDependencies": {
     "@types/arrify": "^1.0.1",
-    "@types/chai": "^4.0.4",
     "@types/diff": "^3.2.1",
     "@types/minimist": "^1.2.0",
     "@types/mkdirp": "^0.5.0",
+    "@types/node": "^8.0.27",
+    "@types/source-map-support": "^0.4.0",
+    "@types/v8flags": "types/npm-v8flags#de224ae1cd5fd7dbb4e7158a6cc7a29e5315930d",
+    "@types/yn": "types/npm-yn#ca75f6c82940fae6a06fb41d2d37a6aa9b4ea8e9",
+    "@types/chai": "^4.0.4",
     "@types/mocha": "^2.2.42",
-    "@types/node": "^9.4.6",
     "@types/proxyquire": "^1.3.28",
     "@types/react": "^16.0.2",
     "@types/semver": "^5.3.34",
-    "@types/source-map-support": "^0.4.0",
-    "@types/yn": "types/npm-yn#ca75f6c82940fae6a06fb41d2d37a6aa9b4ea8e9",
     "chai": "^4.0.1",
     "istanbul": "^0.4.0",
-    "mocha": "^5.0.1",
+    "mocha": "^4.0.0",
     "ntypescript": "^1.201507091536.1",
     "proxyquire": "^1.7.2",
     "react": "^16.0.0",
@@ -70,7 +72,7 @@
     "semver": "^5.1.0",
     "tslint": "^5.0.0",
     "tslint-config-standard": "^7.0.0",
-    "typescript": "^2.7.2"
+    "typescript": "^2.4.1"
   },
   "dependencies": {
     "arrify": "^1.0.0",
@@ -79,7 +81,9 @@
     "make-error": "^1.1.1",
     "minimist": "^1.2.0",
     "mkdirp": "^0.5.1",
-    "source-map-support": "^0.5.3",
+    "source-map-support": "^0.5.0",
+    "tsconfig": "^7.0.0",
+    "v8flags": "^3.0.0",
     "yn": "^2.0.0"
   }
 }
diff --git a/src/_bin.ts b/src/_bin.ts
new file mode 100644
index 0000000..29897dc
--- /dev/null
+++ b/src/_bin.ts
@@ -0,0 +1,406 @@
+import { join, resolve } from 'path'
+import { start, Recoverable } from 'repl'
+import { inspect } from 'util'
+import arrify = require('arrify')
+import Module = require('module')
+import minimist = require('minimist')
+import chalk from 'chalk'
+import { diffLines } from 'diff'
+import { Script } from 'vm'
+import { register, VERSION, getFile, fileExists, TSError, parse, printError } from './index'
+
+interface Argv {
+  eval?: string
+  print?: string
+  typeCheck?: boolean
+  cache?: boolean
+  cacheDirectory?: string
+  version?: boolean
+  help?: boolean
+  compiler?: string
+  project?: string
+  require?: string | string[]
+  ignore?: boolean | string | string[]
+  ignoreWarnings?: string | string[]
+  compilerOptions?: any
+  _: string[]
+}
+
+const strings = ['eval', 'print', 'compiler', 'project', 'ignoreWarnings', 'require', 'cacheDirectory', 'ignore']
+const booleans = ['help', 'typeCheck', 'version', 'cache']
+
+const aliases: { [key: string]: string[] } = {
+  help: ['h'],
+  version: ['v'],
+  eval: ['e'],
+  print: ['p'],
+  project: ['P'],
+  compiler: ['C'],
+  require: ['r'],
+  typeCheck: ['type-check'],
+  cacheDirectory: ['cache-directory'],
+  ignoreWarnings: ['I', 'ignore-warnings'],
+  compilerOptions: ['O', 'compiler-options']
+}
+
+let stop = process.argv.length
+
+function isFlagOnly (arg: string) {
+  const name = arg.replace(/^--?/, '')
+
+  // The value is part of this argument.
+  if (/=/.test(name) || /^--no-/.test(arg)) {
+    return true
+  }
+
+  for (const bool of booleans) {
+    if (name === bool) {
+      return true
+    }
+
+    const alias = aliases[bool]
+
+    if (alias) {
+      for (const other of alias) {
+        if (other === name) {
+          return true
+        }
+      }
+    }
+  }
+
+  return false
+}
+
+// Hack around known subarg issue with `stopEarly`.
+for (let i = 2; i < process.argv.length; i++) {
+  const arg = process.argv[i]
+  const next = process.argv[i + 1]
+
+  if (/^\[/.test(arg) || /\]$/.test(arg)) {
+    continue
+  }
+
+  if (/^-/.test(arg)) {
+    // Skip next argument.
+    if (!isFlagOnly(arg) && !/^-/.test(next)) {
+      i++
+    }
+
+    continue
+  }
+
+  stop = i
+  break
+}
+
+const argv = minimist<Argv>(process.argv.slice(2, stop), {
+  string: strings,
+  boolean: booleans,
+  alias: aliases,
+  default: {
+    cache: null,
+    typeCheck: null
+  }
+})
+
+if (argv.help) {
+  console.log(`
+Usage: ts-node [options] [ -e script | script.ts ] [arguments]
+
+Options:
+
+  -e, --eval [code]              Evaluate code
+  -p, --print [code]             Evaluate code and print result
+  -r, --require [path]           Require a node module for execution
+  -C, --compiler [name]          Specify a custom TypeScript compiler
+  -I, --ignoreWarnings [code]    Ignore TypeScript warnings by diagnostic code
+  -P, --project [path]           Path to TypeScript project (or \`false\`)
+  -O, --compilerOptions [opts]   JSON object to merge with compiler options
+  -F, --fast                     Run TypeScript compilation in transpile mode
+  --ignore [regexp], --no-ignore Set the ignore check (default: \`/node_modules/\`)
+  --no-cache                     Disable the TypeScript cache
+  --cache-directory              Configure the TypeScript cache directory
+`)
+
+  process.exit(0)
+}
+
+const cwd = process.cwd()
+const code = argv.eval === undefined ? argv.print : argv.eval
+const isEvalScript = typeof argv.eval === 'string' || !!argv.print // Minimist struggles with empty strings.
+const isEval = isEvalScript || stop === process.argv.length
+const isPrinted = argv.print !== undefined
+
+// Register the TypeScript compiler instance.
+const service = register({
+  typeCheck: argv.typeCheck,
+  cache: argv.cache,
+  cacheDirectory: argv.cacheDirectory,
+  compiler: argv.compiler,
+  project: argv.project,
+  ignore: argv.ignore,
+  ignoreWarnings: argv.ignoreWarnings,
+  compilerOptions: parse(argv.compilerOptions),
+  getFile: isEval ? getFileEval : getFile,
+  fileExists: isEval ? fileExistsEval : fileExists
+})
+
+// Output project information.
+if (argv.version) {
+  console.log(`ts-node v${VERSION}`)
+  console.log(`node ${process.version}`)
+  console.log(`typescript v${service.ts.version}`)
+  console.log(`cache ${JSON.stringify(service.cachedir)}`)
+  process.exit(0)
+}
+
+// Require specified modules before start-up.
+(Module as any)._preloadModules(arrify(argv.require))
+
+/**
+ * Eval helpers.
+ */
+const EVAL_FILENAME = `[eval].ts`
+const EVAL_PATH = join(cwd, EVAL_FILENAME)
+const EVAL_INSTANCE = { input: '', output: '', version: 0, lines: 0 }
+
+// Execute the main contents (either eval, script or piped).
+if (isEvalScript) {
+  evalAndExit(code as string, isPrinted)
+} else {
+  if (stop < process.argv.length) {
+    const args = process.argv.slice(stop)
+    args[0] = resolve(cwd, args[0])
+    process.argv = ['node'].concat(args)
+    process.execArgv.unshift(__filename)
+    Module.runMain()
+  } else {
+    // Piping of execution _only_ occurs when no other script is specified.
+    if ((process.stdin as any).isTTY) {
+      startRepl()
+    } else {
+      let code = ''
+      process.stdin.on('data', (chunk: Buffer) => code += chunk)
+      process.stdin.on('end', () => evalAndExit(code, isPrinted))
+    }
+  }
+}
+
+/**
+ * Evaluate a script.
+ */
+function evalAndExit (code: string, isPrinted: boolean) {
+  const module = new Module(EVAL_FILENAME)
+  module.filename = EVAL_FILENAME
+  module.paths = (Module as any)._nodeModulePaths(cwd)
+
+  ;(global as any).__filename = EVAL_FILENAME
+  ;(global as any).__dirname = cwd
+  ;(global as any).exports = module.exports
+  ;(global as any).module = module
+  ;(global as any).require = module.require.bind(module)
+
+  let result: any
+
+  try {
+    result = _eval(code, global)
+  } catch (error) {
+    if (error instanceof TSError) {
+      console.error(printError(error))
+      process.exit(1)
+    }
+
+    throw error
+  }
+
+  if (isPrinted) {
+    console.log(typeof result === 'string' ? result : inspect(result))
+  }
+}
+
+/**
+ * Evaluate the code snippet.
+ */
+function _eval (input: string, context: any) {
+  const lines = EVAL_INSTANCE.lines
+  const isCompletion = !/\n$/.test(input)
+  const undo = appendEval(input)
+  let output: string
+
+  try {
+    output = service.compile(EVAL_INSTANCE.input, EVAL_PATH, -lines)
+  } catch (err) {
+    undo()
+
+    throw err
+  }
+
+  // Use `diff` to check for new JavaScript to execute.
+  const changes = diffLines(EVAL_INSTANCE.output, output)
+
+  if (isCompletion) {
+    undo()
+  } else {
+    EVAL_INSTANCE.output = output
+  }
+
+  return changes.reduce((result, change) => {
+    return change.added ? exec(change.value, EVAL_FILENAME, context) : result
+  }, undefined)
+}
+
+/**
+ * Execute some code.
+ */
+function exec (code: string, filename: string, context: any) {
+  const script = new Script(code, { filename: filename })
+
+  return script.runInNewContext(context)
+}
+
+/**
+ * Start a CLI REPL.
+ */
+function startRepl () {
+  const repl = start({
+    prompt: '> ',
+    input: process.stdin,
+    output: process.stdout,
+    eval: replEval,
+    useGlobal: false
+  })
+
+  // Bookmark the point where we should reset the REPL state.
+  const resetEval = appendEval('')
+
+  function reset () {
+    resetEval()
+
+    // Hard fix for TypeScript forcing `Object.defineProperty(exports, ...)`.
+    exec('exports = module.exports', EVAL_FILENAME, (repl as any).context)
+  }
+
+  reset()
+  repl.on('reset', reset)
+
+  repl.defineCommand('type', {
+    help: 'Check the type of a TypeScript identifier',
+    action: function (identifier: string) {
+      if (!identifier) {
+        repl.displayPrompt()
+        return
+      }
+
+      const undo = appendEval(identifier)
+      const { name, comment } = service.getTypeInfo(EVAL_INSTANCE.input, EVAL_PATH, EVAL_INSTANCE.input.length)
+
+      undo()
+
+      repl.outputStream.write(`${chalk.bold(name)}\n${comment ? `${comment}\n` : ''}`)
+      repl.displayPrompt()
+    }
+  })
+}
+
+/**
+ * Eval code from the REPL.
+ */
+function replEval (code: string, context: any, _filename: string, callback: (err?: Error, result?: any) => any) {
+  let err: any
+  let result: any
+
+  // TODO: Figure out how to handle completion here.
+  if (code === '.scope') {
+    callback()
+    return
+  }
+
+  try {
+    result = _eval(code, context)
+  } catch (error) {
+    if (error instanceof TSError) {
+      // Support recoverable compilations using >= node 6.
+      if (Recoverable && isRecoverable(error)) {
+        err = new Recoverable(error)
+      } else {
+        err = printError(error)
+      }
+    } else {
+      err = error
+    }
+  }
+
+  callback(err, result)
+}
+
+/**
+ * Append to the eval instance and return an undo function.
+ */
+function appendEval (input: string) {
+  const undoInput = EVAL_INSTANCE.input
+  const undoVersion = EVAL_INSTANCE.version
+  const undoOutput = EVAL_INSTANCE.output
+  const undoLines = EVAL_INSTANCE.lines
+
+  // Handle ASI issues with TypeScript re-evaluation.
+  if (undoInput.charAt(undoInput.length - 1) === '\n' && /^\s*[\[\(\`]/.test(input) && !/;\s*$/.test(undoInput)) {
+    EVAL_INSTANCE.input = `${EVAL_INSTANCE.input.slice(0, -1)};\n`
+  }
+
+  EVAL_INSTANCE.input += input
+  EVAL_INSTANCE.lines += lineCount(input)
+  EVAL_INSTANCE.version++
+
+  return function () {
+    EVAL_INSTANCE.input = undoInput
+    EVAL_INSTANCE.output = undoOutput
+    EVAL_INSTANCE.version = undoVersion
+    EVAL_INSTANCE.lines = undoLines
+  }
+}
+
+/**
+ * Count the number of lines.
+ */
+function lineCount (value: string) {
+  let count = 0
+
+  for (const char of value) {
+    if (char === '\n') {
+      count++
+    }
+  }
+
+  return count
+}
+
+/**
+ * Get the file text, checking for eval first.
+ */
+function getFileEval (path: string) {
+  return path === EVAL_PATH ? EVAL_INSTANCE.input : getFile(path)
+}
+
+/**
+ * Get whether the file exists.
+ */
+function fileExistsEval (path: string) {
+  return path === EVAL_PATH || fileExists(path)
+}
+
+const RECOVERY_CODES: number[] = [
+  1003, // "Identifier expected."
+  1005, // "')' expected."
+  1109, // "Expression expected."
+  1126, // "Unexpected end of text."
+  1160, // "Unterminated template literal."
+  1161 // "Unterminated regular expression literal."
+]
+
+/**
+ * Check if a function can recover gracefully.
+ */
+function isRecoverable (error: TSError) {
+  return error.diagnostics.every(x => RECOVERY_CODES.indexOf(x.code) > -1)
+}
diff --git a/src/bin.ts b/src/bin.ts
index 03d793b..68e26fc 100644
--- a/src/bin.ts
+++ b/src/bin.ts
@@ -1,380 +1,89 @@
 #!/usr/bin/env node
 
-import { join, resolve } from 'path'
-import { start, Recoverable } from 'repl'
-import { inspect } from 'util'
-import arrify = require('arrify')
-import Module = require('module')
-import minimist = require('minimist')
-import chalk from 'chalk'
-import { diffLines } from 'diff'
-import { Script } from 'vm'
-import { readFileSync, statSync } from 'fs'
-import { register, VERSION, DEFAULTS, TSError, parse, printError } from './index'
+import { spawn } from 'child_process'
+import { join } from 'path'
+import v8flags = require('v8flags')
 
-interface Argv {
-  // Node.js-like options.
-  eval?: string
-  print?: string
-  require?: string | string[]
-  // CLI options.
-  help?: boolean
-  version?: boolean
-  // Register options.
-  typeCheck?: boolean
-  cache?: boolean
-  cacheDirectory?: string
-  compiler?: string
-  ignore?: string | string[]
-  project?: string
-  skipIgnore?: boolean
-  skipProject?: boolean
-  ignoreDiagnostics?: string | string[]
-  compilerOptions?: string
-  _: string[]
-}
+const argv = process.argv.slice(2)
+const signals: NodeJS.Signals[] = ['SIGINT', 'SIGTERM', 'SIGWINCH']
 
-const argv = minimist<Argv>(process.argv.slice(2), {
-  stopEarly: true,
-  string: ['eval', 'print', 'compiler', 'project', 'ignoreDiagnostics', 'require', 'cacheDirectory', 'ignore'],
-  boolean: ['help', 'typeCheck', 'version', 'cache', 'skipProject', 'skipIgnore'],
-  alias: {
-    eval: ['e'],
-    print: ['p'],
-    require: ['r'],
-    help: ['h'],
-    version: ['v'],
-    typeCheck: ['type-check'],
-    cacheDirectory: ['cache-directory'],
-    ignore: ['I'],
-    project: ['P'],
-    skipIgnore: ['skip-ignore'],
-    skipProject: ['skip-project'],
-    compiler: ['C'],
-    ignoreDiagnostics: ['D', 'ignore-diagnostics'],
-    compilerOptions: ['O', 'compiler-options']
-  },
-  default: {
-    cache: DEFAULTS.cache,
-    typeCheck: DEFAULTS.typeCheck,
-    skipIgnore: DEFAULTS.skipIgnore,
-    skipProject: DEFAULTS.skipProject
+v8flags(function (err, v8flags) {
+  if (err) {
+    console.error(err.stack)
+    process.exit(1)
+    return
   }
-})
-
-if (argv.help) {
-  console.log(`
-Usage: ts-node [options] [ -e script | script.ts ] [arguments]
-
-Options:
-
-  -e, --eval [code]              Evaluate code
-  -p, --print [code]             Evaluate code and print result
-  -r, --require [path]           Require a node module before execution
-
-  -h, --help                     Print CLI usage
-  -v, --version                  Print module version information
-
-  --type-check                   Enable type checking through CLI
-  --cache-directory              Configure the output file cache directory
-  -I, --ignore [pattern]         Override the path patterns to skip compilation
-  -P, --project [path]           Path to TypeScript JSON project file
-  -C, --compiler [name]          Specify a custom TypeScript compiler
-  -D, --ignoreDiagnostics [code] Ignore TypeScript warnings by diagnostic code
-  -O, --compilerOptions [opts]   JSON object to merge with compiler options
-
-  --no-cache                     Disable the local TypeScript Node cache
-  --skip-project                 Skip project config resolution and loading
-  --skip-ignore                  Skip ignore checks
-`)
-
-  process.exit(0)
-}
 
-const cwd = process.cwd()
-const code = argv.eval === undefined ? argv.print : argv.eval
-const isEval = typeof argv.eval === 'string' || !!argv.print // Minimist struggles with empty strings.
-const isPrinted = argv.print !== undefined
-
-// Register the TypeScript compiler instance.
-const service = register({
-  typeCheck: argv.typeCheck,
-  cache: argv.cache,
-  cacheDirectory: argv.cacheDirectory,
-  ignore: argv.ignore,
-  project: argv.project,
-  skipIgnore: argv.skipIgnore,
-  skipProject: argv.skipProject,
-  compiler: argv.compiler,
-  ignoreDiagnostics: argv.ignoreDiagnostics,
-  compilerOptions: parse(argv.compilerOptions),
-  readFile: isEval ? readFileEval : undefined,
-  fileExists: isEval ? fileExistsEval : undefined
-})
-
-// Output project information.
-if (argv.version) {
-  console.log(`ts-node v${VERSION}`)
-  console.log(`node ${process.version}`)
-  console.log(`typescript v${service.ts.version}`)
-  console.log(`cache ${JSON.stringify(service.cachedir)}`)
-  process.exit(0)
-}
-
-// Require specified modules before start-up.
-(Module as any)._preloadModules(arrify(argv.require))
-
-/**
- * Eval helpers.
- */
-const EVAL_FILENAME = `[eval].ts`
-const EVAL_PATH = join(cwd, EVAL_FILENAME)
-const EVAL_INSTANCE = { input: '', output: '', version: 0, lines: 0 }
-
-// Execute the main contents (either eval, script or piped).
-if (isEval) {
-  evalAndExit(code as string, isPrinted)
-} else {
-  if (argv._.length) {
-    process.argv = ['node'].concat(resolve(cwd, argv._[0])).concat(argv._.slice(1))
-    process.execArgv.unshift(__filename)
-    Module.runMain()
-  } else {
-    // Piping of execution _only_ occurs when no other script is specified.
-    if ((process.stdin as any).isTTY) {
-      startRepl()
+  const nodeArgs: string[] = []
+  const scriptArgs: string[] = []
+
+  const knownFlags = v8flags.concat([
+    'debug',
+    'inspect',
+    '--debug',
+    '--debug-brk',
+    '--inspect',
+    '--inspect-brk',
+    '--nolazy',
+    '--no-deprecation',
+    '--log-timer-events',
+    '--throw-deprecation',
+    '--trace-deprecation',
+    '--allow-natives-syntax',
+    '--perf-basic-prof',
+    '--preserve-symlinks',
+    '--expose-gc',
+    '--expose-http2',
+    '--trace-warnings'
+  ])
+
+  for (let i = 0; i < argv.length; i++) {
+    const arg = argv[i]
+    const flag = arg.split('=', 1)[0]
+
+    if (knownFlags.indexOf(flag) > -1) {
+      nodeArgs.push(arg)
+    } else if (/^-/.test(flag)) {
+      scriptArgs.push(arg)
     } else {
-      let code = ''
-      process.stdin.on('data', (chunk: Buffer) => code += chunk)
-      process.stdin.on('end', () => evalAndExit(code, isPrinted))
-    }
-  }
-}
-
-/**
- * Evaluate a script.
- */
-function evalAndExit (code: string, isPrinted: boolean) {
-  const module = new Module(EVAL_FILENAME)
-  module.filename = EVAL_FILENAME
-  module.paths = (Module as any)._nodeModulePaths(cwd)
-
-  ;(global as any).__filename = EVAL_FILENAME
-  ;(global as any).__dirname = cwd
-  ;(global as any).exports = module.exports
-  ;(global as any).module = module
-  ;(global as any).require = module.require.bind(module)
-
-  let result: any
-
-  try {
-    result = _eval(code, global)
-  } catch (error) {
-    if (error instanceof TSError) {
-      console.error(printError(error))
-      process.exit(1)
+      // Break when we encounter a "script".
+      scriptArgs.push(...argv.slice(i))
+      break
     }
-
-    throw error
-  }
-
-  if (isPrinted) {
-    console.log(typeof result === 'string' ? result : inspect(result))
-  }
-}
-
-/**
- * Evaluate the code snippet.
- */
-function _eval (input: string, context: any) {
-  const lines = EVAL_INSTANCE.lines
-  const isCompletion = !/\n$/.test(input)
-  const undo = appendEval(input)
-  let output: string
-
-  try {
-    output = service.compile(EVAL_INSTANCE.input, EVAL_PATH, -lines)
-  } catch (err) {
-    undo()
-    throw err
-  }
-
-  // Use `diff` to check for new JavaScript to execute.
-  const changes = diffLines(EVAL_INSTANCE.output, output)
-
-  if (isCompletion) {
-    undo()
-  } else {
-    EVAL_INSTANCE.output = output
-  }
-
-  return changes.reduce((result, change) => {
-    return change.added ? exec(change.value, EVAL_FILENAME, context) : result
-  }, undefined)
-}
-
-/**
- * Execute some code.
- */
-function exec (code: string, filename: string, context: any) {
-  const script = new Script(code, { filename: filename })
-
-  return script.runInNewContext(context)
-}
-
-/**
- * Start a CLI REPL.
- */
-function startRepl () {
-  const repl = start({
-    prompt: '> ',
-    input: process.stdin,
-    output: process.stdout,
-    eval: replEval,
-    useGlobal: false
-  })
-
-  // Bookmark the point where we should reset the REPL state.
-  const resetEval = appendEval('')
-
-  function reset () {
-    resetEval()
-
-    // Hard fix for TypeScript forcing `Object.defineProperty(exports, ...)`.
-    exec('exports = module.exports', EVAL_FILENAME, (repl as any).context)
   }
 
-  reset()
-  repl.on('reset', reset)
-
-  repl.defineCommand('type', {
-    help: 'Check the type of a TypeScript identifier',
-    action: function (identifier: string) {
-      if (!identifier) {
-        repl.displayPrompt()
-        return
-      }
-
-      const undo = appendEval(identifier)
-      const { name, comment } = service.getTypeInfo(EVAL_INSTANCE.input, EVAL_PATH, EVAL_INSTANCE.input.length)
-
-      undo()
-
-      repl.outputStream.write(`${chalk.bold(name)}\n${comment ? `${comment}\n` : ''}`)
-      repl.displayPrompt()
+  const proc = spawn(
+    process.execPath,
+    nodeArgs.concat(join(__dirname, '_bin.js'), scriptArgs),
+    {
+      // We need to run in detached mode so to avoid
+      // automatic propagation of signals to the child process.
+      // This is necessary because by default, keyboard interrupts
+      // are propagated to the process tree, but `kill` is not.
+      //
+      // See: https://nodejs.org/api/child_process.html#child_process_options_detached
+      //
+      // This fix is not being required on Windows; besides, detached mode
+      // runs differently on Windows than on other platforms, and it would break
+      // the behavior of this application. See https://github.com/TypeStrong/ts-node/issues/480
+      // for more details.
+      detached: process.platform !== 'win32',
+      stdio: 'inherit'
     }
-  })
-}
-
-/**
- * Eval code from the REPL.
- */
-function replEval (code: string, context: any, _filename: string, callback: (err?: Error, result?: any) => any) {
-  let err: any
-  let result: any
+  )
 
-  // TODO: Figure out how to handle completion here.
-  if (code === '.scope') {
-    callback()
-    return
-  }
+  // Ignore signals, and instead forward them to the child process.
+  signals.forEach(signal => process.on(signal, () => proc.kill(signal)))
 
-  try {
-    result = _eval(code, context)
-  } catch (error) {
-    if (error instanceof TSError) {
-      // Support recoverable compilations using >= node 6.
-      if (Recoverable && isRecoverable(error)) {
-        err = new Recoverable(error)
-      } else {
-        err = printError(error)
-      }
+  // On spawned close, exit this process with the same code.
+  proc.on('close', (code: number, signal: string) => {
+    if (signal) {
+      process.kill(process.pid, signal)
     } else {
-      err = error
-    }
-  }
-
-  callback(err, result)
-}
-
-/**
- * Append to the eval instance and return an undo function.
- */
-function appendEval (input: string) {
-  const undoInput = EVAL_INSTANCE.input
-  const undoVersion = EVAL_INSTANCE.version
-  const undoOutput = EVAL_INSTANCE.output
-  const undoLines = EVAL_INSTANCE.lines
-
-  // Handle ASI issues with TypeScript re-evaluation.
-  if (undoInput.charAt(undoInput.length - 1) === '\n' && /^\s*[\[\(\`]/.test(input) && !/;\s*$/.test(undoInput)) {
-    EVAL_INSTANCE.input = `${EVAL_INSTANCE.input.slice(0, -1)};\n`
-  }
-
-  EVAL_INSTANCE.input += input
-  EVAL_INSTANCE.lines += lineCount(input)
-  EVAL_INSTANCE.version++
-
-  return function () {
-    EVAL_INSTANCE.input = undoInput
-    EVAL_INSTANCE.output = undoOutput
-    EVAL_INSTANCE.version = undoVersion
-    EVAL_INSTANCE.lines = undoLines
-  }
-}
-
-/**
- * Count the number of lines.
- */
-function lineCount (value: string) {
-  let count = 0
-
-  for (const char of value) {
-    if (char === '\n') {
-      count++
+      process.exit(code)
     }
-  }
-
-  return count
-}
-
-/**
- * Get the file text, checking for eval first.
- */
-function readFileEval (path: string) {
-  if (path === EVAL_PATH) return EVAL_INSTANCE.input
-
-  try {
-    return readFileSync(path, 'utf8')
-  } catch (err) {/* Ignore. */}
-}
-
-/**
- * Get whether the file exists.
- */
-function fileExistsEval (path: string) {
-  if (path === EVAL_PATH) return true
-
-  try {
-    const stats = statSync(path)
-    return stats.isFile() || stats.isFIFO()
-  } catch (err) {
-    return false
-  }
-}
-
-const RECOVERY_CODES: number[] = [
-  1003, // "Identifier expected."
-  1005, // "')' expected."
-  1109, // "Expression expected."
-  1126, // "Unexpected end of text."
-  1160, // "Unterminated template literal."
-  1161 // "Unterminated regular expression literal."
-]
+  })
 
-/**
- * Check if a function can recover gracefully.
- */
-function isRecoverable (error: TSError) {
-  return error.diagnostics.every(x => RECOVERY_CODES.indexOf(x.code) > -1)
-}
+  // If this process exits, kill the child first.
+  process.on('exit', () => proc.kill())
+})
diff --git a/src/index.spec.ts b/src/index.spec.ts
index 2b3c208..567e84d 100644
--- a/src/index.spec.ts
+++ b/src/index.spec.ts
@@ -1,5 +1,5 @@
 import { expect } from 'chai'
-import { exec } from 'child_process'
+import { exec, spawn } from 'child_process'
 import { join } from 'path'
 import semver = require('semver')
 import ts = require('typescript')
@@ -8,7 +8,7 @@ import { register, VERSION } from './index'
 
 const testDir = join(__dirname, '../tests')
 const EXEC_PATH = join(__dirname, '../dist/bin')
-const BIN_EXEC = `node "${EXEC_PATH}" --project "${testDir}/tsconfig.json"`
+const BIN_EXEC = `node "${EXEC_PATH}" --project "${testDir}"`
 
 const SOURCE_MAP_REGEXP = /\/\/# sourceMappingURL=data:application\/json;charset=utf\-8;base64,[\w\+]+=*$/
 
@@ -22,6 +22,41 @@ describe('ts-node', function () {
   describe('cli', function () {
     this.slow(1000)
 
+    it('should forward signals to the child process', function (done) {
+      this.slow(5000)
+
+      // We use `spawn` instead because apparently TravisCI
+      // does not let subprocesses be killed when ran under `sh`
+      //
+      // See: https://github.com/travis-ci/travis-ci/issues/704#issuecomment-328278149
+      const proc = spawn('node', [
+        EXEC_PATH,
+        '--project',
+        testDir,
+        'tests/signals'
+      ], {
+        shell: '/bin/bash'
+      })
+
+      let stdout = ''
+      proc.stdout.on('data', (data) => stdout += data.toString())
+
+      let stderr = ''
+      proc.stderr.on('data', (data) => stderr += data.toString())
+
+      proc.on('exit', function (code) {
+        expect(stderr).to.equal('')
+        expect(stdout).to.equal('exited fine')
+        expect(code).to.equal(0)
+
+        return done()
+      })
+
+      // Leave enough time for node to fully start
+      // the process, then send a signal
+      setTimeout(() => proc.kill('SIGINT'), 2000)
+    })
+
     it('should execute cli', function (done) {
       exec(`${BIN_EXEC} tests/hello-world`, function (err, stdout) {
         expect(err).to.equal(null)
@@ -107,7 +142,7 @@ describe('ts-node', function () {
     })
 
     it('should throw errors', function (done) {
-      exec(`${BIN_EXEC} --typeCheck -e "import * as m from './tests/module';console.log(m.example(123))"`, function (err) {
+      exec(`${BIN_EXEC} --type-check -e "import * as m from './tests/module';console.log(m.example(123))"`, function (err) {
         if (err === null) {
           return done('Command was expected to fail, but it succeeded.')
         }
@@ -122,9 +157,9 @@ describe('ts-node', function () {
       })
     })
 
-    it('should be able to ignore diagnostic', function (done) {
+    it('should be able to ignore errors', function (done) {
       exec(
-        `${BIN_EXEC} --type-check --ignoreDiagnostics 2345 -e "import * as m from './tests/module';console.log(m.example(123))"`,
+        `${BIN_EXEC} --type-check --ignoreWarnings 2345 -e "import * as m from './tests/module';console.log(m.example(123))"`,
         function (err) {
           if (err === null) {
             return done('Command was expected to fail, but it succeeded.')
@@ -247,7 +282,7 @@ describe('ts-node', function () {
 
   describe('register', function () {
     register({
-      project: join(testDir, 'tsconfig.json'),
+      project: testDir,
       compilerOptions: {
         jsx: 'preserve'
       }
diff --git a/src/index.ts b/src/index.ts
index 92cb253..b8d2fe8 100644
--- a/src/index.ts
+++ b/src/index.ts
@@ -1,5 +1,5 @@
 import { relative, basename, extname, resolve, dirname, join } from 'path'
-import { readFileSync, writeFileSync } from 'fs'
+import { writeFileSync, readFileSync, statSync } from 'fs'
 import { EOL, tmpdir, homedir } from 'os'
 import sourceMapSupport = require('source-map-support')
 import chalk from 'chalk'
@@ -9,6 +9,7 @@ import yn = require('yn')
 import arrify = require('arrify')
 import { BaseError } from 'make-error'
 import * as TS from 'typescript'
+import { loadSync } from 'tsconfig'
 
 const pkg = require('../package.json')
 const shouldDebug = yn(process.env.TS_NODE_DEBUG)
@@ -40,6 +41,9 @@ export interface TSCommon {
   findConfigFile: typeof TS.findConfigFile
   readConfigFile: typeof TS.readConfigFile
   parseJsonConfigFileContent: typeof TS.parseJsonConfigFileContent
+
+  // TypeScript 1.5 and 1.6.
+  parseConfigFile? (json: any, host: any, basePath: string): any
 }
 
 /**
@@ -51,25 +55,23 @@ export const VERSION = pkg.version
  * Registration options.
  */
 export interface Options {
-  typeCheck?: boolean | null
-  cache?: boolean | null
+  typeCheck?: boolean
+  cache?: boolean
   cacheDirectory?: string
   compiler?: string
-  ignore?: string | string[]
-  project?: string
-  skipIgnore?: boolean | null
-  skipProject?: boolean | null
-  compilerOptions?: object
-  ignoreDiagnostics?: number | string | Array<number | string>
-  readFile?: (path: string) => string | undefined
+  project?: boolean | string
+  ignore?: boolean | string | string[]
+  ignoreWarnings?: number | string | Array<number | string>
+  getFile?: (path: string) => string
   fileExists?: (path: string) => boolean
+  compilerOptions?: any
   transformers?: TS.CustomTransformers
 }
 
 /**
  * Track the project information.
  */
-interface MemoryCache {
+interface Cache {
   contents: { [path: string]: string }
   versions: { [path: string]: number | undefined }
   outputs: { [path: string]: string }
@@ -86,43 +88,31 @@ export interface TypeInfo {
 /**
  * Default register options.
  */
-export const DEFAULTS: Options = {
+const DEFAULTS = {
+  getFile,
+  fileExists,
   cache: yn(process.env['TS_NODE_CACHE'], { default: true }),
   cacheDirectory: process.env['TS_NODE_CACHE_DIRECTORY'],
   compiler: process.env['TS_NODE_COMPILER'],
   compilerOptions: parse(process.env['TS_NODE_COMPILER_OPTIONS']),
-  ignore: split(process.env['TS_NODE_IGNORE']),
   project: process.env['TS_NODE_PROJECT'],
-  skipIgnore: yn(process.env['TS_NODE_SKIP_IGNORE']),
-  skipProject: yn(process.env['TS_NODE_SKIP_PROJECT']),
-  ignoreDiagnostics: split(process.env['TS_NODE_IGNORE_DIAGNOSTICS']),
+  ignore: split(process.env['TS_NODE_IGNORE']),
+  ignoreWarnings: split(process.env['TS_NODE_IGNORE_WARNINGS']),
   typeCheck: yn(process.env['TS_NODE_TYPE_CHECK'])
 }
 
-/**
- * Default TypeScript compiler options required by `ts-node`.
- */
-const DEFAULT_COMPILER_OPTIONS = {
-  sourceMap: true,
-  inlineSourceMap: false,
-  inlineSources: true,
-  declaration: false,
-  noEmit: false,
-  outDir: '$$ts-node$$'
-}
-
 /**
  * Split a string array of values.
  */
 export function split (value: string | undefined) {
-  return typeof value === 'string' ? value.split(/ *, */g) : undefined
+  return value ? value.split(/ *, */g) : undefined
 }
 
 /**
  * Parse a string as JSON.
  */
-export function parse (value: string | undefined): object | undefined {
-  return typeof value === 'string' ? JSON.parse(value) : undefined
+export function parse (value: string | undefined) {
+  return value ? JSON.parse(value) : undefined
 }
 
 /**
@@ -136,6 +126,7 @@ export function normalizeSlashes (value: string): string {
  * TypeScript diagnostics error.
  */
 export class TSError extends BaseError {
+
   name = 'TSError'
 
   constructor (public diagnostics: TSDiagnostic[]) {
@@ -143,6 +134,7 @@ export class TSError extends BaseError {
       ` Unable to compile TypeScript\n${diagnostics.map(x => x.message).join('\n')}`
     )
   }
+
 }
 
 /**
@@ -169,46 +161,54 @@ function getTmpDir (): string {
 /**
  * Register TypeScript compiler.
  */
-export function register (opts: Options = {}): Register {
+export function register (options: Options = {}): Register {
+  const compiler = options.compiler || 'typescript'
   const emptyFileListWarnings = [18002, 18003]
-  const options = Object.assign({}, DEFAULTS, opts)
-  const cacheDirectory = options.cacheDirectory || getTmpDir()
-  const ignoreDiagnostics = arrify(options.ignoreDiagnostics).concat(emptyFileListWarnings).map(Number)
+  const ignoreWarnings = arrify(
+    options.ignoreWarnings || DEFAULTS.ignoreWarnings || []
+  ).concat(emptyFileListWarnings).map(Number)
+  const getFile = options.getFile || DEFAULTS.getFile
+  const fileExists = options.fileExists || DEFAULTS.fileExists
+  const shouldCache = !!(options.cache === undefined ? DEFAULTS.cache : options.cache)
+  const typeCheck = !!(options.typeCheck === undefined ? DEFAULTS.typeCheck : options.typeCheck)
+  const project = options.project === undefined ? DEFAULTS.project : options.project
+  const cacheDirectory = options.cacheDirectory || DEFAULTS.cacheDirectory || getTmpDir()
+  const compilerOptions = Object.assign({}, DEFAULTS.compilerOptions, options.compilerOptions)
   const originalJsHandler = require.extensions['.js']
 
-  const memoryCache: MemoryCache = {
+  const cache: Cache = {
     contents: Object.create(null),
     versions: Object.create(null),
     outputs: Object.create(null)
   }
 
-  const ignore = options.skipIgnore ? [] : arrify(
-    options.ignore || '/node_modules/'
+  const ignore = arrify(
+    (
+      typeof options.ignore === 'boolean' ?
+        (options.ignore === false ? [] : undefined) :
+        (options.ignore || DEFAULTS.ignore)
+    ) ||
+    ['/node_modules/']
   ).map(str => new RegExp(str))
 
-  // Install source map support and read from memory cache.
+  // Install source map support and read from cache.
   sourceMapSupport.install({
     environment: 'node',
     retrieveFile (path: string) {
-      return memoryCache.outputs[path]
+      return cache.outputs[path]
     }
   })
 
   // Require the TypeScript compiler and configuration.
   const cwd = process.cwd()
-  const compiler = options.compiler || 'typescript'
-  const typeCheck = options.typeCheck || false
   const ts: typeof TS = require(compiler)
-  const transformers = options.transformers || undefined
-  const readFile = options.readFile || ts.sys.readFile
-  const fileExists = options.fileExists || ts.sys.fileExists
-  const config = readConfig(cwd, ts, options.compilerOptions, fileExists, readFile, options.project, options.skipProject)
-  const configDiagnostics = filterDiagnostics(config.errors, ignoreDiagnostics)
+  const config = readConfig(compilerOptions, project, cwd, ts)
+  const configDiagnostics = filterDiagnostics(config.errors, ignoreWarnings)
   const extensions = ['.ts', '.tsx']
 
   const cachedir = join(
     resolve(cwd, cacheDirectory),
-    getCompilerDigest({ version: ts.version, typeCheck, ignoreDiagnostics, config, compiler })
+    getCompilerDigest({ version: ts.version, typeCheck, ignoreWarnings, config, compiler })
   )
 
   // Render the configuration errors and exit the script.
@@ -224,15 +224,21 @@ export function register (opts: Options = {}): Register {
 
   // Add all files into the file hash.
   for (const fileName of config.fileNames) {
-    memoryCache.versions[fileName] = 1
+    cache.versions[fileName] = 1
   }
 
   /**
    * Get the extension for a transpiled file.
    */
-  const getExtension = config.options.jsx === ts.JsxEmit.Preserve ?
-    ((path: string) => /\.[tj]sx$/.test(path) ? '.jsx' : '.js') :
-    ((_: string) => '.js')
+  function getExtension (fileName: string) {
+    const ext = extname(fileName)
+
+    if (config.options.jsx === ts.JsxEmit.Preserve && (ext === '.tsx' || ext === '.jsx')) {
+      return '.jsx'
+    }
+
+    return '.js'
+  }
 
   /**
    * Create the basic required function using transpile mode.
@@ -240,13 +246,13 @@ export function register (opts: Options = {}): Register {
   let getOutput = function (code: string, fileName: string, lineOffset = 0): SourceOutput {
     const result = ts.transpileModule(code, {
       fileName,
-      transformers,
       compilerOptions: config.options,
-      reportDiagnostics: true
+      reportDiagnostics: true,
+      transformers: options.transformers
     })
 
     const diagnosticList = result.diagnostics ?
-      filterDiagnostics(result.diagnostics, ignoreDiagnostics) :
+      filterDiagnostics(result.diagnostics, ignoreWarnings) :
       []
 
     if (diagnosticList.length) {
@@ -256,6 +262,15 @@ export function register (opts: Options = {}): Register {
     return [result.outputText, result.sourceMapText as string]
   }
 
+  let compile = readThrough(
+    cachedir,
+    shouldCache,
+    getFile,
+    cache,
+    getOutput,
+    getExtension
+  )
+
   let getTypeInfo = function (_code: string, _fileName: string, _position: number): TypeInfo {
     throw new TypeError(`Type information is unavailable without "--type-check"`)
   }
@@ -263,18 +278,18 @@ export function register (opts: Options = {}): Register {
   // Use full language services when the fast option is disabled.
   if (typeCheck) {
     // Set the file contents into cache.
-    const updateMemoryCache = function (code: string, fileName: string) {
-      if (memoryCache.contents[fileName] !== code) {
-        memoryCache.contents[fileName] = code
-        memoryCache.versions[fileName] = (memoryCache.versions[fileName] || 0) + 1
+    const setCache = function (code: string, fileName: string) {
+      if (cache.contents[fileName] !== code) {
+        cache.contents[fileName] = code
+        cache.versions[fileName] = (cache.versions[fileName] || 0) + 1
       }
     }
 
     // Create the compiler host for type checking.
     const serviceHost = {
-      getScriptFileNames: () => Object.keys(memoryCache.versions),
+      getScriptFileNames: () => Object.keys(cache.versions),
       getScriptVersion: (fileName: string) => {
-        const version = memoryCache.versions[fileName]
+        const version = cache.versions[fileName]
 
         // We need to return `undefined` and not a string here because TypeScript will use
         // `getScriptVersion` and compare against their own version - which can be `undefined`.
@@ -284,16 +299,18 @@ export function register (opts: Options = {}): Register {
         return version === undefined ? undefined as any as string : String(version)
       },
       getScriptSnapshot (fileName: string) {
-        if (!memoryCache.contents[fileName]) {
-          const contents = readFile(fileName)
-          if (!contents) return
-          memoryCache.contents[fileName] = contents
+        if (!cache.contents[fileName]) {
+          if (!fileExists(fileName)) {
+            return undefined
+          }
+
+          cache.contents[fileName] = getFile(fileName)
         }
 
-        return ts.ScriptSnapshot.fromString(memoryCache.contents[fileName])
+        return ts.ScriptSnapshot.fromString(cache.contents[fileName])
       },
       fileExists: debugFn('fileExists', fileExists),
-      readFile: debugFn('getFile', readFile),
+      readFile: debugFn('getFile', getFile),
       readDirectory: debugFn('readDirectory', ts.sys.readDirectory),
       getDirectories: debugFn('getDirectories', ts.sys.getDirectories),
       directoryExists: debugFn('directoryExists', ts.sys.directoryExists),
@@ -301,15 +318,12 @@ export function register (opts: Options = {}): Register {
       getCurrentDirectory: () => cwd,
       getCompilationSettings: () => config.options,
       getDefaultLibFileName: () => ts.getDefaultLibFilePath(config.options),
-      getCustomTransformers: () => transformers
+      getCustomTransformers: () => options.transformers
     }
 
     const service = ts.createLanguageService(serviceHost)
 
-    getOutput = function (code: string, fileName: string, lineOffset: number = 0) {
-      // Must set memory cache before attempting to read file.
-      updateMemoryCache(code, fileName)
-
+    getOutput = function (_code: string, fileName: string, lineOffset: number = 0) {
       const output = service.getEmitOutput(fileName)
 
       // Get the relevant diagnostics - this is 3x faster than `getPreEmitDiagnostics`.
@@ -317,7 +331,7 @@ export function register (opts: Options = {}): Register {
         .concat(service.getSyntacticDiagnostics(fileName))
         .concat(service.getSemanticDiagnostics(fileName))
 
-      const diagnosticList = filterDiagnostics(diagnostics, ignoreDiagnostics)
+      const diagnosticList = filterDiagnostics(diagnostics, ignoreWarnings)
 
       if (diagnosticList.length) {
         throw new TSError(formatDiagnostics(diagnosticList, cwd, ts, lineOffset))
@@ -341,8 +355,21 @@ export function register (opts: Options = {}): Register {
       return [output.outputFiles[1].text, output.outputFiles[0].text]
     }
 
+    compile = readThrough(
+      cachedir,
+      shouldCache,
+      getFile,
+      cache,
+      function (code: string, fileName: string, lineOffset?: number) {
+        setCache(code, fileName)
+
+        return getOutput(code, fileName, lineOffset)
+      },
+      getExtension
+    )
+
     getTypeInfo = function (code: string, fileName: string, position: number) {
-      updateMemoryCache(code, fileName)
+      setCache(code, fileName)
 
       const info = service.getQuickInfoAtPosition(fileName, position)
       const name = ts.displayPartsToString(info ? info.displayParts : [])
@@ -352,7 +379,6 @@ export function register (opts: Options = {}): Register {
     }
   }
 
-  const compile = readThrough(cachedir, options.cache === true, memoryCache, getOutput, getExtension)
   const register: Register = { cwd, compile, getTypeInfo, extensions, cachedir, ts }
 
   // Register the extensions.
@@ -401,9 +427,9 @@ function registerExtension (
 }
 
 /**
- * Do post-processing on config options to support `ts-node`.
+ * Do post-processing on config options to correct them.
  */
-function fixConfig (ts: TSCommon, config: any) {
+function fixConfig (config: any, ts: TSCommon) {
   // Delete options that *should not* be passed through.
   delete config.options.out
   delete config.options.outFile
@@ -425,39 +451,31 @@ function fixConfig (ts: TSCommon, config: any) {
 /**
  * Load TypeScript configuration.
  */
-function readConfig (
-  cwd: string,
-  ts: TSCommon,
-  compilerOptions: any,
-  fileExists: (path: string) => boolean,
-  readFile: (path: string) => string | undefined,
-  project?: string | null,
-  noProject?: boolean | null
-) {
-  let config = { compilerOptions: {} as any }
-  let basePath = cwd
-  let configFileName: string | undefined = undefined
-
-  // Read project configuration when available.
-  if (!noProject) {
-    configFileName = project ? resolve(cwd, project) : ts.findConfigFile(cwd, fileExists)
-
-    if (configFileName) {
-      const result = ts.readConfigFile(configFileName, readFile)
+function readConfig (compilerOptions: any, project: string | boolean | undefined, cwd: string, ts: TSCommon) {
+  const result = loadSync(cwd, typeof project === 'string' ? project : undefined)
+
+  // Override default configuration options.
+  result.config.compilerOptions = Object.assign({}, result.config.compilerOptions, compilerOptions, {
+    sourceMap: true,
+    inlineSourceMap: false,
+    inlineSources: true,
+    declaration: false,
+    noEmit: false,
+    outDir: '$$ts-node$$'
+  })
 
-      if (result.error) {
-        throw new TSError([formatDiagnostic(result.error, cwd, ts, 0)])
-      }
+  const configPath = result.path && normalizeSlashes(result.path)
+  const basePath = configPath ? dirname(configPath) : normalizeSlashes(cwd)
 
-      config = result.config
-      basePath = normalizeSlashes(dirname(configFileName))
-    }
+  if (typeof ts.parseConfigFile === 'function') {
+    return fixConfig(ts.parseConfigFile(result.config, ts.sys, basePath), ts)
   }
 
-  // Override default configuration options `ts-node` requires.
-  config.compilerOptions = Object.assign({}, config.compilerOptions, compilerOptions, DEFAULT_COMPILER_OPTIONS)
+  if (typeof ts.parseJsonConfigFileContent === 'function') {
+    return fixConfig(ts.parseJsonConfigFileContent(result.config, ts.sys, basePath, undefined, configPath), ts)
+  }
 
-  return fixConfig(ts, ts.parseJsonConfigFileContent(config, ts.sys, basePath, undefined, configFileName))
+  throw new TypeError('Could not find a compatible `parseConfigFile` function')
 }
 
 /**
@@ -471,7 +489,8 @@ type SourceOutput = [string, string]
 function readThrough (
   cachedir: string,
   shouldCache: boolean,
-  memoryCache: MemoryCache,
+  getFile: (fileName: string) => string,
+  cache: Cache,
   compile: (code: string, fileName: string, lineOffset?: number) => SourceOutput,
   getExtension: (fileName: string) => string
 ) {
@@ -482,7 +501,7 @@ function readThrough (
       const [value, sourceMap] = compile(code, fileName, lineOffset)
       const output = updateOutput(value, fileName, sourceMap, getExtension)
 
-      memoryCache.outputs[fileName] = output
+      cache.outputs[fileName] = output
 
       return output
     }
@@ -499,9 +518,9 @@ function readThrough (
     const outputPath = `${cachePath}${extension}`
 
     try {
-      const output = readFileSync(outputPath, 'utf8')
+      const output = getFile(outputPath)
       if (isValidCacheContent(output)) {
-        memoryCache.outputs[fileName] = output
+        cache.outputs[fileName] = output
         return output
       }
     } catch (err) {/* Ignore. */}
@@ -509,7 +528,7 @@ function readThrough (
     const [value, sourceMap] = compile(code, fileName, lineOffset)
     const output = updateOutput(value, fileName, sourceMap, getExtension)
 
-    memoryCache.outputs[fileName] = output
+    cache.outputs[fileName] = output
     writeFileSync(outputPath, output)
 
     return output
@@ -524,7 +543,7 @@ function updateOutput (outputText: string, fileName: string, sourceMap: string,
   const sourceMapContent = `data:application/json;charset=utf-8;base64,${base64Map}`
   const sourceMapLength = `${basename(fileName)}.map`.length + (getExtension(fileName).length - extname(fileName).length)
 
-  return outputText.slice(0, -sourceMapLength) + sourceMapContent
+  return outputText.slice(0, -1 * sourceMapLength) + sourceMapContent
 }
 
 /**
@@ -553,15 +572,35 @@ function getCacheName (sourceCode: string, fileName: string) {
  * Ensure the given cached content is valid by sniffing for a base64 encoded '}'
  * at the end of the content, which should exist if there is a valid sourceMap present.
  */
-function isValidCacheContent (contents: string) {
-  return /(?:9|0=|Q==)$/.test(contents.slice(-3))
+function isValidCacheContent (content: string) {
+  return /(?:9|0=|Q==)$/.test(content.slice(-3))
 }
 
 /**
  * Create a hash of the current configuration.
  */
-function getCompilerDigest (obj: object) {
-  return crypto.createHash('sha256').update(JSON.stringify(obj), 'utf8').digest('hex')
+function getCompilerDigest (opts: any) {
+  return crypto.createHash('sha256').update(JSON.stringify(opts), 'utf8').digest('hex')
+}
+
+/**
+ * Check if the file exists.
+ */
+export function fileExists (fileName: string): boolean {
+  try {
+    const stats = statSync(fileName)
+
+    return stats.isFile() || stats.isFIFO()
+  } catch (err) {
+    return false
+  }
+}
+
+/**
+ * Get the file from the file system.
+ */
+export function getFile (fileName: string): string {
+  return readFileSync(fileName, 'utf8')
 }
 
 /**
diff --git a/tests/tsconfig.json b/tests/tsconfig.json
index a0af3b3..986627d 100644
--- a/tests/tsconfig.json
+++ b/tests/tsconfig.json
@@ -1,6 +1,5 @@
 {
   "compilerOptions": {
-    "jsx": "react",
-    "noEmit": true
+    "jsx": "react"
   }
 }
diff --git a/typings.json b/typings.json
new file mode 100644
index 0000000..60a524a
--- /dev/null
+++ b/typings.json
@@ -0,0 +1,26 @@
+{
+  "dependencies": {
+    "arrify": "registry:npm/arrify#1.0.0+20160723033700",
+    "chalk": "registry:npm/chalk#1.0.0+20160211003958",
+    "diff": "registry:npm/diff#2.0.0+20160723033700",
+    "make-error": "registry:npm/make-error#1.0.0+20160211003958",
+    "minimist": "registry:npm/minimist#1.0.0+20160229232932",
+    "mkdirp": "registry:npm/mkdirp#0.5.0+20160222053049",
+    "proxyquire": "registry:npm/proxyquire#1.0.0+20160211003958",
+    "source-map-support": "registry:npm/source-map-support#0.3.0+20161006200546",
+    "tsconfig": "npm:tsconfig",
+    "v8flags": "registry:npm/v8flags#3.0.0+20161011212142",
+    "xtend": "registry:npm/xtend#4.0.0+20160211003958",
+    "yn": "registry:npm/yn#1.3.0+20170508185912"
+  },
+  "globalDependencies": {
+    "node": "registry:env/node#6.0.0+20170213133316"
+  },
+  "globalDevDependencies": {
+    "chai": "registry:dt/chai#3.4.0+20160216071402",
+    "mocha": "registry:dt/mocha#2.2.5+20161028141524"
+  },
+  "devDependencies": {
+    "semver": "registry:npm/semver#5.0.0+20160211003958"
+  }
+}
